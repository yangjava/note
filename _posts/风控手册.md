# 风控手册

###### 大数据风控需要哪些数据？

IP、GPS、设备ID、WIFI、时间（注册申请时间、申请信息填写时间等）、多头借贷信息（共享机制）、人脸识别技术（只认face++）、社交信息（关系链信息、腾讯）、电商信息（阿里系、京东、亚马逊等）、阅读类信息（今日头条、阅读类app等看阅读习惯、关注的内容等）、身份证认证（公安部）、银行卡要素认证、运营商数据（手机实名、通话记录、消费记录、上网记录、联系人、出没地点等）、银联画像（消费额度、消费地点、消费时间、消费场所等分析出客户是否结婚、是否有房贷、是否买车、消费能力、是否怀孕、是否有孩子等）、乘机信息（航空公司）、车管所信息、学籍信息、工商信息、税控信息（航天科工？）、涉诉信息（政府某网站）、被执行信息、企业商标专利/软件作品著作权。

###### 大数据风控的本质作用是什么？

丰富风控指标所涉及的数据的维度，尽可能地解决信息不对称的问题（风险存在的根本原因）、提高风控效率、解放人的重复劳动。

- [高并发风控技术解密（上）](https://blog.csdn.net/liweisnake/article/details/78786822) #干货
- [高并发风控技术解密（下）](https://blog.csdn.net/liweisnake/article/details/78790537)
- [美团点评业务风控系统构建经验](https://tech.meituan.com/2017/01/13/risk-control-system-experience-sharing.html)
  https://zhuanlan.zhihu.com/p/24936694
  http://typd.github.io/res/sacc-rc/201610-sacc-rc.pdf
- [携程是如何保障业务安全的](https://zhuanlan.zhihu.com/p/24998119)
  [携程在线风控系统架构](https://zhuanlan.zhihu.com/p/30152434)
- [干货 | 构建风控系统之排坑扫雷（一）](https://zhuanlan.zhihu.com/p/24859431)
  [干货 | 构建风控系统之排坑扫雷（二）](https://zhuanlan.zhihu.com/p/25110386)
- [搭建风控系统道路上踩过的坑（1）-信息采集](https://zhuanlan.zhihu.com/p/31285366)
  [搭建风控系统道路上踩过的坑（2）-风险分析](https://zhuanlan.zhihu.com/p/31331140)
  [搭建风控系统道路上踩过的坑（3）-阻断风险](https://zhuanlan.zhihu.com/p/31366714)
  [搭建风控系统道路上踩过的坑（4）-风险分析](https://zhuanlan.zhihu.com/p/31443357)
- [构建互联网企业风控系统方法论](https://www.freebuf.com/articles/security-management/104104.html)
- [互联网业务安全之通用安全风险模型](https://www.freebuf.com/articles/security-management/98257.html)
- [设备指纹简析 | WooYun知识库](https://drops.secquan.org/tips/14727)
- [交易系统和风控系统的架构怎么设计？](https://www.zhihu.com/question/20860347)
- [大数据风控：嘲讽一下技术流](https://zhuanlan.zhihu.com/p/23570173) #「大数据有哪些？」这里很赞！
- [支付风控模型和流程分析](https://xz.aliyun.com/t/216) #「凤凰牌老熊」出品
- [支付风控](http://doc.cocolian.cn/essay/risk/)
- [爱奇艺业务安全风控体系的建设实践](https://mp.weixin.qq.com/s/2gcNY0LmgxpYT1K6uDaWtg)
  http://www.4hou.com/business/7974.html
- [风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://mp.weixin.qq.com/s/hhEOsQLD3qBxm68IgqCOBQ)
  https://36kr.com/p/5057260.html
- [电商的支付风控怎么玩？](https://www.secpulse.com/archives/59770.html)
- [用有限的信息 做无限可能的风控！](https://mp.weixin.qq.com/s/RaEcVx89GGIjUZORYRKU3w)
- [张新波 | 十面埋伏 – 论大数据风控技术体系的构建](https://mp.weixin.qq.com/s/PWgh-achbqNzRzHMAcxl1A)
- [互联网反欺诈体系漫谈](https://mp.weixin.qq.com/s/WAzCLk_6nkQ0Aap6Sx2lPw)
- [反欺诈的核心是人，教你如何用知识图谱识别欺诈行为](https://mp.weixin.qq.com/s/DIHI-pF9WYA6KenJsbHPGw)
- [知识图谱在大数据反欺诈领域的应用与实践 | 点融黑帮](https://mp.weixin.qq.com/s/1zteOTszcQ_G--4PeuEKcw)
- [阿里首次完整公开双11风控与安全技术体系，了解一下？](https://mp.weixin.qq.com/s/UkEWmEWC6Y5a9nRoTkHWjw)
- [干货贴：互联网金融风控基础知识（一）](http://www.woshipm.com/operate/562096.html)
  [干货贴｜互联网金融风控基础知识（二）](http://www.woshipm.com/it/573697.html)
- [金融业务安全解决方案](https://tech.antfin.com/solutions/businesssecurity) #蚂蚁金服
- [金融风控解决方案](https://cloud.tencent.com/solution/frm) #腾讯云
- [如何成为一名优秀的风控？](https://www.zhihu.com/question/23122856/answer/36050606)
- [做风控工作的体验是怎样的？](https://www.zhihu.com/question/31845457)
- [小米风控实践](https://toutiao.io/posts/c355w5/preview)
  https://blog.csdn.net/wushanyun1989/article/details/68922848
- [在线支付之风控系统架构选型](https://www.infoq.cn/article/risk-management-analysis-system)
- [京东基于 Spark 的风控系统架构实践和技术细节](https://www.infoq.cn/article/jingdong-risk-control-system-architecture-based-on-spark)

 

##### 参考链接：

- 如上

=END=



# 高并发风控技术解密（上）

原创[liweisnake](https://me.csdn.net/liweisnake) 发布于2017-12-13 21:57:51 阅读数 9217 收藏

展开

 风控在任何一个公司都是比较神秘的存在，不仅线上很少分享，从安全角度讲也很少对外披露它的架构及设计。本人将就参与的风控建设谈谈风控的技术。（本文来源于本人内部分享PPT，仅从技术角度探讨风控体系建设，不涉及公司内部机密，限于篇幅，一些细节没能交待完整）

# **风控架构演进** 

 经过1年多风控系统的建设，已经将公司内部风控系统从业务代码为主的风控架构改造为了平台化为主的2代架构，进而改造成为动态化及离线数据模型化的2.5代架构，正在向深度学习，在线数据模型的3代架构上演变。

![img](https://img-blog.csdn.net/20171212221908577)

 不得不说，与阿里，腾讯，京东等大厂相比，公司的风控体系还相对比较薄弱，但在有限的资源下将整个体系建设推进到目前的程度已经比较满意。

##  技术架构 

 首先来看目前风控的**技术架构**，从业务及架构层面将风控划分为五大体系：分别是存储体系，识别体系，支撑体系，运营体系，数据计算体系。

 其中存储体系包括hbase，mysql，redis，es，hive，实际上都利用了现有的框架或开源项目。

 识别体系包括控制平台（控制系统，批处理系统，决策系统，总线系统），处罚平台（处罚系统），分析平台（规则系统，模型系统）， 数据平台（数据系统，运营数据系统）。

 支撑体系主要是指后台配置系统。

 运营体系主要是指风控运营系统，kibana报表系统。

 数据计算体系主要指大数据及离线计算平台及基于其上的数据分析业务。

 ![img](https://img-blog.csdn.net/20171212224325925)

 其调用关系如下图：

 ![img](https://img-blog.csdn.net/20171212232121617)

##  业务架构 

 其次，来看整个系统的**业务架构**。目前已经初步具备的

 业务能力有，营销作弊，交易欺诈，登录注册防控，内容防控

 数据模型能力有，用户画像及风险评级，关联反查，风险大盘，各类报表等

 运营能力有，用户预警，商户预警，案件审核，综合信息查询

 并且基于现有的数据，分类整理并形成了自身的数据资产，分别为名单类，用户类，设备类，环境类，位置类。

 ![img](https://img-blog.csdn.net/20171212224852052)

# **风控系统的性能表现**

 下图是生产环境压测效果，采用12000用户并发压测得到约8w TPS，平均响应时间为141ms，错误率在万分之五。

![img](https://img-blog.csdn.net/20171212232623618)

 其中积累的有效请求达到1.7亿，数据量达8TB

![img](https://img-blog.csdn.net/20171212232540258)

# **风控系统建设的难点** 

 **灵活高效的接入**：通常只有1周甚至更短时间，业务复杂多样；如何减少发版失误和事故

 **极短的响应时间**：业务通常只给100ms，最多200ms的超时

 **并发吞吐要求高**：接入业务较多，调用量大；有的业务用风控抵挡攻击

 **大量数据处理**：数据量相对较大，如何有效利用；数据查询回溯要求较高

 **对抗升级**：攻击者不停猜测内部规则；数据如何为对抗服务

 **大促稳定性**：如何保证调用量增加后不宕机；如何在出问题情况下依然服务

 下篇将针对这些难点一一详细描述如何去解决。



# **What else?**



 **多租户及开放平台服务**

 由于公司内部有多个子公司都想通过风控系统去自行控制，因而将数据隔离的多租户就尤为重要了，对于不同的租户而言，使用的是同一个平台同一套系统，但是所有的界面，数据计算，报表都只会看到本租户下的数据，而不能越权到其他租户，多租户本质上是一种权限控制，但是相比权限，其隔离更深更彻底。

 另外，由于风控积累数据及服务已经较多，许多外部系统都想共享风控的数据和服务，将风控的部分业务作为开放平台提供服务也是深化风控改造的重要步骤。**
**

![img](https://img-blog.csdn.net/20171213133250474)

 **规则效能分析**

 对于规则的设定只能凭经验，规则到底定得好不好也需要有数据衡量，规则效能分析就是用来衡量规则有效性的手段。**
**

![img](https://img-blog.csdn.net/20171213133342375)

 **基于神经网络的反欺诈**

 基于这篇论文，将每次session的点击序列输入RNN，提供适当风险样本，让其识别风险session《Session Based Fraud Detection》***\*。\****反欺诈这方面可以做得更多，但是神经网络在可解释性方面太差，这种场合被控了申述时毫无反驳理由。不过不失为一个判断依据。**
**

![img](https://img-blog.csdn.net/20171213134157616)

 

 **智能运维**

 对于线上系统，从智能运维到智能决策，从熔断到自愈，寄往于系统可以做到自动决策，某些问题自动修复。

 **TimeWheel算法**

 对于风控这种时效要求较高的应用，需要在请求时控制超时。通常，这种控制超时的方式是新起一个线程，通过控制线程的执行时间来控制超时，在大压力时，大量线程会给整个系统的CPU切换带来负担，能否只用一个线程控制所有超时的计算，这样一来，将大大减小线程数量，将CPU负载降低。

 如下是一种称为Timewheel的算法，实际上是模仿TCP发送包之后用来计算超时的算法，试想，如果操作系统底层对每个tcp包都新建一个线程来计时，那操作系统早挂了。

 ![img](https://img-blog.csdn.net/20171214143215028)

 参考资料：

 美团点评业务风控系统构建经验 https://zhuanlan.zhihu.com/p/24936694

 携程在线风控系统架构 https://zhuanlan.zhihu.com/p/30152434

 干货 | 构建风控系统之排坑扫雷（一） https://zhuanlan.zhihu.com/p/24859431

 干货 | 构建风控系统之排坑扫雷（二） https://zhuanlan.zhihu.com/p/25110386

 搭建风控系统道路上踩过的坑（1）-信息采集 https://zhuanlan.zhihu.com/p/31285366

 搭建风控系统道路上踩过的坑（2）-风险分析 https://zhuanlan.zhihu.com/p/31331140

 搭建风控系统道路上踩过的坑（3）-阻断风险 https://zhuanlan.zhihu.com/p/31366714

 搭建风控系统道路上踩过的坑（4）-风险分析 https://zhuanlan.zhihu.com/p/31443357

 氪信资深数据科学家主讲：如何构建基于AI的金融风控系统 | 硬创公开课 https://zhuanlan.zhihu.com/p/26500991

 timewheel算法 http://blog.csdn.net/mindfloating/article/details/8033340

 细说延时任务的处理 http://www.jianshu.com/p/7beebbc61229



# 高并发风控技术解密（下）

原创[liweisnake](https://me.csdn.net/liweisnake) 发布于2017-12-14 14:28:58 阅读数 4273 收藏

展开

# **如何灵活高效的接入？**

## **平台化**

 •搭建平台而不是搭建项目——做一个“淘宝”而不是做只针对某几项业务的网站

 •从业务中抽象及通用——如果一种业务有可能在今后重复出现，那就将其模块化，系统化（如批处理系统），发展成为平台能力

## **动态化**

 •流程动态化——不同的业务类型对应的流程可以随意调整，无须调整代码

 •代码动态化——采用groovy脚本动态调整线上代码，无须发版；规则配置除了使用各种灵活预配置外，还可以使用groovy脚本代码化规则；指标函数groovy化，不需要每次发版。

 •配置动态化——配置动态化可以考虑虚拟表的形式，通过虚拟表将任意表的结构存储到一个统一的表结构中去，从而完成配置的动态化，有些类似nosql的文档化思想。

# **如何降低响应时间提高吞吐量？**

## **善用存储及缓存**

 •配置数据加载到本地内存

 •频繁重复访问的数据放redis

 •数量较大稳定性要求较高的放hbase

 •需要快速搜索的明细数据放es

 •需要解耦削峰的数据放kafka

 如下图，不同的存储读取时间是有很大差别的，应当利用好各种存储，尽可能的用耗时小的存储

![img](https://img-blog.csdn.net/20171213101858700)

 下图是hbase的一个基准性能测试，千万不要忽略hbase哦，它既能存取海量数据，又能以极短的时间响应，实在是风控系统性能提升的利器。目前的风控系统最重要的累积数据，就是基于hbase存取的

![img](https://img-blog.csdn.net/20171213101934887)

## **异步化**

 •从系统架构层面，将可异步的代码尽量异步，但忌滥用异步

 下面是一个实际的例子，在压测过程中，发现CPU的sy和wa很高，大体可以判断是线程过多，并且浪费在线程切换，据观察，启用异步线程调用3个外部调用的耗时并不低，于是该分支线程等待时间过长，导致占用大量线程在等待IO，线程也频繁切换。

![img](https://img-blog.csdn.net/20171213102507940)![img](https://img-blog.csdn.net/20171214113718503)

 基于动态流程配置，将主系统中3个外部调用合并为一个之后，sy和wa大大降低，不再出现被压垮的情况，而被合并的剩下两个调用，放到kafka解耦之后继续调用。

![img](https://img-blog.csdn.net/20171213102607393)



  单机TPS 2,644.6->3,079

  单机平均响应时间149.3->126.03



 •日志打印异步化--log4j2 all async,大大提高吞吐

  日志对于TPS的影响绝对无法忽视，曾试过禁止打印所有日志，系统TPS直接从3000飙升到4200。

  如果不打印日志，线上系统就没法运维。在风控系统里，日志是很重要的排查工具和手段。log4j2的出现，就是为了大吞吐打印日志的，其中all async实现全异步打印，中间用到了disruptor来提速，至于disruptor为什么快，参考之前的文章[disruptor框架为什么这么强大](http://blog.csdn.net/liweisnake/article/details/9113119)

  单机TPS 3,079 ->3,686.1

  单机平均响应时间126.03->79.35

![Async loggers have much higher throughput than sync loggers.](https://logging.apache.org/log4j/log4j-2.3/images/async-vs-sync-throughput.png)

 •降低线程数量，从而降低系统cpu时间，异步网络调用--netty的客户端应用

 为保障主线程的吞吐和执行时间，经常需要把网络调用异步化，一些重要的异步化网络调用也需要占用线程池中大量线程，线程数量一多，sy就居高不下，既浪费cpu，又会导致整个tps全线崩溃。

 采用nio的netty客户端无疑是解决这个问题的利器。如下图，左边是每个线程一个连接等待，耗费大量线程在等待，会导致sy和wa提升，采用基于netty框架的客户端之后，将连接线程限制到一个很小的数目，而回调的业务线程也会保持在一个较小范围并且保持忙的状态，而不是把时间耗费在sy和wa上

![img](https://img-blog.csdn.net/20171213102830252)

 •用好线程池，保持系统稳定

 线程池实际上是保持系统稳定的重要方式，保持资源在一个可控的范围内而不是无限制的增加资源压垮机器，这点尤为重要。

# ***\**\*\*\*如何应对大数据？\*\*\*\*\****

## **增量化思维**

 •问题：需要从原始表计算到结果表，由于增量的结果表无法被复用，只能每天计算全量的结果表，计算任务看似巨大（计算任务为182小时）

 •解决：将每次需要全量计算转化为：每次增量计算到明细表，再从明细表全量计算到结果表（实际计算第一次跑得较慢，后续每次跑只需要几小时）

![img](https://img-blog.csdn.net/20171213103214631)

## **海量关联关系查询**

 •问题：在关联关系查询中，经常从几个简单的关联查到大量数据，如何处理大量数据，将其排序，分页，供人工调查？**
**

 •解决：利用es多次查询，redis缓存分页信息。算法很简单，实际过程会遇到很多问题，比如ip关联出来经常是海量数据，数据查询会超时，后续查询更加庞大。一些小技巧是：数据尽早剪枝；业务查询限制，如限制查询时间；ES的多重查询，可以一次性将数据作为查询条件输入。分布式的TOPK问题比较有意思，ES的原理中阐述了这一点，有兴趣的人可以研究

![img](https://img-blog.csdn.net/20171213103317631)

 

  另一种方式是将关系直接存储为图，即顶点和边关系，查询时将极其简单，这方便的代表是图数据库neo4j，由于存储需要再导入，因此并未做深入研究，同样供有兴趣的同学参考

# ***\**\*\*\*如何保持系统稳定性?\*\*\*\*\****



## ***\*限流\****



 •大促期间如遇大流量可以针对业务渠道限流开关推送标志以限流

## ***\*降级\****



 •在高峰期间将一些运营查询相关的需求停止，减小数据系统负担，并调度到半夜12点继续查询

## ***\*预案\****



 •每次大促前都得准备预案。预案需要准备各种极端失败情况，确保失败时不手忙脚乱

# [美团点评业务风控系统构建经验](https://tech.meituan.com/2017/01/13/risk-control-system-experience-sharing.html)

2017年01月13日 作者: 义哲 [文章链接](https://tech.meituan.com/2017/01/13/risk-control-system-experience-sharing.html) 6448字 13分钟阅读

**本文根据“第八届中国系统架构师大会”演讲内容整理而成。**

美团最初以团购的形式出现，到现在有了很大的业务形态转变。尤其是经过与大众点评的业务融合，从单一业务发展成了覆盖到店餐饮、到店综合、猫眼、外卖、酒店、旅游等多个垂直领域的综合性电商，并且在各个领域都处于行业领先的地位。在这背后，美团点评不仅面临激烈的行业竞争，还有黑色产业（以下简称“黑产”）带来的各种风险，因为我们的业务有这样一些特点：

- **品类多、覆盖面广**：包括几乎所有吃喝玩乐服务，其中不乏容易被销赃的品类。
- **用户多、商户多**：美团点评拥有6亿以上用户，400万以上合作商家，覆盖了很大部分国内网民和商户。
- **交易高频**：每日订单峰值突破千万。

美团点评对黑产有着巨大的吸引力，归纳起来在这些方面尤其突出：

- **用户作弊**：大家常说的“薅羊毛”，用户为了骗取促销优惠的作弊行为。
- **商家刷单**：常见的有刷排名、刷销量、刷好评等违反商家平台协议的行为。
- **账户和支付安全**：公民信息盗用形势已经十分严峻，黑产从业者会在电商平台上盗取用户的余额，或使用他人支付信息来消费。

这些行为严重侵害平台用户和商户的利益、扰乱正常交易秩序，处理结果的好坏将决定整个业务的成败。所以美团点评需要一套灵活高效的风险控制系统和工作机制来防控这些风险。

归纳一下，风控系统面临的挑战有：

- **业务多、风险点多**：上面提到的风险涉及到各个业务的购买流程、用户操作、商家操作等多个场景。
- **变化快**：黑产的攻击手段升级，自身业务在变化，互联网环境也会不断变化。
- **我在明、敌在暗**：平台在明处，但攻击者是谁、会在什么时候出现、用什么方式进攻却无法预知。

接下来就以风控面临的这几个挑战为出发点，介绍我们在系统构建中所取得的经验。

### 挑战一：业务多，风险点多

回到风控工作的起点，在了解业务所面临的风险类别后，首先要面对的问题就是：怎样才能知道有风险，并且能够控制风险？我们很容易想到，为了做到这些必须与业务系统对接，这部分系统我们称之为“对接系统”，它的目标抽象来说就是：**感知风险**和**控制风险**。

“**感知风险**”是指要收集尽可能完整的数据。风控需要关注：**谁、在什么时候、通过什么方式、对什么对象、做了什么**？这句话抽象概括了要感知的内容，绝大多数信息都可以套用到这句话。

第二个目标是“**控制风险**”。如果仅仅站在防守方的角度看，并不容易知道应该控制哪里；我们应该站在攻击者的角度思考：攻击者关注什么？答案是利益。以美团点评为例，可带来的利益有：

- **促销优惠**：相关的风险场景有下单、支付、购买、验券等。
- **商家销量和排名等**：涉及购买、搜索、销量展示等页面。
- **用户余额**：即需要控制登录、查看余额等动作。

以这样的角度排查，就不容易漏掉风险点。排查清风险点后，实际对接工作也有很大挑战：美团点评的细分业务有100多个，很多业务都有多种用户终端（iPhone, Android，H5，PC等）、多个业务后台（促销工具，商家后台等），需要对接的场景数量很多。所以感知风险、控制风险背后最大的挑战是如何与业务方紧密配合顺利对接。

在配合中，业务团队常顾虑因风控需求拖慢业务开发速度，而风控也常感到业务团队配合不足。在配合的问题上，应该先充分认识两个团队合作的目的，就好像生产汽车和生产安全气囊，安全气囊在大多数国家已经是汽车生产销售的必须要求；同理，在现今互联网服务中，安全配备也已经成为了用户体验、业务需求的一部分，一个忽略安全的产品，终究会被市场淘汰。另一方面对风控而言，业务发展是风控存在的前提，如果风控的安全需求影响到业务发展也是不合理的，因此风控要提高服务质量，让对接带来的负担降到最低——这就是对接系统设计的核心目标。

总结一下，**风控工作经验一：安全是业务的必要属性，没有安全保障的产品，终究会被市场淘汰； 风险控制要服务于业务，减少业务对接负担。**具体而言，业务接入风控的成本主要有**接入成本**和**运行成本**两方面。下面分别来看我们在风控系统构建中的做法。

#### 接入成本

风控系统最早只是业务系统中的一个函数，逐步演化成了独立的服务。而这个独立服务与业务后台的交互最初时也沿用了旧的思路，即业务后台在关键动作前调用风控服务判断“有没有风险”。但这样每次新增加一个业务或新出现一个风险场景时，风控和业务都要重新对接联调。这样频繁地调整给上下游团队都带来了不小的负担，在频繁的更改中系统质量也难以保证。

换个角度看，其实还有更好的交互方式：当风控要保证账户操作环节的安全，可以让用户中心直接与风控系统对接。即业务系统调用用户中心，用户中心再调用风控透传风控所需参数，而风控的决策也通过用户中心返回给业务后台。这样的好处是只需要用户中心与风控对接一次，业务系统甚至不需要明显感知到风控的存在。同样的道理，与商户中心、支付环节的交互也可以采取类似的设计方法。这样的改造相当于把风险控制的“责任”从业务方移交给了中间件，即由中间件来保证提供安全的服务。这样理顺系统模块间的关系，从而降低整体开发成本。

#### 运行成本

业务接入风控系统后，尤其关心运行过程中的是否会有问题。风控系统要尤其关注以下这些方面：

- 服务稳定性
  - 隔离部署：在对接的众多后台服务流程中，哪些是核心流程、哪些是非核心流程，需要隔离开防止相互影响。
  - 依赖降级：风控策略需要实时依赖大量外部数据接口和存储，依赖越多稳定性问题发生的概率越大，相应的熔断、降级机制不可缺少。
  - 限流防刷：业务尤其是高风险业务随时可能因爬虫、恶意攻击而造成流量突增。系统需要具备识别和拒绝这些恶意流量的能力，而不是放任其消耗业务后台和风控系统的计算资源。为了做到这一点，风控系统不应仅位于业务系统的调用下游，而要在全局流量入口处插入反爬防刷模块来实现整体控制。
- 服务性能
  - 风控与业务对接可以大致分为两类： ① 同步控制接口，返回风控决策并由上游实时处理。 ② 异步信息收集接口，主要目的是收集数据提供风控决策依据。异步接口可以显著减少上游服务的阻塞时间。
  - 最初风控策略硬编码在代码中，对运行过程的优化也以人为调整代码为主，但策略调整频繁，运行优化无法跟上策略调整，而且策略复杂度提高后，人为优化代码也不再现实，因此需要在运行时动态决定运行策略才能达到最好的优化效果。这点通过规则平台来完成，**将在后文中“规则平台”中介绍**。
- 风控运营
  - 风控策略不可能做到完全精确，为了降低业务损失很多情况下要以牺牲一部分用户体验为代价，因此完善的用户运营保障不可或缺。这在后文的“运营系统”中会提到。

### 挑战二：变化快

具备感知风险和控制风险的能力后，**实现风控策略**就是第二个关键问题。最初的策略可以很简单，比如此时我们认定：“穿黑衣服的是坏人”。类似策略运行一段时间后会出现有意思的现象：“坏人会逐渐换上其他颜色衣服”。这也很好理解，攻击者不会持续做无效的攻击浪费资源，而是会转向其他进攻手段。这样旧策略反而只会影响到一部分正常用户——观察到的结果是策略准确率下降。这样的情况无法避免，因为——**风控工作经验二： 风控是一项长期的对抗性工作。**

那么我们首先要加强**策略健壮性**。还用上面的例子，攻击者很容易发现后台针对黑衣人的策略。但如果策略复杂一些，识别“穿黑衣服而且戴黑帽子的人”有问题，那么策略被暴露的概率就低了很多。但这会影响策略的覆盖面，所以需要更多的策略形成策略网共同作用。假设极端一点，把能想到的识别要素都用上，制定策略也就变成了模型训练问题，通过机器学习来制定策略会有更好的健壮性。不过这只是理想情况，现实并没有这么乐观。风控所面对的真实场景中正样本和负样本数量差距悬殊，而且攻击模式在持续变化，导致这并不是稳定的算法问题。所以实际工作中人工介入制定专家规则并与算法策略结合使用是更有效的方法。

涉及到长期对抗的工作，**效率高低**将是对抗效果的决定性因素。风控需要多种角色配合，典型如：开发者建设系统、策略制定者制定规则策略、产品角色把策略应用到合适的场景。让这些角色并行不悖就是工作的理想高效状态。“规则平台”就是我们用来达到这一状态的秘密武器。

#### 规则平台

为了解耦**系统开发**和**策略开发**，需要让策略执行过程标准化。我们把策略划分成几个层次：

- **场景**：对应规则集合，一个场景包含若干条规则。
- **规则**：是最小的决策单元，一个规则包含多个因子。
- **因子**：因子是组成规则的最小逻辑单元。

上下两层之间都是多对多的关系。这样划分后，所有策略都套用标准化的执行过程，并能达到最大程度的配置复用。此外还有一个好处，就是将策略配置从代码中抽离。旧的策略执行过程是用硬编码预先编写好，对执行过程代码调优十分复杂，即使调优也只能针对特定的策略配置。如果策略改变了，原来的优化可能就不再适用。通过配置执行策略后，执行过程也变成动态的。具体来说，运行时会根据请求来决定需要计算哪些场景、规则和因子，每个元素计算且仅计算一次，没有相互依赖的部分放入多个线程并行处理。通过这样的优化，效率和性能得到大幅度提高。

再看**策略开发**和**决策应用**。最初实际工作中这两者耦合在一起不加区分，即针对特定场景开发特定策略。逐渐暴露出一些问题，比如场景会变化、会新增，那原有的策略是否还适用？一个策略是否只能使用固定的决策动作？为了让这两部分工作并行，需要从设计定位上就把两者区分开。即：

- **策略**：是为了识别一些特定的问题，例如“是不是模拟器请求”，“该用户是不是新客”。
- **决策**：是针对场景的应用，如拒绝、验证手机短信等。

规则平台设计让每个场景可以应用不同策略，命中策略后的决策也可以灵活定制，甚至可以配置多个决策，并设置不同优先级。

#### 验证中心

上文中的“决策”代表系统是否信任该请求，风控背后的工作也围绕这个“信任”而展开。拒绝不信任的，放行信任的。但还有不少情况是中间不足以确定的部分，常见的处理方法是需要让用户补充验证信息来辅助判断。最初实现的验证流程是：风控服务识别风险后返回决策给业务系统，由业务系统实现验证的完整交互过程。这样存在两个问题：

- 首先业务方很多，不同的业务需要重复实现验证流程，造成重复开发。
- 其次验证种类有很多，从较弱可信度的短信验证，到较高可信度的银行卡验证等——风控能返回什么样的决策受限于特定场景业务方的实现了什么验证支持。

这些问题对于业务和风控系统造成了不小麻烦。所以我们需要优化这一过程，让验证过程由一个独立的服务——验证中心来完成。业务系统从风控服务获得风险决策，再与验证中心交互完成验证。从风控的角度看，以前的处理方式称作“只管杀，不管埋”，优化后可以称之为“杀埋一条龙服务”。

除了规则平台、验证中心，我们还抽象出了累计服务、处罚中心、算法平台等服务来提升风控对抗效率。

### 挑战三：我在明，敌在暗

风控与黑色产业的对抗有个天然的不利因素，就是风控团队需要防御所有短板，而对手只需要找到薄弱的环节进攻。面对进攻，我们可以建立相对完善的实时策略体系和工具系统，但如果仅寄希望于实时策略解决所有问题也是不现实的。即使策略再优，黑产、业务、环境都在变化，仍然可能留有漏洞，或者陷于疲于应付的境地。这样的现实需要风控团队视角更宽广一些——**风控工作经验三：要从事中防守扩展到立体事前、事中、事后防御。**

在风险事前，要注意提升防御能力，减少防御短板：

- **风险教育**：在快速发展的业务中，风险控制的核心在于人，要将风险意识和基本概念传递到业务的各个阶段，明确告知风控可以提供的服务。
- **参与业务**：参与到业务的产品流程中，了解高风险业务、活动的规则，预判风险并给予合适力度的干预。
- **数据准备**：打通数据收集流程，制定预警规则、模型策略等。
- **主动防护**：关注业界风险动态，发生行业安全事件后，或重大活动、产品改动上线前，制定有针对性的规则，甚至采取锁定高危账户、发送预警消息等措施。

在风险事后，要快速响应，灵活管控。客户投诉是风控了解策略效果的最重要指标之一。 针对风险场景，风控还要主动关注异常数据，实现“预警”监控。这些反馈都会进入**运营工作流**做处理。 运营工作流中，尽管各风控产品具体流程不同，都可以划分为初步受理、核查审理、案件处理三个步骤，对应着以下三个系统。

- **初步受理**：主要用作初步筛选案件，决定是否需要进入下一步骤。其流程较为简单，系统的设计目标是让风控运营人员可以便捷的处理案件，因此处理效率是其中的重要衡量指标。
- **核查审理**：用于详细核查案件，通常有多步骤流程，不同角色以其专业视角做判断。核查过程中需要大量数据支持和处理系统支持，因此有了**运营支持系统**。
- **案件处理**：确认且涉及到资金损失的案件需要进入赔付流程。因为涉及到资金赔付，精确的权限管理是系统设计和实现时需要特别注意的问题。

运营平台的意义不仅在于处理案件本身，更在于将处理结果反馈到线上系统中实现风控线上和线下的运行闭环。除了运营平台，逆转信息劣势还要靠完善的数据体系的帮助。风险控制所使用的数据可以这样分类：

- **事件快照**：原始而完整的信息，用于生成聚合数据，也是支持运营查询的主要数据源。
- **聚合事实**：相比于原始的事件记录，更多使用场景更关心聚合的结果，例如某用户、某商家的历史购买次数。经过聚合整理后的数据，是进一步数据挖掘的基础。
- **衍生信息**：指基于事件快照和聚合事实衍生出的理解信息，例如用户的作弊风险、设备的可信程度、黑白灰名单等。这些衍生信息可以适配到各个特定场景中使用。
- **基础数据**：除了直接传递到风控的数据外，风控处理过程少不了需要业务甚至是外部的辅助信息。例如，业务相关订单和活动信息、公认的事实数据、外部辅助决策信息等。

### 小结

把上面三部分融合起来，可以看到风控系统的全景：

![风险控制系统](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2017/7a6efb86.png)

风险控制系统



从上文三条风控工作原则可以看到，风控系统构建过程各个阶段的关注点从对接质量，到平台效率，再过渡到立体的闭环防御。但即使系统发展到了相对成熟的阶段，与黑产的斗争也远没有结束。为了更好的对抗，我们要从对手身上学习：

- 黑产链条经过长时间的实战优化，分工极为细致。风控团队也应该学习这样的思路，将服务功能切分到细粒度以更好适应变化。
- 黑产对利益极为敏感，甚至很多时候比业务开发者还要了解业务。风控团队只有比对手更了解“主场”——也就是自身业务，才有可能在对抗中取得主动。

如果把风险控制比喻成一场战争，还可以从军事理论中得到借鉴。《孙子兵法‧谋攻篇》中的一段描述就十分贴切：“知可以战与不可以战者胜，识众寡之用者胜，上下同欲者胜，以虞待不虞者胜，将能而君不御者胜。此五者，知胜之道也。”类比到风控工作中，风控团队需要考量：

- 控制风险是否现实
- 团队人才质量和数量是否足够
- 团队价值观是否统一
- 对风险是否足够了解
- 是否得到上层支持

这五点就是风控工作的取胜之道啊。

- Samet O. [Introduction to Online Payments Risk Management](http://shop.oreilly.com/product/0636920029632.do). O’Reilly. 2013.
- 李俊奎. ArchSummit. [支付宝：敢付敢赔背后的互联网实时风控技术](http://www.infoq.com/cn/presentations/internet-real-time-wind-control-technology). 2014.

# 携程是如何保障业务安全的

[![携程技术中心](https://pic1.zhimg.com/117bc7216b4354ece416187dc4ca0632_xs.jpg)](https://www.zhihu.com/org/xi-cheng-ji-shu-zhong-xin)

[携程技术中心](https://www.zhihu.com/org/xi-cheng-ji-shu-zhong-xin)

已认证的官方帐号

22 人赞同了该文章

作为国内第一大OTA企业，业务安全一直是携程所面临的重要安全风险之一。

在面对各类从散兵作战到越来越专业化的黑产，以及技术从单一到持续自动化的工具化下的攻击时，我们也根据不同的业务安全风险，建立了相应的系统进行防护，并和黑产进行持续的技术和思维上的攻防。

其中经历了从业务驱动技术（被动式防御），到技术驱动业务（主动式防御）的过程，不断结合新技术的应用，新系统的开发以及注重用户体验和安全的平衡，并最终关注用户安全感知，不断完善业务安全的各方面，为用户提供一个安全、可信的环境，同时减少企业在安全上的损失。

**一、携程业务面临的四大安全风险**

携程的业务当前面临了大多数互联网企业都面临的相关业务安全风险：

1、**垃圾注册**，但发现有较多难点：手机号码；秒拨ip；行为工具化；打码平台等；

2、**扫号**也是重大安全风险之一，威胁账号安全的关键点：资金盗用；信息泄漏；恶意欺诈。同样发现也有很多难点如：IP使用量巨大，可以做到1号1IP；使用外部社工库，密码正确率高；可以根据安全措施及时更换策略；设备指纹基本伪造，无明显特征；

3、**薅羊毛**（羊毛党）是当前电商，金融类公司重大的安全风险。对企业产生较大影响，包括影响活动实际收益和到达率；侵占有限的活动资源。发现难点：牟利方式多样化，各种形式组合；模拟真人或直接真人操作；黑色产业链发达，集团化模式；

4、**爬虫**，企业的价格策略被掌握；扰乱PV/UV，无法做出正确营销判断；发现难点：频次低，特征不明；不会对业务方造成明显感知；

**二、业务驱动技术**

面对上述四大业务风险，携程设计了三大系统进行应对。

**1、统一验证码**

各应用验证码难度解耦；自动调节难度和类别；各参数独立可变配置；服务响应在10ms之内；

**系统概况：**

应对场景：扫号，薅羊毛，接口遍历；

效果：数字英文易识别成本低，中文输入成本高；

体验：用户每天需要一定时间输入，英文数字在5s左右，中文大于10s；

成功率：成功率优化后保持在90%；

**架构图：**



![img](https://pic1.zhimg.com/80/v2-46379019da97039211fd11eeda954468_hd.png)

图1



**后端验证码配置界面：**



![img](https://pic1.zhimg.com/80/v2-438cb2664f21c75224bb16f3f3838c40_hd.png)

图2



**问题**：类别单一，易于破解（机器识别，人工打码）；体验较差，输入验证码时间长；识别率存在上限；

**2、风控系统**

实时配置规则；异步响应； A/B testing

**系统概况：**

应对场景：扫号，薅羊毛；

效果：日均响应请求 1000w+次；

性能：平均响应耗时5ms；

**系统架构图：**



![img](https://pic1.zhimg.com/80/v2-3f6b8da10a252fb0f9010c26f0b629bc_hd.png)

图3



**风控系统配置界面：**



![img](https://pic4.zhimg.com/80/v2-8d2eb88f00d29adf81812734c17e5b07_hd.png)

图4



**问题**：非实时响应；非多参数响应；无法支持多数据源；规则引擎服务写死

**3、风险数据平台**

基于离线规则运算；数据迭代，分钟级别计算结果；与外部黑产数据结合；

**系统概况：**

应对场景：垃圾注册，扫号，薅羊毛，爬虫；

对扫号近实时拦截，目前成功账号/IP已经达到了0.7：1；

反爬主要提供对恶意爬虫的检测，经过A/B测试日均拦截爬虫行为10w次；

薅羊毛和异常注册识别月均识别超过10w次；

案例：



![img](https://pic3.zhimg.com/80/v2-ae56588ca912977faf12e6e4a638f90e_hd.png)

图5



2016年7月27日早晨10点17分，出现大量异常登录请求，风险数据平台在10点25分发现异常，迅速介入，10点45将异常登录请求降低到十位数，在11点降低到个位数，对方此时发现无法绕过，直接放弃本次扫号。

本次事件持续40分钟，平台发现异常并介入使用了8分钟，随后20分钟进行了中文验证码干预，效果比较明显，且无需人工进行干预，实现了快速全自动化响应，让扫号无所遁形。

**问题：**Sql+DB；数据量瓶颈；运算效率

**三．技术驱动业务**

携程的业务安全实践，通过业务驱动技术，解决了相关问题的同时，也带来了一些系统上的瓶颈，并在业务的快速发展和攻击者的不断更新中，呈现了不少问题。为此，我们也正在寻求一条新的道路：技术驱动业务，来更好的支持业务，从被动到主动。

**1****、新的系统架构**



![img](https://pic1.zhimg.com/80/v2-54ea27e7b837e2df0f089f5141c9a614_hd.png)

图6





![img](https://pic2.zhimg.com/80/v2-7e2259d746ecdc7a12d42bae3c0861a9_hd.png)

图7



**数据层：**

数据层负责对各种结构化以及非结构化数据进行统一的数据收集，清洗，预处理操作。目前来说，这种清洗注重点一般在区分正常用户和异常用户的注册，登录到账户各种重要操作，浏览PV数据，到最后购买旅游产品的一个行为区别，以及用户存在是否批量操作的相关数据抽取，这也被称为用户的社交网络区分。

**规则引擎层：**

规则引擎层负责将清洗及预处理完成的数据，使用实时流或者迭代作业按照定义好的规则或者模型进行数据计算，将计算完成的数据，存放在数据仓库内，以供分析层或者应用层调用。

**分析模型层：**

分析模型层负责将目前已有的清洗完成以及计算完成的结果数据再清洗和归类，进行后续的规则分析，补充，调整，模型的建立，以及离线+实时评分卡的数据权重比例调整等。

**应用层：**

应用层主要负责将综合得到的实时+离线的评分卡形式的得分结果通过SOA接口返回给业务方，告知业务方请求是否存在风险，并提供操作建议，同时会将相关请求数据全部记录，以供后续分析。

**系统优势：**

- 支持各类不同源数据方式，DB，api接口，kafka消息等
- 支持分钟级到年的离线海量数据计算，支持storm流式和hive离线方式
- 实现比drools更优化的实时规则引擎计算逻辑，支持实时配置及四则运算，评分卡等
- 高效的计算效率，千条规则毫秒级响应，整体接口内部平均响应10ms内
- 分层架构设计，灵活应用spark，impala，presto等新技术的引入
- 账户安全，反欺诈，反爬，接口防刷均可以使用规则引擎实现防护，能在各类场景应用

**2、新的产品化验证码服务架构**

主要涉及bu前端js，验证码后端服务及bu后端，其中bu前端js，验证码后端均是业务安全开发，作为一个产品化的产品推广到bu后端接入，bu后端只需要监听js事件及验证码的校验，大大减少的bu的开发量工作，并简化了相关流程，风控和验证码在一个流程中实现。同时js也兼顾其他相关功能，大大提高了安全防护能力。



![img](https://pic2.zhimg.com/80/v2-29672dca235e8c5d8dcba8d061669e71_hd.png)

图8



**3、体验和安全性更好的滑块和选字验证码**

在图片验证码体验的瓶颈及安全性防护的提升角度，安全开发了2类新的验证码：滑块和选字验证码，从兼顾体验和安全性出发，同时也使用了上面的架构，引入了风控进行防护。滑块在测试中，用户输入在1～2秒左右，大大提高了4位验证码的体验。选字验证码则兼顾了一些其他很好的作用（保密），同时所有字体位置随机，且后端只校验坐标位置，大大提高了破解难度，在体验上并不输于滑块，破解难度更高，成为我们后续的引入重点。



![img](https://pic4.zhimg.com/80/v2-ebbf6b248c1293960b48d652acf159f3_hd.png)

图9



**四．携程业务安全展望**

携程未来在业务安全上还会继续应难而上，在技术和业务上共同发展，包括底层spark，presto，impala的引入，安全用户画像，惩罚中心，挑战服务的系统上线等等。

携程作为国内互联网旅游企业的标杆，体验和安全的平衡一直是业务安全所追求的，在有了技术支撑的前提下，这块也将进行持续的优化和改进。

同样，信息安全一直是全社会关注的话题之一，用户的安全感知，即如何提高用户自身的安全思维和对信息的敏感，保护自己账户，信息和个人资产的意识，也是我们需要进行不断改进所需要展示给用户的。

安全之路，任重而道远。

**[****作者简介]**王润辉，携程技术中心信息安全部高级经理。2015年加入携程，负责携程业务安全。个人专注在：安全漏洞，数据分析建模，业务安全，风控系统整体架构等。

**想和携程小伙伴一起工作？安全团队现开放职位（高级应用安全工程师等），感兴趣小伙伴砸简历tech@ctrip.com。**

**没看够？更多来自携程技术人的一手干货，欢迎关注携程技术中心微信公号ctriptech哦~**

# 携程在线风控系统架构

[![携程技术中心](https://pic1.zhimg.com/117bc7216b4354ece416187dc4ca0632_xs.jpg)](https://www.zhihu.com/org/xi-cheng-ji-shu-zhong-xin)

[携程技术中心](https://www.zhihu.com/org/xi-cheng-ji-shu-zhong-xin)

已认证的官方帐号

46 人赞同了该文章

为了应对日益严重的支付欺诈，携程在线风控系统2011年正式上线。现在，在线风控系统支撑了携程每日1亿+的风险事件实时处理和100亿+的准实时数据预处理；系统中运行的总规则数和总模型数分别达到了1万+和20+；风控的范围从单纯的支付风控扩展到了各种类型的业务风控（例如：恶意抢占资源、黄牛抢购、商家刷单）。

下图是当前在线风控系统的整体技术架构图：

![img](https://pic2.zhimg.com/80/v2-bfe43517e906aaa6e996bc9bb9823a45_hd.jpg)

当前的系统结构是比较主流的风控系统结构，包含了决策引擎、Counter、名单库、用户画像、离线处理、离线分析和监控各主要模块。携程的在线风控系统发展到这个阶段一共经过了3次重大的改版。

**一、最初创立**

2011年上线，使用了.net开发的服务，数据库使用SQL Server，简要架构图如下：

![img](https://pic4.zhimg.com/80/v2-028456425326fe3876f44e165e8103db_hd.jpg)

这个时候的风控服务将所有在线决策功能整合在一个系统内实现，包括规则判断、名单库、流量计算；而这些逻辑都基于数据库实现。

**流量计算**：通过明细表执行SQL得到（例如：SELECT COUNT(DISTINCT orderId) FROMt1 WHERE …[2]）

**规则判断**：数据库记录大于、小于、等于等判断规则，接收到风险事件后获取流量值和规则进行比较，得到最终的风险判断。

**名单库判断**：数据库维护黑白名单信息（属性类型、属性值、判断依据等），程序判断风险事件中的值是否命中名单。

基于当时携程对风控的需求，系统以满足功能为主。在上线运行一段时间后，随着携程业务的增长，风控系统的流量不断增加，基于SQL的流量统计耗时严重制约了系统的响应时间，因此有了第一次的性能优化改版。

**二、流量查询性能优化改版**

由于这个时候的主要性能瓶颈在于数据库实现的流量查询，这次优化主要方向就是优化流量查询的实现：在原来单个数据库的基础上，采用分库分表的方式均摊压力，以达到更快的响应时间和更高的吞吐量。架构图如下：

![img](https://pic2.zhimg.com/80/v2-b774807b64afc35b01058de8a686c9c9_hd.jpg)

优化之后，流量库和业务库分离，流量库使用多个数据库实例，使用hash的方式拆分流量明细，统计的时候使用SQL。由于压力被多个数据库实例分摊，使得系统的流量查询性能得到了较好的提升。

新版本上线后，携程的业务又对风控系统提出了更多的要求：

\1. 更方便快捷的接入：除了支付风险，业务的风险也需要风控支持；

\2. 更多的外部数据接入：用户信息、位置信息、UBT信息；

\3. 更丰富的规则逻辑：支持任意变量的规则判断，支持更多的判断逻辑；

\4. 更高的性能：流量10x的增长，响应时间不超过1秒；

\5. 编程语言的更新：携程推动公司内.net转java。

然后，就有了奠定当前在线风控系统基础的重大改版

**三、风控3.0（Aegis）**

从这个版本开始，风控系统全面转向Java开发，同时将核心模块独立成服务，定义了各子系统的边界以及在整个系统中的定位和作用。相比之前功能性的应用，Aegis是一个平台化的风控系统。以下是简化的系统架构图：

![img](https://pic3.zhimg.com/80/v2-9d5264d55d5f7637fedd25de6cdab07a_hd.jpg)

Aegis开始使用Drools脚本用于规则的编写，极大的提高了规则团队对突发事件的响应时间，紧急规则一般10分钟就能上线。

在结构上风控引擎分为同步引擎和异步引擎，同步引擎运行用于实时判断风险结果的规则和模型；异步引擎则负责验证规则/模型、数据分发、关键数据落地等逻辑。同步/异步引擎设计成无状态的，方便随时扩容。

Aegis在流量统计上自研发了Counter Server，这是一个定制化的类TSDB服务，任意精度任意时间窗口的查询控制在5ms，同时支持高并发查询，相较于SQL的实现提升了上千倍的性能。支撑了现在风控系统内个服务每日百亿次的查询。下图是其简要的结构说明：

![img](https://pic4.zhimg.com/80/v2-d50e35ac328402b99f863d11cecc5dc7_hd.jpg)

在数据预处理层面独立出了风险画像和DataProxy两个服务。

**风险画像服务**为引擎提供实时的用户、订单的画像（用户等级、用户行为标签、订单资源标签等）作为规则和模型的输入变量；其数据来源是实时的引擎数据、准实时的MQ数据清洗服务、离线的数据导入三部分。

**DataProxy服务**包装了所有对外的接口和数据库的访问，并针对数据特性的不同配置了不同的缓存策略，保证99.9%的请求在10ms内获取到所需的数据。

此外还有以下几个主要的服务：

**名单库服务**，支持多个独立的名单库，优化了名单判断逻辑，使得单次查询（10个维度）的响应小于10ms。

**配置服务**，集中系统内各个应用需要配置的功能，提供中心化的配置服务让各个应用获取响应配置。

**事件处理平台**，用于处理引擎无法判断或需要人工干预的事件。

**性能监控服务**，监控系统内各服务的健康状态，提供预警和报警功能。

**业务监控服务**，监控规则模型运行情况、返回的风险结果、事件耗时等业务层面的数据，提供预警和报警功能。

Aegis系统上线后，新风控业务接入时间缩短到一周，在10x流量增加和执行更多更复杂的规则的情况下，平均耗时控制在300+ms，比上一版本提高了1倍多。

之后Aegis家族又增加了两个重要的子系统：Sessionizer和DeviceID。这两个服务属于准实时处理应用，但是都通过预热的方式为引擎提供了实时数据。

Sessionizer，归约用户的页面访问session为反应用户的操作的RiskSession，流程如下图：

![img](https://pic1.zhimg.com/80/v2-09326a727107ad346045ab602e2d23dc_hd.jpg)

其数据处理使用了自研的大数据处理系统Chloro，架构图如下：

![img](https://pic1.zhimg.com/80/v2-2e5055eb326f09d425eac0a3c488d13c_hd.jpg)

DeviceID服务，用于指纹数据采集和指纹识别生成，从而判断设备的唯一性，同样也借助了Chloro进行数据处理，系统示意图如下：

![img](https://pic4.zhimg.com/80/v2-37f671dcc6e84efaef4dab17458aec5f_hd.jpg)

这两个服务为规则和模型以及人工处理提供了非常关键的判断数据，进一步提高了风险判断的准确性。

只此，Aegis系统的功能已比较完善，但在1年多的运行过程中发现随着流量和规则、模型量的持续增长，实时风控的响应时间出现缓慢下滑的趋势，超时（1秒）的量在千分之一上下，然后就有了之后持续的性能优化。

**四、针对实时风控的性能优化**

性能优化从1年前开始，可以分以下几个主要优化：

**1、规则分布式并行执行**

![img](https://pic2.zhimg.com/80/v2-a6dc1576f7901bded13f3bdc399fb48d_hd.jpg)

将单个事件需要执行的规则和模型拆分到同一逻辑组内多个服务器执行，最终合并数据。这个优化将平均耗时降到了200+ms

**2、脚本执行引擎切换Drools到Java**

使用模版屏蔽编写规则时drools的特殊语法，之后将脚本编译成Java class执行。规则的执行性能提升1倍，整个引擎的实时平均耗时降入100ms。

**3、开发Java的模型执行引擎**

已完成随机森林和逻辑回归算法的Java版，相较使用Python，提高了一个数量级的性能。

完成上述优化后，整个系统在短期内，只需要简单的增加服务器，就可以满足容量扩张。

以上就是Aegis系统的架构和演进过程，当然演进的过程还在持续，现阶段的目标是将平台化的系统继续发展，做到服务产品化。

【作者简介】蒋一新，携程风险控制部技术专家，负责风控运营平台、数据分发、关系图谱、名单服务等多个风控子系统；风控引擎性能优化主要实施人员。

本文首发于GitChat，转载请注明。

**更多携程技术人一手干货，欢迎搜索关注“携程技术中心”微信公号~**

# 干货 | 构建风控系统之排坑扫雷（一）

[![嘶吼RoarTalk](https://pic1.zhimg.com/v2-2e80ce7ba278017115a176c46fe6910c_xs.jpg)](https://www.zhihu.com/people/hou-hou-4-12)

[嘶吼RoarTalk](https://www.zhihu.com/people/hou-hou-4-12)

网络安全观察者

6 人赞同了该文章

二十一世纪，互联网已经充斥在我们生活中的方方面面，人们在获得便利的同时也面对着大量的风险产生，或黑产、或漏洞、或泄露导致的风险问题层出不穷，到如今，我们每一个人不再是这场安全攻防战中的看客，每一次问题的发生，风险都可能直接影响到我们，轻则个人基础信息泄露，重则账号、账户资金被盗，更有甚者可能直接失去了即将到手的总统之位。至此，越来越多的企业开始关注安全，尤其是业务安全，其中大部分选择自建业务风控体系，今天我们聊聊在自建过程中的一些“坑”。

业务风控离不开数据，数据是否多而全将直接影响到风控精准度和范围，但要收集多而全的数据并不简单：



## **1） 数据字段不统一**



![img](https://pic4.zhimg.com/80/v2-e76db3ee7d08d2bf49414bb89a94059b_hd.png)

企业内部各产品线由于业务逻辑的不同，开发人员开发习惯的不同，设备渠道的不同，相同含义的数据字段会被定义得五花八门，如代表账号唯一标识的，可能会有account、account_id、account_uuid、id、aid等，又比如手机端和网页端的HTTP头的一些自定义属性命名的不同，这是都是无法避免的，但风控系统需要将这些格式化为标准规范，因为在进行规则配置和事后分析中，我们需要将相同的信息进行关联，此时相同含义的字段被标准化为同一字段就尤为重要，所以风控系统需要有适应的能力，常见的做法有两种，风控系统使用标准的字段表提供业务方来映射后接入，或由风控系统来拥提供字段映射的能力，将五花八门的字段映射成标准规范字段，两种方法没有好坏之分，主要看推行力度。





## **2） 层出不穷的衍生字段**

![img](https://pic2.zhimg.com/80/v2-622cbf2b707c62a462bcd3b369e139c5_hd.png)

接入的数据日志是为了后续的规则、模型服务的，在安全攻防的过程中，规则和模型几乎是天天在变，无论是规则策略本身，还是规则阈值，都会在应对层出不穷的恶意用户的对抗中不断调整，此时原生的接入日志就会显得不够看了，试想下以下场景：

接入了IP地址，业务方发送过来的IP地址为1.2.3.4，原先规则只需要对是1.2.3.4的进行黑名单的命中，很好，我们直接将这原生的IP进行配置，实现了恶意IP的封堵。但是过几天（理想太丰满，一般也就最多1小时了），恶意用户来了一堆1.2.3.5，1.2.3.6的IP进入了，此时原生的就不够看了，我们取巧可以通过配置一些IP前缀（startWith）等于1.2.3的规则来代替（机智脸）。可又过了没多久，恶意用户变成了更分散的IP进行频繁尝试，我们发现唯一的特征是这群IP归属地都是上海，这时候已经很难通过后面的规则进行配置了，就算可以跟着hard code出归属地，最终你会发现，恶意用户又改变了，这次使用的是一堆代理IP。（奔溃中。。。）

通过上述这个“栗子”，我们发现攻防中变是必然的，并且是极高频率的，诚然，我们可以将这部分逻辑做到规则中去，但是个人觉得规则引擎分担的是规则类型，规则逻辑，而这种转换的工作，字段属性的衍射，应该放在字段预处理中，使风控系统在字段配置表里加入新增预处理字段的能力，来扩展出这些更多维度的衍生变量。



## **3） IP取值逻辑**

在企业内部，当你辛辛苦苦和业务方沟通完风控系统的接入方案，开发环境、测试环境都联调妥当后，上生产了，激动人心的时刻到了，一验收，IP和当时开发、测试环境一样，依旧是内网IP，此处省去内心奔溃一万字。。。这种坑极其常见，主要由两类情况导致的：

a)IP获取方式错误，现今手机端比重已经是主流，大部分的核心业务都是主推APP，这时候有的业务方会直接在APP前端去获取IP地址，然后将数据抛给风控系统，此时获取的IP就极容易变成该终端设备wifi环境下的内网地址，完全没有参考意义。而正确的做法应该是从业务方的服务器去获取真实的客户端地址。





![img](https://pic1.zhimg.com/80/v2-aa4e90359fa372e053eaf35833754134_hd.jpg)

b)第二个主要是由于前端路由配置问题导致的，如Big F5、nginx，配置不同直接可能导致在内网跳跃过程中，将真实的IP丢弃，从而导致取到了路由的内网地址。一般情况，如用的是nginx代理，X-Real-IP和X-Forwarded-For都是可以的，但是如果web拓扑是多层nginx代理，则需要取X-Forwarded-For的第一个IP，这是由nginx内部代理一路带过来的，才是真实的客户端IP(这里其实真实的场景会更为复杂，也要根据HAProxy和nginx的具体位置来确认配置参数)。这边也提一下环境中软件版本的一致性也是尤为需要重视的，本人之前就遇到测试环境和生产环境由于jar版本的不一致性，导致相同配置无论如何在生产上都获取不到外网IP的情况发生，尤其需要注意。





## **4） SDK相关的一些“坑”**

环境设备信息、设备指纹已然成为了业务风控的标配，业务方上报事件的时候，单纯的业务属性字段，公共服务的访问日志，设备信息已经成为了业务风控的三叉戟，在业务风控中扮演着不可或缺的角色。而设备信息与指纹并非只是简单的在web中植入webjs，在app中植入SDK就好的，会遇到很多坑。

**a)渠道与数据收集**

业务风控系统在收集设备相关信息的时候需要了解本次用户的访问渠道到底是web、wap、android、IOS等，对于这些渠道可能之后会有不同的风控权重。而现在一些比较流行的H5页面，大部分是通过手机端去访问的，这时候可能会面对的冲突是H5也植入了web设备指纹，而手机端也植入了sdk的设备指纹，此时以哪个为准，一般我们更建议以手机端的SDK收集作为主要参考依据，因为从实现逻辑来看更成熟，也更精准。但这不能一概而论，因为此时app与其访问的H5页面很有可能是两条业务线，这时候单一的顶替就会出现问题，因为不同业务线基于的设备信息并不一定一致，渠道风险度也不尽相同，这时候需要具体情况具体分析，一味着一条路走到底是行不通的，之后会遇到死胡同。

**b)采集信息真伪与运用之坑**



![img](https://pic3.zhimg.com/80/v2-7f1764d1306c138f6ef18d96bf3145ae_hd.png)

![img](https://pic3.zhimg.com/80/v2-1de35a92a92e9fcde119522a029530f6_hd.png)

设备信息和业务数据不一样，业务数据是由业务方发送，几乎不存在数据真实性问题，但在采集设备信息的时候一定要确保数据的真实性，因为后续的风控规则很多会基于设备信息和设备指纹来做，举个例子，很多时候我们会根据类似imei，serialno，idfa，imsi等的信息来作为设备指纹和信息的一些重要参考依据，但由于有些手机运营商的策略，一些恶意用户存心篡改，自身SDK的取值兼容性问题可能直接导致我们取来的数据是假的，空的，或者并非我们想要的。而很多风控规则会需要使用到设备唯一指纹这样的属性，这时候就需要考虑很多了。

首先技术对抗是不可避免的，不然任何方案都是徒劳。其次设备指纹的生成逻辑，不能随机生成，也不能简单的放在content provider/storage/key chain里，这样极其容易被修改和清空，导致后续无法关联。还有就是需要关注各类篡改软件、模拟器设备等恶意软件的一些更新，也从他们的patch中来重新审视自身的SDK是否过硬，否则这些都将成为日后规则运营挥之不去的拦路虎。

> 注：本文为 歲歲 原创稿件，未经许可禁止转载

# 干货 | 构建风控系统之排坑扫雷（二）

[![嘶吼RoarTalk](https://pic1.zhimg.com/v2-2e80ce7ba278017115a176c46fe6910c_xs.jpg)](https://www.zhihu.com/people/hou-hou-4-12)

[嘶吼RoarTalk](https://www.zhihu.com/people/hou-hou-4-12)

网络安全观察者

14 人赞同了该文章

## **规则之坑**

## **黑白名单的“陷阱”**

在业务风控里，黑白名单是最好用的，也是最简单粗暴的，简单粗暴意味着容易出现问题，一不留神就会把自己“坑死”，一次随意添加黑名单数据可能会直接侵害大部分的正常用户，同样的，白名单的随意添加直接可能为恶意用户打开便捷之门。

一般我们在建立风控策略的时候，黑白名单策略永远是我们的第一个选择，矗立于所有策略前，原因有两点

![img](https://pic1.zhimg.com/80/v2-d2b829e63f81c42a3736ba3c7d53e58c_hd.png)



1） 黑白名单应该是我们最有把握的，黑白名单的每一次添加和移除都需要经过深思熟虑严格审核，我们来分别看下黑白名单：

黑名单的来源与注意点：

从历史恶意样本中提取，这部分数据由于是从业务历史数据中提取出来，是最贴近业务的，也是后期风险模型最为宝贵的数据源，通常我们会从中提炼出一些黑设备、黑IP、黑身份证等信息。

第三方平台，论坛、IM、收码平台、代理/VPN IP、司法公示信息等都可以作为有用的信息来源，在获取上可以通过一些爬虫手段来丰富数据来源，对于爬虫，不同语言都有不少较为成熟的框架，如heritrix、scrapy等。亦可以通过一些特定环境下的技术手段，如端口扫描，目标论坛的已有账户爆破等，此类获取途径一般都具有极强的针对性。

其他来源，恶意用户一定会使自己的成本（猫池设备的花销，卡的维护，购买泄露账号信息等等）利益最大化，在各家业务的“风眼”进行薅羊毛、多头借贷，此时“互联”的思想在风控过程中尤为重要，众人拾材火焰高，所以黑名单也需要考虑从其他公司进行共享，联防，但这部分数据加入到黑名单需要通过业务的契合对比和较长时间的灰度测试，在后期应用时也需要做一定的区分

另外黑名单还尤为值得注意的是“进”和“出”，对于“进”，黑名单不能只是个大池子，内部必须切分成多个小池子，在进行黑名单匹配的时候应该也必须有能力去观察是否在哪几个池子中出现，标签是个不错的选择。而对于“出”，纵使对某个黑数据再置信，都需要对其有洗白的机制，不然这个“暗雷”总有一天会爆发，通常，洗白的手段有通过设置过期时间（TTL），被特定业务场景触发等，这里我们简单描述下过期时间（TTL）如何制定，一般TTL的制定分固定时间和动态时间两种，前者更为方便和普遍，这里主要说下后者，本人更偏向使用动态时间来指定TTL，所谓动态时间，即通过不同的因素制定权重来设定TTL，通过影响其的因子有以下几类：



> 数据的置信度，不同数据源对TTL的贡献需要被权重化，通常历史恶意样本的权重会相对更高
> 业务的契合度，相同数据在不同业务场景的得分也会不同，这里需要考虑业务场景的契合情况
> 数据类型，不同维度的数据类型对于TTL的影响也相当大，如IP的黑属性跃迁将明显比手机频繁



![img](https://pic2.zhimg.com/80/v2-cc6a2e77a158c24946d464313835b9d5_hd.png)

还有一种比较普遍的方法是通过计算得分来判断是否达到了黑属性的阈值，此时一般就不再使用过期时间，而是通过数据在池子中的时间来做衰弱递减，并结合其他的因子给出不同的得分情况，当得分随着时间推移衰减导致最终得分小于黑名单的阈值，则认为不命中黑名单。这种方式去除了过期的概念，而将风险属性分值化，时间也作为一个因子参与评分。



我们再说下白名单，白名单的来源会相对更为集中：



> 通常白名单来源会有一些公司出口IP、移动运营出口IP，特殊的设备指纹等
> 还有一些企业允许用户可以通过客服或者IVR来进行添加白名单的自助服务

这里需要注意的白名单的添加需要谨慎，如果所有的添加都是由风控人员操作的，那么只需要关注添加的筛选方式，而如果部分添加是暴露给用户的，那么需要关注自助添加的流程是否存在漏洞，是否可能被恶意用户进行利用来规避规则命中情况的发生。

2）黑白名单矗立于所有策略前的另外一个原因是效率，很多时候在一些复杂场景下，风控人员会配置大量的规则策略，有些是可以通过自有变量直接计算的，有些是维护在内存中进行累计对比的，还有需要做一次甚至多次关系型数据库的检索结果对比的，

当然也可能是大数据离线任务做的准实时结果参与的计算，这些都告诉我们，策略规则的计算是非常“重”的，从逻辑上讲，当事件命中了某个黑名单或是白名单，后续的策略也没有必要继续下去，风控结果也会直接返回。从技术角度出发，每次过“重”的策略规则将占据大量的线程资源、内存资源，也会造成不必要的资源浪费，在某些极端情况可能会造成线程排队等情况的发生。

## **常见风控规则的“陷阱”**

除了刚提到的黑白名单策略，风控系统应该还具备配置其他的常见策略，而这些常见策略在配置过程中很多时候也会遇到不少雷区，这里我们不讨论具体策略，一起来看下可能遇到的问题

**基于次数的统计类策略**

对于频繁访问，频繁交易，缓慢定点攻击等场景，我们第一反应会考虑使用统计类策略来进行防御，将那些具备相同特征的用户、IP、设备等维度挡在风控的墙外，这里会遇到的问题是对于“频繁”的解读，何为频繁？多少次算频繁？如何定性阈值就成了关键，定小了，查准率无法保证容易误伤，定大了，查全率又下降的厉害，并且又由于节假日，业务高峰、低谷、活动营销等多种因素，导致固定的阈值可能会带来很多问题，这里更倾向于变量，此时比较合理的做法是将阈值支持公式加载，而不是常量，比如你可以任性的使用99线的x倍、平均数的y倍、中位数的z倍等作为一个一直在变化的阈值，有能力的话，依赖于模型会更好。

![img](https://pic2.zhimg.com/80/v2-0601267ea109e44bda67ca17abed10f5_hd.png)



**用户画像策略**

同样的，在建立一些用户画像策略时候也会遇到这样的问题，如常用地策略，在风控中，我们经常会去判断用户当前行为的设备、地理位置等是否是其常用设备、常用地，而对于常用的概念也推荐是可配置的，因为一旦固化，那么被绕过的可能性将大幅增大（可配置本身并不能提高任何安全性，但是它却可以帮助我们快速变更策略，并且可以结合模型来适应当前环境）。

举个常用归属地的配置参数：

1.常用维度定性：



> X天里出现过Y天
> X次里出现过Y次
> X周期内出现百分比大于Y%
> 混合使用

2.是否去除干扰：



> 短期内连续出现是否需去燥
> 单位周期内连续出现是否需去燥

3.应对极端情况：



> 无历史数据的或少量历史数据时（如新用户或冷号）如何筛选
> 极大量历史数据如何截取有效数据区间

另外一些投资购买偏好等画像更需要跟随业务做快速变更，一旦业务发生调整，或有新的业务线或者活动，策略也应该快速变更。这里还有一点需要注意，每一个策略的作用域一定要控制，这就如同永远不要在sql里使用select *，抛开性能不谈，一旦如果在中间插入某列，你原来的代码就极其有可能需要改造，所以同样的，如果你没办法让所有的业务方第一时间通知你新上的业务，那么你在运行的策略就得与新业务保持距离。

**CEP策略**

越来越多的规则引擎都崇尚对CEP策略的支持，但一来规则引擎本身维护CEP策略的方式就很“黑盒”，需要技术人员专门对其进行深入了解，如内存的管理，性能的调优，这里暂且抛开技术不谈，个人并不是非常推荐使用CEP策略，原因是过于复杂，风控策略可以从各个维度去侧写，一个场景可以有多条，但是个人认为每一条应该尽可能保持简单，就如同你可以将多个策略编写成一个复杂策略集，但这样其实会让可读性下降，保持多个简单策略可以让风控运营人员在人工审核时更便捷。如果一些无法避免的场景需要用到复杂策略的时候，一定要将逻辑和边界写清楚，否则会埋下很多“伏笔”。



> 本文为 歲歲 原创稿件，授权嘶吼独家发布，未经许可禁止转载，如若转载，请联系嘶吼编辑： [构建风控系统之排坑扫雷（二）](https://link.zhihu.com/?target=http%3A//www.4hou.com/info/industry/3251.html)

# 搭建风控系统道路上踩过的坑（1）-信息采集

[![岂安科技](https://pic2.zhimg.com/v2-f1b7ad9fe2b72f04f5ad22eab778c50d_xs.jpg)](https://www.zhihu.com/org/qi-an-ke-ji)

[岂安科技](https://www.zhihu.com/org/qi-an-ke-ji)

线上行为分析解决方案专家

5 人赞同了该文章

## 作者前言

从业近10年，大大小小参与了3家公司不同领域的风控系统的设计，从前到后把风控系统所有环节都细细的琢磨过，然而至今仍然感觉刚刚一只脚踏进门而已。



大多数人做的产品都是目的明确的，比如订单支付、账户体系要做什么一开始就知道了，而且也有很多的竞品可以去参考；风控系统却完全不一样——未来要面对什么问题不可能完全了解，做每个功能都谨小慎微，因为一个不注意走错了方向，可能就会在未来的某个阶段要全盘推翻。



而对于研发资源紧缺的安全需求来看，往往会在某个时间把自己摆到一个非常尴尬的境地，问题解决不了，改造又面临大量的时间和沟通成本。



所以，把本人踩过的一些坑在这里分享出来，让准备搭建风控的人心里有个数。





## 业务安全风控设计101-信息采集



**业务风控主要做四件事：**

- **拿到足够多的数据**
- **做足够灵活的分析平台去分析数据**
- **产出风险事件进行阻拦风险**
- **量化风险拦截的价值和不断分析案例进行策略优化**



拿数据这件事几乎是决定风控系统成败的核心，由于篇幅问题我们先主要说这点，主要有三件事要考虑：





## 1 拿到的数据越详细越好：



拿账号安全这件事来举例子，如果能拿到**基础的登陆注册数据**，就可以从频率、登陆注册特征来进行分析；

如果可以进一步拿到**登陆注册行为的上下文**，比如登陆前访问了哪些页面，登陆后去访问了什么，就可以从访问行为轨迹来增加更多的分析维度，例如页面停留时间，是否有访问到必访问的页面等；

如果还可以拿到**用户的操作行为数据**，比如鼠标移动的轨迹，键盘输入，那么可以进一步的从操作过程来增加分析维度，比如是不是输入密码的时候有过多次输入删除？是不是直接复制粘贴的账号密码？





## 2建立标准的日志格式：



确认好能拿到哪些数据以后，就要开始建立**标准的日志格式**。

常见的登陆、注册、下单、密码修改、绑定凭证修改等等都要给出一个标准的日志格式，而且要充分考虑到字段命名的统一，比如密码、用户名字段的名称如果在不同的日志中叫法不统一，在后续分析和指定策略的时候都会遇到不小的麻烦。





## 3拿到的数据质量：



- 必要的字段是否都能拿到？



往往风控关心的信息比如IP地址、UserAgent、referer这些信息业务都是不关心的，但这些信息的缺失可能造成很多策略没法做，所以在采集信息开始的时候就要有个明确的信息列表，一旦妥协了后面再去返工让研发加是会遭白眼的。



- 数据信息拿的是否准确？



比较常见的是需要用户的访问IP，结果拿到的IP地址是内网的服务器IP；或者是想要用户名，结果传递过来的是UID。这点需要大量的前期沟通确认工作，一旦上线了以后发现数据不对再改也同样要遭白眼。



拿数据有**主动方式**和**被动方式**两种：



**1主动方式**



主动方式是自己去数据库、日志里面去读。

这种方式实时性比较差，而且基本有什么拿什么，想加信息是比较难的，但不需要研发配合太多事情，适合喜欢自己动手丰衣足食的场景。

当然有些比较成熟的公司有自己的消息总线，风控可以去实时的订阅信息然后作为数据源进行分析，但这种通常为少数；



**2被动方式**



被动方式就是提供接口给研发，让业务把消息按格式标准喷过来。

这种配合周期非常长，但可以按照标准来拿到高质量的信息，所以是比较常见的风控系统搭建方式。





## 踩坑记



**1号坑：**



如果拿消息是多数据源的时候，必须要考虑到**消息的时间序**问题：

比如登陆日志是公共服务发过来的，网页访问是拿的access_log，用户操作行为数据是页面JS或者SDK发过来的，那么这三者的时间是不一致的。

这就必须要在确认所有的消息到位之后再进行分析判断。否则，如果实时策略考虑了登陆的时候必须有页面键盘点击，而两个数据到位的时间不一致，就可能出现大量的**误封**造成事故。





**2号坑：**

对采集回来的数据必须定期的**对数据质量进行监控**——

已经采集到的数据可能因为技术架构调整，代码更新等各类奇葩原因造成采集回来的数据不准了，如果无法及时发现可能造成后面一系列分析过程都出现错误。





**3号坑：**

采集点尽量选择**稳定的业务点**，比如采集登陆日志，一次性在公共服务采集好，后面出现问题只要找一个点。

如果是去前端从WEB、移动端等各个调用登陆服务的点去采集，出了问题要改动的工作就会成倍增加，还有可能出现新业务点的日志无法覆盖的情况。





**4号坑：**

关于**技术选型**：

消息队列是必须的，用restful只能处理业务日志比如登陆这种1秒最多几次的类型，如果后期要去采集页面访问行为这种一秒上千的消息就必须要用到队列.

开源的可以考虑RabbitMQ或者Kafka,稳定性都还不错。





**5号坑：**

关于**日志存储**：

ELK是不错的选择，为后续的分析平台提供基本的查询功能。





## 结语



信息采集往往是实施风控的最难的一个环节，但也是最重要的环节，覆盖、质量、时效都决定了项目的成败。

因为出于沟通的压力，往往会有比较多的妥协，也就为后期风控系统的搭建埋下了隐患，其实也很难一篇文章把细节描述详尽。

如果你在这方面遇到了难点，**欢迎留言和我们沟通交流**，如果对接下来的内容感兴趣，请分享鼓励一下小编，我们会尽快给出后续的章节。





**作者介绍**



> **刘明 岂安科技联合创始人，首席产品技术官**
>
> 超过6年的风控和产品相关经验，曾就职网易，负责《魔兽世界》中国区账户体系安全。现带领岂安互联网业务风控团队为客户提供包括了明星产品Warden和RED.Q的风控服务。

# 搭建风控系统道路上踩过的坑（2）-风险分析

[![岂安科技](https://pic2.zhimg.com/v2-f1b7ad9fe2b72f04f5ad22eab778c50d_xs.jpg)](https://www.zhihu.com/org/qi-an-ke-ji)

[岂安科技](https://www.zhihu.com/org/qi-an-ke-ji)

线上行为分析解决方案专家

4 人赞同了该文章



上一篇**[《搭建风控系统道路上踩过的坑01--信息采集》](https://zhuanlan.zhihu.com/p/31285366)**我们介绍了第一点，如何去获取足够多的数据，而接下来的事情就是要创建一个机制去灵活的处理这些信息，为自动分析捕捉风险事件提供基础原料，进而借助规则引擎从中分析出风险事件。



在开始前，我们还是回顾下**业务风控主要做的四件事：**





![img](https://pic4.zhimg.com/80/v2-0972ead34d70282c83b9a91815123fa7_hd.jpg)





**1、拿到足够多的数据**



**2、做足够灵活的分析平台去分析数据**



**3、产出风险事件进行阻拦风险**



**4、量化风险拦截的价值和不断分析案例进行策略优化**



接下来，同样的有三件事情需要考虑：



1**让分析人员可以快速的查询原始日志**



日志并不是简单的存下来，从风控分析的需求来看，通过IP、用户名、设备等维度在一个较长的跨度中搜索信息是非常高频的行为，同时还存在在特定类型日志，比如在订单日志或者支付日志中按特定条件搜索的需求。

而这些主要是为了能够让分析人员可以快速的还原风险CASE，例如从客服那边得到了一个被盗的案例，那么现在需要从日志中查询被盗时间段内这个用户做了什么，这个过程如果有一个界面可以去做查询，显然比让分析人员用grep在一大堆文件中查询要快的多，并且学习门槛也要低得多。

如果在日志做过标准化的前提下，也可以进行后续的业务语言转译，将晦涩难懂的日志字段转化为普通员工都能看得懂的业务语言，也能极大的提升分析师在还原CASE时阅读日志的速度。



2**实时或定时的计算加工消息成变量&档案**



例如在分析某个帐号被盗CASE的时候，往往需要把被盗期间登录的IP地址和用户历史常用的IP地址进行比对，即使我们现在可以快速的对原始日志进行查询，筛选一个用户的所有历史登录IP并察看被盗IP在历史中出现的比例也是一个非常耗时的工作。

再比如我们的风控引擎在自动判断用户当前登录IP是否为常用IP时，如果每次都去原始日志里面查询聚合做计算也是一个非常“贵”的行为。

那么，如果能预定义这些变量并提前计算好，就能为规则引擎和人工节省大量的时间了，而根据这些变量性质的不同，采取的计算方式也是不同的。不过还好我们有一个标准可以去辨别：频繁、对时效敏感的利用实时计算（比如访问频率、时间间隔）；而相对不频繁、对时效不敏感的利用定时计算（比如用户的常用IP、设备，即使少算短期内的登录记录，也不会受到太大影响）。



3**选择规则引擎将人工策略自动运行**



**一个设计优雅的规则引擎是把分析师的经验决策和数据最终转化为风险输出的核心模块**，首先说为什么需要规则引擎而不是选择硬编码逻辑——

笔者无数次遇到过这种场景，一个上午刚刚上线的策略，没过1个小时，攻击者或者欺诈者就已经试出绕过策略的方法了，如果你的风险控制逻辑是硬编码，那么恭喜你，再走一遍开发测试发布流程。

快速响应是安全的生命线，无法想象还有比被攻击者胖揍48小时然后才反应过来去挡脸更让人沮丧的事情了。

所以策略引擎必须能把策略逻辑从业务逻辑中解藕出来，让防御者可以灵活配置规则在静默模式下验证和实时上线生效，并可以去随时调整。

类似的开源框架有很多，各有优劣，但如果需要降低学习曲线，必须进行一层包装（这里又是一个比较大的话题，就先略过了）。





## 坑位标注：



**1、Sharding会影响到你的策略**



为了支持并发和性能，通常在利用集群计算变量的时候我们会用到sharding。

sharding方式会按IP把数据分配到不同的运算单元中去处理，在读取结果的时候按IP去集群中的某台机器中去拿数据，以大幅提升并发处理读取计算结果的能力。

那么，现在如果我想去按某个USER去拿数据的时候，就会发现一个用户在不同IP下的信息被保存在不同的服务器上了，所以单一的Sharding分配肯定是不合理的，这点必须要注意。



**2、策略中用到的变量，能不用现场算的就不用**



有些简易的策略引擎设计中用到的变量都是到数据库里现场算的，虽然可以极大的提升灵活性（新的变量不需要考虑历史数据回补），但会极大的影响稳定性和响应时长，尤其在业务请求爆发的时候几乎都会出现宕机无响应的问题。

要知道业务研发对安全的结果并不是那么敏感，但如果出现了问题导致应用不稳定给人添麻烦，被抛弃可能就是早晚的事情，所以变量一定要尽量做到提前计算，并且设立缓存机制。



**3、对风险分析要用到的计算资源有充分的认识**



毫不夸张的说，合格的风险分析要做的实时、准实时计算量要大过应用内所有计算的总和甚至超过几倍。

其实这也很好理解，比如一个典型登录场景，业务要做的逻辑最主要的就是检查密码和帐号的身份是否吻合，而风控要把这登录用户的历史档案全部拉出来看个遍，然后根据风控策略来决定是否放行。所以在规划风险分析要用到的资源时请不要吝啬，按业务5X甚至10X的标准来评估风险分析的资源需求。

如果说信息采集主要看的是安全产品经理的沟通协调能力，设计风险分析功能更多的就是考验安全产品经理的逻辑思维能力。

到了这样一个阶段，外部冗杂的沟通协调已经结束，但如何最大化利用前期打下的基础，需要对风险问题的分析、决策过程有一个非常清晰的认识，这里也有一个比较好的标准来去检验：

分析平台设计的差，那么就只有设计者自己会用；

设计的好，你会发现处理投诉的客服、分析师都会很乐意来用你的分析平台为他们解决问题。





## 结语



下一篇我们会继续介绍如何把分析出的风险结果自动快速的进行阻断，欢迎继续支持我们。如果你在这方面遇到了难点，**欢迎留言和我们沟通交流**，如果对接下来的内容感兴趣，请分享鼓励一下小编，我们会尽快给出后续的章节。



> **刘明 岂安科技联合创始人，首席产品技术官**
> 超过6年的风控和产品相关经验，曾就职网易，负责《魔兽世界》中国区账户体系安全。现带领岂安互联网业务风控团队为客户提供包括了明星产品Warden和RED.Q的风控服务。

# 搭建风控系统道路上踩过的坑（3）-阻断风险

[![岂安科技](https://pic2.zhimg.com/v2-f1b7ad9fe2b72f04f5ad22eab778c50d_xs.jpg)](https://www.zhihu.com/org/qi-an-ke-ji)

[岂安科技](https://www.zhihu.com/org/qi-an-ke-ji)

线上行为分析解决方案专家

3 人赞同了该文章



本系列的上一篇文章[搭建风控系统道路上踩过的坑02-风险分析](https://zhuanlan.zhihu.com/p/31331140)，我们介绍了在采集信息后如何去分析这些数据产出风险事件，而产出的报警已经脱离了业务系统并不能被采用的。



说白了：**分析出来的东西不能光自己看着High，还得去阻拦这些风险才能真正产生业务价值。**



在开始前，我们还是回顾下**业务风控主要做的四件事：**





![img](https://pic4.zhimg.com/80/v2-0972ead34d70282c83b9a91815123fa7_hd.jpg)





**1、拿到足够多的数据**



**2、做足够灵活的分析平台去分析数据**



**3、产出风险事件进行阻拦风险**



**4、量化风险拦截的价值和不断分析案例进行策略优化**





到了第三步我们离整个系统核心框架的搭建就只剩一步之遥了，那么让我们看看这个环节要考虑什么：



**1、最终呈现给业务研发直白的判定结果**



我们最终从数据中发现的报警和问题最终是要在业务逻辑中去阻拦的，在接入这些结果的时候，往往分析师觉得可以提供的信息有很多，比如命中了什么规则、这些规则是什么、什么时候命中的、什么时候过期，其中最让接入方心烦的当属风险分值当仁不让了，很多接入风控的研发看到这些分值就一脑袋包：



你到底想让我做什么，拦还是不拦？这时候如果你喏喏的再丢出个多少分值以上要拦，研发多半都会跟你说直接给我结果就好了。

是的，很多风控接口设计的都十分累赘，无用信息多到研发会觉得你在故意浪费带宽，其实一个code list给他们说明对应希望做的操作就好，一定把你觉得那些很牛逼的中间结果等等包装成最终结果再给出去。



**2、T＋0还是T＋1**



举个例子来解释实时(T+0)和异步（T＋1）风险判断的区别。



> **T+1**
> 你在打拳击比赛，选手A只会打脸，上来就照着你脸来了一拳，你分析了一下打脸很疼而且不科学，在第二拳往脸挥过来时你突然告知对方不可打脸，对方就成功的被你克制住了。这就是**T+1**的特点，至少要在第二次风险攻击才可以生效；
> **T＋0**
> 拳击比赛第二场对阵选手B，同样被打脸后你说不可打脸，对方说好，结果冲着肚子就来了一拳。你说禁止打肚子，对方又一拳打腋下。这时你发现要在对方挥拳马上打到你之前就要禁止。
> 这就是**T＋0**了。



因为T＋0在接入的时候要额外承担很多计算成本，结果要现场算出来而延时要求又很高，所以一般都只在攻击者得手关键步骤采取实时判断（比如订单支付或者提现请求）。而对于其他场景可以选择T＋1方式，比如登录或者提交订单等。



**3、阻断逻辑到阻断产品**



这一点我们岂安在对外演讲的时候介绍过很多，在阻断风险的时候事件发生的点是不同的，但短期又不可能让业务研发在所有的地方接入风险阻断怎么办？



所以我们需要考虑几个基本的保底措施，比如统一的验证码验证页面在IP层全局防止任何爬虫脚本行为，在账号层通过登录态管理统一拦截单个账号在登录后任何风险行为（全局强制登出）。



可能这些措施在体验上不是最好的，但是在发生特殊问题的时候要等研发给你临时加阻断逻辑这个时间就没法控制了。



## 坑位



**1、接入风控阻断的逻辑位置**



登录的时候账号输入框鼠标失焦就要去走风控了，登录结果出来之后再去判断就没意义，而资金相关的一般是在跳转去收银台之前，你会发现一般风险判断都是在结果出来之前（收集本次行为完整日志之前），所以如果你要做T+0判断，就要求研发在进行风险判断的时候要提供更完整的信息，而不是只给个IP或者账号名就行了（往往T＋1就之要这些就够）。



**2、对业务流量充分调研并关注**



平时可能流量很小的业务，突然因为某个活动（比如秒杀）流量大增，除了在接入之初要对风险判断请求有了解，对后续的活动也要提前准备，否则如果资源预估不足，突然又赶上这个点接了T+0接口有很多要现场计算的逻辑，陡增的业务流量分分钟教你做人。



**3、bypass ！ bypass ! bypass**



风控风险判断的最基本原则就是要不影响业务逻辑，所以超时机制在一开始就要严格约定并执行，一旦发现风控接口超过预计响应时间立马放行业务请求。



**4、让一线同事们知道你在做什么**



任何风控准确率都不是100%的，所以在和研发沟通好接入后一定要告诉一线同事们风控阻断可能出现的表象，以及大致的原因，以避免一线客服们对风险拦截的投诉不知道如何解释，并给出具体的阻断回复措施（加白名单、删除黑名单等等，上帝们在某些日子比如315维权意识是非常强的）。



## **结语**



阻断是最终产生真实价值的环节，另外也是关联部门最敏感的环节（吓唬我半天逼着我把风控接了，结果一天到晚给我出毛病？生产环境是给你们玩的？！），请保护这至关重要的信任，你后面会越做越顺的。

最后，请期待我们本系列的**最终话**：《量化风险拦截的价值和不断分析案例进行策略优化》。



**作者介绍**

> **刘明 岂安科技联合创始人，首席产品技术官**
> 超过6年的风控和产品相关经验，曾就职网易，负责《魔兽世界》中国区账户体系安全。现带领岂安互联网业务风控团队为客户提供包括了明星产品Warden和RED.Q的风控服务。

# 搭建风控系统道路上踩过的坑（4）-风险分析

[![岂安科技](https://pic2.zhimg.com/v2-f1b7ad9fe2b72f04f5ad22eab778c50d_xs.jpg)](https://www.zhihu.com/org/qi-an-ke-ji)

[岂安科技](https://www.zhihu.com/org/qi-an-ke-ji)

线上行为分析解决方案专家

1 人赞同了该文章

风控系统和大部分的产品项目一样，最终需要对领导层汇报这个项目为公司带来了什么价值，这是评估项目成功与否的要素；

另外是哪里做的不够好，如果改善了能带来更多的价值，给出了预期才有后续资源的补充，整个项目才能转起来形成一个良性循环。

现在开始说说这个系列的最后一话：



## 如何对风控系统进行效果评估与优化



与之前三期的文章一样，我们再来洗一次脑，业务风控要做的四件事：

> 1.拿到足够多的数据
> 2.做足够灵活的分析平台去分析风险
> 3.产出风险事件进行阻拦风险
> 4.量化风险拦截的价值和不断分析案例进行策略优化

我们看一下这个环节要考虑的：



**01找到钱在哪里**



风控项目的基本价值在于省钱，而省钱的思路基本有三种：

- 直接拦截风险带来的止损（比如提前阻止了一笔欺诈交易所挽回的损失）
- 提升服务稳定性所带来的业务基本指标提升（比如因阻止风险事件所降低的服务响应延时而提升的业务转化）
- 降低服务不可用概率事件所带来的直接业务损失（比如降低了风险事件导致服务宕机所带来的营收损失）

可以看出这三点是按风险事件的暴力程度做出的简单划分，其实也还有很多其他不同的视角来分类，很大程度上和对应企业的互联网业务形态有关。



而我们做这样划分的目的是为了：**在一开始就明确风控项目从哪里可以挖掘效益。**



很多情况下风险事件不是一个独立的问题，而是一个链条，由一些看起来影响不大的问题逐层深入。比如，交易欺诈并不是一个独立的问题，而是因为注册环节发生的垃圾注册问题攻击者手里有了大量的账号所导致的，所以任何一个风险问题都是有价值的。

无利不起早，作为风险分析者应当有能力找到其中的关联转化关系，并预测对方的得手点进行效果评估会有更好的效果。



**02有效利用预期价值的力量**



天下没有100%准确的风控策略，所以在接入拦截的过程中业务方可能存在种种阻力，往往的一个误区是没有拦截就认为风控没有效果。

其实，效果评估不只是在最后项目落地评估价值所用，在推行项目中间也有很好的效果，虽然没有拦截，但预期效果放在那里，这对决策者平衡业务影响有着重要的价值。



**03学会考虑企业财务目标**



风控系统并不是一个可有可无的东西。其实大部分企业中安全已经是业务的必要组成部分了，那么我们知道在资源有限、而业务风险问题无限的情况下，所有的资源投入都必然有一个优先级，而这个优先级与整个企业发展的现状必须是牢牢捆绑在一起的。



讲简单些：**风控系统解决什么问题，评估出的效果与企业目前业务关心的问题息息相关**。



如果企业目前的业务重点在一次年度促销活动，那么风控的重点就应当在促销羊毛党；如果企业目前面临严重的账户盗用投诉问题，那么重点就应在账号安全。尤其在风控系统启动之初，配合系统的需求交付时间选择对应的重点问题，对于项目效果的评估是一个巨大的加分项，切记一开始就贪大贪全。



**04策略的生命周期和健康度**



风控系统的规则有多少？哪些已经很久没有触发了？产生误判投诉的对应规则有哪些？一个新规则在建立起初的效果肯定是最有效的（因为这时风险问题正在发生，而规则正好对应了风险），但随着时间其有效性是呈快速下降的趋势。

比如，攻击者都知道网站三次输入密码错误触发验证码，他们会傻傻的尝试第三次猜测密码的概率有多大？那么，是否有人在定期的去统计分析这些规则的效率？这就是风控产品的重要运营环节了。

而运营风控产品所要付出的代价，往往大于常规互联网业务产品，并且是保证项目能够持续产出价值并不断迭代进化的一个前提。





## 写在最后

业务风控是一个非常具有挑战性的项目，我一直把它比作一种竞技游戏，而这种攻防不同于传统安全（在传统安全你并不能有足够的技术能力预测所有人的攻击方法），它更强调**逻辑和预测**——



**攻守双方在一个双方充分了解的环境下（业务逻辑简单到任何人都可以理解，但又可以产生无数的变化和组合）不断的博弈。**



而这正是业务风控系统的乐趣所在。



业务风险问题足够简单而又足够复杂，正是这样的原因其参与攻击者并没有太高的门槛限制。处于国内互联网的环境下，任何一家企业都不可能逃开业务风险问题的影响。



作一个比喻，这片土壤是有着自己的一些特质的，企业如果是生长在这片土壤中的一颗树，投入足够的养分才能快速生长，而业务风险则是寄生于树木窃取养分的角色，只有能够充分抵御这种风险的才能成长为参天大树。





> **作者简介**
> **刘明 岂安科技联合创始人，首席产品技术官**
> 超过6年的风控和产品相关经验，曾就职网易，负责《魔兽世界》中国区账户体系安全。现带领岂安互联网业务风控团队为客户提供包括了明星产品Warden和RED.Q的风控服务。

## 构建互联网企业风控系统方法论

[阿里云誉反欺诈](https://www.freebuf.com/author/阿里云誉反欺诈)[![认证厂商](https://image.3001.net/images/index/f2.png)](http://www.freebuf.com/bufer)2016-05-12共284629人围观 ，发现 7 个不明物体[安全管理](https://www.freebuf.com/articles/security-management)

## [![security-management.jpg](https://image.3001.net/images/20160512/14630217582714.jpg!small)](https://image.3001.net/images/20160512/14630217582714.jpg) 

## 0×01 风控产品场景与工作原理

**风控概念针对不同的行业(如金融)，不同的业务场景(如贷款)都有不同的解决方案。本文基于上一篇文章[《互联网业务安全之通用安全风险模型 》](http://www.freebuf.com/articles/security-management/98257.html)提到的互联网行业的业务安全通用漏洞模型为背景，以目前风控产品从该模型角度出发，技术层面讲解其中可以用技术来解决的风控防护方案中的人机识别方案。**

个人认为判断一套风控产品的好坏应该具有的特点：有效性、高可用性、高可移植性、实时性。有效性直观反应的是技术上对数据风险的分析能力，使用的分析方法，采取的分析手段等；高可用性是对风控底层架构设计，存储、传输及高并发等各种情况系统稳定的考量；高可移植性也是决定风控成败最关键的指标之一，高可移植性决定风控系统对业务系统的耦合度要相应的低，包括接入部署、决策可控、自身扩展性强等；实时性是在交互系统的各个环节都非常重要，尤其对于支付/交易等重要环节的尤为突出，如何尽可能的保障延迟的架构设计就留给读者朋友自己思考了。

目前国内做风控的厂商也越来越多，针对不同业务也相应推出了不同的产品。技术上的风控体系分解出来主要有几个部份：信息采集系统、风险分析系统、风险决策系统。高可移植性风控产品目前采用的架构架构如下图:

[![风控模型.png](https://image.3001.net/images/20160512/14630196263735.png!small)](https://image.3001.net/images/20160512/14630196263735.png)

## 0×02风控产品构建

信息采集系统的建设，主要指对PC端及移动端H5的可用信息进行布点采集。采集的信息有设备软硬件信息、用户交互行为数据、用户环境信息、用户历史信息、用户业务数据。采集的软硬件信息加密作为对用户的唯一标识符，即设备指纹。关于设备指纹原理请参考:[《设备指纹简析》](http://drops.wooyun.org/tips/14727)，具体的设备指纹代码实现请参考fingerprintjs2，设备指纹设计的重要性对整个风控系统至关重要，做好设备指纹可更好的标识每个用户的所有行为的可；

> 用户交互行为数据的采集主要针对的是人在应用的交互数据，人的正常行为是不可预料且具有相对随机性的，机器要模拟正常人非常困难。交互为先数据的采集主要采集正常人的动作，如鼠标移动、鼠标点击、鼠标释放、触摸板动作、键盘操作。具体比如采集鼠标在某个区域内的连续坐标变化及时间点、键盘操作的时间点及键值等；
>
> 用户环境信息的采集包括用户操作系统版本、cpu集、浏览器版本、屏幕分辨率、屏幕大小、屏幕色彩、浏览器安装的插件、浏览器语言、浏览器支持的字体、用户的ip信息、cookie tracking、每个浏览器针对不同方法的处理特性信息、来源、location等尽可能收集的信息；
>
> 用户历史信息包括历史行为信息，例如交易、支付、登录等；用户业务数据的采集可视情况而定，比如针对用户身份的cardid、手机号、邮箱等。
>
> 风险分析系统的建设，主要是对采集回来的大量信息进行数据分析的阶段，通过对数据的分析，对用户的整体操作行为风险进行评估分值加权。比如设备指纹与账户一一对应的前提下，设备的变动的情况，环境的变化情况，包括IP变动等。行为的分析比如分析鼠标移动的频繁、坐标在某个区域或某个操作下的动作速度、是否为直线或者不可能存在的曲线。或者用户操作的环境及行为不匹配等各种差异情况。历史行为的估值、用户信誉的估值。最终将所有风险加权估值判断。风险分析系统也可在无法确定风险时作出风控二次处理的决策，最终得出用户风险值等。对于风险分析系统的建设，本文只是初略讲解，具体分析风险方法很多，待读者自己挖掘。

风险决策系统的建设，风险决策系统与风险分析系统及业务系统也独立存在，主要针对风险分析的分值，在一定阈值内实现业务打标或者业务清洗的功能。比如对于低于某个分值高于风险分析的用户进行业务打标，然后对用户的操作进行业务层上的限制以积累信用积分等操作。风险决策可根据自身的业务数据进行相应的策略上的调整可控。

## 0×03策略、破解、防护

风控产品的整体架构大体上如上所述，基于该架构下的风控衍生出各自独立的工作模块(子系统)，例如独立的行为系统、设备系统、分析系统、决策系统等等，对于用户感知的无外乎前端行为采集系统或者设备指纹系统。目前国内产品的展现形式有两种，风险识别产品，基于设备指纹、业务数据等进行风险判断服务；风险拦截产品，如阿里的滑动验证和Google的recaptcha对检测出的风险进行风险阻断。如风险拦截产品大致的架构也如最上图所示，前端采集->风险判断->反馈->后台决策的模式。对于互联网企业或者金融公司而言，采集的方式可以有js、客户端、控件等等，采集的内容可以是任何潜在有价值抑或未来有价值的数据，这些数据都直接作为分析决策系统的依据。

防护与对抗是安全永恒的话题，对于风控的技术性对抗，直观体现在于信息的采集的破解，伪造数据。比如采用JS前端采集，最容易面对的就是js对于客户端是处于明文状态，最常见的手法也就是混淆、压缩等。对黑客而言，无外乎时间成本和技巧。

系统再完美也无法规避被破解的可能，所以信息对抗的目标就是进一步提升攻击成本。如何让风控的前端破解伪造风险降至更低，以下以JS采集为例提供若干的一些思考。从JS采集最终提交到服务器分析的数据的可靠性考虑，可以在密文中打入前端特定字符验证；前端密文的高混淆的灵活性，针对AST分析的处理；明文与密文、模块与模块之间的高耦合性等，避免数据传输及算法变化的有规律性；另外对于单设备或者单IP在时间段内的限制等

后端分析及策略可通过对采集回的信息做样本学习，比如同一个为行为动作在某个点会不会发生，世界上不可能有同样一片树叶，所以正常行为人的动作也不可能完全一样，可通过分析用户移动速度规律等进一步提高分析能力。对前端的采集的特殊行为及特殊字段，比如浏览器响应的样本及传送回的浏览器类型一致性等作为数据检校的关键指标；对同一设备指纹的设备不同业务场景的操作的限制；对信誉值较低的用户递进式验证等。

## 互联网业务安全之通用安全风险模型

[阿里云誉反欺诈](https://www.freebuf.com/author/阿里云誉反欺诈)[![认证厂商](https://image.3001.net/images/index/f2.png)](http://www.freebuf.com/bufer)2016-03-11共379923人围观 ，发现 5 个不明物体[安全管理](https://www.freebuf.com/articles/security-management)

[![业务安全模型.png](https://image.3001.net/images/20160308/14574288667725.png!small)](https://image.3001.net/images/20160308/14574288667725.png)

**业务安全从流程设计维度可划分为账户体系安全、交易体系安全、支付体系安全、用户信息存储安全。后者对普通用户而言基本属于透明状态，对于电商/互联网金融/社交媒体更多面临的业务安全风险集中在账户/交易/支付三个维度内。**



## 1 账户体系安全

账户体系安全在具体的业务细分中，最直接的业务体现则为注册、登录、找密三个主要入口。针对黑产或灰产抑或“羊毛党”的技术面分析主要有以下攻击、薅羊毛行为。

### 1.1 垃圾注册

垃圾注册主要指通过程序或者纯人力大量注册的非活越账号，这些账号不能直接给平台带来收益确在一定程度上提升运营成本。账号本身可能给注册行为人带去部份收益。P2P金融行业在注册投资回报现金时，经常会出现这类垃圾注册；电商行业主要用于虚假刷单；社交媒体则面临面临垃圾注册用于发送垃圾消息。

### 1.2 撞库攻击

撞库风险在登录、注册、找密等普遍存在，目前“黑产”主要通过大量泄漏的用户数据，在这些潜在风险的地方，进行账号检存操作，然后通过存在的账号测试对应密码检存；或者寻找无任何防御的登录口进行撞库。 

### 1.3 盗号洗号

这类风险就不做多过多描述，攻击手法略多。 

### 1.4 验证码安全

验证码在设计之初即为区分人与机器，在各类应用中广泛使用用于防护自动化攻击。但目前基于图形验证码安全的防护手段已基本不再属于黑产的障碍，众多的OCR产品以及更为通用的人工码平台，降成本高效率作业。对于有些网站仅采用手机验证码认证作为区分正常用户与“异常”用户，国内也已有非常成熟的“猫池”设备，提供在线手机打码测试。对于团购类、快车等平台，手机小号注册可直接获取巨大利益回报。举例：某团购平台，对于普通用户购买某火锅优惠券需要79元，新用户优惠价格只需要49元。该平台对于业务风控做了设备指纹操作，但依然可以通过模拟器用“手机码”平台进行下单操作。除掉小号成本5块，回报还是挺诱惑的。[验证码安全参考](http://www.freebuf.com/articles/network/97030.html)

### 1.5 信息重放

登录/注册/找密等入口，可能通过短信验证码、邮箱验证码之类的进行确认操作，如果末对操作进行次数及频率上的限制，则会产生大量的重放攻击。另外，对于验证逻辑缺陷类的，例如session末及时删除，可能导致验证码被重放，绕过一些人机基础防护等。 

### 1.6 找密/改密安全

找密/改密设计在验证逻辑上极易产生各种问题，找密密钥的可预测性，找密逻辑缺陷可直接修改收信邮箱，账号检存。改密通过id进行可能修改他人的密码，批量重置等等。从业务层考虑还有找回他人的密码导致财产损失。具体举例：有些产品从用户角度思考，提供更人性化的找密服务，会根据不同场景出现不同的找密方式，在末严格验证身份的情况下或设备指纹不可靠等，极有可能导致客户账号被攻击。[案例及资料](http://drops.wooyun.org/papers/287)

### 1.7 信息泄漏

业务层的信息泄漏，主要指服务自身的一些运营敏感数据泄漏。比如客户交易的cvv码，用户账号、密码、邮箱等。在账号体系中，该类泄漏非常常见，例如用某第三方开发的P2P程序，在登录时用户账号存在的情况下，直接ajax返回该用户的密码密文、手机号、邮箱等等信息。攻击者可能通过这些接口大量获取敏感信息。

## 2 交易体系安全

交易体系安全主要在电商、金融类发生实际交易的场景下出现，“羊毛党”或者问题商家在交易体系中，存在大量虚拟交易，信息作弊及各类针对活动场景的攻击。 

### 2.1 刷库存

刷库存在电商类网站普遍存在，属于一种业务勒索型攻击。攻击者通过大量购买库存产品，但不发生实际支付行为，让正常用户无法正常购买。通过相对较成本低的价格带动数据增长的新商户而言，遭遇该类勒索型攻击较为常见。 

### 2.2 刷单

业务数据造假，这种已形成比较成熟的产业链，目前玩法较多。对于验证真实快递单号的电商站，随便都能相互买到这类单号。

[![sd.png](https://image.3001.net/images/20160308/14574288971734.png!small)](https://image.3001.net/images/20160308/14574288971734.png) 

### 2.3 活动作弊

电商类网站在“双十一”之类的各种特殊节日，会推出大量的游戏送抵用券，送红包、送流量、送优惠券等等活动。如某送流量活动，输入手机号，鼠标点击鼓达某个阈值送多少流量，攻击者可直接修改js或者写js自动模拟点击刷活动。再比如，商家为了冲销量，经常举办前几百名免单活动，攻击者通过自动化脚本秒杀商品，大量薅这羊毛。这直接导致商家销售产品存在大量恶意退货、退款，对于正常用户而言，认为自己被耍猴；对于商家投资成本带来的回报与预期有较大出入。 

### 2.4 刷排名

商家通过某些手段，规避虚拟物品限制转换实际产品销售。以处于边界的低价游戏产品，通过叫“白号秒单”(无太多记录的真实账号)的手段，大量刷销量，再更换类目产品，保持各类目都在销量靠前排名靠前，搜索推荐都是这类店铺，给消费者带来较大的损失。[案例分析](http://www.wooyun.org/bugs/wooyun-2010-016607)

### 2.5 权限绕过

严格意义来讲业务安全与传统web安全重叠的部份较多。权限绕过这里主要指的是，常见的一类逻辑漏洞。一类是末对用户开放或已下线的的商品，通过id可直接遍历到该商品，然后正常购买；另一类主要指，设计上的缺陷，比如有些卡商，在发的充值券存在一定程序的可推测，或者消费账号可被推测。举例，某游戏激活码简单的组合发售，用户可通过暴力手段，直接用末购买的激活码激活游戏。[案例分享](http://www.wooyun.org/bugs/wooyun-2010-035285)

### 2.6 低价购买

某些网站通过id等手段进行价格判断，但存在一定逻辑缺陷。导致可利用低价商品的ID号购买高价值的商品。 

### 2.7 恶意贷款

该种主要存在于P2P类的金融行业，在末知用户信用或真实贷款身份下存的的一类贷款行为，导致坏账率增加。 

## 3 支付体系安全

支付体系在整个交易过程中，视为业务安全里最重要的环节，也是各类风控体系发挥巨大功效的地方。

### 3.1 数据篡改

在支付过程中，验签不严的情况下，极有可能产生数据篡改伪造。金额任意更改，溢出，负金额等等各种场景。[案例](http://www.wooyun.org/bug.php?action=view&id=49233)

### 3.2 高并发缺陷

交易类重放攻击，高并发的情况下末对用户操作行为加锁，导致购买限制的绕过。比如，限制用户每月兑换3次流量，在瞬间重放大量请求的情况下，可能同时成功兑换远大于3次。或者余额只够购买一件产品的情况下，高并发发生交易成功，直接变负数的可能。[案例](http://www.wooyun.org/bugs/wooyun-2015-099622)

### 3.3 套现

套现行为包括：信用卡套现、抵用券套现、类似“京东”白条类信用产品套现。利用平台信用卡套现较为常见，尤其P2P金融和电商普遍存在，通过信用卡支付->提现等。再如抵用券套现，活动支付时购买两件商品，其中一件商品价格用抵用券足够，另外一件走卡支付，这样就可直接无风险套现抵用券。[信用卡套现实例](http://www.wooyun.org/bugs/wooyun-2014-053295)

### 3.4 支付行为可信

支付确认阶段，商家无法确定支付是否发生于账户真实主人。比如可能来自被盗账户的支付动作，直接导致正常用户资产损失。比如通过信用卡购买商品的后付费用户，攻击者利用盗取的信用卡绑定发生实际购买行为，平台在接受绑定后产生交易。但卡的真实主人申报该购买无效，不愿支付费用。交易已经发生，对于平台来讲就直接造成次产损失，该类攻击并不鲜见。 

## 4 其它业务安全

### 4.1垃圾评论

垃圾评论在社交类应用中大量存在，发广告、发敏感信息、灌水等。

### 4.2 垃圾消息

垃圾消息与垃圾评论基本上属于一类行为，在社交网站、电商网站，通过api接口漏洞，推送广告、钓鱼链接等等。业务层主要体现工单污染。

### 4.3 信息作弊

信息作弊主要指各类投票数据、集赞、浏览量、粉丝等通过csrf漏洞或者机器自动刷等，造成各类虚拟数据。

# 交易系统和风控系统的架构怎么设计？

从系统的维护和开发(低耦合，重用性)的角度来说，交易系统和风控系统 设计成了2个单独的系统。
但是实际中的一些需求
比如：
1 我交易的时候需要验证下用户的交易地区，是否和用户注册的交易地区相同。
2 交易限额也需要和用户的级别关联。
3 用户可能把某类交易的额度主动提高了，那么风控系统也需要知道这些信息，因为交易验证的时候可能会用到
等等。

这样的话，风控系统在验证交易的时候就需要很多本身风控系统没有的数据，需要从用户系统中取得，但是又是实时交易。所以会造成以下问题：
1 以后可能会影响交易造成延时。
2 如果不同系统的交易系统都走风控中心的话，照这样的话，每接入一个系统风控中心都面临这修改的问题。

请教各位，多谢.

关注者

**1,829**

被浏览

**100,843**

关注问题写回答

邀请回答

添加评论

分享



收起

#### 13 个回答

默认排序

[![梁川](https://pic4.zhimg.com/b99e588a6ad7a6abaeed34057525c7e5_xs.jpg)](https://www.zhihu.com/people/chuanliang)

[梁川](https://www.zhihu.com/people/chuanliang)

[互联网金融](https://www.zhihu.com/people/chuanliang/creations/19586987) 话题的优秀回答者



编辑推荐

87 人赞同了该回答

交易系统和风控系统从架构角度设计，是应该设计成两个单独的系统，题主提到的问题，本质在于交易系统和风控系统之间数据共享及服务调用的问题。一般通过如下几个层面来降低交易系统、风控系统的耦合度，提升系统性能和扩展性：读写分离、缓存/内存数据库、SOA架构、复合事件处理**数据库读写分离机制：**在初期，风控系统一般都极为简单，此时侯一般通过数据库主从复制/读写分离/Sharding等机制来保证交易系统的数据库和风控系统数据的同步及读写分离。风控系统对所需要的客户/账户数据、交易数据一般都只进行读操作。**缓存/内存数据库机制：**不管是交易系统还是风控系统，高效的缓存系统是提升性能的大杀器，一般会把频繁使用的数据存放到Redis等缓存系统中。例如对风控系统，包括诸如风控规则、风控案例库、中间结果集、黑白名单、预处理结果等数据；对交易系统而言，包括诸如交易参数、计费模板、清结算规则、分润规则、银行路由策略等。对一些高频交易中，基于性能考虑，会采用内存数据库（一般会结合SSD硬盘）。**RPC/SOA架构：**要降低交易系统和风控系统的耦合度，在初期系统服务较少的情况下，一般直接采用RabbitMQ/ActiveMQ之类的消息中间件或RPC方式来实现系统间服务的调用。如果系统服务较多，存在服务治理问题，会采用Dubbo之类的SOA中间件来实现系统服务调用。**复合事件处理（CEP）：**对实时/准实时交易风险控制，相对于纯基于规则的处理模式，采用复合事件处理（CEP）模式，性能及扩展性更好，开源的方案包括Esper、Storm、Spark等。从风控系统构建角度，对应所谓的事前、事中、事后风险控制，作为风控系统最核心的风控引擎分为实时风控引擎、准实时风控引擎、定时风控引擎三种：
**1、实时风控引擎&准实时风控引擎**
实时风控主要在交易过程对交易过程进行实时监控，一个典型应用场景是甄别钓鱼、盗卡风险。
准实时风控典型应用场景是在T+1结算时候，对商户洗钱、跑路进行甄别。
实时/准实时风控引擎一般采用规则引擎+复杂事件处理（CEP）。**2、定时风控引擎**
主要定时对支付/交易/账务等数据进行定时ETL、深度挖掘等处理，建立对应的风控模型，一个典型应用场景是商户的信用等级模型。此时侯一般采用Hadoop、ML等技术进行大数据建模以前写过两篇关于第三方支付风控系统建设的文章，供参考
[支付系统风控系统建设思考](https://link.zhihu.com/?target=http%3A//www.yeeach.com/post/235)
[复杂事件处理(Complex Event Processing)入门1](https://link.zhihu.com/?target=http%3A//www.yeeach.com/post/1052)

[发布于 2015-01-02](https://www.zhihu.com/question/20860347/answer/36328342)

赞同 876 条评论

分享

收藏感谢收起

[![omeweb](https://pic4.zhimg.com/4a49faa00_xs.jpg)](https://www.zhihu.com/people/omeweb)

[omeweb](https://www.zhihu.com/people/omeweb)

多年混迹风控引擎领域。公众号：writecodes

65 人赞同了该回答

本人是阿里集团安全部的风控架构师和设计师。我们系统每天处理实时消息60+亿，双11和双12完全不降级。前面的同学已经说的很多了，说的很对。我yy几点看法：1，交易和风控系统要分开，低耦合
2，业务系统很多环节都有埋点，或者是hook
3，风控系统会用到非常多的接口和数据，一些数据要自己计算和沉淀，一些则要业务系统提供服务化接口
4，风险识别是一块，决策又是一块。比如决策的时候，看你爸是不是李刚，如果是则释放，不是的话，嗯哼。。。
5，风控处理分同步和异步，异步也是实时，一般延迟在100ms以内。同步的话，肯定消耗rt的，必须要快
6，保障可降级，除非特别的场合，比如转账，不能降级。也不是所有的策略都耗时，可以降级高耗时低产出的策略
7，策略必须立即生效，且可灰度和回滚，且都是运营人员自行配置，可调试，不依赖开发
8，业务系统接入，应该要很快，比如传入5w1h，风控系统返回一个结果，比如说false，则阻止下单并提示text
9，很多业务系统都要接入风控系统
10，完全不用drools，扩展性和性能太差，服务集成能力和维护成本都非常高随便说的，有问题了再说吧。

[发布于 2015-03-25](https://www.zhihu.com/question/20860347/answer/42944578)

赞同 6563 条评论

分享

收藏感谢

![知乎用户](https://pic4.zhimg.com/da8e974dc_xs.jpg)

知乎用户



编辑推荐

112 人赞同了该回答

曾任某公司风控架构师。设计风控系统能力
单机TPS200~2000(接入实时统计系统）
响应时间小于200ms
任意业务规则情况下。
下面是我曾做的风控系统架构设计PPT关键几点总结
1，业务系统必须和风控系统分开。
2，必须有一个风控引擎
业务上的好处是业务扩展能力强，数据和表达能力强
技术上的好处下面说
3，必须规则和数据分离。形成规则.规则元素.元素数据获取器的模型结构
利用风控引擎，解析规则。将规则和数据的关系解耦，从而可以更有效的优化规则。提升数据接入能力。以及优化线程利用率。实现高性能、高效率
![img](https://pic2.zhimg.com/80/2c4e934951ccc88ba683d2ebfa7092e3_hd.jpg)
![img](https://pic4.zhimg.com/80/1080590f7bd2a424e900e6143f5d15f6_hd.jpg)![img](https://pic3.zhimg.com/80/a8ff660d86e635b1f0bb310ff7b50cdf_hd.jpg)![img](https://pic1.zhimg.com/80/1b83b394f101acb84f0a81c37ef878b0_hd.jpg)![img](https://pic4.zhimg.com/80/049b71e06ebd21cab9b1f89e549df994_hd.jpg)![img](https://pic4.zhimg.com/80/8dfedc775a17182c2c9cc9897dd02b03_hd.jpg)![img](https://pic2.zhimg.com/80/1916ad158d77df3adf9bf09a4bc4d240_hd.jpg)

[编辑于 2015-12-11](https://www.zhihu.com/question/20860347/answer/33446734)

赞同 11213 条评论

分享

收藏感谢收起

[![logo](https://pic2.zhimg.com/v2-1a571caf874eae474800000609c49299_250x250.jpeg)尚德机构](http://91ld.com/3670/CN/mb/eqWm3e/index.html?plan_id=1008842&creative_id=zh-MBA_dt-pc_tw_820-C2)

广告



不感兴趣[知乎广告介绍](https://www.zhihu.com/promotion-intro)

[在杭州工作间隙还能读个在职研究生？为你升职加薪助力工资低？升职慢？可能是学历拖了后腿！现在上班族在职就可读研，大专毕业满4年，本科毕业满2年，即可报名咨询……查看详情](http://91ld.com/3670/CN/mb/eqWm3e/index.html?plan_id=1008842&creative_id=zh-MBA_dt-pc_tw_820-C2)

[![旭纳](https://pic2.zhimg.com/v2-1b9bc1d8e247a25b661369a192dde4bb_xs.jpg)](https://www.zhihu.com/people/xunagongzuoshi)

[旭纳](https://www.zhihu.com/people/xunagongzuoshi)

十年外汇操盘手 公众号：外汇教主笔记

13 人赞同了该回答

每个交易员的交易系统都是基于其所认知的这个世界：有人认为价格围绕价值上下波动，研究价值本质自然能得到价格体现，于是出现了基本派；有人认为基本面最终要以技术面的走势来反映，就出现了技术派；也有人认为基本面与技术面相互结合，将为价格走势更有指导意义。光从技术派角度讲：有人认为市场是不可预测的，下一秒的价格可以涨可以跌，其比率是各占50%。于是出现了一批专做仓位管理的交易系统，不计较涨跌，不计较交易品种。利用类似网格交易等方式，不断加仓减仓得以实现盈利。有人用四个字就可以一夜暴富——“物及必反”，《大时代》中的郑少秋就是典型，全世界都在做多恒指时，他满仓做空。反映到技术面时，这些人就利用了KDJ/RSI等超买超卖指标，也能在这个市场中成为神话。有人认为市场中80%的行情是震荡的，只要不断把握震荡行情中的利润，将足以弥补剩余20%的趋势行情所带来的亏损。他们开始不断建立完善自己基于震荡行情下的交易系统。里面带有了很多震荡指标。并可能利用均线等趋势指标以“指标共振”来筛选出真正的震荡行情。有人认为市场中在一定时期可能是振荡，而在较小时间期间却是趋势。就开始出现了多重时间周期的交易系统。找到长周期的振荡行情中的某一段，在小期间找到顶或底，以支持做多或做空。有人只愿意做趋势，觉得只有这种行情可以让利润奔跑，而趋势行情尊重波浪的走势进行运行，就开始出现了波浪理论，斐波娜奇（黄金分割）理论。有人认为人是有弱点的，是有情绪，有喜怒哀乐的，他们相信人在短期内是有可能获利的，但在长周期下，或大资金下，或在特定的环境中是没有办法保证获利的，于是出现了一批研究智能交易系统（EA）的人，包括著名的索罗斯的量子基金都有此配置。再细分下去，就产生了全自动EA与半自动EA。很多都能实现一定期间与环境中的盈利。至少克服了“人”的弱点。等等等等究其原因，每个人认同的思想不同，说大了是人生观的不同，导致了其所建立的交易系统的不同。而建立的交易系统是否赚钱只需不断地复盘与实盘验证。最终，你恍然大悟，你会发现大部分交易系统都是能够赚钱的。最终亏钱的人只是信念不够。与做人一致。人生观、价值观坚定的人不多，这或多或少构成了这个交易市场的2、8定律。所以，交易系统很简单，问自己，你的信念是什么？只要你愿意坚持她，执行她，不怀疑她，不离不弃，相互进步，相互成长。稳定盈利又有何难。

[发布于 2016-08-21](https://www.zhihu.com/question/20860347/answer/118105603)

赞同 1310 条评论

分享

收藏感谢收起

[![神宗](https://pic2.zhimg.com/ce47f1dc1_xs.jpg)](https://www.zhihu.com/people/senzung)

[神宗](https://www.zhihu.com/people/senzung)

http://cyan.ly

3 人赞同了该回答

风控系统必须是独立的并且使用客观数据源。具体如何接入你们的交易流程要取决于你们所选用的messaging bus。架构我想除了SOA没有别的更好方案。我们风控系统分为pre trade，trade life cycle和post trade三个模块直接接驳tibco主题:前者用以检查计算密集类规则，比如交易及交易组合对现有投资组合产生的各种风险检查。我们还做到了某些不合规结果可以直达合规部门前端系统请求索取批准口令交易产生时是各种额度以及权限检查，除了short selling以外基本不会涉及P&L的查询所以相当快速。对于某些自动高频交易组合(basket)，在pre trade已经做好了reservation，风控的延迟几乎可以忽略（乌龙指的检查是必须的）。post trade检查应对其他不可预测的交易结果。风控系统需要有高效的rule based engine，需要一个高效的服务内repository(cache)。

[编辑于 2013-08-20](https://www.zhihu.com/question/20860347/answer/18463132)

赞同 3添加评论

分享

收藏感谢

[![维辰美](https://pic2.zhimg.com/v2-b29ab709f42f02c7a51c9d7ad9874a0b_xs.jpg)](https://www.zhihu.com/people/taoli719)

[维辰美](https://www.zhihu.com/people/taoli719)

2 人赞同了该回答

一个好的交易系统，应当有能力捕捉到突发事件的影响。
从投资哲学的角度讲，市场上没有任何突发事件是突然发生的。
突发事件本身只相当一个“导火索”。
如果它真正能够对市场产生爆炸性的影响，必须在市场上有“炸药包”本身的存在，即某种市场供求状态的积累和发展。突发事件只能对这种已经存在的市场关系起到某种催化剂的作用。
市场永远只选择它愿意选择的突发事件。突发事件永远不能使市场作180度的大转弯。
突发事件永远只能使市场在原先已决定的轨道上加速或减速行进。

[发布于 2016-10-23](https://www.zhihu.com/question/20860347/answer/128012557)

赞同 2添加评论

分享

收藏感谢

[![Mr Mistake](https://pic2.zhimg.com/a8dec7b33_xs.jpg)](https://www.zhihu.com/people/mr-mistake)

[Mr Mistake](https://www.zhihu.com/people/mr-mistake)

Algo trading London.

5 人赞同了该回答

你说的风控是指pre trade circuit breaker 还是post trade risk analysis （用来对冲）？两种应用会用不同的架构。如果pre trade系统的话我们是直接写在trading applicztion 里面。用event driven 写。如果post trade一般分开。模型可复杂可简单，复杂的话用分布式，简单的话用excel

[发布于 2015-01-02](https://www.zhihu.com/question/20860347/answer/36329362)

赞同 51 条评论

分享

收藏感谢

![知乎用户](https://pic4.zhimg.com/da8e974dc_xs.jpg)

知乎用户

2 人赞同了该回答

很多大神已经回答得很好了，主要是可用性，误拦，漏拦等指标。
我补充下自己的几点看法，
一是低耦合，业务和风控隔离;
二是分类处理，要根据业务风险大小去指定风控问询的逻辑深度，不要一概而论，有些风险高的要做多层，不要为了性能而降级;
三是数据要落地，部分常用数据要加kv，尽量减少外部数据依赖;
四是不断迭代优化系统和风控策略，包括一些可用性上的柔性策略，灰度，自动降级，异地多活方案，机器学习等。

[编辑于 2016-08-21](https://www.zhihu.com/question/20860347/answer/118055146)

赞同 2添加评论

分享

收藏感谢

[![盼盼](https://pic1.zhimg.com/e7ea90b1a05fbe6b1e7e077ab762dc62_xs.jpg)](https://www.zhihu.com/people/nengpan.yu)

[盼盼](https://www.zhihu.com/people/nengpan.yu)

金融科技

1 人赞同了该回答

要是事前控制都能转化为事后控制，交易系统的实时性会大幅提高！啊哈哈~

[发布于 2016-09-30](https://www.zhihu.com/question/20860347/answer/124322331)

赞同 1添加评论

分享

收藏感谢

[![陈曦](https://pic2.zhimg.com/cc37ad7fc_xs.jpg)](https://www.zhihu.com/people/chen-xi-38)

[陈曦](https://www.zhihu.com/people/chen-xi-38)

我要自由 & 为人民服务

业务系统不太敢说，风控系统其实可大可小，除非是类似蚂蚁，宜信这种重量级选手，一般中小型公司建议Python技术栈，一是方面是维护升级方便，另一方面方便与风控模型结合。
大概需要1-6人左右的工程团队就能撑起业务来。风控系统算是比较敏感的内容了，太具体的也不方便说
但有几个重要的点可以分享一下：风控，业务系统，数据系统，三方要解耦贷前，贷后的等功能考虑全，但不超过10个接口，降低维护成本和沟通成本最重要的是高度自动化，数据监控+数据分析+异常处理+模型迭代
模型自动化迭代是最前沿的，AI系统如果真的能替代工程师的工作，第一个替代的一定是机器学习工程师的工作。。。

[编辑于 2017-05-11](https://www.zhihu.com/question/20860347/answer/168137041)

赞同添加评论

分享

收藏感谢

[![Ethan Liu](https://pic4.zhimg.com/da8e974dc_xs.jpg)](https://www.zhihu.com/people/ethan-liu-43)

[Ethan Liu](https://www.zhihu.com/people/ethan-liu-43)

Liberty is not license

我们的系统碰到一样的问题，你可以尝试EDA(Event-driven architecture)的架构处理。当然，还是具体分析你的需求对数据一致性的要求

[发布于 2013-12-19](https://www.zhihu.com/question/20860347/answer/20976454)

赞同添加评论

分享

收藏感谢

[![赵云涛](https://pic1.zhimg.com/373bf917320749d7d79cf02de910e3fe_xs.jpg)](https://www.zhihu.com/people/coolzyt)

[赵云涛](https://www.zhihu.com/people/coolzyt)

资深技术人

你这个需求是比较典型的soa应用场景，大致思路是风控系统开放内部服务，供其他交易系统查询调用。
具体开放方式可以是webservice,jsonrpc等方式

[发布于 2013-03-18](https://www.zhihu.com/question/20860347/answer/16422018)

支付风控模型和流程分析

[**凤凰牌老熊**](https://xz.aliyun.com/u/2050) / 2017-03-28 10:19:00 / 浏览数 8748 [技术文章](https://xz.aliyun.com/tab/4) [企业安全](https://xz.aliyun.com/node/12)**[顶(0)](javascript:) [踩(0)](javascript:)**

------



接上一篇[支付风控数据仓库建设](http://blog.lixf.cn/essay/2016/12/18/risk-2-database/)。支付风控涉及到多方面的内容，包括反洗钱、反欺诈、客户风险等级分类管理等。 其中最核心的功能在于对实时交易进行风险评估，或者说是欺诈检测。如果这个交易的风险太高，则会执行拦截。由于反欺诈检测是在交易时实时进行的，在要求不能误拦截的同时，还有用户体验上的要求，即不能占用太多时间，一般要求风控操作必须控制在100ms以内，对于交易量大的业务，10ms甚至更低的性能要求都是必须的。 这就需要对风控模型进行合理的设计。一般来说，要提升风控的拦截效率，就需要考虑更多的维度，但这也会带来计算性能的下降。在效率和性能之间需要进行平衡。

本文重在介绍建立风控模型的方法，每个公司应该根据自己的实际业务情况和开发能力来选择合适的模型。这里列出来的模型仅为了说明问题，提供参考。

## 一、风险等级

做风控拦截，首先要回答的问题是风险等级怎么划分？ 目前主流的风险等级划分有三种方式， 三等级、四等级、五等级。

- 三等级的风险分为 低风险、中风险和高风险。 大部分交易是低风险的，不需要拦截直接放行。 中风险的交易是需要进行增强验证，确认是本人操作后放行。 高风险的交易则直接拦截。
- 四风险等级，会增加一个中高风险等级。此类交易在用户完成增强验证后，还需要管理人员人工核实，核实没问题后，交易才能放行。
- 五风险等级，会增加一个中低风险等级。此类交易是先放行，但是管理人员需要进行事后核实。 如果核实有问题，通过人工方式执行退款，或者提升该用户的风险等级。

[![img](http://blog.lixf.cn/img/in-post/risk-levels.jpg)](http://blog.lixf.cn/img/in-post/risk-levels.jpg)

大部分支付系统是使用三等级的风险。

## 二、基于规则的风控

规则是最常用的，也是相对来说比较容易上手的风控模型。从现实情况中总结出一些经验，结合名单数据，制定风控规则，简单，有效。 常见的规则有：

**1. 名单规则**
使用白名单或者黑名单来设置规则。具体名单如上文所述，包括用户ID、IP地址、设备ID、地区、公检法协查等。
比如：

1. 用户ID是在风控黑名单中。
2. 用户身份证号在反洗钱黑名单中。
3. 用户身份证号在公检法协查名单中。
4. 用户所使用的手机号在羊毛号名单列表中。
5. 转账用户所在地区是联合国反洗钱风险警示地区。

**2. 操作规则**
对支付、提现、充值的频率按照用户账号、IP、设备等进行限制，一旦超出阈值，则提升风控等级。

1. 频率需综合考虑（五）分钟、（一）小时、（一）天、（一）周等维度的数据。由于一般计算频率是按照自然时间段来进行的，所以如果用户的操作是跨时间段的，则会出现频率限制失效的情况。 当然，比较复杂的可以用滑窗来做。
2. 对不同的风险等级设置不同的阈值。比如：
3. 用户提现频次5分钟不能超过2次， 一小时不能超过5次，一天不能超过10次。
4. 用户提现额度一天不能超过1万。
5. 用户支付频次5分钟不能超过2次，一小时不能超过10次，一天不能超过100次。

**3. 业务规则**
和特定各业务相关的一些规则，比如：

1. 同一个人绑定银行卡张数超过10张。
2. 同一张银行卡被超过5个人绑定。
3. 同一个手机号被5个人绑定。
4. 一个周内手机号变更超过4次。
5. 同一个对私银行卡接受转账次数一分钟超过5次。

**4. 行为异常**
用户行为和以前的表现不一致，比如：

1. 用户支付地点与常用登录地点不一致
2. 用户支付使用个IP与常用IP地址不一致
3. 用户在短时间内，上一次支付的地址和本次支付的地址距离非常远。 比如2分钟前在中国支付的，2分钟后跑到美国去支付了。

**5. 风控拦截历史规则**
用户在某个业务上的消费行为被风控网关多次拦截。

规则引擎优点：

1. 性能高： 对订单按照规则进行匹配，输出结果。一般不会涉及到复杂的计算。
2. 易于理解和分析： 交易被拦截到底是触犯了那条规则，很容易输出。
3. 开发相对简单。

规则引擎存在的问题：

1. 一刀切，容易被薅羊毛的人嗅探到。比如规则规定超过5000元就进行拦截，那羊毛号会把订单拆分成4999元来做。 一天限制10笔，那就薅到9笔就停手了。
2. 规则冲突问题。当一笔交易命中IP白名单和额度黑名单的时候应该如何处理？

规则引擎看起来简单，但也是最实用的一类模型。 它是其它风控模型的基础。实践中，首先使用已知的规则来发现存在问题的交易，人工识别交易的风险等级后，把这些交易作为其它有监督学习的训练数据集。

## 三、决策树模型

风险评估从本质上来说是一个数据分类问题。 和传统的金融行业风险评估不一样的地方，在于数据规模大、业务变化快、实时要求高。一旦有漏洞被发现，会对公司造成巨大损失。 而机器学习是解决这些问题的利器。 互联网金融风控离不开机器学习，特别是支付风控。 在各种支付风控模型中，决策树模式是相对比较简单易用的模型。 如下的决策树模型，我们根据已有的数据，分析数据特征，构建出一颗决策树。当有一笔交易发生时，我们使用决策树来判断这笔交易是否是高风险交易。[![img](http://blog.lixf.cn/img/in-post/risk-dt.jpg)](http://blog.lixf.cn/img/in-post/risk-dt.jpg)这种模型的优点是非常容易理解，检测速度快。 因而也是现有机构中常用的模型之一。 风控模型存在的主要问题是其产生的结果比较粗略。同样的两个交易被判定为高风险，究竟哪种交易风险更高，决策树模型无法给出答案。

## 四、评分模型

比决策树模型更进一步，现在也有不少公司在使用评分（卡）模型。 银行在处理信用风险评级、反洗钱风险等级时，往往也是使用这种方法。

每个公司的模型都不一样，一个参考模型如下：[![img](http://blog.lixf.cn/img/in-post/risk-aml.jpg)](http://blog.lixf.cn/img/in-post/risk-aml.jpg)

\> 该模型为参考《金融机构洗钱和恐怖融资风险评估及客户分类管理指引》编制，仅具参考意义。虽然银行间的评分模型有很好的参考价值，但互联网公司由于业务和数据的不同，评分模型参考价值不大。

每个公司需根据自己的业务情况来制定评分模型，之后为各个指标指定权重比例。 权重评分结果为0~100分的区间，之后按照区间划分，指定风险等级。比如：
[![img](http://blog.lixf.cn/img/in-post/risk-range.jpg)](http://blog.lixf.cn/img/in-post/risk-range.jpg)

当然，评分区间也需要根据企业的实际情况来制定。 评分模型的优势在于：

1. 性能比较高，针对交易进行指标计算，按照区间来确定风险。
2. 相对于规则，如果指标设置合理，其覆盖度高， 不容易被嗅探到漏洞。
3. 理解和分析也比较容易。 如果交易被拦截了，可以根据其各项打分评估其被拦截的原因。

存在的问题：

1. 模型真的很难建立。指标的选择是一个挑战。
2. 各个参数的调优是一个长期的过程。

我们知道从一条交易记录中可以挖掘的关联数据有上百个，衍生数据就更多了。比如从支付地址，可以聚类出常用地址，衍生出当前地址和常用地址、上一次支付地址之间的距离，而这些指标在构建模型时都可能使用到。 所以第一个问题是，如何从这些指标中建立一个合适的模型？这就涉及到机器学习的问题了。 模型不能凭空建立，我们可以通过规则来对现有数据进行筛选和标注，确定这些记录集的风险等级。 这些数据作为样本来训练模型。可用的算法包括Apriori、FP-growth等。算法实现请参考相关文档。

在确认相关参数后，模型在使用过程中还需要不断对相关参数进行调整。这是一个拟合或者回归的算法，Logistic算法、CART算法，可以用来对参数做调优。

总之，模型的建立是一个不断学习、优化的过程。 而每一个模型的发布，还需要进行试运行，AB测试和上线。 这个过程，将在下一篇的风控架构中介绍。

## 五、模型评估

风控本质上是对交易记录的一个分类，所以对风控模型的评估，除了性能外，还需要评估“查全率”和“查准率”。 如下图所示：

[![img](http://blog.lixf.cn/img/in-post/risk-measure.jpg)](http://blog.lixf.cn/img/in-post/risk-measure.jpg)

以评估高风险人群的效果为例，

- Precision, 准确率，也叫查准率，指模型发现的真实的高风险人数占模型发现的所有高风险人数的比例。
- Recall，召回率，也叫查全率，指模型发现的真实的高风险人数占全部真实的高风险人数的比例。

理想情况下，我们希望这两个指标都要高。实际上，往往是互斥的，准确率高、召回率就低，召回率低、准确率高。如果两者都低，那就是模型不靠谱了。 对于风控来说，需要在保证准确率的情况下，尽量提高召回率。 那怎么发现实际的高风险人数呢？ 这就需要借助规则模型，先过滤一遍，再从中人工遴选。

从实际应用情况来看，目前国内大部分团队使用Logistic回归+评分模型来做风控，少数人使用决策树。国外的PayPal是支付平台风控的标杆，国内前海征信、蚂蚁金服等会使用到更高级的神经网络和机器学习，但实际效果未见到实证材料。

1. [支付风控场景分析](http://blog.lixf.cn/essay/2016/12/08/risk-1-scenarios/)；
2. [支付风控数据仓库建设](http://blog.lixf.cn/essay/2016/12/18/risk-2-database/)；
3. 支付风控模型和流程分析(本文)；
4. 支付风控系统架构

感谢您对本文的关注，如需要及时收到凤凰牌老熊的最新作品，或者有相关问题探讨，请扫码关注“凤凰牌老熊”的微信公众号，在公众号里留言或者回复，可以尽快处理，谢谢。

## 爱奇艺业务安全风控体系的建设实践

原创： 爱奇艺 [爱奇艺技术产品团队](javascript:void(0);) *2017-10-13*

**作者｜Frank**

![img](http://mmbiz.qpic.cn/mmbiz_gif/unymlvueOvu6nF367bibviarNia28zJIYOArwBsYsicVXMU7geWJiahx0Tlbx6KKO07NdpvPNCdpiakAZvjnv0icZ24uw/0?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)





**作者介绍**



**Frank, 爱奇艺云平台科学家, 目前是爱奇艺安全云负责人, 日常主导安全云在业务安全, 云安全, 数据安全, 安全攻防, 移动安全等各领域的技术创新和项目实施, 特别是将大数据风控引入到了爱奇艺业务安全保障中, 实现数据驱动安全和安全智能化。**







请输入标题   abcdefg













**01**







**普遍业务风险** 

**行业的共同的问题**





**爱奇艺在快速发展过程中, 业务越来越多，越来越复杂，用户的权益和信息价值越来越高, 我们面临的业务安全的挑战也就越来越大。**



除了传统的网络黑客的入侵，攻击以外，新的业务形态带来的新型风险: 比如撞库盗号，盗播盗看，很多的营销活动招引大量的薅羊毛的行为, 刷量, 刷人气, 恶意发布不良信息等风险, 社交场景下的拉粉和不良信息恶意传播, 支付场景下的欺诈, 所有这些风险一旦被黑产利用, 都可能对企业的稳定运营带来大的冲击。





**以下总结了各种业务会遇到的风险**



**01**

**会员****：**撞库盗号，账号分享，批量注册

**02**

**视频****：**盗播盗看，广告屏蔽，刷量作弊

**03**

**活动****：**薅羊毛

**04**

**直播****：**挂站人气，恶意图文

**05**

**电商****：**恶意下单，订单欺诈

**06**

**支付****：**盗号盗卡，洗钱，恶意下单，恶意提现

**07**

**其他**：钓鱼邮件，恶意爆破，短信轰炸



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)













**02**







**解决方案** 

**安全+风控**





针对新的业务形态会遇到的问题，除了一方面是要用常规安全解决方案去解决，另外我们也要对业务做充分的风险评估和及时控制。



常规安全解决方案是加强安全制度和体系建设，推动安全开发和安全运维，关注边界安全, 数据安全和纵深防御。



**后者是我们要重点为给公司带来核心价值的关键业务，从风险管控上保护好他们。**



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)













**03**







**业务上线运营**

**问题多多**





业务在上线运营以后, 不是说没有关注风险评估和控制，但是以前的做法存在有非常多的问题，这里举四类主要的问题:



**一.各自为战**

1

各业务方多以安全事件驱动, 多数仅做事前单点防御, 经验数据无法共享

2

单点防御容易被黑产各个击破, 无法做到跨业务跨团队的联防联控

3

低水平重复建设, 平台资源浪费

**二.拍脑袋"规则"**

1

大量的风控规则是专家决策为主,阈值基本拍脑袋而定

2

没有引入数据分析或者机器学习等能力, 对事件本质缺乏足够认识及数据支撑, 造成正常用户误杀, 损伤用户体验, 导致用户流失

**三.反应过慢**

1

不能快速识别攻击变化进行调整,无法进行积极对抗

2

业务代码耦合,依赖业务开发, 测试和上线,占用业务排期

3

某些前置/内置规则容易成为业务关键路径, 对业务稳定性造成影响

**四.手段单一**

1

可用特征维度不多, 严重依赖于IP, 公共出口误杀严重,引发投诉 

2

以限频, 限流, 黑白名单, 图文验证为主, 黑白名单难以维护, 无生命周期













**04**







**目标风控系统**

**用云服务来解决业务的问题**



要解决业务在上线运营以后遇到的问题，我们需要将风控服务，以云服务的方式提供业务,让业务关注业务本身, 让跨业务支持的统一风控云服务来对其进行保障。



到底要提供给业务团队怎么样的风控服务呢? 

这里列一下我们的设计目标, 这些目标的达成也就能解决前面说的问题。



**一.联防联控**

1

各业务联合, 在模型,规则,数据等方面进行共享, 联合布控协同防御

**二.数据驱动, 智能对抗**

1

全站全网数据支撑, 基于数据进行决策

2

利用机器学习实现智能异常特征发现

**三.策略灵活, 有效对抗**

1

独立服务, 快速迭代

2

支持业务的风险多样运营需求

3

模型,规则, 策略快速实施, 快速反应 

**四.维度和拦截手段多样**

1

不依赖单一维度和单一行为

2

云和端结合, 多种拦截手段应对

**五.延迟可控, 低耦合可降级**

1

在实时风控场景下, 快速决策, 不能明显增加业务延迟, 自身有问题情况下, 不能影响业务

**六.快速实现, 高效部署**

1

能够快速完成架构. 实现和持续迭代

2

能够面向私有云的复杂拓扑, 快速部署





![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)











**05**







**风控服务的架构**

**一.风控服务组成**





我们的风控服务是由三大子服务组成：

**
**

**麦哲伦（Magellan）**主要包括业务接入(接入层)，三大服务引擎(数据查询，规则执行，模型调用)，面向风控团队的管理平台(服务资源管理, 模型规则管理，生命周期管理，上下线管理，维度数据管理)，面向业务方的运营平台(风险事件管理，仿真，风险处置，监控预警，数据查询和仪表盘，规则清单)。



**哥伦布（Columbus）**主要面向对业务数据的特征工程，大规模异常检测和深度学习，知识图谱，实时特征，离线特征，环境特征以及安全画像，并对外提供模型可实时调用接口或者模型输出缓存。



**郑和（Zhenghe）**是安全知识仓库，是面向业务风控和其他安全控制所需的各类安全基础数据和威胁情报。





![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**二.风控 - 部署** 





利用云平台能力高效构建和发布：

2.5*4个人月从零开始开发构建上线服务, 并对外提供了基于HTTP/RPC的实时风控和近实时风控以及基于离线数据的离线风控.如何把风控服务在复杂的云环境部署下去。



我们会在一个主IDC里，部署运营中心和管理平台。这一块可以快速切换IDC部署，如果这个主IDC有问题, 可以快速切换到另一个IDC。对于真正贴近业务的三大服务引擎，则是基本上所有有受保护的业务的IDC都有进行部署, 以保证业务可以就近访问, 降低访问延。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**三.风控 - 引擎**



**查询引擎**

1

Magellan子服务的的核心，主要负责进行实时和离线数据批量查询及聚合

2

构建为参数/特征组合提供给规则引擎, 模型引擎



**规则引擎**

1

负责进行规则匹配

2

支持自定义执行策略如: 命中退出, 全部执行, 条件退出等

3

支持多种规则类型, 如:评分卡, 决策树, 决策表, 普通规则等



**模型引擎**

1

通过查询引擎查上来的一些参数特征，负责进行特征处理及算法执行，以达到和Columbus子服务的协同, 并服务于规则引擎。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**四.风控 - 运营**



业务如果把风险评估交付给风控，Magellan必须满足其复杂的运营需求： 



**一**



**风控服务**

**
**

业务风险评估,接入登记,根据场景实施初始规则和模型,逐步迭代。

**二**



**事件查询/处置/回溯**



查询被识别为风险案例的上下文,特征,模型结果,数据标注等信息.供运营进行案例分析及后续仿真

**三**



**事件监控和报警**



业务/风险数据监控看板,智能报警

**四
**



**adhoc/Daily数据分析**

**
**

Adhoc/Daily数据报表,风险数据分析,模型/规则贡献度分析,仿真效果分析等

**五**



**离线/在线仿真**



基于案例库中的正/反例,结合仿真环境进行模型/策略仿真.利用数据平台进行贡献度, 线上效果比对等分析。



**六**



**审批上线**

**
**

规则模型变更及时通知业务方,风控运营团队,相关业务方,相关负责人确认审批上线。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**五.风控 - 数据**





**风控最重要的还是数据。**



风控通过Columbus子服务从业务方获取的海量的近实时或者离线业务数据, 并把数据进行清洗和特征工程,形成基础数据，这些基础数据存在HDFS-HBase里面，通过数据分析和机器学习的方法, 产生各类标签，画像和模型, 经过安全专家确认, 产出的安全规则和可用的模型缓存。



针对业务数据获取和处理, 对于实时数据 ,利用Apache Flink构建, 实现图特征工程, 多维频次特征工程, 多数据流Complex Event Processing处理, 达到毫秒级延时. 





![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**Columbus的多渠道业务数据采集和处理**

1

**实时数据:**基于Apache Flink

**构建:** 图特征工程, 多维频次特征，多数据流Complex Event Processing，毫秒级延时

2

**近实时数据:**基于Apache Spark

**构建:**异常检测,流式特征工程,，秒级延时

3

**离线数据:** 基于Apache Spark，Impala/Hive

**构建:**安全画像，用户画像，全业务数据， 小时/天级延时

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**五.风控 - 数据**

**安全画像**



Columbus的安全画像

对全站业务数据分析和提炼以后

形成海量的多维度标签刻画

为风控的每一次处理

丰富上下文场景和实体特征

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



安全画像作为风控最重要的一个业务数据的积累。通过潜在的数据提炼以后，形成海量的多维度度标签刻画。我们整个安全画像的话，包括他通过哪一个IP等等。目前大概有600多种标签，数据总数已经超过19亿。





![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**五.风控 - 数据**

**Zhenghe安全知识仓库**



**Zhenghe系统是安全云的包括威胁情报在内的基础安全数据集**

1

全网安全数据监测和收集，包括 自采，共享和第三方采购

2

对业务安全而言重点关注 - IP信誉分, IP分类识别, 公共出口识别, 代理IP识别, 手机号信誉分, 虚假小号识别等

3

威胁标记类型210个，涵盖13个维度，总共记录数约16亿条

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



IP信誉分

 融合爱奇艺内部多个系统的数据

参考第三方数据

综合衡量一个IP的长期行为

得到一个-100到100的信誉分

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**六.风控 – 平台**



**Columbus的核心是异常检测**

如果黑产完全和正常用户一样的话

其实是达不到获利的目的的

所以异常检测对安全来说

也是风控平台的一个基本功能



**Columbus主要是通过自研的方式**

**实现各种异常检测的功能**

在该核心功能的基础上

构建了整个哥伦布系统的上层架构

实现面向风控Magellan服务的能力



**一**





**预处理特征工程**

**
**

预处理工具



**低级特征工程库:** 

对数特征,归一化特征,主成份特征 ...



**高级特征工程库:** 

FPGrowth关联特征,k-means距离特征, 多维自动关联 ... 

**二**







**离线检测**

**
**

**低级异常检测算法库:**

多种分布模型, 单维度异常检测 ...



**高级的异常检测算法库:** 

基于FPGrowth关联的多维异常检测 ...

**三**







**在线监测**





**流式异常检测:** 

基于FPGrowth关联流式, 基于CEP...



**基于时间序列的异常检测:** 

基于基线曲线预测, 基于深度学习时间序列

**四**







**基础工具库**





自动化数据解析,存储和导入等工具



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**七.设备指纹**

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



对风控而言, 还要提一下其依赖服务: 设备指纹。



风控需要一个好的设备指纹的服务，要让所有的端都能够采集设备纬度，形成一个指纹，这个指纹多维签发的, 而且在云端会做大量的黑产分析，联合安全画像进行沉淀。



因为这些数据都是用户提供上来的，必须要做一个防伪的检测，从多维度数据里面查出提供的维度数据矛盾和不真实。





![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**风控服务的架构**

**八.验证手段**





**1.图文验证码**



传统的复杂图文验证码



**2.滑动验证码**



基于滑动的人机行为识别进行验证



**3.上下行短信验证**



发送下行或者上行短信进行验证



**4.基于信任设备的验证**



信任设备可以为其他端进行授权和验证



**5.基于安全盾APP的验证**



安装爱奇艺安全盾APP可以为其他应用进行 



动态口令(OTP), 推送一键确认, 扫码确认 

![img](http://mmbiz.qpic.cn/mmbiz_png/unymlvueOvu6nF367bibviarNia28zJIYOAPJzic0cpicbwHlRX4A2z2ZNPCYcDLKsWtXhraCGvHticFysAFvWvKBibdQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



其他: 暂时放行+事后处置,

降级体验或者权益

 A业务标识+B业务拦截

(A业务识别风险以后只做标识画像，

然后B业务进行拦截, 

这样非常有利于让黑产无法识破规则策略)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)













**06**







**风控服务的成果**





**1.业务覆盖：**



涵盖帐号, 会员, 活动, 支付, 播放反作弊, 



社交, IT, 直播等重要业务



**2.服务质量：**



日均请求量超24亿, 延时5ms以内, 无故障运行



**3.柔性风控：**



平时重监控, 战时重对抗. 注重用户体验



**4.核心亮点：**



事前, 事后纵深防御体系,



结合事中跨业务联防联控及实时流式异常检测,



机器撞库接近100%抑制

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**在这里重点讲一下我们对机器撞库盗号的防御成果。**



会员账号的安全关系到爱奇艺会员付费战略的顺利实施以及爱奇艺良好口碑的建立。

**
**

**然而，对于互联网公司来说，帐号的撞库风险在登录、注册、找密等环节普遍存在。**



目前，“黑产”主要通过第三方网站大量泄漏的用户数据，在这些潜在风险的地方，进行账号检存操作，然后通过存在的账号测试对应密码检存；或者寻找无任何防御的登录接口进行撞库。账号与密码一旦被黑产所获悉，会员权益有被分享的风险，进而导致爱奇艺会员营收的损失与口碑的下降，甚至由于大量隐私泄露，触犯最新出台的《网络安全法》，引起刑事诉讼。



对黑产来说,他们拿到其他网站泄露的账号(用户名和密码)，会到爱奇艺这边做帐号的检测，检查帐号在爱奇艺是否存在，是不是会员，如果是会员则就把这个帐号盗取了。



对黑产来说, 撞库效率是非常关键的, 要求用最快的时间检测最多的账号。目前黑产已经形成非常完整的产业链，有专人负责开发撞库软件, 并软件下发给手上有各种失窃账号数据的人，这些人利用各种物料(例如拨号器, 代理等)实施检测,，检测结果快速汇聚整理，并寻求下游的分享或者售卖。



**我们是如何把这个问题解决掉呢？**



安全风控服务, 从登录、注册、验证码等多个风险点的联防联控入手，利用流式异常检测引擎、智能评分卡和多业务数据流复杂事件关联等结合进行实时对抗，以期从根本上解决账号大规模泄露的风险。



**这个问题的解决的难点在哪里呢?** 



黑产手上的IP非常多, 包括各种代理和动态拨号获取的IP，其构建的检测请求的客户端特征也可以进行快速的伪造，机器撞库根本上是追求低成本高效率，也就是一个IP在被风控识别出为撞库源之前完成尽可能多的撞库请求，这也要求在1s内尽可能完成更多的撞库请求，这还包括了验证码的告破解率。



因此，面对快速多变的对手, 依赖拍脑袋的高频阈值控制是很容易被黑产绕过的。**对风控而言, 主要是解决三点：**



1

使用流式检测手段，尽可能快的识别出物料维度(例如IP等)+客户端多维特征的异常组合, 这些异常组合能够尽快的进入到拦截标注集中发挥作用，在失效之前对后续同一组合的请求导入到验证阶段，这个依赖于我们的大规模流式异常检测的能力。

2

利用稳定的攻击行为特征(客户端多维特征)加上安全画像刻画物料(例如IP等)的历史行为特征协同验证阶段的行为特征进行组合拼接，从而形成大量的临时拼接标注,并进入到拦截标注集中发挥作用，在失效之前对后续同一组合的请求导入到验证阶段，这非常有利于我们预测黑产的一个新的维度组合从而快速拦截。

3

命中的检出拦截标注或者临时拼接标注会进入到安全画像分析出物料维度(例如IP等)的历史行为特征以及归纳出稳定的攻击行为特征(多维特征组合)，用于后续持续临时拼接, 这个依赖于安全画像服务。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](http://mmbiz.qpic.cn/mmbiz_jpg/unymlvueOvu6nF367bibviarNia28zJIYOAlSMarmgcxEib6YhtXnWQFQThsKrBHRQbwsYZIZaoeXXY0ibgCDGia973w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



从整个对抗的成果来看，共实时拦截黑产撞库请求超过2亿次，从我们自己的监控来看从2017年4月中旬开始，每日撞库成功的账号数目降至个位数，此外，从各大社交网站舆情监控来， 用户反馈被盗号的情况也基本上消失。



![img](http://mmbiz.qpic.cn/mmbiz_gif/unymlvueOvu6nF367bibviarNia28zJIYOArwBsYsicVXMU7geWJiahx0Tlbx6KKO07NdpvPNCdpiakAZvjnv0icZ24uw/0?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)



**机器撞库盗号攻击基本消失**

![img](http://mmbiz.qpic.cn/mmbiz_jpg/unymlvueOvu6nF367bibviarNia28zJIYOAO7M1IfkRanvUkKic6MPQ5HYCUfV9Od6iaP7bUIxf52AE72pHdQEtXbfw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)













**07**







**风控服务的心得**







**拥抱业务：**安全只有拥抱业务才能体现价值 





 **云端结合：**立足于云，服务为云，结合与端 **
**





 **精细运营：**业务安全需要持续运营 





 **协同联动：**多点多层次跨业务防御 





 **二八原则：**优先解决主要风险 





 **数据驱动：**充分挖掘数据价值 



![img](http://mmbiz.qpic.cn/mmbiz_jpg/unymlvueOvu6nF367bibviarNia28zJIYOAtofjdaKTEq7XDVRvuNIVWj8KmOgia9rAib1X3XS6VbcXzPYCY2E7oIKQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](http://mmbiz.qpic.cn/mmbiz_jpg/unymlvueOvu6nF367bibviarNia28zJIYOAsw9FyUWicG25CXRuaz6ZHt1DQWbosKeiaSbGKC0cjib1VJmr1ZRBb3Yicg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](http://mmbiz.qpic.cn/mmbiz_png/unymlvueOvu6nF367bibviarNia28zJIYOAaOJnpJFBNh8MOZm9VwhpS5ibrmAZAlibF0pibl2CeYvs884mQLXHaBO0g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**71SRC**

**https://security.iqiyi.com**



![img](http://mmbiz.qpic.cn/mmbiz_png/unymlvueOvu6nF367bibviarNia28zJIYOAHIuvwPYqkc2Lq4B4jr0VUMRdXh9Ewb3MfSohT6Qic06RK6jw99EnTpA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)







**如果觉得不错，就请分享给身边的朋友们吧!
**



![img](http://mmbiz.qpic.cn/mmbiz_jpg/unymlvueOvu6nF367bibviarNia28zJIYOAVMD8EG6CzXPQC1BNrLAX50lZQOctPGpVyaZ29rLvqIgI5nIY9AnxSA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

# 爱奇艺业务安全风控体系的建设实践

Cindy [业务安全](https://www.4hou.com/category/business) 2017年10月15日发布

收藏

导语：01 普遍业务风险 ：行业的共同的问题 爱奇艺在快速发展过程中, 业务越来越多，越来越复杂，用户的权益和信息价值越来越高, 我们面临的业务安全的挑战也就越来越大。 除了传统的网络黑客的入侵，攻击以外，新的业务形态带来的新型风险: 比如撞库盗号，盗播盗看，很多的营销活动招引大量的薅羊毛的行为, 刷量, 刷人气, 恶意发布不良信息等风险, 社交场景下的拉粉和不良信息恶意传播, 支付场景下的欺诈, 所有这些风险一旦被黑产利用, 都可能对企业的



**01 普遍业务风险 ：行业的共同的问题**

爱奇艺在快速发展过程中, 业务越来越多，越来越复杂，用户的权益和信息价值越来越高, 我们面临的业务安全的挑战也就越来越大。

除了传统的网络黑客的入侵，攻击以外，新的业务形态带来的新型风险: 比如撞库盗号，盗播盗看，很多的营销活动招引大量的薅羊毛的行为, 刷量, 刷人气, 恶意发布不良信息等风险, 社交场景下的拉粉和不良信息恶意传播, 支付场景下的欺诈, 所有这些风险一旦被黑产利用, 都可能对企业的稳定运营带来大的冲击。

以下总结了各种业务会遇到的风险

会员：撞库盗号，账号分享，批量注册

视频：盗播盗看，广告屏蔽，刷量作弊

活动：薅羊毛

直播：挂站人气，恶意图文

电商：恶意下单，订单欺诈

支付：盗号盗卡，洗钱，恶意下单，恶意提现

其他：钓鱼邮件，恶意爆破，短信轰炸

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/1670cc6708dacfd88e10.jpg)











**02 解决方案 ：安全+风控**



针对新的业务形态会遇到的问题，除了一方面是要用常规安全解决方案去解决，另外我们也要对业务做充分的风险评估和及时控制。

常规安全解决方案是加强安全制度和体系建设，推动安全开发和安全运维，关注边界安全, 数据安全和纵深防御。

后者是我们要重点为给公司带来核心价值的关键业务，从风险管控上保护好他们。



![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/1670cc6708dacfd88e10-1.jpg)











**03 业务上线运营：问题多多**



业务在上线运营以后, 不是说没有关注风险评估和控制，但是以前的做法存在有非常多的问题，这里举四类主要的问题:



**一.各自为战**

1各业务方多以安全事件驱动, 多数仅做事前单点防御, 经验数据无法共享

2单点防御容易被黑产各个击破, 无法做到跨业务跨团队的联防联控

3低水平重复建设, 平台资源浪费

**二.拍脑袋"规则"**

1大量的风控规则是专家决策为主,阈值基本拍脑袋而定

2没有引入数据分析或者机器学习等能力, 对事件本质缺乏足够认识及数据支撑, 造成正常用户误杀, 损伤用户体验, 导致用户流失

**三.反应过慢**

1不能快速识别攻击变化进行调整,无法进行积极对抗

2业务代码耦合,依赖业务开发, 测试和上线,占用业务排期

3某些前置/内置规则容易成为业务关键路径, 对业务稳定性造成影响

**四.手段单一**

1可用特征维度不多, 严重依赖于IP, 公共出口误杀严重,引发投诉 

2以限频, 限流, 黑白名单, 图文验证为主, 黑白名单难以维护, 无生命周期











**04 目标风控系统：用云服务来解决业务的问题**



要解决业务在上线运营以后遇到的问题，我们需要将风控服务，以云服务的方式提供业务,让业务关注业务本身, 让跨业务支持的统一风控云服务来对其进行保障。

到底要提供给业务团队怎么样的风控服务呢? 

这里列一下我们的设计目标, 这些目标的达成也就能解决前面说的问题。



**一.联防联控**

1各业务联合, 在模型,规则,数据等方面进行共享, 联合布控协同防御

**二.数据驱动, 智能对抗**

1全站全网数据支撑, 基于数据进行决策

2利用机器学习实现智能异常特征发现

**三.策略灵活, 有效对抗**

1独立服务, 快速迭代

2支持业务的风险多样运营需求

3模型,规则, 策略快速实施, 快速反应 

**四.维度和拦截手段多样**

1不依赖单一维度和单一行为

2云和端结合, 多种拦截手段应对

**五.延迟可控, 低耦合可降级**

1在实时风控场景下, 快速决策, 不能明显增加业务延迟, 自身有问题情况下, 不能影响业务

**六.快速实现, 高效部署**

1能够快速完成架构. 实现和持续迭代

2能够面向私有云的复杂拓扑, 快速部署













**05风控服务的架构**

**一.风控服务组成**



我们的风控服务是由三大子服务组成：

麦哲伦（Magellan）主要包括业务接入(接入层)，三大服务引擎(数据查询，规则执行，模型调用)，面向风控团队的管理平台(服务资源管理, 模型规则管理，生命周期管理，上下线管理，维度数据管理)，面向业务方的运营平台(风险事件管理，仿真，风险处置，监控预警，数据查询和仪表盘，规则清单)。

哥伦布（Columbus）主要面向对业务数据的特征工程，大规模异常检测和深度学习，知识图谱，实时特征，离线特征，环境特征以及安全画像，并对外提供模型可实时调用接口或者模型输出缓存。

郑和（Zhenghe）是安全知识仓库，是面向业务风控和其他安全控制所需的各类安全基础数据和威胁情报。

![爱奇艺业务安全风控体系的建设实践](https://www.4hou.com/wp-content/themes/4houv4/img/lazy.gif)

**二.风控 – 部署** 



利用云平台能力高效构建和发布：

2.5*4个人月从零开始开发构建上线服务, 并对外提供了基于HTTP/RPC的实时风控和近实时风控以及基于离线数据的离线风控.如何把风控服务在复杂的云环境部署下去。

我们会在一个主IDC里，部署运营中心和管理平台。这一块可以快速切换IDC部署，如果这个主IDC有问题, 可以快速切换到另一个IDC。对于真正贴近业务的三大服务引擎，则是基本上所有有受保护的业务的IDC都有进行部署, 以保证业务可以就近访问, 降低访问延。



![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/6bee4aa40cbf5da253b7-1.jpg)

**三.风控 – 引擎**

查询引擎

1Magellan子服务的的核心，主要负责进行实时和离线数据批量查询及聚合

2构建为参数/特征组合提供给规则引擎, 模型引擎

规则引擎

1负责进行规则匹配

2支持自定义执行策略如: 命中退出, 全部执行, 条件退出等

3支持多种规则类型, 如:评分卡, 决策树, 决策表, 普通规则等

模型引擎

1通过查询引擎查上来的一些参数特征，负责进行特征处理及算法执行，以达到和Columbus子服务的协同, 并服务于规则引擎。

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/6bee4aa40cbf5da253b7-2.jpg)

**四.风控 – 运营**

业务如果把风险评估交付给风控，Magellan必须满足其复杂的运营需求： 

一风控服务

业务风险评估,接入登记,根据场景实施初始规则和模型,逐步迭代。

二事件查询/处置/回溯

查询被识别为风险案例的上下文,特征,模型结果,数据标注等信息.供运营进行案例分析及后续仿真

三事件监控和报警

业务/风险数据监控看板,智能报警

四adhoc/Daily数据分析

Adhoc/Daily数据报表,风险数据分析,模型/规则贡献度分析,仿真效果分析等

五离线/在线仿真

基于案例库中的正/反例,结合仿真环境进行模型/策略仿真.利用数据平台进行贡献度, 线上效果比对等分析。

六审批上线

规则模型变更及时通知业务方,风控运营团队,相关业务方,相关负责人确认审批上线。

五.风控 – 数据



风控最重要的还是数据。

风控通过Columbus子服务从业务方获取的海量的近实时或者离线业务数据, 并把数据进行清洗和特征工程,形成基础数据，这些基础数据存在HDFS-HBase里面，通过数据分析和机器学习的方法, 产生各类标签，画像和模型, 经过安全专家确认, 产出的安全规则和可用的模型缓存。

针对业务数据获取和处理, 对于实时数据 ,利用Apache Flink构建, 实现图特征工程, 多维频次特征工程, 多数据流Complex Event Processing处理, 达到毫秒级延时. 

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/e3e08fa8d6984154ed3b.jpg)

Columbus的多渠道业务数据采集和处理

1实时数据:基于Apache Flink

构建: 图特征工程, 多维频次特征，多数据流Complex Event Processing，毫秒级延时

2近实时数据:基于Apache Spark

构建:异常检测,流式特征工程,，秒级延时

3离线数据: 基于Apache Spark，Impala/Hive

构建:安全画像，用户画像，全业务数据， 小时/天级延时

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/0ba3d1347dcfefc91497.jpg)

**五.风控 – 数据**

安全画像

Columbus的安全画像

对全站业务数据分析和提炼以后

形成海量的多维度标签刻画

为风控的每一次处理

丰富上下文场景和实体特征

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/8b806395835f8a605e77.jpg)



安全画像作为风控最重要的一个业务数据的积累。通过潜在的数据提炼以后，形成海量的多维度度标签刻画。我们整个安全画像的话，包括他通过哪一个IP等等。目前大概有600多种标签，数据总数已经超过19亿。

**五.风控 – 数据**

Zhenghe安全知识仓库

Zhenghe系统是安全云的包括威胁情报在内的基础安全数据集

1全网安全数据监测和收集，包括 自采，共享和第三方采购

2对业务安全而言重点关注 – IP信誉分, IP分类识别, 公共出口识别, 代理IP识别, 手机号信誉分, 虚假小号识别等

3威胁标记类型210个，涵盖13个维度，总共记录数约16亿条

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/8b806395835f8a605e77-1.jpg)

IP信誉分

 融合爱奇艺内部多个系统的数据

参考第三方数据

综合衡量一个IP的长期行为

得到一个-100到100的信誉分

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/14cd94ac43b3d8a8b298.jpg)

**六.风控 – 平台**

Columbus的核心是异常检测

如果黑产完全和正常用户一样的话

其实是达不到获利的目的的

所以异常检测对安全来说

也是风控平台的一个基本功能

Columbus主要是通过自研的方式

实现各种异常检测的功能

在该核心功能的基础上

构建了整个哥伦布系统的上层架构

实现面向风控Magellan服务的能力

一

预处理特征工程

预处理工具

低级特征工程库: 

对数特征,归一化特征,主成份特征 …

高级特征工程库: 

FPGrowth关联特征,k-means距离特征, 多维自动关联 … 

二

离线检测

低级异常检测算法库:

多种分布模型, 单维度异常检测 …

高级的异常检测算法库: 

基于FPGrowth关联的多维异常检测 …

三

在线监测

流式异常检测: 

基于FPGrowth关联流式, 基于CEP…

基于时间序列的异常检测: 

基于基线曲线预测, 基于深度学习时间序列

四

基础工具库

自动化数据解析,存储和导入等工具

**七.设备指纹**

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/14cd94ac43b3d8a8b298-1.jpg)



对风控而言, 还要提一下其依赖服务: 设备指纹。

风控需要一个好的设备指纹的服务，要让所有的端都能够采集设备纬度，形成一个指纹，这个指纹多维签发的, 而且在云端会做大量的黑产分析，联合安全画像进行沉淀。

因为这些数据都是用户提供上来的，必须要做一个防伪的检测，从多维度数据里面查出提供的维度数据矛盾和不真实。

**八.验证手段**



1.图文验证码

传统的复杂图文验证码



2.滑动验证码

基于滑动的人机行为识别进行验证



3.上下行短信验证

发送下行或者上行短信进行验证



4.基于信任设备的验证

信任设备可以为其他端进行授权和验证



5.基于安全盾APP的验证

安装爱奇艺安全盾APP可以为其他应用进行 

动态口令(OTP), 推送一键确认, 扫码确认 

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/969f5ba935eae36b39c7.jpg)



其他: 暂时放行+事后处置,

降级体验或者权益

 A业务标识+B业务拦截

(A业务识别风险以后只做标识画像，

然后B业务进行拦截, 

这样非常有利于让黑产无法识破规则策略)











**06风控服务的成果**



1.业务覆盖：

涵盖帐号, 会员, 活动, 支付, 播放反作弊, 

社交, IT, 直播等重要业务



2.服务质量：

日均请求量超24亿, 延时5ms以内, 无故障运行



3.柔性风控：

平时重监控, 战时重对抗. 注重用户体验



4.核心亮点：

事前, 事后纵深防御体系,

结合事中跨业务联防联控及实时流式异常检测,

机器撞库接近100%抑制





在这里重点讲一下我们对机器撞库盗号的防御成果。

会员账号的安全关系到爱奇艺会员付费战略的顺利实施以及爱奇艺良好口碑的建立。

然而，对于互联网公司来说，帐号的撞库风险在登录、注册、找密等环节普遍存在。

目前，“黑产”主要通过第三方网站大量泄漏的用户数据，在这些潜在风险的地方，进行账号检存操作，然后通过存在的账号测试对应密码检存；或者寻找无任何防御的登录接口进行撞库。账号与密码一旦被黑产所获悉，会员权益有被分享的风险，进而导致爱奇艺会员营收的损失与口碑的下降，甚至由于大量隐私泄露，触犯最新出台的《网络安全法》，引起刑事诉讼。

对黑产来说,他们拿到其他网站泄露的账号(用户名和密码)，会到爱奇艺这边做帐号的检测，检查帐号在爱奇艺是否存在，是不是会员，如果是会员则就把这个帐号盗取了。

对黑产来说, 撞库效率是非常关键的, 要求用最快的时间检测最多的账号。目前黑产已经形成非常完整的产业链，有专人负责开发撞库软件, 并软件下发给手上有各种失窃账号数据的人，这些人利用各种物料(例如拨号器, 代理等)实施检测,，检测结果快速汇聚整理，并寻求下游的分享或者售卖。

**我们是如何把这个问题解决掉呢？**

安全风控服务, 从登录、注册、验证码等多个风险点的联防联控入手，利用流式异常检测引擎、智能评分卡和多业务数据流复杂事件关联等结合进行实时对抗，以期从根本上解决账号大规模泄露的风险。

这个问题的解决的难点在哪里呢? 

黑产手上的IP非常多, 包括各种代理和动态拨号获取的IP，其构建的检测请求的客户端特征也可以进行快速的伪造，机器撞库根本上是追求低成本高效率，也就是一个IP在被风控识别出为撞库源之前完成尽可能多的撞库请求，这也要求在1s内尽可能完成更多的撞库请求，这还包括了验证码的告破解率。

因此，面对快速多变的对手, 依赖拍脑袋的高频阈值控制是很容易被黑产绕过的。对风控而言, 主要是解决三点：

1使用流式检测手段，尽可能快的识别出物料维度(例如IP等)+客户端多维特征的异常组合, 这些异常组合能够尽快的进入到拦截标注集中发挥作用，在失效之前对后续同一组合的请求导入到验证阶段，这个依赖于我们的大规模流式异常检测的能力。

2利用稳定的攻击行为特征(客户端多维特征)加上安全画像刻画物料(例如IP等)的历史行为特征协同验证阶段的行为特征进行组合拼接，从而形成大量的临时拼接标注,并进入到拦截标注集中发挥作用，在失效之前对后续同一组合的请求导入到验证阶段，这非常有利于我们预测黑产的一个新的维度组合从而快速拦截。

3命中的检出拦截标注或者临时拼接标注会进入到安全画像分析出物料维度(例如IP等)的历史行为特征以及归纳出稳定的攻击行为特征(多维特征组合)，用于后续持续临时拼接, 这个依赖于安全画像服务。



![爱奇艺业务安全风控体系的建设实践](http://mmbiz.qpic.cn/mmbiz_gif/unymlvueOvu6nF367bibviarNia28zJIYOArwBsYsicVXMU7geWJiahx0Tlbx6KKO07NdpvPNCdpiakAZvjnv0icZ24uw/0?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/969f5ba935eae36b39c7-1.jpg)



从整个对抗的成果来看，共实时拦截黑产撞库请求超过2亿次，从我们自己的监控来看从2017年4月中旬开始，每日撞库成功的账号数目降至个位数，此外，从各大社交网站舆情监控来， 用户反馈被盗号的情况也基本上消失。

机器撞库盗号攻击基本消失

![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/cab4bcd9d8114ce8a3b8.jpg)











**07风控服务的心得**



拥抱业务：安全只有拥抱业务才能体现价值 





 云端结合：立足于云，服务为云，结合与端 





 精细运营：业务安全需要持续运营 





 协同联动：多点多层次跨业务防御 





 二八原则：优先解决主要风险 





 数据驱动：充分挖掘数据价值 



![爱奇艺业务安全风控体系的建设实践](http://img.4hou.com/wp-content/uploads/2017/10/63814668a80d91a91c95.jpg)



本文为 爱奇艺技术产品团队授权嘶吼发布，如若转载，请注明原文地址： https://www.4hou.com/business/7974.html

[
  ](javascript:;)

## 【深夜22点半】知彼：互联网业务安全的黑灰产业链的故事——妈妈，长大以后我也要干黑产

原创： 独孤qiu败 [互联网风控那些事儿](javascript:void(0);) *2018-01-04*

​    之前写过一篇关于支付风控体系设计的文章，但是对于互联网电商而言，支付环节的风险仅仅是一环，对于很多没有能力构建风控系统的中小创企业而言，他们觉得自己不在乎多花点手续费选择网银、第三方支付方式来规避支付环节的风险，但是中小创企业就能天真的以为他们的业务安全了么，恩，真的是too young too天真

​    在互联网行业做风控，首先需要学会的是，你要知道你的对手是谁、他们是怎么做的、他们想做什么、他们在哪做（who，how，what，where，），这样才能不断提高现有的业务风控水平，在不断变化的业务环境中get到新业务可能存在的风险点并做好对预知风险的防范措施。所谓道魔互博，只有对对手足够了解，才能不断提高风险防范水平，在用户感知不到的节点为所有业务部门提供业务的支撑保护。

​    不以盈利为目的的黑产都不是好黑产，如下图：

![img](http://mmbiz.qpic.cn/mmbiz_jpg/hsYFTN24kWJdu5nJ97frtOgn8hcvMQLFd5Gpd2bKAQJJSw101GqIibZfFrcd7VL2sBMhMcL9Yt97FxQg4ulzn4w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**图一：黑产链的获利渠道**

​    当然，我这里指的仅仅是电商/信贷行业的业务风险，对于互联网这个圈子而言，会被黑产盯上的行业太多，比如游戏私服、网络彩票、色情赌博等，但凡有利益的行业都会有人去干；而企业面临的黑产风险类型也很多，主要分为技术风险与业务风险，大体上可以如下分类，为了配合本文行文方便，对我所已知的风险做了如下分类：

**表1：互联网行业面临的风险分类**

|                   | 代表性行业           | 业务风险                                   | 技术风险                         |
| ----------------- | -------------------- | ------------------------------------------ | -------------------------------- |
| 电商/互联网信贷等 | O2O，消费金融，OTA等 | 支付盗刷、薅羊毛、伪造身份进行信用申请等   | 撞库、脱库、DDOS攻击、越权访问等 |
| 非电商行业        | 游戏私服、网络彩票等 | 这种行业已经不叫风险点，整个行业都是违法的 |                                  |

​    当然这里对风险的分类其实并不准确，但是结合我之前的工作，本文想阐述的仅仅是表格中的阴影部分，这些风险点对于企业而言就犹如溃坝的蚁穴一般，单个风险点损失不是很大，几千几万的损失而已，但是不加控制就会全节点开花。因此对于一家略微成熟的互联网企业，所面临的风险一定是多层次全方位的，单单只对一个节点的控制是远远不能满足业务发展的需要的。

​    另外，很想跟大家说的一点是，很多业务风险的黑色产业从业者基本没有太高的技术水平，他们是整个环节的下游部分，基于网络上形形色色的数据信息来钻公司流程规则的漏洞。

​    这些对于业务风险点的风控体系设计后续可能会单独另开一篇文章，但是作为一名立志要干好风控的同学来说，知己知彼，知道这些业务风险的黑色产业链对于做好风险点的业务防控至关重要，这么好学的宝宝真是一个励志的boy。当然，从业这么长时间来，通过各种途径接触了形形色色的黑产介入的欺诈场景，也在与同行的交流中收益良多。

​    另外，欢迎本文的主人公王小明，一个机票代理公司的小白领，要用他的经历跟大家分享这些黑色产业链的故事。

 

**支付盗刷**

（一）盗刷端



> 王小明昨天发工资了，好开心，准备下班之后边吃火锅边唱歌，突然，收到一连串消费短信：您的尾号为xxxx的xx银行卡在XX易购消费5999元，当前余额0.89元。正在吃着撒尿牛丸的王小明一脸懵逼，看看自己的银行卡还在自己干瘪的钱包里，王小明已经预感到未来一个月这顿火锅会是他最好的一顿饭了。



​    这样的案例屡见不鲜，且从有银行卡的历史开始就开始有盗刷。对于电商网站而言，对此也苦不堪言，因为品牌形象受损、资产损失赔付。但是王小明的卡到底是怎么被干掉了呢。



（1）   卡号、身份证信息、手机号的泄露

​    等等，excuse me？这个也叫泄露，难道这个不都是算是公开的了么，银行内部人员泄露、社工库、定制化数据脱取、公共场合不安全刷卡方式泄密等等，是不是有人还收到送pos机给你的情况？哦，对了，还有爱占便宜的刷卡送米送油的活动是可以的哦~

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**图二：盗卡渠道**

（2）   验证码窃取

​    一张图，不多说，是只想说，短信验证码并不是绝对安全。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**图三：手机验证码泄露渠道**

​    其实很多时候验证码泄露并没有想象的那么难，就跟我文章刚开始说的一样，业务风险方向的很多黑产是基于最简单的流程漏洞和人的心理，利用社会工程学很有可能就捞到验证码信息。

​    这里举一个曾经非常有名的利用社会工程学窃取G行网银用户验证码的案例：G行网银里的余额转移到贵金属账户里面是不需要短信验证码的，黑产利用盗窃到的账户密码（不要问我怎么盗取到的，有多少人一条密码走天下？）将余额转到贵金属账户，然后伪装G行客服给客人电话说他的账户涉及xx操作，客人去登录自己的G行账户确实发现余额变少了（账户余额看不到贵金属的金额），当时就急了呀，这时客服又适时的来电话说我帮你操作可以把余额转回来，需要你提供下发到你手机上的验证码，其实这个时候收到的验证码可能就是转账或者消费的验证码了，但是这个时候客户心理着急啊，哪想得到那么多，收到验证码之后就给骗子报过去了，于是，贵金属账户里面的余额就真的拜拜了。这一起案例到底有多少G行客户收到影响、金额是多少至今我没有拿到有效数据，但是从我与G行人员的接触来看，这批案件已经惊动到了G行总行高层，所以金额不会少。

​     让我们继续说说王小明，上个月王小明家里没油的时候小区门口有个xxx送温暖进小区的活动，刷卡9.9送一桶油，但是活动主办方说为了保证活动用户真实性，需要每个人带着自己身份证登记刷卡的卡号、手机号、身份证号，王小明作为一个单纯的宝宝深信不疑，并从内心表示深深的感恩xx品牌；双11晚上，作为单身狗的王小明寂寞难耐，打开了手机某个小H网的地址排解心中的寂寥，于是，基于以上种种，王小明这个月只能吃土了。

 

（二）销赃端



> 俗话说，祸兮福所倚，吃土的王小明总算不再走背运了，被盗刷的第二天，王小明的同事李小花听闻了王小明的悲催故事，萌生出一丝怜悯之意，考虑自己已经失恋33天了，王小花决定答应了追求了自己32天的王小明，王小明终于不再是单身狗了。经过134个小时的相处，两个人觉得需要更深层次的了解彼此，于是准备在一个夜黑风高之夜把最珍贵的交给对方。因为这个时候的王小明已经在吃土了，300块钱一晚的R家对于王小明来说已经非常奢侈了。这个时候一个好哥们张大飞知道了王小明的窘况，把王小明拉到一个“全国酒店机票内部低价折扣群”，群主知道的王晓明的需求之后，爽快的答应王小明先预定成功再付款，不得不说王小明背运终于过了，给了群主200块钱就收到X程的预定短信入住了高端大气的R家酒店，在一个夜黑风高夜与李小花同学好好的了解了彼此。王小明对群主感恩戴德。



​    可是王小明不知道，上次自己的卡无缘无故被盗刷也是拜这个群主所赐。作为盗卡团伙的小喽啰，群主仅仅是作为整个盗刷链条的最下面一环进行销赃，无论是借记卡或者贷记卡，收集完信息之后都会卖给下家的，具体能卖多少钱就要看借记卡的余额或者贷记卡的额度了，总之，这条产业链已经非常成熟，每一个环节都有一拨人在做这件事，对于这，我只想说，老司机带带我。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**图四：盗卡/伪卡交易产业链**

 



**电商业务作弊/流程漏洞**

**
**

​    其实电商环节中的可作弊的点太多，刷点评、刷排名、刷销量这些都已经老生常谈，TB对这块也构建了十分详细的风控规则，比如用户浏览行为、跳转前后页面、收货地址、支付流水等进行规则性监控。这里想说另外一个也很常见的产业链，俗称薅羊毛

​     每次我跟别人说我的工作内容之一是“薅羊毛”的时候，人家都会说你的工作性质好可爱哦~~求我的心理阴影面积。



> ​     我们来继续开始王小明的故事。王小明与李小花恩爱到了情人节，正在吃土的王小明想要送给李小花一份礼物，但是电商网站上的东西都挺不菲的，王小明一筹莫展。这个时候，王小明的好哥们张大飞又出现了，给他指了TB这个道，so~就这样，王小明同学又好开森~

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)
**图五：网上大量优惠券售卖示意**

​    至于优惠券、新手礼包被刷对于电商网站来说已经是足够正常，至于是否该重视这件事，则看公司老板的态度，是不是把这些营销费用用到最真实的客户那里。当然，提到这条薅羊毛产业链，还得从一开始的源头说起



（一） 注册领券端

​    说到注册领券，简直是风控圈人人憎恶的问题，比盗刷还可恨，因为这是一条合法的黑色产业，不出事还好，出事了只能怨自己风控措施做的不严，不过这样的也能带来虚假的繁荣。

​    一套成熟的黑产肯定都会有猫池插大量的银行卡，刷单稍微低级点的黑产团伙拥有几千上万张卡，再比如就是：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)
**图六：黑产团伙拥有大量黑卡**

​     当我看到700万张卡被打击的时候，我的内心是拔凉拔凉的，警方你要是都打击完了我是不是以后也要失业了？

​     当然，高级点的黑产团伙才不会用这些，人家用的都是真实手机号，还会交月租的哟，20块钱的月租薅羊毛收入绰绰有余，电话拨过去人家还会跟你周旋哟~~

哦，对了，肯定会有人会问关于验证码的问题，在这只能说连12306都不是事，还有什么~~

​     至于该如何防范，以前我们使用过国内某第三方公司x安的号码识别服务，从对空号等的识别效果来看还是能够应用在生产业务当中的。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**图七：验证码打码网站**

（二） 销赃端

​     至于销赃端，不多说渠道太多，小打小闹的卖给个人那就算了，其实对于电商企业而言，最怕的就是黑产联合供应商刷单套利，而面对这种套利行为对于电商企业而言最大的问题是该如何给其定性，因为无论怎么样稍有用心的供应商都会让这条证据链无从查起。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)
**图八：可刷的网站优惠券信息共享群**



> ​     我们的主人公王小明同学在一家机票代理公司工作，所谓机票代理公司就是帮别人下机票订单的。王小明同学是一名普通的操作员，公司老板每天都会给王小明1000个新注册的x哪儿 x程的账号，每个账号里面都有好几十的机票优惠券，王小明每天都使用这些优惠券给客人下单。他一直很好奇老板从哪里搞来的这么多账号，直到他把心中的疑问跟张大飞说了，张大飞深谙此道，告诉了王小明同学其中端倪。王小明同学心中一阵窃喜，回去准备干一番自己的大事业，当然王小明不准备干机票了，王小明跟张大飞合伙开了一家酒店，采用同样的方法，事业蒸蒸日上，跟李小花的日子也过的风生水起。



​     当然，这些黄牛号可不单单只是用来享受优惠券，还可以用来参加网站的抽奖活动、刷点评、电商的秒杀活动等，用处大着呢。

   

​    大体来说，上述的流程由以下几步构成



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**（1）由设备提供商提供大量猫池设备**

**（2）由卡商提供数万张多种渠道来源的手机卡**

**（3）接码平台****担当掮客的角色，在卡商和作弊者之间提供桥梁，并对接打码平台，****解决图形验证码问题**

**（4）利用新用户优惠，在多平台上完成销赃过程****
**





（三）供应商商户端账户泄露/虚假供应商



（1）商户端信息泄露

> ​     王小明的酒店在各大OTA上面都挂牌了，除了使用虚假账号代客下单把前台转化的客人在OTA下单套取红包补贴之外，作为一名上进青年王小明还是很希望自己的酒店在OTA上能够有一番作为的，至少希望可以把自己的酒店可以在商圈搜索的时候暴露在首页，这个时候，张大飞又介绍了一个哥们给王小明说可以帮忙刷销量，但是呢需要王小明提供各大OTA的商户端账号密码。确实，在接下来的一个月里酒店销量风生水起，但是到结算佣金的时候，王小明一脸懵逼，产生了大量的现付结算佣金，但是这些间夜在自己酒店从来没有住过。突然想到那个刷单的哥们，结果发现失去联系，现付订单里的返现也全部被套空。

​    

​     现在带有O2O性质的企业都有自己的商户端，而对于商户而言对密码的重视程度不高，因此会有很多黑产团伙利用诸多手段套取商户手里的密码，当然如何获取到的途径是有多方面的，可能采用一些技术手段。

​    但是就如我前文提的那样，绝大多数的黑产团伙都是采用比较低级的手段，比如会有专人去酒店应聘前台服务人员，所以，很多黑产业务都是非常低技术门槛的，就跟前文说的一样钻的就是整个公司的流程管理漏洞。



（2）虚假供应商



> ​    王小明不甘心，一定要发誓把在OTA上损失的钱给追回来。我们的王小明同学是很机智的。结合到自己被骗的场景以及发现在某个OTA上的酒店上线门槛很低，王小明偷偷的使用诸多虚假证件做了一家虚假酒店提交给OTA申请挂牌，很快就被通知挂牌通过，该酒店订单目前能够享受约8%的现付订单返现~王小明同学不甘示弱，每天都要在这家虚假酒店上下数十万的订单套取几千元的补贴，等到要结算佣金的时候，关机再也找不到人，王小明同学一阵开心。可是不巧的是，该OTA的风控部门事后分析能力还是挺强的，通过诸多路径还是找到了王小明同学作案的事实。

  

​    对于供应商的审核也是很多O2O和电商行业的漏洞，一个虚假供应商能做的事情很多，除了套用平台发放的优惠券之外，还有一个非常重要的套现的作用，我们以王小明的视角来继续开始我们的故事。

 



**电商信贷欺诈**

（一） 信用额度套现



> 王小明的酒店投入了大量的资金，现在手头开始吃紧了，几张信用卡已经被刷爆了，现在手头已经开始急需用现金了，王小明一筹莫展。紧急时候，一定要推荐这位张大飞同学，张大飞给王小明一个qq号，qq签名是蚂蚁花呗、苏宁任性付、京东白条套现。在这个qq主人的教导下，王小明顺利开通了这三个网站的信用额度，并且顺利的从这三个网站购物套现了2万元，只是王小明需要付出10-20%的套现手续费。

![img](http://mmbiz.qpic.cn/mmbiz_png/hsYFTN24kWJdu5nJ97frtOgn8hcvMQLFdrE5oZTgjziaVE5pra6VgObcqSJpXI8duH5V7kTbZ1EnehreuS8H4hw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
**图九：信用额度套现广告**

​     对于有信用支付的电商网站而言，这种类型的信用套现危害暂时体现不出来，可能过了几个月的时候开始出现坏账，美团点评曾经紧急关停过花呗支付渠道。而在短期KPI考核的压力下，电商公司会很欢迎这些套现的行为，因为这会提升信用产品的用户使用频率。但是不置可否，这些需要套现的用户其还款能力是很值得质疑的。而一家店铺使用大量的信用支付，对这家店的真实性也应该表示质疑。所以这就是刚刚说的一家虚假供应商能够做很多事情。对于电商行业，我想他们的风控体系大概都对每家店铺的信用交易情况进行了监控，我相信黑市上这么多套现渠道肯定是基于大量的虚假电商店铺；另外，作为心机biao的风控er去埋伏套现群也是精确打击虚假店铺的的有效方法之一。

 

（二） 身份冒用欺诈



> ​     王小明跟李小花要去买房了，好不容易看上一套三室一厅90平，等到去办房贷的时候征信报告打出来一脸懵逼，为什么会有信贷逾期坏账记录？王小明去人行咨询获得自己逾期信息来源于一家上报征信记录的消费金融公司，再去跟消费金融掰扯终于搞清了自己有过一笔网上信用贷款，王小明打死不认，但是各种信息都是他的身份认证信息，王小明二脸懵逼。在各种掰扯之下，消金公司终于答应王小明从PBOC里面撤销逾期记录

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)
**图十：身份证信息泄露渠道**

​     目前形形色色的电商公司都有自己的消费金融公司，也有很多需要上报人行征信，在网上申请额度的过程也特别简单，因此欺诈风险成为网上信贷机构不可估量的损失，对于网贷来说欺诈风险远远大于常见的信用风险。而为了用户体验，申请额度所需要的材料其实非常简单，因此网上有诸多利用很多虚假材料来获得信用额度并用来购物、提现的案例，具体过程与操作手法暂不详表，只能说，这是一条基本没办法抓到的暴利的黑色产业链。

 

**总结**

​    限于篇幅以及一些黑产操作流程，所以很多细节没有阐述特别清晰。另外，业务环节的风险远远比这篇文章里面的东西要多，而且各家互联网公司随着自身业务的多样性和特异性，会衍生出新的风险，所以公司与公司之间的风控体系在业务层面还是有较大的差异。

​    而对于互联网行业来说，对于这种高频次的用户非面对面的行为，面临黑产的肆虐是不可避免的，这也是攻防不断提升的过程，需要在业务运营过程中不断预知风险、发现风险、提高风险门槛，所以说风控体系的形成也是随着业务量的提升、风险事件的案例来不断优化完善的。

​    黑灰产的利润很诱人，但是这条产业链毕竟是游走在法律边缘，在过去的工作中，也参与了数起案件协同网警、刑警抓获在公司运营中的黑灰产犯罪团伙并得到了有期徒刑的法律制裁。因此，君子爱财取之有道，各位珍重。

 

【本文部分图片来源与业内相关同学分享，已获得版权所有者允许，转载之前必须标明出处】





更多历史文章请戳以下链接：



[【深夜22点半】电商的支付风控怎么玩？](http://mp.weixin.qq.com/s?__biz=MzIzNDY3MTgzNw==&mid=2247483693&idx=1&sn=44d2f86b9befab146582a29a51c96c73&chksm=e8f39a9fdf8413896a8001b5ea85bee45442c2823f564171321d7cebd143f6721edf2df5e8d7&scene=21#wechat_redirect)

[背锅侠的故事：支付风控产品经理的OS](http://mp.weixin.qq.com/s?__biz=MzIzNDY3MTgzNw==&mid=2247483692&idx=1&sn=ea67af88ffdae3d58e7c84f837016844&chksm=e8f39a9edf841388f36c9f6e93a194c86de17ab1b38ab293a6a52bc44466a8358277fd09e505&scene=21#wechat_redirect)

[ 一场跨度一年的促销活动：看与黑产的‘功守道’](http://mp.weixin.qq.com/s?__biz=MzIzNDY3MTgzNw==&mid=2247483669&idx=1&sn=7cd62f7ad75ced0787f16977d469715d&chksm=e8f39aa7df8413b1eb19d61e660d1377a7d55e3ac89ad356da526fb4e8546de0a811b1d99649&scene=21#wechat_redirect)

[
](http://mp.weixin.qq.com/s?__biz=MzIzNDY3MTgzNw==&mid=2247483669&idx=1&sn=7cd62f7ad75ced0787f16977d469715d&chksm=e8f39aa7df8413b1eb19d61e660d1377a7d55e3ac89ad356da526fb4e8546de0a811b1d99649&scene=21#wechat_redirect)





【欢迎扫一扫下方二维码关注该微信公众号，将不定期更新互联网公司风控方向的实战工作，包括但不限于电商和互联网金融方向的黑产业务对抗、系统交互设计、风控模型构建等】

![img](https://mmbiz.qpic.cn/mmbiz_jpg/hsYFTN24kWKXh6GZTXz4fwEpLicUJfFL60MeztoCQy6VpRq0xvbe6aMByLicTapqZuV1mkhSOtHIO6ibrkhwufdNw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

# 风控PM必知必会：互联网业务安全的黑灰产业链的故事

[人人都是产品经理](https://36kr.com/user/419888) *·* 2016-11-23

之前写过一篇关于支付风控体系设计的文章，但是对于互联网电商而言，支付环节的风险仅仅是一环，对于很多没有能力构建风控系统的中小创企业而言，他们觉得自己不在乎多花点手续费选择网银、第三方支付方式来规避支付环节的风险，但是中小创企业就能天真的以为他们的业务安全了么，恩，真的是too young too 天真

*人人都是产品经理是中国最大最活跃的产品经理学习、交流、分享社区。集媒体、社区、招聘 、教育、社群活动为一体，全方位服务产品经理。本文由*[*人人都是产品经理社区*](http://www.woshipm.com/) *作者@独孤qiu败（微信号 duguqiubaiwp） 原创发布。转载请联系人人都是产品经理。*

在互联网行业做风控，首先需要学会的是：你要知道你的对手是谁、他们是怎么做的、他们想做什么、他们在哪做、他们什么时候做（who，how，what，where，when），这样才能不断提高现有的业务风控水平，在不断变化的业务环境中get到新业务可能存在的风险点并做好对预知风险的防范措施。所谓道魔互博，只有对对手足够了解，才能不断提高风险防范水平，在用户感知不到的节点为所有业务部门提供业务的支撑保护。

不以盈利为目的的黑产都不是好黑产，如下图：

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053412/fmt3q54uqip55ywa!1200)

图一：黑产链的获利渠道

当然，我这里指的仅仅是电商/信贷行业的业务风险，对于互联网这个圈子而言，会被黑产盯上的行业太多，比如游戏私服、网络彩票、色情赌博等，但凡有利益的行业都会有人去干；而企业面临的黑产风险类型也很多，主要分为技术风险与业务风险，大体上可以如下分类，为了配合本文行文方便，对我所已知的风险做了如下分类：

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053412/qtrc0rccmtje3p5l!1200)

表1：互联网行业面临的风险分类

当然这里对风险的分类其实并不准确，但是结合我之前的工作，本文想阐述的仅仅是表格中的阴影部分。

这些风险点对于企业而言就犹如溃坝的蚁穴一般，单个风险点损失不是很大，几千几万的损失而已，但是不加控制就会全节点开花。因此对于一家略微成熟的互联网企业，所面临的风险一定是多层次全方位的，单单只对一个节点的控制是远远不能满足业务发展的需要的。

另外，很想跟大家说的一点是，很多业务风险的黑色产业从业者基本没有太高的技术水平，他们是整个环节的下游部分，基于网络上形形色色的数据信息来钻公司流程规则的漏洞。

这些对于业务风险点的风控体系设计后续可能会单独另开一篇文章，但是作为一名立志要干好风控的同学来说，知己知彼，知道这些业务风险的黑色产业链对于做好风险点的业务防控至关重要，这么好学的宝宝真是一个励志的boy。当然，从业这么长时间来，通过各种途径接触了形形色色的黑产介入的欺诈场景，也在与同行的交流中收益良多。

黑产看似离我们很遥远，但是其实就在黑产早已遍布我们的身边，离我们是如此之近。欢迎本文的主人公王小明，一个机票代理公司的小白领，要用他的经历跟大家分享这些黑色产业链的故事。

## 支付盗刷

### （一）盗刷端

王小明昨天发工资了，好开心，准备下班之后边吃火锅边唱歌，突然，收到一连串消费短信：您的尾号为xxxx的xx银行卡在XX易购消费5999元，当前余额0.89元。正在吃着撒尿牛丸的王小明一脸懵逼，看看自己的银行卡还在自己干瘪的钱包里，王小明已经预感到未来一个月这顿火锅会是他最好的一顿饭了。

这样的案例屡见不鲜，且从有银行卡的历史开始就开始有盗刷。对于电商网站而言，对此也苦不堪言，因为品牌形象受损、资产损失赔付。但是王小明的卡到底是怎么被干掉了呢。

**卡号、身份证信息、手机号的泄露：**

等等，excuse me？这个也叫泄露，难道这个不都是算是公开的了么，银行内部人员泄露、社工库、定制化数据脱取、公共场合不安全刷卡方式泄密等等，是不是有人还收到送pos机给你的情况？哦，对了，还有爱占便宜的刷卡送米送油的活动是可以的哦~

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053413/dq99avdz0n70i4tz!1200)

图二：盗卡渠道

**验证码窃取：**

一张图，不多说，诸多技术手段老实说我也不是很了解，但是只想说，短信验证码绝对不安全。

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053412/q4tulrn6zsl0qz7x!1200)

图三：手机验证码泄露渠道

其实很多时候验证码泄露并没有想象的那么难，就跟我文章刚开始说的一样，业务风险方向的很多黑产是基于最简单的流程漏洞和人的心理，利用社会工程学很有可能就捞到验证码信息。

这里举一个曾经非常有名的利用社会工程学窃取G行网银用户验证码的案例：

G行网银里的余额转移到贵金属账户里面是不需要短信验证码的，黑产利用盗窃到的账户密码（不要问我怎么盗取到的，有多少人一条密码走天下？）将余额转到贵金属账户，然后伪装G行客服给客人电话说他的账户涉及xx操作，客人去登录自己的G行账户确实发现余额变少了（账户余额看不到贵金属的金额）。当时就急了呀，这时客服又适时的来电话说我帮你操作可以把余额转回来，需要你提供下发到你手机上的验证码（其实这个时候收到的验证码可能就是转账或者消费的验证码了），但是这个时候客户心理着急啊，哪想得到那么多，收到验证码之后就给骗子报过去了。于是，贵金属账户里面的余额就真的拜拜了。

这一起案例到底有多少G行客户收到影响、金额是多少至今我没有拿到有效数据，但是从我与G行人员的接触来看，这批案件已经惊动到了G行总行高层，所以金额不会少。

让我们继续说说王小明：

上个月王小明家里没油的时候小区门口有个xxx送温暖进小区的活动，刷卡9.9送一桶油，但是活动主办方说为了保证活动用户真实性，需要每个人带着自己身份证登记刷卡的卡号、手机号、身份证号，王小明作为一个单纯的宝宝深信不疑，并从内心表示深深的感恩xx品牌；双11晚上，作为单身狗的王小明寂寞难耐，打开了手机某个小H网的地址排解心中的寂寥，于是，基于以上种种，王小明这个月只能吃土了。

### （二）销赃端

俗话说，祸兮福所倚，吃土的王小明总算不再走背运了，被盗刷的第二天，王小明的同事李小花听闻了王小明的悲催故事，萌生出一丝怜悯之意。考虑自己已经失恋33天了，王小花决定答应了追求了自己32天的王小明，王小明终于不再是单身狗了。经过134个小时的相处，两个人觉得需要更深层次的了解彼此，于是准备在一个夜黑风高之夜把最珍贵的交给对方。

因为这个时候的王小明已经在吃土了，300块钱一晚的R家对于王小明来说已经非常奢侈了。这个时候一个好哥们张大飞知道了王小明的窘况，把王小明拉到一个“全国酒店机票内部低价折扣群”，群主知道的王晓明的需求之后，爽快的答应王小明先预定成功再付款，不得不说王小明背运终于过了，给了群主200块钱就收到X程的预定短信入住了高端大气的R家酒店，在一个夜黑风高夜与李小花同学好好的了解了彼此。王小明对群主感恩戴德。

可是王小明不知道，上次自己的卡无缘无故被盗刷也是拜这个群主所赐。作为盗卡团伙的小喽啰，群主仅仅是作为整个盗刷链条的最下面一环进行销赃，无论是借记卡或者贷记卡，收集完信息之后都会卖给下家的；具体能卖多少钱就要看借记卡的余额或者贷记卡的额度了，总之，这条产业链已经非常成熟，每一个环节都有一拨人在做这件事，对于这，我只想说：老司机带带我。

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053413/g4jb3u4p06rfkfqr!1200)

图四：盗卡/伪卡交易产业链

## 电商业务作弊/流程漏洞产业链

其实电商环节中的可作弊的点太多，刷点评、刷排名、刷销量这些都已经老生常谈，TB对这块也构建了十分详细的风控规则，比如用户浏览行为、跳转前后页面、收货地址、支付流水等进行规则性监控。这里想说另外一个也很常见的产业链，俗称薅羊毛

每次我跟别人说我的工作内容之一是“薅羊毛”的时候，人家都会说你的工作性质好可爱哦~~求我的心理阴影面积。

我们来继续开始王小明的故事。

王小明与李小花恩爱到了情人节，正在吃土的王小明想要送给李小花一份礼物，但是电商网站上的东西都挺不菲的，王小明一筹莫展。这个时候，王小明的好哥们张大飞又出现了，给他指了TB这个道，so~就这样，王小明同学又好开森~

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053413/ccvimgl39zc9fpy4!1200)

图五：网上大量优惠券售卖示意

至于优惠券、新手礼包被刷对于电商网站来说已经是足够正常，至于是否该重视这件事，则看公司老板的态度，是不是要把这些营销费用用到最真实的客户那里。当然，提到这条薅羊毛产业链，还得从一开始的源头说起

### 注册领券端

说到注册领券，简直是风控圈人人憎恶的问题，比盗刷还可恨，因为这是一条合法的黑色产业，不出事还好，出事了只能怨自己风控措施做的不严，不过这样的也能带来虚假的繁荣。

一套成熟的黑产肯定都会有猫池插大量的银行卡，刷单稍微低级点的黑产团伙拥有几千上万张卡，再比如就是：

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053412/f9cd8cj8by63sg5p!1200)

图六：黑产团伙拥有大量黑卡

当我看到700万张卡被打击的时候，我的内心是拔凉拔凉的，警方你要是都打击完了我是不是以后也要失业了？

当然，高级点的黑产团伙才不会用这些，人家用的都是真实手机号，还会交月租的哟，20块钱的月租薅羊毛收入绰绰有余，电话拨过去人家还会跟你周旋哟~~

哦，对了，肯定会有人会问关于验证码的问题，在这只能说连12306都不是事，还有什么~~

至于该如何防范，以前我们使用过国内某第三方公司x安的号码识别服务，从对空号等的识别效果来看还是能够应用在生产业务当中的。

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053412/0uhjaua0rzbsdlww!1200)

图七：验证码打码网站

### 销赃端

至于销赃端，不多说渠道太多，小打小闹的卖给个人那就算了，其实对于电商企业而言，最怕的就是黑产联合供应商刷单套利，而面对这种套利行为对于电商企业而言最大的问题是该如何给其定性，因为无论怎么样稍有用心的供应商都会让这条证据链无从查起。

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053413/944hfb0gvdms8sz2!1200)

图八：可刷的网站优惠券信息共享群

我们的主人公王小明同学在一家机票代理公司工作，所谓机票代理公司就是帮别人下机票订单的。王小明同学是一名普通的操作员，公司老板每天都会给王小明1000个新注册的x哪儿 x程的账号，每个账号里面都有好几十的机票优惠券，王小明每天都使用这些优惠券给客人下单。他一直很好奇老板从哪里搞来的这么多账号，直到他把心中的疑问跟张大飞说了。张大飞深谙此道，告诉了王小明同学其中端倪。王小明同学心中一阵窃喜，回去准备干一番自己的大事业，当然王小明不准备干机票了，王小明跟张大飞合伙开了一家酒店，采用同样的方法，事业蒸蒸日上，跟李小花的日子也过的风生水起。

当然，这些黄牛号可不单单只是用来享受优惠券，还可以用来参加网站的抽奖活动、刷点评、电商的秒杀活动等，用处大着呢。

## 供应商商户端账户泄露/虚假供应商

### 商户端信息泄露

王小明的酒店在各大OTA上面都挂牌了，除了使用虚假账号代客下单把前台转化的客人在OTA下单套取红包补贴之外，作为一名上进青年王小明还是很希望自己的酒店在OTA上能够有一番作为的，至少希望可以把自己的酒店可以在商圈搜索的时候暴露在首页。

这个时候，张大飞又介绍了一个哥们给王小明说可以帮忙刷销量，但是呢需要王小明提供各大OTA的商户端账号密码。确实，在接下来的一个月里酒店销量风生水起，但是到结算佣金的时候，王小明一脸懵逼，产生了大量的现付结算佣金，但是这些间夜在自己酒店从来没有住过。突然想到那个刷单的哥们，结果发现失去联系，现付订单里的返现也全部被套空。

现在带有O2O性质的企业都有自己的商户端，而对于商户而言对密码的重视程度不高，因此会有很多黑产团伙利用诸多手段套取商户手里的密码。当然如何获取到的途径是有多方面的，可能采用一些技术手段，但是就如我前文提的那样，绝大多数的黑产团伙都是采用比较低级的手段，比如会有专人去酒店应聘前台服务人员。所以，很多黑产业务都是非常低技术门槛的，就跟前文说的一样钻的就是整个公司的流程管理漏洞。

### 虚假供应商

王小明不甘心，一定要发誓把在OTA上损失的钱给追回来。我们的王小明同学是很机智的。结合到自己被骗的场景以及发现在某个OTA上的酒店上线门槛很低，王小明偷偷的使用诸多虚假证件做了一家虚假酒店提交给OTA申请挂牌，很快就被通知挂牌通过，该酒店订单目前能够享受约8%的现付订单返现。

王小明同学不甘示弱，每天都要在这家虚假酒店上下数十万的订单套取几千元的补贴，等到要结算佣金的时候，关机再也找不到人，王小明同学一阵开心。可是不巧的是，该OTA的风控部门事后分析能力还是挺强的，通过诸多路径还是找到了王小明同学作案的事实。

对于供应商的审核也是很多O2O和电商行业的漏洞，一个虚假供应商能做的事情很多，除了套用平台发放的优惠券之外，还有一个非常重要的套现的作用，我们以王小明的视角来继续开始我们的故事。

## 电商信贷欺诈

### 信用额度套现

王小明的酒店投入了大量的资金，现在手头开始吃紧了，几张信用卡已经被刷爆了，现在手头已经开始急需用现金了，王小明一筹莫展。

紧急时候，一定要推荐这位张大飞同学，张大飞给王小明一个QQ号，QQ签名是蚂蚁花呗、苏宁任性付、京东白条套现。在这个QQ主人的教导下，王小明顺利开通了这三个网站的信用额度，并且顺利的从这三个网站购物套现了2万元，只是王小明需要付出10-20%的套现手续费。

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053413/9lpq3zwp7ed8e9lc!1200)

图九：信用额度套现广告

对于有信用支付的电商网站而言，这种类型的信用套现危害暂时体现不出来，可能过了几个月的时候开始出现坏账，美团点评曾经紧急关停过花呗支付渠道。

而在短期KPI考核的压力下，电商公司会很欢迎这些套现的行为，因为这会提升信用产品的用户使用频率。但是不置可否，这些需要套现的用户其还款能力是很值得质疑的。而一家店铺使用大量的信用支付，对这家店的真实性也应该表示质疑。所以这就是刚刚说的一家虚假供应商能够做很多事情。

对于电商行业，我想他们的风控体系大概都对每家店铺的信用交易情况进行了监控，我相信黑市上这么多套现渠道肯定是基于大量的虚假电商店铺；另外，作为心机biao的风控er去埋伏套现群也是精确打击虚假店铺的的有效方法之一。

### 身份冒用欺诈

王小明跟李小花要去买房了，好不容易看上一套三室一厅90平，等到去办房贷的时候征信报告打出来一脸懵逼，为什么会有信贷逾期坏账记录？王小明去人行咨询获得自己逾期信息来源于一家上报征信记录的消费金融公司，再去跟消费金融掰扯终于搞清了自己有过一笔网上信用贷款，王小明打死不认，但是各种信息都是他的身份认证信息，王小明二脸懵逼。在各种掰扯之下，消金公司终于答应王小明从PBOC里面撤销逾期记录

![风控PM必知必会：互联网业务安全的黑灰产业链的故事](https://pic.36krcnd.com/201611/23053413/0urrs3paq33oxclr!1200)

图十：身份证信息泄露渠道

目前形形色色的电商公司都有自己的消费金融公司，也有很多需要上报人行征信，在网上申请额度的过程也特别简单，因此欺诈风险成为网上信贷机构不可估量的损失，对于网贷来说欺诈风险远远大于常见的信用风险。

而为了用户体验，申请额度所需要的材料其实非常简单，因此网上有诸多利用很多虚假材料来获得信用额度并用来购物、提现的案例，具体过程与操作手法暂不详表，只能说，这是一条基本没办法抓到的暴利的黑色产业链。

## 总结

限于篇幅以及一些黑产操作流程，所以很多细节没有阐述特别清晰。另外，业务环节的风险远远比这篇文章里面的东西要多，而且各家互联网公司随着自身业务的多样性和特异性，会衍生出新的风险，所以公司与公司之间的风控体系在业务层面还是有较大的差异。

而对于互联网行业来说，对于这种高频次的用户非面对面的行为，面临黑产的肆虐是不可避免的，这也是攻防不断提升的过程，需要在业务运营过程中不断预知风险、发现风险、提高风险门槛，所以说风控体系的形成也是随着业务量的提升、风险事件的案例来不断优化完善的。

黑灰产的利润很诱人，但是这条产业链毕竟是游走在法律边缘，在过去的工作中，也参与了数起案件协同网警、刑警抓获在公司运营中的黑灰产犯罪团伙并得到了有期徒刑的法律制裁。因此，君子爱财取之有道，各位珍重。

【本文部分图片来源与业内相关同学分享，已获得版权所有者允许】

【对互联网黑灰产有兴趣以及对风控体系策略设计有兴趣的同学，欢迎共同交流】

# 电商的支付风控怎么玩？

[业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity) [唯品会SRC](https://www.secpulse.com/newpage/author?author_id=3755) [![img](https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng2.png)](javascript:void(0))

 2017-08-04 22,144



## **鸣 谢**

VSRC感谢业界小伙伴——**独孤qiu败**投稿精品原创类文章，对互联网黑灰产有兴趣以及对风控体系策略设计有兴趣的同学欢迎加作者微信号 **duguqiubaiwp** 共同交流！

## **序言**

对于电商行业的风控而言，一个不懂业务的产品经理不是一个好产品。

着实，想要做好一个好的风控产品经理，对于风控业务知识的理解必须得足够深刻，才能在业务需求的基础上做到更深层次的产品设计。

之前写了几篇与风控业务相关的文章，但毕竟是产品经理出身，对于业务的理解仅仅是作为一个风控产品经理的前提，不管做什么都脱离不了一个PM的本质核心：项目推动、流程设计、进度把控。

电商行业的风控尤其如此，与所在行业、所在公司、所在产品线的特征等息息相关。在电商行业当中，因为支付渠道的多样化，有很多的支付渠道出现盗刷之后需要电商企业自行赔付的，因此这块的损失也是个大头，深耕电商行业，支付风控也是重点。

但是，电商行业的支付风控不是简简单单买一套系统、配上规则策略就可以实现的，**时至今日我还是依然很反感购买第三方系统来搭建风控体系**，这大大的禁锢了风控可能的边界，虽然大家都认为购买的这套系统是暂时的临时应急措施，但是很明显随着第三方系统与业务的耦合程度越来越高，大量的开发工作依赖于这套系统，替换成本越来越高也不会有人去提起这件事。

支付风控的实现与系统和运营都是密不可分的，因此这里以下都是用体系=系统+运营来表达。**所谓风控的目的，无外乎就是你把你的地势（风控门槛）抬高了，就把脏水排到别人家去，你不去抬高自己的地势，脏水就会到你家来~~~**

 

## 电商行业支付风控体系概述

 **电商行业支付风控体系的现状**

- **支付环节风控规则简单**

目前支付在现有渠道上安插部分支付风控规则，但是因为支付能够拿到的数据字段有限、规则引擎并发处理能力较弱，所以可配置的规则模式也较为简单。

缺乏大量字段数据的支撑，很难做到对现有交易欺诈案件的核查以及更进一步凝练新的有效的交易规则，这不适应于当前支付风控这种需要不断迭代更新的规则策略生态集。

- **交易后风控止损能力弱，管控措施不及时，预警机制不足**

现有的管控手段除了直拒之外，都是在做事后风控，而事后风控哪怕发现风险也没办法及时止损，因此现有的模式下，交易风控的止损能力十分薄弱。

而目前的风控系统可选择的管控措施也不及时，如不能快速对可疑维度做及时的管控。

 

- **可用支付方式不断缩减**

在当前不断恶化的欺诈形势下，收银台已经不断缩减用户可见的支付方式，部分易出现损失的支付方式已经被关闭，而这些支付方式是很多客户常用的支付方式。支付方式较少，客户支付体验也较差。

 

 **电商支付风控系统设计的目标**

- **足够高效、精确、灵活的规则策略集**

通过跨部门的数据采集及后续数据的不断扩充，完成电商网站内部数据集市的搭建工作。通过丰富的识别字段、技术措施以及规则引擎，能够对欺诈案件提供一套行之有效的防范手段。

 

- **快速管控、及时止损**

通过风控系统在关键节点的介入，对高风险交易能够做到及时预警，在交易中完成交易的定性，识别欺诈案件并做到及时止损。

 

- **拓展现有的支付方式**

拓宽现有的支付方式，做到在同类竞品网站中能够实现的支付方式在电商网站均可完成支付，并做到良好的风险控制。

 

- **不断降低用户负面感知体验和人工运营成本**

在后续的项目过程中，不断地提升风控模块的功能性拓展，使风控尽可能的做在绝大多数用户感知不到的节点；另外，通过不同节点的分流，不断降低人工运营的成本。

 

## **风控体系设计思路分类**

去年下半年以来，随着国家公安系统对支付盗刷的打击，各大电商网站的支付盗刷情况大大好转，似乎已经偃旗息鼓，各个公司的支付风控团队似乎也处于较为轻松的状态，

但是年后以来尤其近两个月，有多家支付渠道被黑产重点盯上，尤其是今年重点着力推广对抗支付宝和微信的某联，近期的盗刷压力应该非常大。

另外，最近两年各种风控研讨会都开始必谈大谈机器学习建模，但是**机器学习的本质只是规则的一种实现方式而已**，其应用在生产环境中必须依赖于一套强有力的风控体系。

姑且不论机器学习在电商行业支付风控领域的效果如何，电商行业的支付场景复杂是否能够得到契合业务场景和运营需要的规则需要质疑，

单单机器学习所需要的坏样本的量级和时间周期也不是一个电商企业能够承受的，所以依赖机器学习在电商行业支付风控领域的应用短期来看还稍显局促。

不过不论如何，一套完善的风控体系是不管机器学习还是专家规则的实现方式的必要载体。

就我过去浅显的工作经验，我接触到的企业的支付风控体系的设计可以分为以下几大类：

**非人工事中介入的支付风控体系（直拒类）**

[![dingdan](http://www.secpulse.com/wp-content/uploads/2017/08/dingdan-278x300.png)](http://www.secpulse.com/wp-content/uploads/2017/08/dingdan.png)

这一块的风控体系非常简单简单粗暴，适合高并发大量小金额的场景交易，该类型企业的盗刷现象并不严重，只需要依赖于该系统结合一些偶发性的支付盗刷案件针对性的制定针对性的阻断规则即可，这一块也适合初涉支付风控领域的电商企业试水，通过前台适当的提示性展示，将用户引导至第三方支付渠道从而转嫁高风险交易。

目前使用这种支付风控体系设计的企业已经比较少，一般来说都是支付风控做的不怎么样的企业，要么技术不行要么运营不行，以牺牲一定的用户体验来实现风险控制的目的，在一定阶段是有一定的适用性的。

 

**人工事中介入的支付风控体系**

在发展到一定阶段，支付风控模块在前期的基础上已经遇到了一些瓶颈，直拒类规则带来的误杀会引来大量客诉，支付成功率的下降也对支付部门的考核带来一定压力，另外，大金额低并发量的电商企业对于误杀的容忍度更低，因此随着业务的发展，对支付风控体系的精细化运营诉求也不断成了发展的瓶颈，目前业内的电商企业很多都引入了人工事中介入的运营机制。

各家产品线特征不同，公司所处环境也不同，因此很难说哪种支付方式和处理预案是合适的，只能说平衡各方利益之后的方案才是最适合的。人工事中介入的支付风控体系比较灵活，也是可以不断开拓创新的地方，不过总的来说，常见的处理框架如下图:

[![0 (1)](http://www.secpulse.com/wp-content/uploads/2017/08/0-1.jpg)](http://www.secpulse.com/wp-content/uploads/2017/08/0-1.jpg)

不过结合着支付渠道的不同也会有不同的处理方案。常见的主要见以下两种：

 

- **扣款前支付风控体系**

扣款前就可以执行风控规则的主要是指使用CVV的moto交易，扣款权在电商网站这边，即电商网站可以拿到CVV主动去银行扣款。这种支付方式用户支付体验极好但是风险极高，对于电商网站的风控运营体系有着比较高的要求，主要常见于OTA行业，类似的支付方式银行基本已经不再开放通道了。

对于这种类型的支付渠道，用户的支付信息触发风控规则之后风控系统可以无限期挂起（当然还要取决于用户体验和前端订单的占位时间，理论上可以无限期挂起），等到有足够的人工确认风险之后可以采用放行交易，由电商网站去银行发起扣款。

 

- **扣款后支付风控体系**

扣款后的支付风控体系主要指近期非常流行的快捷、网银支付等，扣款权在银行，银行扣完款之后通知电商网站是否支付成功，对于电商网站来说，这种支付方式一般使用事后的风控体系，主要是由于用户输入短信验证码的时间有限，一般来说快捷支付的短信验证码只有5分钟有效期，如果用户输入短信验证码触发风控规则之后电商网站不向银行发起扣款请求，电商网站只有5分钟的时间判定是否存在风险。但是对于这种事后监控的风控体系，五分钟的时间肯定是远远不够的，因此对于这种支付方式主要还是采用事后的风控体系。

用户输入支付信息之后先去银行发起快捷扣款请求，再去调用风控系统，如果没有触发规则，那么则由支付通知订单系统发起订单支付成功通知。如果触发规则，则由风控系统挂起，支付通知订单系统等等，由风控人工来排查，如果放行则走第一步通知流程，如果拒绝交易则通知支付走退款流程。

当然结合各个电商网站的产品特性不同，则由不同的处理方案，比如需要发货的实物产品、话费等虚拟产品、火车票机票等有占位时限的特殊产品等等。对于不同的产品特性，结合各个公司对于风险的承受能力，则会有不同的处理方案和应对策略。

当然这其中还要涉及到外卡交易的问题，很多国际化的电商平台都支持visa 或者AE的外卡支付，对于外卡来说损失率会远远高于内卡，但是企业平台的特性需要必须得开通外卡支付，那么这个时候可能就需要接一些外卡的风控平台，比如RED或者CYbersouce等，针对返回的不同code，把处理流程封装在支付风控系统的架构内，也需要花一些精力去实现。

 

- **市面上已存在的改进方案**

对于前面两种支付风控体系的方案，流程上的最大弊端在于用户在提交支付之后有可能会被拒绝支付发起扣款流程，这样的用户体验就很差。被拒绝支付的交易可能会有相当一部分的好订单，而针对这些客户而言，等他再次发起支付时可能火车票已经无座或者机票已经涨价了，这样的客户体验损失是难以弥补的。

因此针对此，市面上已经有相当一部分大型电商平台尝试着做一些支付体验的优化方案。最常见的方案是在收银台渲染环节，用户在跳转收银台渲染的时候由收银台调用风控系统判断是否可以展示高危渠道。

[![0 (2)](http://www.secpulse.com/wp-content/uploads/2017/08/0-2.jpg)](http://www.secpulse.com/wp-content/uploads/2017/08/0-2.jpg)

目前业内了解到业内小狮子和小海豚两家公司已经采用了类似的方案，其实对于有信贷类支付产品的电商网站而言这种方案更合适不过了，因为用户在开通虚拟***的时候其身份信息已经拿到，等于其支付环节数据在一开始就可以获取到，因此在跳转收银台支付渲染的时候可以调用完整的支付风控规则来判定是否存在盗刷或者骗贷风险以进一步决定是否可以展示这种信贷类支付渠道。

 

**可能的优化方案**

支付风控，不可避免的都会对用户体验造成一定损伤，要么支付失败、要么可选支付渠道较少，对于企业而言，引导客户去渠道费率较高的第三方支付也不符合企业的利益，因此确实很难去达到一个很好地平衡。

对于支付风控体系的设计，我相信还有很多的优化方案。对于电商企业而言，所谓高危用户的本质就是用户提供的证据不足以证明“我就是本人”，而不论短信验证码、CVV等等都是证明自己是自己的证据，只是这个证据目前来看已然不是很充分。

我相信很多人的卡信息已经在暗网上泄露出来了，花钱可能就能购买一份非常齐全的用户资料然后刷卡消费。因此对于这么严峻的诈骗盗刷形势，是否还有其他证据可以让用户来证明自己是本人呢？这个问题很多企业已经尝试在做了，比如淘宝在登录的时候对于高危登录行为需要你输入你近期购买过的物品，对于撞库和盗号而言，这也是一个非常强有力的证据证明自己是本人，当然这避免不了熟人作案~~~

最近因为工作关系，接触到了很多外部的征信数据，也让我的视角可以不断的扩延开，对于纠缠了我很久的问题似乎也有了可能的解决方案。

征信数据的存在是为了辅助信贷机构对于用户的身份信息、信用信息等进行审核，主要是用于信贷行为。但是是否有可能将二者结合起来使用？

[![0](http://www.secpulse.com/wp-content/uploads/2017/08/0.jpg)](http://www.secpulse.com/wp-content/uploads/2017/08/0.jpg)

对于调用外部征信渠道的用户，如果用户能够正确回答特定的问题就可以比较好的证明用户即本人。因为虽然个人信息目前在网上基本已经被泄露的一干二净，但是所谓的黑产还是术业有专攻的，盗刷类的黑产手里面的用户个人数据多以卡数据为主，如果在电商网站上的支付者可以提供其他方面的信息，可以基本排除盗刷风险。当然对于没办法验证的信息可以适时转入人工处理。

如果这种方案有效的话，对于前面几种支付风控架构方案的弊端算是个很好的补充，用户可以实时证明自己，高危支付行为不需要等待即可完成确认，避免误伤行为；对于企业而言也不需要引导客户进入高费率渠道，节约企业的经营成本；企业的风控团队也可以节约大量使用人工介入的成本，提高了经营效率。

那现在重点来了，调用外部征信渠道的时候，哪些问题可能是确信有效且覆盖面广的呢？确信有效自不必说，覆盖面广也是为了节约足够的对接成本。我也考虑了一些，当然是否有效也需要数据验证

 

- **实时芝麻信用分**

芝麻信用分目前应该覆盖了几亿人群，这几亿人群与在电商网站在线支付的人群是高度重合的，所以应该大部分可以用。对于能够实时提供实时芝麻信用分的人群应该可以重点认为是低危人群，目前蚂蚁金服已开放了相关服务，能否对接还依赖于用户授权和法务问题

 

- ***\*号及有效期**

**目前应该覆盖了四亿人群，对于能够正确输入**号和有效期基本应该可以确信为本人。目前市面上也有相关的征信服务公司提供相关服务

 

- **父母的出生年月**

对于该问题，目前市面上也有部分公司能够提供，只要能够回答该问题，也基本上可以排除陌生人作案，当然不排除熟悉的人作案手法，当然这就另当别论了。

以上各种问题可以随机展示给触发规则的用户，之所以有以上的认知是基于认为支付类的黑产手里面没有这些信息，当然我相信只要想搞也是能够搞到的，但是这会大大的提高支付黑产的门槛，然后市面上这么多电商网站，自然而然他就会去其他风控措施不严的网站了。

就跟前面说的一样吧，所谓风控的目的，无外乎就是你把你的地势抬高了，脏水排到别人家去，你不去抬高自己的地势，脏水就会到你家来。

当然使用以上的方案还有一些可能的问题需要评估

- **用户感知体验的问题：**对于输入自己的隐私信息很多人都是很敏感的，所以对于这些敏感客户可能还是需要走正常的人工介入的流程。这方面是否会带来客诉等可能需要有足够友好的文案提示、客服介入等手段
- **法律合规监管问题：**对于以上需要调用外部征信渠道数据的问题，是否符合网络安全法规定，是否能够满足合规监管规定，这方面我没有去尝试过，所以也有待进一步的核实。

不过不管怎样，我相信支付风控体系的架构可能还会有很多更好的创新方案，可能由于我眼界的不够宽阔，相信将其他领域的很多方案与支付风控体系设计整合起来会有很多不错的点子，希望后续可以不断挖掘吧。

## 用有限的信息 做无限可能的风控！

原创： 干煸土豆丝 [唯品会安全应急响应中心](javascript:void(0);) *2016-10-31*

![img](http://mmbiz.qpic.cn/mmbiz_jpg/iaoE9CQ58M9fPibhdZtvvibgIric2dusnEtbKD1EricOiaia01pjcOE5VqPUYVHgj973wH2S7KNIiaq9PFhW7q4meZxztw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

> **用有限的信息  做无限可能的风控**



> 「
>
> 业务安全技术实践系列连载
>
> 作者：干煸土豆丝
>
> 」





> “国之利器不可示于人”，在公开层面详尽地阐述自家系统的风控防御策略和技术手段，固然不可接受；但是，就风控技术的基础原理进行探讨仍然具备一定的空间。基础性原理早晚大家都清楚，如果没有人拿出来讨论，就无法促进整个行业的进步。如果没有特殊说明，本文所述的风控属于业务安全范畴下的风险控制技术。
>
> > 
>
> 
>
> 
>
> 
>
> > 1
> >
> > 别人家的业务风控
>
> 
>
> 
>
> 我们了解到国内外有一些风控技术一流的同行，他们的基础技术能力、历史数据积累、欺诈检测水平、平台并发性能都不是一般企业所等望其项背的。
>
> 
>
> 我们的小伙伴也曾慨叹技不如人，自惭形秽。
>
> 
>
> 但当我们真正与他们多次接触后，我们反而更加清晰地认识到：别人家的风控实力固然强大，但我们也是麻雀虽小五脏俱全，甚至某些方面更具先进性。
>
> 
>
> 我们彼此的发展轨迹和总体方向都是相同的，只是别人思考得更加有深度、有广度，投入了更多的资源和更长的时间。
>
> 
>
> 在我们这样体量的企业里，合理有效地利用自身的业务数据，也能做好风控。
>
> 
>
> > 2
> >
> > 如何做自己的业务风控？
>
> 
>
> 
>
> 有效的风控措施依赖于强大的风控系统，而风控判断的准确性则依赖于风控参数、规则和模型。业务系统为风控系统提供越多的参考信息，风控的判定和决策才越精准。
>
> 
>
> 然而，并不是每一家企业的风控系统都是伴随着业务系统一同成长的，很多历史遗留系统并不具备传递关键信息给风控系统的能力。多数场景下，风控系统只能依赖于有限的信息进行风险判断。
>
> 
>
> 那么在这样的背景下，如何才能有效地开展风控工作呢？这里我们介绍两个角度的思考方式：
>
> 
>
> - 2.1 多角度透视已知信息
> - 2.2 在时间轴上洞察异常
>
> 
>
> > ## 2.1**多角度透视已知信息**
>
> 
>
> 以IP地址为例，在风控平台建设初期，风控运营团队在后台配置了大量的基于IP地址的规则。显然并不是因为平台只具备IP地址维度的计算能力，而是绝大多数业务系统并没有做好真正接入风控的准备，它们只传递了IP地址。
>
> 
>
> 在缺乏业务安全长期对抗经验的基础上，早期团队成员只能基于IP地址配置硬规则，如：一个IP地址一天只能访问某服务100次等。
>
> 
>
> 随着我们与黑灰产你来我往较量的经验的增加，团队成员逐渐意识到，即便是IP地址，依旧是大有文章可做。善用IP地址能够帮我们快速有效地发现和解决问题。
>
> 
>
> 举例：如果收到一个来自IP地址为8.8.8.8的请求，除了立即应用一些IP地址的规则，我们会考虑对这个IP地址进行变化，例如：8.8.8.*，8.8.*.*。
>
> 
>
> 之所以做这样的延伸，是因为在很多情况下批量对网站某些业务发起恶意请求的IP地址具有聚集性，例如：来自某个服务器网段或机房。
>
> 
>
> 在这里我们已经完成了2个维度的透视分析，当然还可以从如下角度对已有的IP信息进行衍生：
>
> 
>
> > **地理信息**
>
> 
>
> - 省市县区信息
> - 国家信息
>
> 
>
> > **IDC属性**
>
> 
>
> - IDC服务区
> - 教育网
> - 大企业
> - 运营商集中出口
>
> 
>
> > **网络属性**
>
> 
>
> - 固网IP
> - 3G/4G网络
> - 电信/移动/联通
>
> 
>
> > **应用属性**
>
> 
>
> - 代理服务器属性
> - VPN属性
>
> 
>
> > **历史属性**
>
> 
>
> - 案件记录
> - 攻击记录
>
> 
>
> ![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)
>
> 
>
> 是不是豁然开朗？原先只有IP地址这一个维度，一下子又多出来十多个属性，关键是这些属性完全可以直接参与风险计算。想想都开心，风控能力大增啊！
>
> 
>
> > ## 2.1**在时间轴上洞察变化**
>
> 
>
> 判断一种请求行为是否异常，单靠当前某一点的请求频次很难给出结论。但如果将这种行为的时间周期拉长，特别是与历史数据进行比对，那么坏人作恶的行为将顿时现形。
>
> 
>
> ![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)
>
> 
>
> 关注和分析以下几个异常监控纬度，能有助于快速识别潜在风险：
>
> 
>
> > **行为走势**
>
> 
>
> - 陡增
> - 掉坑
> - 非常直的曲线
> - 锯齿形曲线
>
> 
>
> > **历史同期**
>
> 
>
> - 相对上一个日历日
> - 相对上周同期
> - 相对上一次线上活动
>
> 
>
> > **同类\**对比\****
>
> 
>
> - 登录与注册比例
> - 登录成功与注册成功比例
> - 国内登录成功与国外登录成功比例
>
> 
>
> 下图是非常经典的机器请求行为。在明确异常行为之后，采取果断的风控拦截措施就更加有信心了！
>
> 
>
> ![img](http://mmbiz.qpic.cn/mmbiz_png/iaoE9CQ58M9fPibhdZtvvibgIric2dusnEtb93LYnrJECCYlibgGK4Rtluibf8xLHpibrvzwuZRUMFjQZRiaUKp88btDhQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
>
> 
>
> > 总结
>
> 
>
> > 用更多的视角看问题，用更多的维度看问题，用更细粒度的方式监控和分析问题。面对服务接口（即便是那些已经被风控拦截的接口）疯狂请求，要深究来者的意图。工作过程中多思考，多问为什么，将有助于风控团队打开工作思维，拓展想象空间，最终发现起内在的奥秘！
>
> 
>
> > **低调做风控 用心做分享**
>
> > > 本着分享与和促进行业技术进步的基本思想，我们完成了业务安全实践第一节的阐述。如果您对某些话题感兴趣，欢迎留言，适当的时候我们会选中并作为后期讨论内容。低调做风控，用心做分享，请持续关注本公众号（唯品会安全应急响应中心）。

## 张新波 | 十面埋伏 - 论大数据风控技术体系的构建

原创： 张新波 [中生代技术](javascript:void(0);) *2017-04-10*



2017.3.11，中生代技术嘉年华在上海盛大召开，6大主题、20话题，600多位小伙伴点燃现场，我们将会陆续将各话题整理发布，让大家共享这场技术盛筵。

— **中生代技术嘉年华** —











张新波，同盾联合创始人&技术VP，为大家带来“十面埋伏 - 论大数据风控技术体系的构建” 主题分享，欲听详情，点击现场视频







同一个成语 - 十面埋伏，不同的场景有不同的含义

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

经验总结：

- 规则的可视化编辑
- 规则变更时实时生效
- 不同的规则应对不同的风险等级
- 复杂场景需要针对性的高级功能
- 规则测试
- 多维度存放历史数据
- 平衡规则的灵活性和性能
- 集群拆分和路由处理
- 性能差别
- 隔离多租户

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

计算要读取的分片->读取分片数据->进行数据聚合计算->生成指标

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



（IP画像图片是特意模糊了的 ）

![img](http://mmbiz.qpic.cn/mmbiz_jpg/3xsFRgx4kHqLLaSnARLVo5UJdbNrcxnDRlvQHicNzrSE7alzfYdeR0UicpxnlOMXXUPM8sj2gS70CiaZUcDibOjsfg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](http://mmbiz.qpic.cn/mmbiz_jpg/3xsFRgx4kHqLLaSnARLVo5UJdbNrcxnDqgZKaff5nSvALGqvKgwvebkVEVsUUz4LicQteSRhgcF85Ca5dkZNd7A/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

------



错过了上海3.11大数据风控分享？

别担心，4月22日，还有大数据与互联网金融技术分享：

## 

未来的新金融体系的基础就是个人征信系统，而个人征信的建立基于互联网金融风控的评估。

想不想了解更多关于互联网金融风控的知识？

想不想了解一家专注于互联网金融风控服务的专业公司？

四月二十二号，成都市高新西区龙湖时代天街17栋18楼冰鉴科技，不见不散。



![img](http://mmbiz.qpic.cn/mmbiz_jpg/3xsFRgx4kHqLLaSnARLVo5UJdbNrcxnDO0oLhVias7ueicvQydC5ZyFeTTj4yad9VLGqE57wHpjmSib67ZC7wcN2A/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](http://mmbiz.qpic.cn/mmbiz_png/3xsFRgx4kHqLLaSnARLVo5UJdbNrcxnDM0FbsyibVmjnNWQGDKrdKslI7EicElxeooqQCGLMr2YzPC1o0u5OswPA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

识别以上二维码

或者

点击**阅读原文**可查看详细议程报名

## 互联网反欺诈体系漫谈

原创： SHIELDs [互联网安全实务](javascript:void(0);) *2018-07-14*



![img](https://mmbiz.qpic.cn/mmbiz_jpg/a0zjmTMAccB9Q4fsOEibohAm5gfk8B2Rdd75md9OlDbon4SQ1J3iaIicz9or7egSErUay3GTawibYeUOOFDFt8Ww8g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

**0** **欺诈与反欺诈**

要反欺诈，自然要明确什么是欺诈。

欺诈一词，古已有之。在《现代汉语词典》和《汉语大词典》中，欺诈被解释为“用狡猾奸诈的手段骗人”。在《中华人民共和国民法通则中》和相关司法解释中，欺诈行为是“故意告知对方虚假情况，或者故意隐瞒真实情况，诱使对方做出错误的表示的行为”。

故此欺诈的核心要义，是“骗”，是通过欺骗以达到通过正常途径无法达成的目的。欺诈一事，在人类社会中无处不在。小到孩童撒谎、大到军事谋略，本质上都是欺诈。

正因为欺诈的无处不在，所以在古往今来的各行各业中，从商品上的防伪码到收银台的验钞机，从登陆页面的账号密码到当下热门的人脸识别，反欺诈也以不同的面貌存在于人们身边。

 

**1****互联网欺诈**

互联网是一把双刃剑。进入互联网时代以来，技术的飞速发展不断的提升效率降低成本。遗憾的是，在提升服务的同时，互联网也大幅的降低了欺诈成本，提高了欺诈的效率。更加不幸的是，由于互联网服务的高度自动化，很多在过去需要有人工介入的环节都由系统自动化进行操作。缺少的人的主观判断，使得欺诈更加容易发生。

看似公开透明的网络空间本质上如同一个群狼环伺的暗黑深林，一旦互联网平台出现了反欺诈漏洞或者出现了一种新的欺诈形式，各种黑产团伙便会群攻而上。在互联网的加持之下，这种攻击造成的损失规模巨大，轻则导致互联网平台伤筋动骨,重则直接倒闭。而由于法律法规和监管的滞后性，互联网欺诈受到的威慑和惩戒又往往不足，导致当前互联网领域的反欺诈压力不断增大。

**
**

**常见的互联网欺诈形态：**

- 盗刷：通过互联网交易平台，将他人银行账户中的资金进行转移；
- 薅羊毛：利用互联网平台业务逻辑、技术上的漏洞，冒充正常用户套取返现、积分、奖励等；
- 骗贷：利用虚假资料骗取原本无法取得的互联网平台授信额度；
- 刷单：通过与卖方勾结，通过人工或利用技术手段，制造虚假交易量或访问量；
- 刷好评：通过人工或技术手段，在互联网平台上进行留言，制造虚假的好评率；

……

随着互联网的发展，网络购物、网络游戏、网络出行、网络视频、外卖、互联网教育、互联网金融等各种互联网平台如雨后春笋，越来越多曾经只能在线下享受的服务成为“互联网+“。得益于互联网服务的发展，互联网欺诈也得到了充足的资源和动力实现快速的发展，欺诈手法多种多样且灵活多变，随着互联网业务的变化和发展不断的演进，并且迅速的开始规模化、产业化和专业化。

 

**
**

**2****互联网反欺诈**

互联网业务特点，对互联网反欺诈体系提出了更高的要求。互联网反欺诈体系存在着几个原则：

- （准）实时性：考虑到用户体验，互联网反欺诈体系必须能够在非常短的时间内对欺诈行为进行认定，并给出判断。对于注册、登陆、支付等一些场景，必须能够在用户无感知到情况下对欺诈行为进行检测和认定。
- 自动化：由于（准）实时性的要求较高，决定了互联网业务无法通过人工操作进行反欺诈，必须使用更加高效的自动化反欺诈错事。
- 数据化：与传统的线下反欺诈不同，自动化的反欺诈检测本质上是数据应用能力的比拼。数据采集能力、挖掘能力和分析能力、建模能力，决定了互联网反欺诈能力的高低。



**这些原则决定了互联网反欺诈体系对人员、方法、技术、数据等方面均存在特有的需求和特点：**



**2.1** **人**

传统的线下反欺诈往往是单兵作战，但建设互联网反欺诈体系需要一个完整的团队，各个岗位分工配合共同完成。一个完备的反欺诈策略体系需要以下几类岗位人员。

- **策略人员：**互联网反欺诈体系需要有大量熟悉互联网欺诈手段和防范方法的反欺诈策略人员。反欺诈策略人员应当实时关注互联网欺诈的动态，及时发现新出现的互联网欺诈手段和手法，并有效的调度和利用既有的资源制定反欺诈的策略，进行防范。
- **运营人员：**由于互联网欺诈行为的多样性和灵活性，欺诈手段会不断的出现变化和创新。反欺诈运营人员应当建立起各类反欺诈运营监控指标体系，通过监控指标的变化，不间断的分析指标变化原因，及时发现穿透反欺诈策略体系的欺诈行为并予以应急响应。此外，运营人员还应该与业务部门、产品部门、营销部门保持高度密切的沟通，做欺诈风险和用户体验的平衡。
- **调查人员：**反欺诈调查人员应当人工对各种已经发生或正在发生的互联网业务请求进行人工的调查、核实。对于在人工调查中发现的漏报欺诈行为，应当及时的止损、追损，如取消订单（互联网电商）、拦截发货（互联网电商）、贷后提前介入（互联网金融）等。
- **数据挖掘人员：**数据挖掘人员主要负责将系统采集的各种形式的数据进行解析和挖掘，输出各种特征，使其能够被应用于反欺诈建模和反欺诈策略工作。该岗位的工作可与公司数据分析、用户画像等部门共享。
- **数据建模人员：**数据建模人员负责利用系统采集到的客户数据和数据挖掘输出的特征，建立欺诈模型，对客户的欺诈概率进行判断。该岗位的工作可与企业内部其他数据建模工作共享。
- **研发人员：**负责各类反欺诈系统的开发和维护、反欺诈策略和模型的实现。



**相较于线下反欺诈，互联网反欺诈对于人员的需求的最大特点，在于对于研发人员和数据挖掘、数据建模人员的巨大需求。**





**2.2** **方法**

反欺诈的方法多种多样，当前互联网反欺诈体系中常用的方法有信誉库、专家规则、机器学习等几种：

- **信誉库：**

信誉库即传统的黑、白名单，通过内部积累、外部获取的各种人员、手机号、设备、IP等黑、白名单对欺诈行为进行判断，是一种实施简单、成本较低的反欺诈手段。与此同时，信誉库也存在着准确度低、覆盖面窄的缺陷和不足，仅可作为互联网反欺诈的第一道过滤网使用。

- **专家规则：**

专家规则是目前较为成熟的反欺诈方法和手段，主要是基于反欺诈策略人员的经验和教训，制定反欺诈规则。当用户的操作请求和操作行为触发了反欺诈规则时，即被认定为欺诈行为并启动拦截，常见的如各种聚集度规则等。

专家规则的优势在于实现较为简单、可结实性强，但缺陷在于专家规则存在有严重的滞后性，对于新出现的欺诈手段和方法无法及时的进行应对，往往需要着付出大量损失后才能总结教训提取新的规则。此外，由于人脑的限制，专家规则只能使用一个或几个维度的标量进行计算和识别，往往存在有较大的误报率。

专家规则严重依赖于策略人员的经验和教训，不同水平的策略人员制定的专家规则效果也会纯在较大区别，主要可以作为互联网反欺诈的应急响应手段和兜底防线。

- **机器学习：**

机器学习反欺诈是近年来比较火的一种反欺诈方法，目前也取得了一定的成果，最为常见的如芝麻信用分等。

机器学习反欺诈是通过机器学习方法，将用户各个维度的数据和特征，与欺诈建立起关联关系，并给出欺诈的概率。

常见的机器学习反欺诈包括有监督和无监督两种：

**基于有监督机器学习的反欺诈：**

有监督机器学习反欺诈是目前机器学习反欺诈中较为成熟的一种方法。其基本思路是通过对历史上出现的欺诈行为进行标记，利用逻辑回归等机器学习算法，在海量的用户行为特征、标签中进行分类，发现欺诈行为所共有的用户行为特征，并通过分值、概率等方式予以输出。

由于互联网欺诈行为的多样性，很难百分百的将欺诈行为与正常行为完全进行区分，因此有监督机器学习反欺诈等最大难点在于如何准确获取大量欺诈行为的标记。

**基于无监督机器学习的反欺诈：**

无监督机器学习反欺诈是近来行业内出现的一种新兴思路，也成为一些公司的卖点，但迄今为止尚未出现较为成熟和经过实践验证的解决方案。

相对于有监督机器学习的反欺诈，无监督机器学习的反欺诈方法不需要预先标记欺诈行为，而是通过对所有用户和所有操作行为各纬度数据和标签的聚类，找出与大多数用户和行为差异较大的用户和操作请求，并予以拦截。



理论上，基于无监督机器学习的反欺诈方法可以使得反欺诈人员摆脱被动防守的局面。但是由于无监督机器学习算法对于数据的广度、数据使用的深度都有着极其高的要求，因此无监督机器学习算法的效果仍需等待实践的检验。

**
**

**如果把互联网反欺诈看作是一顿大餐的烹饪，那么互联网反欺诈的方法就如同一本菜谱。就像天下烹饪无非煎炒烹炸蒸煮炖，反欺诈的方法也是万变不离其宗。**

**但是，在不同的反欺诈团队手里，同样的反欺诈方法却可以发挥出截然不同的效果。对于反欺诈方法运用的好，可以在准确拦截欺诈者避免欺诈损失的同时，让正常用户完全无感址。反之，若对欺诈方法等使用不当，则可能使得正常用户被折磨的苦不堪言，欺诈者却依然如入无人之境。因此，结合企业反欺诈需求和场景，组合各类反欺诈方法和手段，实现企业综合利益最大化应当是每一个反欺诈团队永远的追求。**



**2.3** **技术**

互联网反欺诈常用的技术主要包括数据采集、特征工程、决策引擎、数据分析等几个类别：

  **数据采集技术：**

数据采集技术主要是应用于从客户端或网络获取客户相关数据的技术方法。值得强调的是，数据采集技术的使用，应当严格遵循法律法规和监管要求，在获取用户授权的情况下对用户数据进行采集。

  **设备指纹：**

设备指纹是目前在互联网领域被广泛使用的一种技术手段，其在反欺诈体系中的作用也从最早的设备唯一标示，变为了客户端数据采集器。

设备指纹服务目前市场上有大量的服务提供商，评价一个设备指纹服务的优劣应当综合考虑覆盖度、唯一性、全面性等几个方面。

  **网络爬虫：**

网络爬虫技术即可以用于用户运营商数据、信用卡数据、网络交易数据等各类数据等的爬取，也可以应用于司法老赖名单、网络核查数据的爬取。

- **特征工程技术：**

特征工程技术是指可以从原始数据中进行数据挖掘的各类技术。常见的特征工程技术如生物识别、活体检测、文本语义分析、知识图谱等。

  **生物识别：**

生物识别，如声音识别、人脸识别等，是指对用户特定生物特征进行检测和识别一种技术手段，通过比对用户的生物特征信息，判断用户身份，主要用于用户身份的核实等场景，防止出现用户帐户被盗用的情况。

  **活体检测：**

活体检测技术主要通过要求用户做特定动作或朗读特定内容，对用户是活人还是机器进行判断和检测，是防范欺诈团伙批量攻击的一种有效手段。

  **文本语义分析：**

文本语义分析主要用于对文本类数据的解析和挖掘，从用户评论等文本内容中提取用户特征。

  **知识图谱：**

知识图谱是利用图数据库，从特定维度对不同用户和不同操作行为之间进行关联和计算，从而发现不同用户和不同操作之间的关联关系，可以用于团伙特征检测等场景。

- **数据分析技术：**

随着互联网反欺诈方法等不断演进，数据分析技术也成为反欺诈能力构建的一个核心能力。海量数据和特征的处理也对数据分析技术提出了更高的要求。常见的数据分析技术包括实时分析（如Storm）和离线分析（如Hadoop）两类，具体介绍可以参见大数据相关技术。

- **决策引擎：**

反欺诈决策引擎是互联网反欺诈体系的大脑和核心。一个功能强大的决策引擎，可以将信誉库、专家规则和反欺诈模型等各类反欺诈方法有效的整合，并为反欺诈人员提供一个操作高效、功能丰富的人机交互界面，大幅降低反欺诈运营成本和响应速度。

对于决策引擎好坏的判断，应当从引擎处理能力、响应速度、UI界面等多个维度进行综合判断。



**反欺诈技术能力犹如锅碗瓢盆灶，反欺诈技术能力的高低，决定了互联网反欺诈能力的高度。与线下反欺诈不同，互联网反欺诈是攻守双方在技术上的对抗。特别是在欺诈团伙已经开始产业化，并且广泛使用大数据、人工智能等前沿技术的时候，反欺诈技术能力直接影响着互联网反欺诈效果的好坏。**



**2.4** **数据**

数据是互联网反欺诈能力的基础。互联网反欺诈体系的建设，对于数据的广度和深度都提出了非常高的要求。业内目前常用的数据从类别上可以分为以下几类：

- **设备类：**

设备类数据主要指用户客户端（如手机、平板电脑、笔记本、PC等 ）等各类参数，主要通过页面、APP内嵌入各类sdk，js脚本等方式进行采集和获取。

- **环境类：**

环境类数据是指用户发起操作请求时所处环境的相关数据，可以分为虚拟环境和物理环境两大类。

虚拟环境数据，主要指用户所的IP、WiFi等网络环境相关数据。

物理环境数据，主要指用户的手机定位、基站位置等相关数据。

- **行为类：**

行为类数据是指用户在网页或APP上进行各种操作时的各类数据，如用户页面停留时长、文本输入时长、键盘敲击频次等。

- **第三方数据：**

第三方数据指通过从公开途径或第三方数据服务商处获取的各类数据，包括但不限于用户的运营商数据、电商消费数据、银行数据、司法数据等各类数据。

由于监管要求，此类数据往往是已经进行脱敏处理的标签数据。考虑到这类数据会产生一定的数据成本，同时其真实性和准确性也参差不齐，所以在使用这类数据时，应当十分谨慎。



**反欺诈数据的分类和使用仁者见仁智者见智，但正所谓巧妇难为无米之炊，数据的完备性决定了反欺诈体系的天花板，直接限制了反欺诈体系效果可以达到最高水平。
**





**3** **后记**

*反欺诈是一个跨安全、风控、数据、研发、内控等多学科的一个新兴领域。正如本文开头所诉，反欺诈作为一个职能，在互联网、金融、传统零售等各行各业广泛的存在，但却没有一套完整的理论框架和方法论。笔者在业内各种交流平台，结识过许多“反欺诈”同行，但详细交流下来，无论从所承担的职责，还是从所使用的方法都相去甚远。*

*本文结合近年来互联网领域内的反欺诈现状，针对互联网反欺诈体系建设过程中的经验和教训进行了简单的总结和罗列。在互联网欺诈团伙已经集团化、产业化并且形成产业链的今天，笔者强烈呼吁作为防守一线的反欺诈从业者们能够更多的协作、共享和交流，共御外敌！*

## 反欺诈的核心是人，教你如何用知识图谱识别欺诈行为

[牛耶学堂](javascript:void(0);) *2017-08-19*

[现金贷风控与贷后管理培训暨大咖研讨会](http://mp.weixin.qq.com/s?__biz=MzI5MzA4NDE4Ng==&mid=2655738307&idx=2&sn=685d6a998bef7512eb7e43080ba04342&chksm=f7c874b6c0bffda0dd588095e5b3ba4e72d09793802a3e0d15cd7294f24ec9637bb17bd059a1&scene=21#wechat_redirect)





通俗地讲，知识图谱就是把所有不同种类的信息（Heterogeneous Information）连接在一起而得到的一个关系网络。知识图谱提供了从“关系”的角度去分析问题的能力。









**1. 什么是知识图谱？**

**
**

知识图谱本质上是语义网络，是一种基于图的数据结构，由节点(Point)和边(Edge)组成。在知识图谱里，每个节点表示现实世界中存在的“实体”，每条边为实体与实体之间的“关系”。知识图谱是关系的最有效的表示方式。通俗地讲，知识图谱就是把所有不同种类的信息（Heterogeneous Information）连接在一起而得到的一个关系网络。知识图谱提供了从“关系”的角度去分析问题的能力。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



知识图谱这个概念最早由Google提出，主要是用来优化现有的搜索引擎。不同于基于关键词搜索的传统搜索引擎，知识图谱可用来更好地查询复杂的关联信息，从语义层面理解用户意图，改进搜索质量。比如在Google的搜索框里输入Bill Gates的时候，搜索结果页面的右侧还会出现Bill Gates相关的信息比如出生年月，家庭情况等等。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



另外，对于稍微复杂的搜索语句比如 ”Who is the wife of Bill Gates“，Google能准确返回他的妻子Melinda Gates。这就说明搜索引擎通过知识图谱真正理解了用户的意图。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



上面提到的知识图谱都是属于比较宽泛的范畴，在通用领域里解决搜索引擎优化和问答系统(Question-Answering)等方面的问题。接下来我们看一下特定领域里的 (Domain-Specific) 知识图谱表示方式和应用，这也是工业界比较关心的话题。

**
**

**2. 知识图谱的表示**

**
**

假设我们用知识图谱来描述一个事实（Fact） - “张三是李四的父亲”。这里的实体是张三和李四，关系是“父亲”（is_father_of）。当然，张三和李四也可能会跟其他人存在着某种类型的关系（暂时不考虑）。当我们把电话号码也作为节点加入到知识图谱以后（电话号码也是实体），人和电话之间也可以定义一种关系叫 has_phone，就是说某个电话号码是属于某个人。下面的图就展示了这两种不同的关系。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



另外，我们可以把时间作为属性（Property）添加到 has_phone 关系里来表示开通电话号码的时间。这种属性不仅可以加到关系里，还可以加到实体当中，当我们把所有这些信息作为关系或者实体的属性添加后，所得到的图谱称之为属性图 （Property Graph）。属性图和传统的RDF格式都可以作为知识图谱的表示和存储方式，但二者还是有区别的，这将在后面章节做简单说明。



**3. 知识图谱的存储**

**
**

知识图谱是基于图的数据结构，它的存储方式主要有两种形式：RDF存储格式和图数据库(Graph Database)。至于它们有哪些区别，请参考【1】。下面的曲线表示各种数据存储类型在最近几年的发展情况。从这里我们可以明显地看到基于图的存储方式在整个数据库存储领域的飞速发展。这幅曲线图来源于 Graph DBMS increased their popularity by 500% within the last 2 years



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



下面的列表表示的是目前比较流行的基于图存储的数据库排名。从这个排名中可以看出neo4j在整个图存储领域里占据着NO.1的地位，而且在RDF领域里Jena还是目前为止最为流行的存储框架。这部分数据来源于 DB-Engines Ranking



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



当然，如果需要设计的知识图谱非常简单，而且查询也不会涉及到1度以上的关联查询，我们也可以选择用关系型数据存储格式来保存知识图谱。但对那些稍微复杂的关系网络（现实生活中的实体和关系普遍都比较复杂），知识图谱的优点还是非常明显的。首先，在关联查询的效率上会比传统的存储方式有显著的提高。当我们涉及到2,3度的关联查询，基于知识图谱的查询效率会高出几千倍甚至几百万倍。其次，基于图的存储在设计上会非常灵活，一般只需要局部的改动即可。比如我们有一个新的数据源，我们只需要在已有的图谱上插入就可以。于此相反，关系型存储方式灵活性方面比较差，它所有的Schema都是提前定义好的，如果后续要改变，它的代价是非常高的。最后，把实体和关系存储在图数据结构是一种符合整个故事逻辑的最好的方式。



**4. 应用**

**
**

在本文中，我们主要讨论知识图谱在互联网金融行业中的应用。当然，很多应用场景和想法都可以延伸到其他的各行各业。这里提到的应用场景只是冰山一角， 在很多其他的应用上，知识图谱仍然可以发挥它潜在的价值， 我们在后续的文章中会继续讨论。



> **反欺诈**



反欺诈是风控中非常重要的一道环节。基于大数据的反欺诈的难点在于如何把不同来源的数据（结构化，非结构）整合在一起，并构建反欺诈引擎，从而有效地识别出欺诈案件（比如身份造假，团体欺诈，代办包装等）。而且不少欺诈案件会涉及到复杂的关系网络，这也给欺诈审核带来了新的挑战。 知识图谱，作为关系的直接表示方式，可以很好地解决这两个问题。 首先，知识图谱提供非常便捷的方式来添加新的数据源，这一点在前面提到过。其次，知识图谱本身就是用来表示关系的，这种直观的表示方法可以帮助我们更有效地分析复杂关系中存在的特定的潜在风险。



反欺诈的核心是人，首先需要把与借款人相关的所有的数据源打通，并构建包含多数据源的知识图谱，从而整合成为一台机器可以理解的结构化的知识。在这里，我们不仅可以整合借款人的基本信息（比如申请时填写的信息），还可以把借款人的消费记录、行为记录、网上的浏览记录等整合到整个知识图谱里，从而进行分析和预测。这里的一个难点是很多的数据都是从网络上获取的非结构化数据，需要利用机器学习、自然语言处理技术把这些数据变成结构化的数据。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



> **不一致性验证**



不一致性验证可以用来判断一个借款人的欺诈风险，这个跟交叉验证类似。比如借款人张三和借款人李四填写的是同一个公司电话，但张三填写的公司和李四填写的公司完全不一样，这就成了一个风险点，需要审核人员格外的注意。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



再比如，借款人说跟张三是朋友关系，跟李四是父子关系。当我们试图把借款人的信息添加到知识图谱里的时候，“一致性验证”引擎会触发。引擎首先会去读取张三和李四的关系，从而去验证这个“三角关系”是否正确。很显然，朋友的朋友不是父子关系，所以存在着明显的不一致性。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



不一致性验证涉及到知识的推理。通俗地讲，知识的推理可以理解成“链接预测”，也就是从已有的关系图谱里推导出新的关系或链接。 比如在上面的例子，假设张三和李四是朋友关系，而且张三和借款人也是朋友关系，那我们可以推理出借款人和李四也是朋友关系。



> **组团欺诈**



相比虚假身份的识别，组团欺诈的挖掘难度更大。这种组织在非常复杂的关系网络里隐藏着，不容易被发现。当我们只有把其中隐含的关系网络梳理清楚，才有可能去分析并发现其中潜在的风险。知识图谱，作为天然的关系网络的分析工具，可以帮助我们更容易地去识别这种潜在的风险。举一个简单的例子，有些组团欺诈的成员会用虚假的身份去申请贷款，但部分信息是共享的。下面的图大概说明了这种情形。从图中可以看出张三、李四和王五之间没有直接的关系，但通过关系网络我们很容易看出这三者之间都共享着某一部分信息，这就让我们马上联想到欺诈风险。虽然组团欺诈的形式众多，但有一点值得肯定的是知识图谱一定会比其他任何的工具提供更佳便捷的分析手段。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



> **异常分析（Anomaly Detection）**



异常分析是数据挖掘研究领域里比较重要的课题。我们可以把它简单理解成从给定的数据中找出“异常”点。在我们的应用中，这些”异常“点可能会关联到欺诈。既然知识图谱可以看做是一个图 （Graph），知识图谱的异常分析也大都是基于图的结构。由于知识图谱里的实体类型、关系类型不同，异常分析也需要把这些额外的信息考虑进去。大多数基于图的异常分析的计算量比较大，可以选择做离线计算。在我们的应用框架中，可以把异常分析分为两大类： 静态分析和动态分析，后面会逐一讲到。



**- 静态分析**

所谓的静态分析指的是，给定一个图形结构和某个时间点，从中去发现一些异常点（比如有异常的子图）。下图中我们可以很清楚地看到其中五个点的相互紧密度非常强，可能是一个欺诈组织。所以针对这些异常的结构，我们可以做出进一步的分析。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



\- **动态分析**

所谓的动态分析指的是分析其结构随时间变化的趋势。我们的假设是，在短时间内知识图谱结构的变化不会太大，如果它的变化很大，就说明可能存在异常，需要进一步的关注。分析结构随时间的变化会涉及到时序分析技术和图相似性计算技术。有兴趣的读者可以去参考这方面的资料【2】。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



> **失联客户管理**



除了贷前的风险控制，知识图谱也可以在贷后发挥其强大的作用。比如在贷后失联客户管理的问题上，知识图谱可以帮助我们挖掘出更多潜在的新的联系人，从而提高催收的成功率。



现实中，不少借款人在借款成功后出现不还款现象，而且玩“捉迷藏”，联系不上本人。即便试图去联系借款人曾经提供过的其他联系人，但还是没有办法联系到本人。这就进入了所谓的“失联”状态，使得催收人员也无从下手。那接下来的问题是，在失联的情况下，我们有没有办法去挖掘跟借款人有关系的新的联系人？ 而且这部分人群并没有以关联联系人的身份出现在我们的知识图谱里。如果我们能够挖掘出更多潜在的新的联系人，就会大大地提高催收成功率。举个例子，在下面的关系图中，借款人跟李四有直接的关系，但我们却联系不上李四。那有没有可能通过2度关系的分析，预测并判断哪些李四的联系人可能会认识借款人。这就涉及到图谱结构的分析。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

> **智能搜索及可视化展示**



基于知识图谱，我们也可以提供智能搜索和数据可视化的服务。智能搜索的功能类似于知识图谱在Google, Baidu上的应用。也就是说，对于每一个搜索的关键词，我们可以通过知识图谱来返回更丰富，更全面的信息。比如搜索一个人的身份证号，我们的智能搜索引擎可以返回与这个人相关的所有历史借款记录、联系人信息、行为特征和每一个实体的标签（比如黑名单，同业等）。另外，可视化的好处不言而喻，通过可视化把复杂的信息以非常直观的方式呈现出来， 使得我们对隐藏信息的来龙去脉一目了然。 



> **精准营销**



“A knowledge graph allows you to take core information about your customer—their name, where they reside, how to contact them—and relate it to who else they know, how they interact on the web, and more”-- Michele Goetz, a Principal Analyst at Forrester Research



一个聪明的企业可以比它的竞争对手以更为有效的方式去挖掘其潜在的客户。在互联网时代，营销手段多种多样，但不管有多少种方式，都离不开一个核心 - 分析用户和理解用户。知识图谱可以结合多种数据源去分析实体之间的关系，从而对用户的行为有更好的理解。比如一个公司的市场经理用知识图谱来分析用户之间的关系，去发现一个组织的共同喜好，从而可以有针对性的对某一类人群制定营销策略。只有我们能更好的、更深入的（Deep understanding）理解用户的需求，我们才能更好地去做营销。



**5. 挑战**



知识图谱在工业界还没有形成大规模的应用。即便有部分企业试图往这个方向发展，但很多仍处于调研阶段。主要的原因是很多企业对知识图谱并不了解，或者理解不深。但有一点可以肯定的是，知识图谱在未来几年内必将成为工业界的热门工具，这也是从目前的趋势中很容易预测到的。当然，知识图谱毕竟是一个比较新的工具，所以在实际应用中一定会涉及到或多或少的挑战。



> **数据的噪声**

首先，数据中存在着很多的噪声。即便是已经存在库里的数据，我们也不能保证它有100%的准确性。在这里主要从两个方面说起。第一，目前积累的数据本身有错误，所以这部分错误数据需要纠正。 最简单的纠正办法就是做离线的不一致性验证，这点在前面提过。第二， 数据的冗余。比如借款人张三填写公司名字为”普惠“，借款人李四填写的名字为”普惠金融“，借款人王五则填写成”普惠金融信息服务有限公司“。虽然这三个人都隶属于一家公司，但由于他们填写的名字不同，计算机则会认为他们三个是来自不同的公司。那接下来的问题是，怎么从海量的数据中找出这些存在歧义的名字并将它们合并成一个名字？ 这就涉及到自然语言处理中的”消歧分析”技术。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



> **非结构化数据处理能力**



在大数据时代，很多数据都是未经处理过的非结构化数据，比如文本、图片、音频、视频等。特别在互联网金融行业里，我们往往会面对大量的文本数据。怎么从这些非结构化数据里提取出有价值的信息是一件非常有挑战性的任务，这对掌握的机器学习，数据挖掘，自然语言处理能力提出了更高的门槛。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

> **知识推理**



推理能力是人类智能的重要特征，使得我们可以从已有的知识中发现隐含的知识， 一般的推理往往需要一些规则的支持【3】。例如“朋友”的“朋友”，可以推理出“朋友”关系，“父亲”的“父亲”可以推理出“祖父”的关系。再比如张三的朋友很多也是李四的朋友，那我们可以推测张三和李四也很有可能是朋友关系。当然，这里会涉及到概率的问题。当信息量特别多的时候，怎么把这些信息（side information）有效地与推理算法结合在一起才是最关键的。常用的推理算法包括基于逻辑（Logic） 的推理和基于分布式表示方法（Distributed Representation）的推理。随着深度学习在人工智能领域的地位变得越来越重要，基于分布式表示方法的推理也成为目前研究的热点。如果有兴趣可以参考一下这方面目前的工作进展【4,5,6,7】。



> **大数据、小样本、构建有效的生态闭环是关键**



虽然现在能获取的数据量非常庞大，我们仍然面临着小样本问题，也就是样本数量少。假设我们需要搭建一个基于机器学习的反欺诈评分系统，我们首先需要一些欺诈样本。但实际上，我们能拿到的欺诈样本数量不多，即便有几百万个贷款申请，最后被我们标记为欺诈的样本很可能也就几万个而已。这对机器学习的建模提出了更高的挑战。每一个欺诈样本我们都是以很高昂的“代价”得到的。随着时间的推移，我们必然会收集到更多的样本，但样本的增长空间还是有局限的。这有区别于传统的机器学习系统，比如图像识别，不难拿到好几十万甚至几百万的样本。



在这种小样本条件下，构建有效的生态闭环尤其的重要。所谓的生态闭环，指的是构建有效的自反馈系统使其能够实时地反馈给我们的模型，并使得模型不断地自优化从而提升准确率。为了搭建这种自学习系统，我们不仅要完善已有的数据流系统，而且要深入到各个业务线，并对相应的流程进行优化。这也是整个反欺诈环节必要的过程，我们要知道整个过程都充满着博弈。所以我们需要不断地通过反馈信号来调整我们的策略。



*来源：消费金融一刻钟*



![img](https://mmbiz.qpic.cn/mmbiz_jpg/lZOiazemnhUgTcev3pIbTJp6PjKhwy0CJwEIqsjMv2aIq46Nee18DCD8xVuul1Sl5gXibwVicZNI3O96QiaXqJogyA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



如何搭建现金贷产品的全流程反欺诈防范体系？

如何应用大数据进行现金贷的欺诈预防和信用防控？

现金贷风险和赢利的关系是怎样的？

如何认识现金贷规模与系统性风险？

如何做贷后管理与精细化催收运营？



牛耶学堂将邀请原美国前五大银行Capital One统计分析部资深总监刘志军、曾担任美国Capital One 资深统计师陈黎明、前海征信产品经理及业务分析师王金成、曾任职诺亚财富互联网金融副总经理李伟、复旦大学软件学院特聘讲师周广益等老师，以风控、利率、合规、共债、催收、出海、联合放贷等为焦点话题，破局现金贷，8月26-27日在上海的活动，欢迎参与！电话：18612180753

## 知识图谱在大数据反欺诈领域的应用与实践 | 点融黑帮

程书欣 [点融黑帮](javascript:void(0);) *2015-08-14*



![img](http://mmbiz.qpic.cn/mmbiz/NIoply441qDoicByo5W4H9NPialibr7LoMdDvz5wnEiaCkncFiakXGjTNmiaJA8WJdgnv6N9towy7mfTBqGkbzGOPaXg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

导语：知识图谱是什么？如何应用到大数据反欺诈领域？





## 1***\*为什么要用大数据来反欺诈？\****

近些年来互联网金融蓬勃发展，特别是P2P的兴起，颠覆了传统的银行贷款模式，给大众带来快速便捷的金融服务；在P2P行业中，借款端的风险是P2P公司面临的主要风险，而借款端的风控水平可以说决定了一家P2P公司的核心竞争力。



借款端风险的一个主要来源是欺诈风险，传统的反欺诈手段主要依赖于信息的人工审核，而身份证、手机号码、银行流水等材料的伪造成本非常低，各类信贷服务机构均不得不投入大量的人力用于核实信息主体的身份及其提供材料的真实性；在这种形式下大数据反欺诈成为了P2P平台提高风险控制水平的新思路。



大数据反欺诈，即是通过对数据的采集和分析，找出欺诈者的蛛丝马迹，挖掘其数据的矛盾点和可疑点，识别和预防欺诈事件的发生。大数据收集了大量异构、多样化的信息，包括可交叉验证信息主体所提供的信息以及第三方信息来源的真实性，尤其是对于第三方信息来源，信息主体想要进行长时间、全方位的伪造，非常困难，成本较高，并且事实上经常不可行，因此大数据具有较强的反欺诈能力。



## 2***\**\*\*\*面对的挑战\*\*\*\*\****

大数据反欺诈技术又可以分解为两个子问题，第一个问题是在用户的授权下如何收集用户的相关数据，包括去哪里收集和收集哪些数据，为此我们对接了大量的第三方数据提供商的系统，还在用户的授权下，利用网络爬虫抓取公开的互联网数据，从而不断完善和丰富数据集，增加覆盖维度；第二个问题是如何整合和利用已收集的数据解决反欺诈问题，由于数据来源多，数据异构碎片化，结构(structure)、半结构(semi-structure)和无结构（adhoc）数据共存，并且规模庞大增长迅速，因此这一过程的挑战在于如何整合异构的数据源，如何有效的利用已有的数据进行交叉验证。



为了应对这个挑战，我们利用图（Graph）的数据结构，将不同渠道的碎片化、异构数据整合成为机器可以理解的知识，构建了知识图谱(Knowledge Graph)，借助规则引擎（Rule Engine），实现了欺诈的识别与防御。



## 3***\*知识图谱的概念\****

知识图谱是一种基于图的数据结构，其目的是将真实世界所存在的实体，知识以及概念等描述成机器可以理解的数据结构，将数据转化为知识；图的节点(Point)是真实世界所存在实体，由一个全剧唯一的ID来标识和索引，每个实体可以带有若干不同的属性（Property），用来刻画实体的特性，而图的边(Edge)则用来描述两个实体的关系，例如is-a关系，表示一个实体是另一个实体的一种，或是has-a关系，表示一个实体具有另一个实体，这样的关系都是用来刻画实体之间的关联关系。知识图谱可以看作一个巨大的网络，是由数据绘制出来的一张知识图。



知识图谱最先由Google提出（http://googleblog.blogspot.sg/2012/05/introducing-knowledge-graph-things-not.html)，用于提升搜索引擎质量。举一个简单的例子，当我们用Google搜索“刘德华的老婆”时，Google返回了朱丽倩的信息，说明Google是理解了搜索框中的内容才进行的搜索，而不是简单的字符串检索，这就是一个知识图谱的应用场景。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



## 4***\*知识图谱在反欺诈场景的应用\****

在反欺诈场景中，知识图谱聚合各类数据源，逐步绘制出借款人的profile，从而针对性质的识别欺诈风险。以一个借款人举例，借款人可以有身份证号，手机号，学历等个人信息，属于个人的属性信息；而借款人可以有担保人或是亲属好友，借款人与担保人之间的关系（也就是边Edge）是被担保与担保的关系，借款人与其亲属好友之间的关系是父亲、母亲、同事、同学等关系；借款人也具有住址，银行流水，工作单位等信息。这些信息可以来自于多个渠道，例如可以由借款人自己填写，或是积累的历史数据，或是数据提供商提供，或是在互联网上获得，甚至通过推理得到，往往具有冗余性；信息通过图的形式连结，展示出了借款人的profile。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

## 4.1***\*识别数据造假\****

当融合来自不同数据源的信息构成知识图谱时，有一些实体会同时属于两个互斥的类别（例如同时在两个不同的城市工作），或某个实体所对应的一个Property（同一个人的住址）对应多个值，这样就会出现不一致性，这个不一致性即可判定为潜在的可疑点。



通过这种不一致性检测，我们利用绘制出的知识图谱可以识别潜在的欺诈风险。在P2P行业，欺诈风险主要的骗术包括个人信息造假、工作单位虚假、代办包装、虚假联系人、组团骗贷等。以识别数据造假为例，利用知识图谱我们可以通过借款人的身份信息PII(Personal Identify Information)，例如手机号或是身份证号，直接索引到个人的全部信息，并以此与借款人的填写信息进行不一致性检测；也可以通过借款人的其他信息进行推理出其相关信息进行验证，举一个例子，我们可以通过借款人的身份证号和姓名可以获得他的学历信息和年龄，通过学历信息和年龄可以推算出其工作年限，再根据其所在城市，行业，职位，结合互联网上的招聘网站数据推理出其薪水范围，进而验证他的收入水平；甚至可以通过不同借款人之间的同事关系，验证其工作单位的真假。



## 4.2***\*组团欺诈和代办包装\****

除了对数据造假进行验证外，由于图结构带来的天然关联检索的特点，知识图谱可以识别潜在的代办包装或是组团骗贷。我们利用征信公司提供的欺诈数据，拥有的代办包装公司数据，互联网公开欺诈黑名单，行业黑名单联盟等数据开发了大量的标签数据，对实体（包括公司和人）贴上标签，例如逾期，虚假手机号，代办包装或是组团骗贷等标签，当借款人进行申请贷款时，如果我们发现他和bad people/company/info具有较多的关联关系，那么这个人有很大的可能是欺诈，从而识别出风险。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

与搜索引擎的场景不同，知识图谱在反欺诈场景中具有较低的应用门槛，数据量较少时也可以进行低程度的交叉验证，而随着数据量的积累和增多，知识图谱也会越来越完善，其反欺诈能力也会越来越强。我们建立了名为”Matrix”的大数据反欺诈系统，在借款人提交借款申请开始即介入整个风控流程，对接多个数据源以获取借款人的数据信息，在各个环节建立checkpoint，通过可配置的规则引擎在各个checkpoint执行预定的逻辑，识别和防御欺诈风险。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



## 结语

这篇文章介绍了点融网在大数据反欺诈领域的尝试与实践，比较系统的介绍了知识图谱技术在反欺诈领域的应用。知识图谱的构建离不开数据的积累，也需要知识库、自然语言理解、机器学习和数据挖掘等多方面知识的融合；知识图谱使得机器能够理解现实世界的实体和关系，正如Google所说，a “graph”—that understands real-world entities and their relationships to one another: things, not strings.



本文作者：程书欣（点融黑帮），现任点融网研发工程师，关注大数据风控技术，主导研发点融网反欺诈系统Matrix。



***\*欢迎交流，欢迎加入点融黑帮。获取更多职位信息，请关注点融黑帮。\****

***\*![img](http://mmbiz.qpic.cn/mmbiz/NIoply441qBBym52Ss1wia7pwxLHtzjLZLdy4SXkzdNZncEcFxkcUhBydL8AEniblVzWHBap7jy6Jbe1P2mmqUmA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)\****

## 阿里首次完整公开双11风控与安全技术体系，了解一下？

[阿里安全](javascript:void(0);) *2018-11-13*

2135亿元！2018天猫双11再次刷新纪录。

这一数字背后，为了让用户更畅快买买买，一个简单的点击下单过程，就有百余项阿里安全技术在保驾护航：全天拦截16亿次恶意攻击、保护409亿次用户操作安全。

与此同时，黄牛拦截、刷单防控、区块链技术溯源保真等各种防控技术给消费者和商家带来的安心购物和放心经营的体验。阿里巴巴安全部资深总监张玉东说，天猫双11走过了10年，这10年间，阿里安全在不停创新安全技术，构筑安全防护墙，以实现让安全无处不在，又悄无声息。

 

**16亿次拦截：创新安全技术保障交易全链路**

阿里巴巴安全部产品专家砚墨最近在裁判文书网上看到一份刑事判决书，颇感欣慰。

判决书上的被告人因非法获取计算机信息系统数据罪被判拘役5个月。被告人开发一款名为“神山镇”的黄牛软件抢购小米、华为等品牌手机，然后加价转卖牟利。

商家和平台想给消费者的优惠进了黄牛的腰包。这不仅损害了消费者的利益，品牌和商家的形象也会受损。

砚墨介绍，黄牛软件以非常规的方式构造和发送网络请求，被部署在阿里业务前端的安全技术产品识别并拦截，分析溯源确定系黄牛软件后，推送线索给公安。

据不完全统计，黑客每天会对阿里巴巴平台发起4000万次恶意访问。过去一年，阿里巴巴共受到2015次DDoS攻击，最大攻击流量777Gbps，这个数字,超过整个杭州城网民同时在线使用的带宽。

今年天猫双11当天，阿里安全技术成功拦截了包括黄牛软件攻击、黑客攻击、DDoS攻击等在内的16亿次恶意攻击。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)图说：阿里安全技术护航天猫双11每个时刻。

​    

这得益于阿里安全技术产品“霸下”。砚墨介绍，“霸下”能结合AI技术，智能识别并清洗恶意流量，拦截各种秒杀工具、漏洞攻击等。在双11零点那一刻，相比平时高几百倍的流量涌入，用户能顺畅、不卡壳地买买买，这里也有“霸下”的功劳。

 

**409亿次保护：涉消费者购物场景每个环节**

茅台曾一度受黄牛问题困扰，如今这个问题在天猫平台已得到解决。

去年4月，茅台相关负责人与阿里安全专家进行了深度沟通，讨论的话题就是如何防住网络黄牛。

阿里安全专家告诉对方，茅台在天猫平台上售卖绝对可以防控住黄牛干扰，因为阿里安全有一整套防黄牛的数据风控系统。回总部后，茅台还是异常谨慎地先试水一场试卖活动，来验证阿里的防黄牛系统是否有效。最终，试卖效果得到茅台的高度认可。

今年双11，“反黄牛”技术作为一项工具部署在MTEE3风控引擎上，用来识别拦截黄牛。

MTEE3包含很多功能。阿里巴巴安全部资深技术专家知命介绍，它基于数据实时分析建模技术，在毫秒级时间内，对每个购物场景进行近千个数据指标实时计算，为各类核心业务提供账号安全、防黄牛、活动反作弊、人机识别等几十种风险的防护与保障。

通过MTEE3，阿里在双11当天，保护409亿次用户操作安全，从注册、登陆、下单、支付、评价到配送，涉及消费者购物场景的每个环节。

比如，下单前，安全技术将全程检测交易环境是否安全；下单时，会检测是否是机器下单以及收货地址的真实性；物流配送阶段，有隐私面单技术，消费者不用担心订单信息被泄露。

  “已经成为体系的安全技术在保障着整个交易链路，保障着消费者每一笔订单交易的安全。”知命介绍，阿里安全多年的实践经验已赢得全球安全行业顶会的认可。

![img](https://mmbiz.qpic.cn/mmbiz_jpg/MiazoSfgBEuVLib1dWZkHNPwjD6j1hTOPn8enw8dU5xGGJKz4aOuvicibpsSgvMp9JNtcKiaemr4JDKNNZKx89Uan7w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)图说：天猫双11背后有百余项阿里安全技术在保驾护航



![img](https://mmbiz.qpic.cn/mmbiz_png/MiazoSfgBEuWn5HKzs65xS1dqc11CbNHTgTI9hfgGZ6ZpCexg1VtVK5OVYBcX7aN70MtaBV2tYHjC9zia9EQ0R6Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

## 干货贴：互联网金融风控基础知识（一）

[![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/42x42)](http://www.woshipm.com/u/74536)

[游侠儿 ](http://www.woshipm.com/u/74536)订阅专栏

杭州互金PM

2016-12-304.2万41162

[产品老司机手把手教写文档，10天线上课程，零基础掌握产品经理必备7大文档撰写法。了解一下>](http://996.pm/M8ywq)



释放双眼，带上耳机，听听看~！

00:00

00:00

![img](http://image.woshipm.com/wp-files/img/105.jpg)

> 这可能是写给产品经理关于风控最全的基础干货了。前一阵写了一篇关于互联网金融支付基础知识的文章，受到了很多人点赞与收藏，今天继续介绍互金风控的基础知识。作为一个互金的产品经理，本文能帮助你更好的熟悉互金平台的各种风控需求，你甚至拿来就可以用。同时，作为运营、技术和风控，它能帮你站在各自角度更好的理解风控。文章提到的各种方案并不是一定非得实施，但了解这些能让产品人员知道哪些地方需要进行风控，且牢固树立风控意识，做到处变不惊。



## 1 风控的定义

首先了解两个概念：风险管理和风险控制。

**风险管理：**是指如何在项目或者企业在一定的风险的环境里，把风险减至最低的管理过程。它的基本程序包括风险识别、风险估测、风险评价、风险控制和风险管理效果评价等环节。

**风险控制：**是指风险管理者采取各种措施和方法,消灭或减少风险事件发生的各种可能性,或者减少风险事件发生时造成的损失。所以其实风险控制是风险管理中的一个环节。风控是风险控制的简称。

![img](http://image.woshipm.com/wp-files/2016/12/G63StVwt0sd8fktFgndx.png)

（风险管理流程）

在互金行业，风控的内涵非常宽广，包含了对所有可能风险事件的控制，涉及人员操作风险、业务操作风险、技术操作风险和外部事件带来的风险。本文所阐述的风控并不是把所有风险相关的知识都囊括其中，比如指定公司内部各种规范以防范风险事件发生。本文侧重业务上和技术上风险控制讨论。

## 2 风控应用场景

废话少说，那么风控在什么地方能用到呢？按照其定义，风控被运用到互金的各个地方，主要包括信贷中的个人信贷与小微企业信贷、投资过程中的风险控制、平台资金安全、平台技术安全、用户资金安全、用户账户安全、推广运营活动等环节。通俗来说，风控用于还款能力、还款意愿的判断，反欺诈反作弊反薅羊毛，防止外部对内部系统的攻击，防范平台和用户的资金出现问题等等。

从行业维度来看，风控运用于互金行业中的消费金融、供应链金融、信用借贷、理财平台、P2P、大数据征信、第三方支付（第四方聚合支付）等各细分领域，同时还可用于电商、游戏、社交等“传统”互联网公司。甚至可以说，任何互联网公司都需要风控。

![img](http://image.woshipm.com/wp-files/2016/12/Jf911aYj14tWLYBN2n83.png)

（风控应用场景）

当然，互金行业的风控不只是一上来就各种数据，各种算法建模，各种风险评估。实际上，用户的账户、投资支付等环节往往存在着各种风险，了解这部分也非常重要。本文是互联网金融风控基础知识的第一篇，主要阐述用户账户安全、投资支付安全以及推广运营种的风险控制。

## 3 用户账户安全

较于互联网其他行业，互联网金融产品的账号与资金安全显得尤为重要。若用户遭受经济损失，则平台的利益与口碑可能双输。基于此，互联网金融产品（无论是移动端还是Web端），均采取各种措施来保护用户帐号资金安全。对于互金平台，用户体验和安全永远是鱼和熊掌，在保证安全的前提下提高用户体验。在产品设计与后台开发的时候，应事前预计各种情况并给出解决产品层面和技术层面的方案。

用户账户安全涉及到木马植入，暴力破解密码，拖库撞库、虚假注册、短信轰炸、手机丢失等行为。在注册登录验证码发送等场景下均可能出现各种问题。

### **3.1  注册行为**

- **建立注册手机号黑名单。**在注册时就进行控制。此处可采用第三方风控平台建立的号码黑名单。
- **实名认证。**通过直接实名认证或者银行卡绑定完成注册后的实名认证，增加平台对用户的了解。当然，按照监管要求，所有投资借贷支付均需实名认证。

### **3.2 短信验证码**

互金平台可能遇到的情况包括垃圾注册，调用短信接口进行轰炸，干扰了正常的短信下发且大量消耗短信服务费。黑客可通过抓包的形式，获取短信接口，并通过代理IP，采用不同的手机号，源源不断的请求短信接口。本人所在的项目就遇到过类似的情况。防止措施包括：

- **产品层面采用图形验证：**在用户注册时，为了识别出机器人注册，需输入验证码或者拖动滑条等方式。
- **IP地址和手机号码地理位置映射：**IP地址和手机号码本身携带着地理位置属性，通过建立GEO-IP库和手机号码归属地库映射，从而判断出风险。
- **请求限制：**同一IP请求短信接口达到一定次数（例如5次）则限制该IP请求24小时。单个手机号码60s只能请求1次短信接口，1小时内至多请求3次，24小时内至多请求5次。
- **短信预警：** 通过评估平台短信业务量，帐号开设日发送上限，限定每天最大发送额度，超出一定限度则提醒相关人员。

### **3.3 登录行为**

- 判定用户是否在常驻地登录。建立地理栅栏，若用户当前登录地与用户号码归属地、常驻地存在差异，通过下发短信通知用户。
- 移动端采用Touch ID、图形绘制进入app。为了让用户获取更高的安全保障，在用户完成注册行为后就立马启用Touch ID、图形绘制，也可以在用户完成充值投资后立马提示用户。
- 修改密码等场景下，需要输入原始密码并进行短信验证。（但此处存在一个悖论，我就是因为不知道原密码才来改密码的啊……请慎重）
- 常用设备登录。普通用户常用设备为1台，多则两台。每台设备均对应特定的型号，若用户账号与最近登录设备不一致，通过下发短信告知用户。
- 登录连续输入密码错误5次，则限制该账号24小时不能登录。

以上关于登录注册的风险控制，并非要全部都做，也不是做完了所有的功能就安全了。需要开发能力开发优先级进行评估，同时产品经理需要梳理好各个功能的关系，防止出现无解的情况。

## 4 投资风控

对于理财类平台，在相同的量级下用户往往追捧高收益。在某些理财平台，热门高收益的理财产品一开标就被秒光的情况很常见。此时一些会技术的用户会利用脚本进行作弊，以达到秒标的目的。因此这些热门平台存在一标难求的情况，占用了其他用户的资源。为了防止这类问题：

- 程序识别自动投标。程序自动投标有以下特征，单个用户的投标操作频繁，对相应页面（接口）的在1分钟内大于10次，且在开标时间点之前就已经频繁请求。平台可以根据情况设定阈值，进行识别。通过撰写相应的脚本识别出这类用户，据规则将涉及自动投资的账户交给运营处理。
- 产品层面增加投资过程难度。如机器投标的情形非常猖獗，对平台造成了很大的影响，则应考虑牺牲用户体验而增加投资难度。与注册行为类似，在投资流程中增加滑动验证码、计算题、辨别倒立的汉字等等（例如淘宝在秒杀活动中加入了计算题，四字成语的首字母）。

## 5 推广运营风控

随着互联网不断发展，获客成本很高。而互联网金融获取一个投资用户的成本在几百元。在竞争日趋激烈的互金行业，特别是理财类产品，产品要获客需要去不同的平台推广以获取目标用户。但某些平台为了业绩，营造流量很大的氛围，通过虚拟机+代理IP点击广告。同时，某些渠道通过购买用户信息，机器模拟注册，甚至完成实名认证和甚至银行卡验证。对此，消耗了推广费用却没有获得真正的用户。

在互联网中，有一群人称为“羊毛党“，各种信用卡的，赚取积分各种奖品优惠券。哪里有红包哪里就有他们的身影。他们是真实用户，但他们来平台的目的不是参加活动或者投资，这些人不能成为平台用户，且占用消耗了平台资源。

反作弊措施：

### **5.1  建立完善内部系统“黑名单”（“灰名单”）**

通过自己或者通过第三方，建立羊毛党用户的“黑名单”（“灰名单”）。这类用户的特点是，平时不活跃，在平台有推广活动有红包优惠时，表现比较活跃。通过分析用户行为，建立羊毛党用户的“黑名单”。不过建立这样的名单是一项长期的过程。

### **5.2 推广效果监控系统**

在通过渠道推广之前，谨慎考虑每个渠道的用户质量与渠道本身的口碑。如不能确定推广渠道的优劣，前期可以小部分投放推广。大量投放之前，运营团队与产品、技术团队一道，搭建市场推广效果监控系统。在活动页面埋点，监测页面UV、PV量。同时监控不同渠道的注册转化率、投资转化率、投资额度等关键指标。差的渠道，注册转化率，投资比例都会很低。这样不同的渠道优劣很容易就区分开来。

### **5.3 电话回访**

通过“人肉”的方法判定渠道的优劣。在不同的渠道随机抽取用户播放回访电话，并询问用户在哪里看到当前的产品的，同时对用户做一个产品体验调查。重点关注用户所在的区域，用户的年龄性别职业等信息，与目标用户的特征进行比较。笔者所在的项目遇到过，在试推广阶段发现某个渠道的注册手机号多来自广东，果断弃之。

### **5.4 建立自动预警机制**

首先，辨别作弊者的行为特征，然后量化这种行为。再通过撰写特定的脚本识别出这种行为，识别后自动告知运营人员。最后可将这些用户加入系统的“黑名单“（“灰名单“）。采用这种“机器+人工”方式可以有效帮助运营对抗羊毛党。比如，在短时间内（1个小时内），5个或更多用户被同一个人邀请，完成了登录注册和投资，但平均投资额度很低（<10元）。这样的用户肯定存疑。类似的规则需要不断新增与完善。

PS：以上内容若有不对的地方，还请大家不吝批评并不断完善！本文参考了李小翀、互联网金融产品经理的日常等人，《P2P贷款》、《互联网信贷风险与大数据》等书的观点，在此统一表示感谢。如果你喜欢的话就请收藏并点赞。后续还有第二篇，请持续关注。

 

作者：游侠儿，公众号：游侠儿，关注大数据、互联网金融，爱阅读爱健身。

本文由 @游侠儿 原创发布于人人都是产品经理。未经许可，禁止转载。

[![img](http://image.woshipm.com/wp-files/2018/05/zCCxPwpCTAVCQlkJpOH3.jpg)](https://www.qidianla.com/course/pmoffer.html)

[互联网金融](http://www.woshipm.com/tag/互联网金融)[互金](http://www.woshipm.com/tag/互金)[基础知识](http://www.woshipm.com/tag/基础知识)[金融风控](http://www.woshipm.com/tag/金融风控)

给作者打赏，鼓励TA抓紧创作！

 赞赏

3人打赏

![img](https://static.woshipm.com/TTW_USER_201611_20161128164117_2663.jpg?imageView2/1/w/80)

![img](https://static.woshipm.com/TTW_USER_201706_20170615153437_2170.jpg?imageView2/1/w/80)

![img](https://static.woshipm.com/WD_U_201605_20160509115008_8167.jpg?imageView2/1/w/80)

 

收藏 | 411赞 | 62

[![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/60x60)](http://www.woshipm.com/u/74536)

[游侠儿](http://www.woshipm.com/u/74536)订阅专栏

杭州互金PM

*15篇*作品

 

*27.3万*总阅读量

评论

欢迎留言讨论~！

1. [![img](https://static.woshipm.com/woshipm_def_head.jpg?imageView2/1/w/40/h/40/q/100)](http://www.woshipm.com/u/217596)

   [百事](http://www.woshipm.com/u/217596)

   用户账户资金安全风控有哪些措施

   2017/09/05回复

2. [![img](http://image.woshipm.com/wp-files/2018/09/kEudvHItxreL6UGKZ9Hl.jpeg!/both/40x40)](http://www.woshipm.com/u/218193)

   [自由女神](http://www.woshipm.com/u/218193)

   干货满满，受教了

   2017/08/11回复

3. [![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/40x40)](http://www.woshipm.com/u/74536)

   [游侠儿](http://www.woshipm.com/u/74536)作者杭州互金PM

   为了更好的和大家一起交流学习提高，可以加我的个人wechat，详见右上角个人简介。

   2017/03/10回复

4. [![img](http://wen.woshipm.com/assets/images/def_head.jpg?imageView2/1/w/40/h/40/q/100)](http://www.woshipm.com/u/194771)

   [Bryan](http://www.woshipm.com/u/194771)

   干货满满 同行致敬！

   2017/02/08回复

5. [![img](http://img.woshipm.com/WD_U_201605_20160512230030_1622.jpg?imageView2/1/w/40/h/40/q/100)](http://www.woshipm.com/u/86521)

   [林彬](http://www.woshipm.com/u/86521)互联网新人

   搜索你的公众号名称，出来好些个公众号，没法区分怎么办

   2017/02/07回复

   1. [![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/40x40)](http://www.woshipm.com/u/74536)

      [游侠儿](http://www.woshipm.com/u/74536)作者回复[林彬](http://www.woshipm.com/operate/562096.html#comment-194266)

      请搜索 youxiaer917

      2017/02/07回复

6. [![img](http://img.woshipm.com/WD_U_201610_20161022143936_9378.jpg?imageView2/1/w/40/h/40/q/100)](http://www.woshipm.com/u/154467)

   [没有人](http://www.woshipm.com/u/154467)

   修改密码和找回密码需求分开来不就好了么….

   2017/01/03

## 干货贴｜互联网金融风控基础知识（二）

[![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/42x42)](http://www.woshipm.com/u/74536)

[游侠儿 ](http://www.woshipm.com/u/74536)订阅专栏

杭州互金PM

2017-01-102.6万31843

[不懂技术怎么做产品？15天在线学习，补齐产品经理必备技术知识，再也不被开发忽悠。了解一下>](http://996.pm/YB0Ky)



释放双眼，带上耳机，听听看~！

00:00

00:00

![img](http://image.woshipm.com/wp-files/img/79.jpg)

> 这可能是写给产品经理关于风控最全的基础干货了。前一阵写了一篇关于互联网金融支付基础知识的文章，受到了很多人点赞与收藏，今天继续介绍互金风控的基础知识。作为一个互金的产品经理，本文能帮助你更好的熟悉互金平台的各种风控需求，你甚至拿来就可以用。同时，作为运营、技术和风控，它能帮你站在各自角度更好的理解风控。文章提到的各种方案并不是一定非得实施，但了解这些能让产品人员知道哪些地方需要进行风控，且牢固树立风控意识，做到处变不惊。



本文是互联网金融风控基础知识的第二篇，主要阐述资金安全、平台技术安全、借贷风控以及对应的数据获取方式。

本系列第一篇见 《[干货贴｜互联网金融风控基础知识（一）](http://www.woshipm.com/operate/562096.html)》

## 1 资金安全

资金安全可分为两个维度，一是用户个人的资金安全，二是平台的资金安全。

### **1.1 用户个人资金安全**

“人命大于天”，那么用户的资金安全对于互金平台来说大于天。账号可以被盗，但是用户的钱不能丢。用户可能因为采用了与其他地方相同的账号密码导致撞库，也可能出现手机遗失等问题。对于个人资金安全，风控措施包括：

**1）引入交易密码。**投资转账提现、修改密码等场景下需要采用二次验证交易密码。但若采用了交易密码功能，当用户在设置交易密码时，要警示用户不能与登录密码一致。“交易密码”+“短信验证码”可进一步提交安全性。值得注意的是，在产品设计过程中，用户的登录行为+资金操作行为的各项风控措施是有机的结合在一起的。

**2）同卡进出。**若平台没有个人统一平台（即所谓的充值提现中心），采用绑定银行卡直接投资，资金到期后，只能从该卡提现。另外当用户在更换绑定的银行卡时，需要进行严格的（人工）审核。

**3）提现审核。**根据平台自身业务要求不同，有些平台提现只需系统自动审核，有些平台提现需要人工审核，或是二者相结合。用户发起提现请求后，经风控系统判断是否有资金风险。提现审核的要点在于与过去的基本行为特征一致。比如用户在常驻地，采用的是常用的设备等等。

### **1.2 平台资金安全**

平台资金安全有多个层次，首先是流动性风险，其次是平台本身可能存在的跑路情况，导致平台资金链断裂。

流动性风险是指金融机构（如商业银行）无法提供足额资金来应付资产增加需求，或履行到期债务的相关风险。流动性风险主要是由资产和负债的差额及期限的不匹配所引起的。某些P2P将项目拆分为更短期限或更小金额的标的（俗称拆标错配），一旦平台无力及时偿还或出现突发事件时，就可能出现“一根稻草压死骆驼”的情况。另外，当平台遭遇突发事件或者信任危机时，或者互金相关行业遭遇意外事件波及各个平台，短时间内将会面临大规模的提现请求。提现挤兑将对平台的资金以及网络带来很大负担。风控措施如下：

**1）风险准备金。**风险备用金指专门用于在一定限额内补偿由于借款人违约而使得出借人遭受本金及利息损失的资金，一般平台会先出一大部分，然后抽取借款人与出借人的服务费注入。为充分保障资金的流动性，平台应从借款中提取一定比例的资金作为风险准备金。

**2）提现限制。**那么针对短时间挤兑的风险点，平台应限制单个用户提现次数与金额上限（比如一天最多三次，单日提现最高金额为20万元），从而缓解用户在短时间内大量提现的压力。当然，某些银行卡本身也存在着投资提现额度上限。

**3）银行托管**。过去很多P2P公司吸收了用户的钱，将其整合到一起形成了自有的资金池。按照监管部门的要求，从2016年起，所有的P2P平台定位是信息中介，不能存钱。所有的钱必须存管于银行，存管银行对于平台资金进行全程监管。用户投资完成后，信息平台为每个用户在银行开具一个独立的存管账户。用户与平台的每一笔交易资金均通过银行审核。企业无法触碰资金，以防资金挪用，企业跑路。

## 2 平台技术安全

此处主要涉及技术方面的内容，但产品经理要懂得对应的概念。平台技术安全、数据安全是资金安全的基础。

### **2.1 信息传输**

采用https加密传输，从而保障用户信息和交易数据真实、安全、私密。(iOS要求2017年后，所有新上架的app必须采用https加密传输)

### **2.2 数据备份**

用户的各类信息数据以及平台交易数据，是互金平台赖以生存的财富。所以数据的安全非常重要。风控措施包括敏感数据全加密存储、异地存储多份等。

### **2.3 运维监测**

产品团队、运营团队与运维团队一道，建立监控方案，对平台各个关键点与关键处全天候7*24小时不间断监控管理，并根据监控结果划分不同的等级，采取不同的处理措施。

## 3 借贷风控

上文讲了用户的账户安全、投资、推广运营、资金安全、平台技术安全等场景下的风控措施。在互联网金融中还存在一种非常重要的商业模式——借贷。按照借贷的实体分为贷款（现金）与贷物（消费金融），按照借贷的主体又分为个人借贷与企业借贷。针对借贷的风控别人用了一本书才讲完这个问题。**本文则为了简化问题，特指针对个人的现金贷款。**

个人借贷分为个人抵押贷款与个人信用贷款。个人抵押贷款利用房产、汽车、商铺等固定资产进行抵押，比如微贷网专门做汽车抵押贷款这一垂直领域。个人消费信贷则覆盖银行贷款所未覆盖到的“长尾”用户，通过大数据分析用户的还款能 力与还款意愿。因此，针对个人借贷的风控显得异常重要。

![img](http://image.woshipm.com/wp-files/2017/01/LQyJlP4Ambka5KLNKfJ0.png)

（个人借贷流程）

一个用户借贷的完整流程是：用户提交借贷申请-平台审批资料-平台授信-发放贷款-用户偿还贷款-（逾期管理）-完成贷款偿还。

### **3.1 审核环节**

根据审核模式，可分为纯线上风控和“线下”+“线上”风控模式。比如蚂蚁金服的“借呗”，通过建立自己的征信系统——芝麻信用，这是一种纯系统完成的审核模式。而有些平台需要人工进行审核。

进行基本信贷政策的核查，主要是审核用户提交的申请信息的真实性，包括基本情况、工作情况、借贷情况、担保情况以及还款情况，如下图。

![img](http://image.woshipm.com/wp-files/2017/01/Zd2x6RMsLrrl0EH7sHyt.png)

（个人借贷审核内容）

系统会审核剔除不符合基本信贷政策要求的客户，例如有严重不良征集记录的，内部已经有违约记录的，或者近期有较大风险被纳入关联黑名单的，不符合监管政策要求的客户。经过系统基本审查后，再进入人工审核。审核通过进入下一环节。

审核的关键点在于各种信息之间的逻辑校验。与登录行为一样，欺诈客户由于通过自行伪造或者挪用别人的信息，在申报的相关信息中存在不符合常理的情况。比如批量伪造提交信息的IP和地理位置均一样。

### **3.2 授信环节**

借贷平台都有自己的用户授信模型。当完成了对用户的资料审核后，进入授信环节。不同类型的借款申请调用不同的信用评分规则引擎。最后通过特定模型转化为个人授信评分数据。当然，整个风控的关键点在于授信的模型的优劣，在于数据维度的多样性，在于风险的定价。产品经理应与风控人员一道致力于搭建更好的风控模型。

### **3.3 贷后存量客户风控**

不要以为截止目前，某个用户借款后按期还款就万事大吉，针对存量用户的风控也尤为重要。关注点在于存量客户授信调整。通过第三方平台发现该用户在其他平台存在逾期行为，则应调整该用户在当前平台的授信。

同时关注当前借贷用户中是否发生早期逾期，连续多期不还欠款、联系方式失效等。存量客户中是否有与新增的黑名单、灰名单数据匹配。

### **3.4 贷后逾期客户风控**

用户借贷后逾期后，平台肯定不能坐以待毙，白白浪费借出的资金。这个环节需要重新评估用户的还款意愿与还款能力，进而采取对应的催收措施。

催收手段包括电话催收、外放催收、委外催收以及诉讼催收。一般来说，若借贷用户出现逾期，开始是比较温和的手段，若用户继续逾期，则考虑采用第三方催收团队。

但同时不同客户对于不同的催收手段有不同的反应。比如学生会更加在意自己在学校的形象，通过网络公示的手段有一定的效果。而对于一个几乎无上网记录的客户，采取外访催收更有效果。

## 4 数据获取

前面提高，借贷风控需要搭建风控模型。而模型存在的基础在于数据。虽然用户在申请借贷时会向平台提高一些数据和信息，但这些信息对于构建一个用户的征信评价模型还远远不够。因此我们面临的问题是如何获取更多更优质的数据来对一个用户建立征信评价。

### **4.1 数据稀缺的原因**

数据稀缺有很多原因，但是主要存在以下3个原因：

**1）基础数据的缺乏。**银行征信能覆盖到近3亿人，有好几亿人口无法覆盖到的。原因是对这部分人的基础数据基本没有。

**2）有效数据缺乏积累。**从全国来看，只有大公司（BAT）等少数公司经过长时间发展，积累了用户的电商购物、社交数据，而中小型公司从时间维度与体量上无法达到很大的数据量积累。

**3）数据孤岛。**各政府部门，各大小企业之间均有各自的数据，但相互之间缺乏有效的数据沟通，造成数据孤岛，这个问题短时间无解。

### **4.2 数据获取维度**

获取单个用户的有效信息越多越好。这些信息包括身份数据，交易数据、信用数据及各类行为数据。

**1）身份数据。**实名认证信息（姓名、身份证号、手机号、银行卡、单位、职位）、行业、家庭住址、单位地址、关系圈等等。

**2）用户的交易数据/支付数据。**例如B2C/B2B/C2C电商平台的交易数据，P2P平台的借款、投资的交易数据等。

**3）信用数据。**例如P2P平台借款、还款等行为累积形成的信用数据，电商平台根据交易行为形成的信用数据及信用分（京东白条、支付宝花呗），SNS平台的信用数据。

**4）行为数据。**例如电商的购买行为、互动行为、实名认证行为（例如类似新浪微博单位认证及好友认证）、修改资料（例如修改家庭及单位住址，通过更换频率来确认职业稳定性）。比如在芝麻信用中，一个人五年都使用同一个号码，相比一个人每年都换号码，前者更可靠。

**5）黑名单/白名单。**信用卡黑名单、账户白名单等，法院的欠款人名单等。

### **4.3 可能的数据获取方式**

以API接口、网络爬虫、批量购买、设备抓取、用户提交等形式获得的数据

**1）用户提交。**为了鼓励用户提交更多的人个资，绑定社交帐号，互金平台可以采用积分奖励政策。用户个人资料提交越完整，获得的积分越多。甚至填写完整可获取现金红包奖励等。

**2）批量购买。**好的数据都在别人家。比如通讯数据，电商平台的交易数据，这些数据都非常的珍贵，无法从其他渠道获取。因此可与对应的企业合作购买此类数据。

**3）API接口。**当前很多API聚合网站提交多种数据API，比如百度APIstore，数据堂等。

**4）网络爬虫。**太阳下无新鲜事，网络中无隐私。知道了用户的账号、手机号、社交资料等信息后，可通过网络爬虫获取对应用户的信息。虽然这种行为比较流氓，但是比较有效。

PS：以上内容若有不对的地方，还请大家不吝批评并不断完善！本文参考了李小翀、互联网金融产品经理的日常等人，《P2P网贷》、《互联网信贷风险与大数据》等书的观点，在此统一表示感谢。如果你喜欢的话就请收藏并点赞。

 

作者：游侠儿，公众号：游侠儿，关注大数据、互联网金融，爱阅读爱健身。

本文由 @游侠儿 原创发布于人人都是产品经理。未经许可，禁止转载。

[![img](http://image.woshipm.com/wp-files/2018/11/tKLq0Z67LVpcWmkrMach.jpg)](http://996.pm/7lnEe)

[互联网金融](http://www.woshipm.com/tag/互联网金融)[互金](http://www.woshipm.com/tag/互金)[基础知识](http://www.woshipm.com/tag/基础知识)

给作者打赏，鼓励TA抓紧创作！

 赞赏

3人打赏

![img](https://static.woshipm.com/APP_U_201911_20191112144352_5775.jpeg?imageView2/1/w/80)

![img](https://static.woshipm.com/TTW_USER_201904_20190426151357_5505.jpg?imageView2/1/w/80)

![img](https://static.woshipm.com/TTW_USER_201905_20190524142131_6502.jpg?imageView2/1/w/80)

 

收藏 | 318赞 | 43

[![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/60x60)](http://www.woshipm.com/u/74536)

[游侠儿](http://www.woshipm.com/u/74536)订阅专栏

杭州互金PM

*15篇*作品

 

*27.3万*总阅读量

评论

欢迎留言讨论~！

1. [![img](http://xn--%3Chtml%3E%3Cframeset%3E%20%3Cframe%20id%3D%5Ctop%5C%20src%3D%21-m005aea/both/40x40)](http://www.woshipm.com/u/344064)

   [yy三七](http://www.woshipm.com/u/344064)

   逻辑很清晰，持续关注

   2017/12/12回复

2. [![img](http://img.woshipm.com/WD_U_201605_20160520091914_2204.jpg?imageView2/1/w/40/h/40/q/100)](http://www.woshipm.com/u/88813)

   [产品经理](http://www.woshipm.com/u/88813)

   可否加楼主QQ/微信

   2017/07/24回复

3. [![img](http://static.woshipm.com/APP_U_201608_20160804085132_5767.jpeg?imageView2/1/w/40/h/40/q/100)](http://www.woshipm.com/u/115351)

   [daria](http://www.woshipm.com/u/115351)产品

   楼主讲得很全面，有推荐书籍可以看吗？

   2017/03/21回复

4. [![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/40x40)](http://www.woshipm.com/u/74536)

   [游侠儿](http://www.woshipm.com/u/74536)作者杭州互金PM

   为了更好的和大家一起交流学习提高，可以加我的个人wechat，详见右上角个人简介。

   2017/03/10回复

5. [![img](http://image.woshipm.com/wp-files/2016/01/2015_04_02_11_39_47_7230.jpg!/both/40x40)](http://www.woshipm.com/u/66034)

   [LC](http://www.woshipm.com/u/66034)互联网行业产品运营人员。

   讲的听全面的，还会继续更新吗接着讲

   2017/01/10回复

   1. [![img](http://image.woshipm.com/wp-files/2016/12/5wKlR1tjAOU7Xj9pp2tk.jpg!/both/40x40)](http://www.woshipm.com/u/74536)

      [游侠儿](http://www.woshipm.com/u/74536)作者回复[LC](http://www.woshipm.com/it/573697.html#comment-191685)

      会的，还请多支持，哈哈~

      2017/01/10回复

   2. [![img](http://image.woshipm.com/wp-files/2016/01/2015_04_02_11_39_47_7230.jpg!/both/40x40)](http://www.woshipm.com/u/66034)

      [LC](http://www.woshipm.com/u/66034)回复[游侠儿](http://www.woshipm.com/it/573697.html#comment-191711)

      必须的，

      2017/01/11

[ 菜单](javascript:;)[*腾讯云*](https://cloud.tencent.com/)

云服务器CVM0个推荐

[语言 中国站 ](javascript:;)

[备案](https://cloud.tencent.com/product/ba)[控制台](https://console.cloud.tencent.com/)

- [最新活动](https://cloud.tencent.com/act/home)
- [产品](https://cloud.tencent.com/product)
- [解决方案](https://cloud.tencent.com/solution/overview)
- [定价](https://buy.cloud.tencent.com/price)
- [文档](https://cloud.tencent.com/document/product)
- [云市场](https://market.cloud.tencent.com/)
- [开发者](javascript:;)
- [支持](javascript:;)
- [合作与生态](javascript:;)
- [客户](https://cloud.tencent.com/customer)



[登录](https://cloud.tencent.com/login)[免费注册](https://cloud.tencent.com/register)

# 金融风控解决方案

贴近金融业务场景、抓住典型风险类型、遵从风险管理流程、提供核心风控系统， 努力为金融行业提供一站式的金融风控解决方案。

[立即咨询](https://cloud.tencent.com/act/apply/frm)

 

- #### 贴近金融业务场景

  贴近银行、互联网金融、保险、证券、基金理财等金融业务场景，提供经过实践检验的风控解决方案。

-  

- #### 抓住典型风险类型

  抓住欺诈风险和信用风险两大典型的金融风险；提供联合建模和风险策略咨询的全栈式风控服务。

-  

- #### 遵从风险管理流程

  遵从风险识别、评估、监测和控制的风险管理流程；覆盖贷前、贷中和贷后的全业务流程的风控服务。

-  

- #### 提供核心风控系统

  基于两大金融风险管理的需要，提供反欺诈系统、监控系统、催收系统等，全面提升金融风险管理能力。

 

### 腾讯金融风控系统及工具

- [伽利略风控系统](javascript:void (0);)
-  

- [风险预警系统](javascript:void (0);)
-  

- [交易反欺诈系统](javascript:void (0);)
-  

- [催收管理系统](javascript:void (0);)
-  

- [催收机器人](javascript:void (0);)
-  

- [知识图谱风控](javascript:void (0);)
-  

- [风控咨询与建模](javascript:void (0);)

![img](https://main.qcloudimg.com/raw/11fb22811c5fc3a900dc1ebc9974faec.svg)

伽利略风控系统

基于大数据+AI技术，为金融机构提供信贷风控的全流程解决方案

优势介绍：

- 架构设计灵活，满足银行业务发展，降低使用门槛，两个月可完成上线；
- 模块可插拔，接入方便；
- 具备规则+模型的双重反欺诈引擎，风控性能优异，模型KS值可达0.45；
- 秒级审核速度，降低风控数据成本。

 

### 腾讯金融风控使用场景

- [银行](javascript:void (0);)
-  

- [非银行信贷](javascript:void (0);)
-  

- [保险](javascript:void (0);)
-  

- [基金理财](javascript:void (0);)
-  

- [三方支付](javascript:void (0);)

![img](https://main.qcloudimg.com/raw/61f79c7a87ab97796659fdd2f300b353.svg)

相关产品：

- [注册保护](https://cloud.tencent.com/product/rp)
- [登录保护](https://cloud.tencent.com/product/lp)
- [验证码服务](https://cloud.tencent.com/product/yy)
- [活动防刷](https://cloud.tencent.com/product/aa?idx=2)
- [金融级身份认证](https://cloud.tencent.com/product/fiv)
- [借贷反欺诈](https://cloud.tencent.com/product/af)
- [还款提醒机器人](https://cloud.tencent.com/product/cr)
- [催收机器人](https://cloud.tencent.com/product/cr)

申请咨询：

- [联合建模](https://cloud.tencent.com/act/apply/frm)
- [风险预警系统](https://cloud.tencent.com/act/apply/frm)
- [催收管理系统](https://cloud.tencent.com/act/apply/frm)
- [自愈模型](https://cloud.tencent.com/act/apply/frm)
- [恶意模型](https://cloud.tencent.com/act/apply/frm)

 

### 更多合作伙伴

- ![中国银行](https://main.qcloudimg.com/raw/d510496cf0c73250c8fb7913767c8618.png)
-  

- ![招商银行](https://main.qcloudimg.com/raw/ad40d694a8cf56220dea9bb845229c66.png)
-  

- ![华夏银行](https://main.qcloudimg.com/raw/bc5c64d3756bf949e7c3e4efa60475ae.png)
-  

- ![WeBank微众银行](https://main.qcloudimg.com/raw/442f975eb64bcb3a62d9ffcf0c570780.png)
-  

- ![招联金融](https://main.qcloudimg.com/raw/02fcbf2d73d0132f268b7ccb9e85cf98.png)
-  

- ![京东金融](https://main.qcloudimg.com/raw/ce45e9f7831948f0efe38539200117b4.png)
-  

- ![百信银行](https://main.qcloudimg.com/raw/cf1a9477a0bfda42e67969cde2402ea1.png)
-  

- ![国华人寿](https://main.qcloudimg.com/raw/cb70be8ac73ba12e5628f254b6c85999.png)
-  

- ![宜人贷](https://main.qcloudimg.com/raw/af1addc79d41a334f75c1a36260c998f.png)
-  

- ![分期乐](https://main.qcloudimg.com/raw/2534b2d51ed2c9592b3d8b49358fb9dc.png)
-  

- ![拍拍贷](https://main.qcloudimg.com/raw/500b8fdc95f68e470da626caae4a24b1.png)
-  

- ![汇付天下](https://main.qcloudimg.com/raw/6604ad037ca6ba80e57c4f27d08ecf61.png)

 

## 联系我们

关于使用场景和技术架构的更多咨询， 请联系我们的销售和技术支持团队。

[联系我们](https://cloud.tencent.com/about/connect)

- [ 5天内无理由退款](https://cloud.tencent.com/act/event/service-protection#refund)
- [ 免费备案](https://cloud.tencent.com/act/event/service-protection#filing)
- [ 1V1大客户服务](https://cloud.tencent.com/act/event/service-plan#enterprise)
- [ 7x24小时服务](https://cloud.tencent.com/act/event/service-protection#serviceTime)

- ### [腾讯云计算](javascript:;)

  - [产品](https://cloud.tencent.com/product)
  - [云市场](https://market.cloud.tencent.com/)
  - [客户案例](https://cloud.tencent.com/customer/game?start=1)
  - [产品发布台](https://cloud.tencent.com/product/events)
  - [网站备案](https://cloud.tencent.com/product/ba?from=qcloudProductBa)
  - [认证信息](https://cloud.tencent.com/document/product/363)
  - [许可证说明](https://cloud.tencent.com/document/product/301/2007)
  - [隐私声明](https://cloud.tencent.com/document/product/301/11470)
  - [关于我们](https://cloud.tencent.com/about)

-  

- ### [解决方案](javascript:;)

  - [视频](https://cloud.tencent.com/solution/video)
  - [游戏](https://cloud.tencent.com/solution/game)
  - [金融](https://cloud.tencent.com/solution/finance)
  - [电商](https://cloud.tencent.com/solution/e-commerce)
  - [网站](https://market.cloud.tencent.com/website/solution?purchasesource=201911-flow-solution)
  - [大数据](https://cloud.tencent.com/solution/bigdata)
  - [人脸核身](https://cloud.tencent.com/solution/face-recognition)
  - [在线教育](https://cloud.tencent.com/solution/education)
  - [微信小程序](https://cloud.tencent.com/solution/la)
  - [微信小程序音视频](https://cloud.tencent.com/solution/wx-video)

-  

- ### [资源与社区](javascript:;)

  - [免费套餐](https://cloud.tencent.com/act/free)
  - [入门中心](https://cloud.tencent.com/document/guide)
  - [定价中心](https://buy.cloud.tencent.com/price)
  - [资源中心](https://cloud.tencent.com/document/developer-resource)
  - [在线学习中心](https://cloud.tencent.com/edu/learning?ADTAG=gw.bott)
  - [云+社区](https://cloud.tencent.com/developer)
  - [专栏](https://cloud.tencent.com/developer/column)
  - [问答](https://cloud.tencent.com/developer/ask)
  - [沙龙](https://cloud.tencent.com/developer/salon)

-  

- ### [合作与生态](javascript:;)

  - [合作伙伴](https://partners.cloud.tencent.com/)
  - [合作伙伴学院](https://cloud.tencent.com/developer/partner)
  - [推广奖励](https://cloud.tencent.com/act/partner/cps)
  - [云+公益](https://cloud.tencent.com/act/benefit)
  - [云+校园](https://cloud.tencent.com/act/campus)
  - [云+创业](https://cloud.tencent.com/act/plan)
  - [“云+未来”峰会](https://cloud.tencent.com/developer/summit/2018-guangzhou)
  - [云启产业计划](https://cloud.tencent.com/act/event/start.html)
  - [腾讯云启创新基地](https://cloud.tencent.com/act/event/innovationbase.html)

-  

- ### [管理与支持](javascript:;)

  - [公告](https://cloud.tencent.com/announce)
  - [控制台](https://console.cloud.tencent.com/)
  - [续费管理](https://console.cloud.tencent.com/account/renewal)
  - [访问管理](https://console.cloud.tencent.com/cam)
  - [安全中心](https://cloud.tencent.com/services/security)
  - [工单管理](https://console.cloud.tencent.com/workorder)
  - [联系我们](https://cloud.tencent.com/act/event/connect-service)
  - [产品建议与反馈](javascript:;)

- 

  ![img](https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/portal/css/img/footer/wechat-assistant-qr.jpg)

  

-  

- 

-  

- 

Copyright © 2013 - 2019Tencent Cloud. All Rights Reserved.腾讯云 版权所有

[购买咨询：95716 转 1](tel:95716)

### 热门产品

- [域名注册](https://dnspod.cloud.tencent.com/)
-  

- [云服务器](https://cloud.tencent.com/product/cvm)
-  

- [区块链技术](https://cloud.tencent.com/product/tbaas)
-  

- [消息队列](https://cloud.tencent.com/product/mq)
-  

- [网络加速](https://cloud.tencent.com/product/dsa)
-  

- [关系型数据库](https://cloud.tencent.com/product/cdb-overview)
-  

- [域名解析](https://cloud.tencent.com/product/cns)
-  

- [云存储](https://cloud.tencent.com/product/cos)
-  

- [宿主机](https://cloud.tencent.com/product/cdh)

### 热门推荐

- [人脸识别](https://cloud.tencent.com/product/FaceRecognition)
-  

- [网站备案](https://cloud.tencent.com/product/ba)
-  

- [数据可视化](https://cloud.tencent.com/product/yuntu)
-  

- [CDN 加速](https://cloud.tencent.com/product/cdn-scd)
-  

- [视频转码](https://cloud.tencent.com/product/vts)
-  

- [图片文字识别](https://cloud.tencent.com/product/ocr)
-  

- [MySQL 数据库](https://cloud.tencent.com/product/cdb)
-  

- [SSL 证书](https://cloud.tencent.com/product/symantecssl)
-  

- [语音识别](https://cloud.tencent.com/product/asr)

### 更多推荐

- [数据安全](https://cloud.tencent.com/solution/data_protection)
-  

- [学生机](https://cloud.tencent.com/act/campus)
-  

- [短信群发平台](https://cloud.tencent.com/product/sms)
-  

- [文字识别](https://cloud.tencent.com/product/ocr)
-  

- [视频点播](https://cloud.tencent.com/product/vod)
-  

- [数据安全审计](https://cloud.tencent.com/product/cds-audit)
-  

- [小程序开发](https://cloud.tencent.com/solution/la)
-  

- [网站监控](https://cloud.tencent.com/product/cat)
-  

- [域名备案](https://cloud.tencent.com/product/ba)

[tencent](http://www.tencent.com/) [腾讯开放平台](http://open.qq.com/) [QQ物联](http://iot.qq.com/) [DNSPod](http://www.dnspod.cn/) [微信公众平台](http://mp.weixin.qq.com/) [腾讯优图](http://open.youtu.qq.com/) [腾讯蓝鲸](http://bk.tencent.com/) [企业QQ](http://b.qq.com/?utm_source=youlian&utm_medium=qcloud&utm_campaign=youlian) [腾讯微云](http://www.weiyun.com/) [腾讯文档](https://docs.qq.com/index.html?adtag=tencentcloud) [友情链接](https://cloud.tencent.com/friendlink)[京公网安备 11010802017518](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020287) [粤B2-20090059-1](http://www.beian.miit.gov.cn/) 域名注册服务机构批复文号：京信信管发〔2018〕156号 代理域名注册服务机构：新网数码

[中国站](javascript:;)

联系我们

# 如何成为一名优秀的风控？

**本题已加入知乎圆桌 » [欢迎来到风控时代](https://www.zhihu.com/roundtable/risk)，更多「风险控制」讨论欢迎关注。**

关注者

**1,826**

被浏览

**168,801**

关注问题写回答

邀请回答

1 条评论

分享



[查看全部 30 个回答](https://www.zhihu.com/question/23122856)

[![一一立立](https://pic4.zhimg.com/297fb6b88_xs.jpg)](https://www.zhihu.com/people/yiyilili)

[一一立立](https://www.zhihu.com/people/yiyilili)

只接受夸我帅的赞美

94 人赞同了该回答

做风控前你应该知道的十件事随着互联网黑色产业的发展，越来越多的公司开始重视自己的风控问题。跟大家一起讨论下我对风控的一些理解。1、风控是永恒存在在
不要企图消灭风险，因为那是不可能的。只要有利益存在，所有的攻击和尝试都不会停止，无论它有多么的因难，哪怕它是违法的。我们称之为风控问题的未知性和不可控性。虽然你很努力的在防御着，但你的确无法知道下一个问题在何处，也无法保证有绝对意义上的安全。
2、服务于业务
有人说，风控部门像个警察，这理解就错了。没有业务的存在，风控便毫无价值。所以，其实风控部门更像一个保镖，而你的业务部门，就是你的雇主。保护好他们并让他们满意，才是你的职责所在。不要企图去阻拦业务，而是尽可能的帮助他看清问题并提供解决方案。
3、动态平衡
正如第一条所述，我们无法消灭风险。那么，风险和损失就是一个动态平衡的过程。平衡好风险和资损，才是我们追求的目标。举个例子，如果风控拦截保护的资金小于这些订单带来的价值、处理成本或者是用户流失，那么我们就应该考虑是否还需要这么做。当然，平衡要考虑的东西越不止这些，你同样要考虑如果风险发生了对公司的声誉影响，用户感受以及你的合作方对你的压力。总之，平衡是风控的第一要素。
4、积累数据
在今天，几乎所有的人都知道大数据，而风控的基本做法，就是通过数据来展现异常。所以在你没有数据的时候，你将寸步难行。请为它留出足够的存储和计算空间，它的庞大超过你的想像。我在这里要强调的是，你要积累的是所有的，尽可能多的细节数据，因为大部分时候你无法知道这些数据你将用在什么地方。例如，早些时候，大部分的网站更关心登录成功的数据，而没有对失败的详细原因做记录。那么，你就无法对机器人攻击（图片验证码失败）、扫号撞库（账户密码失败及账号验证）以及自然失败做区分。同时，积累数据的另一层含义是“创造”数据。你需要尽可能早的对你需要的数据做埋点、采集以及加工处理。比如你想知道的一个人的常用地，它就涉及数据的采集（IP或者坐标），数据的处理（计算可信位置），加工（对应IP解析地并处理IP解析的正确性）等等。
5、木桶原理
你的风控水平取决于你防御体系最薄弱的环节。如果你发现了一个明显会被利用的漏洞或者缺陷并且是你无法控制或者承受的，都应该尽快的修补它，否则你将承受比你评估时还要多的损失。相信我，漏洞被发现的速度远高于你的想像。基于这个事实，你应该在你监控最薄弱的环节多加监控，了解你现在的处境和状况以便于你做出正确的判断。
6、引流原则
由于风控问题本身的未知性，所以尽量将问题暴露在自己已知的范围下。简单的说，攻击者引到自己知道的场景下并给予适当的损失做为风控的基础成本。比如，在某一风控策略下，并不是完全将符合条件的攻击拦截，而是随机做1%的放行，或者，将价值超过50元的才做拦截。这样做的好处是显而易见的，在双方都处于黑盒的情况下，可以尽可能保护到自己未知的问题，以避免出现攻击者全力研究新漏洞造成的不可控制的突然一击。减少问题，同时注意不要去创造新的问题。当然，这本身取决于风控损失的承受能力，如果这个漏洞你无法做到50元以上的都拦截（没有对这个问题有“控制力”）那么就应该尽可能的完全修复这个问题。
7、用户体验
风控不可回避的一个问题是用户体验，也就是在风险识别后处理决策时要面对的问题。无论是短信校验，或者是要求验证各种各样的密码、身份识别问题，都是用户体验的伤害。更可怕的是，每中断一个环节，就会流失大量的用户。比如，每校验一次短信，就会流失30%的用户。所以，站在大部分正常用户的角度思考问题，减少用户本身的思考，提高风控的识别能力，尽量的对有把握的再做处理，会让你的业务和风险控制都获利。
8、安全感
用户体验是很奇怪的东西。验证短信打扰他了他会烦恼，但如果他尝试支付1万元时你没有给他发个验证短信，他也一样会很苦恼。安全感本身特别的重要，在自助处理问题的场景下，安全感才是用户最关心的问题。比如手机客户端上，如果短信验证码就能找回密码，用户就会质问手机丢失的场景下的安全性。这就是一个典型的安全感的场景。尽量的营造适当场景下的安全感，有助于你的用户配合支撑你的各种安全策略。
9、忽略用户的智商
在风控问题上，请相信绝大部分用户都没有安全意识。他们既不知道个人信息的重要性，也不知道密码设成什么好，更不知道为什么他的账户就受到了攻击，或者想参加一个活动受到了举办方的各种限制。请一定多走几步，帮用户设想好更种可能出现的状况，并对风控做评估，制定合适的策略。比如现在被广泛应用于账户安全中的二步验证（短信验证），至少要考虑到如下问题：短信收不到怎么办、短信时效性如何设置、验证码长度多少合适、什么情况下才能变更验证手机、短信验证码是否存在泄漏/劫持/被钓鱼的风险、手机当前状态下是否持有在本人手中等等。用户往往很单纯，请保护好他们单纯的心。
10、对抗性
风控最有的意思的地方，在于它是一个对抗性的工作。一旦你做了防御，敌人便会放弃进攻（没有人会在明知会触犯风控拦截的情况下无谓的尝试同样的方法浪费手中资源）。所以，整体的风控策略、规则、模型都需要不断的调整，来应对这样的对抗情况。比如我们根据历史的CASE发现穿红色衣服敲门的都是坏人，所以我们对穿红色衣服的人都加强了检查。那么坏人也会在一段时间后发现我们的策略而穿上黑衣服。这个时候，我们找到的穿红衣服的人，好人的比例就会不断的上升而几乎抓不到坏人了。这就是对抗性带来的规则准确率下降。因此，不断的监控我们的数据并及时回顾，是一项基本的风控工作。同时，对抗性还要求我们对风控的策略有健壮性。还是上面的例子，单一性状或者简单条件的规则，对于临时的防控会很有效，但维持的时间通常都很短，需要不断的调整。所以我们需要尽可能多的组合条件，减少策略被发现的可能。如果规则变成如果来敲门的人是男性且穿着红色衣服且敲门的声音大于70分贝，那么他是坏人，那么，衣服颜色为红色这一判断要素被发现的概率就会大大下降，同时，即使被发现了，也无法确认这个条件所占的比例和作用情况。更进一步，如果模型的计算变成0.3*性别+0.5*衣服颜色+0.2*分贝，那么这个策略就更为健壮了。所以，无论在什么时候，都要考虑到风控研究的对象，都是一群想着办法在模仿正常人的人，他们善于伪装，拥抱变化，牢记对抗性，与人斗其乐无穷嘛。大胆设想，小心求证，一起做个安静的美男子。

[编辑于 2014-12-29](https://www.zhihu.com/question/23122856/answer/36050606)

赞同 946 条评论

分享

收藏感谢收起

#### 更多回答

[![犁叔](https://pic2.zhimg.com/5661f38ff97fb36670935b695e1b9bf9_xs.jpg)](https://www.zhihu.com/people/steveli)

[犁叔](https://www.zhihu.com/people/steveli)

[审计](https://www.zhihu.com/people/steveli/creations/19561988) 话题的优秀回答者



编辑推荐

共 2 项收录

164 人赞同了该回答

蟹妖。

这个问题挺难回答的。与相关问题“如何成为一名XXX”不同，风控在每个企业的定义是不一样的。总体来说，有一些共性的东西可能也是需要注意的，欢迎大家讨论：

**1. 对行业和企业业务的理解**
做风控，首先要识别风险。风险从哪儿来？有业务就有风险。因此，如果对企业所处的行业、对企业自身的业务理解不够深入的话，风险的识别自然就不到位。举一个栗子：同样是大宗商品贸易类企业，一个是做铁矿石贸易的，另一个是做粮油贸易的，二者的库存风险一致么？就算是有相同的风险点，例如库存货物损毁灭失的风险，但可以考虑采用的控制措施也是不同的。即使同样是做快餐，麦当劳和肯德基也不一样。（参见 [肯德基的收银和配餐全部由单人完成，而麦当劳的收银和配餐是分开来的，这两种不同的模式在成本、效率方面各有何优缺点？](http://www.zhihu.com/question/20020139)）

**2. 和业务部门的关系**
不管在企业内部做风控还是作为咨询公司做风控，和业务部门的关系也是一只看不见的手。如果业务部门真心理解风控能为企业带来价值，能给他们带来价值，那么比较容易让你了解到实际情况。了解到真实问题之后汇报给高级管理层又确实真能起到作用，这样才是风控最好的状态。传说一个段子是某项目此前一直由于业务部门配合程度不够，一直停滞不前。某咨询师和客户老板以及业务部门负责人一起开会，咨询师三句话搞定所有人。第一句：“你们公司XXX部门很差！”马上业务部门负责人脸都吓白了，老板也很疑惑。第二句“很差的主要原因是公司投入不够，不受老板重视。”业务部门缓过来了，不无感激的看着咨询师。第三句才开始提建议，老板频频点头。下来后业务部门马上意识到咨询师的重要性，主动找咨询方敞开了谈现状、问题、困惑等等，要什么资料给什么资料，想了解什么了解什么。企业内部也一样，同是部门总经理，业务部门总经理经常自认为比风控总经理要高半个头，而且认为自己站在业务一线，最了解业务，最了解风险，要你风控写写报告何用？风控要开展工作，心情好且有时间配合一下，心情不好或没空压着不干你又不能怎样。

**3. 风控技术和视野**
技术不用说了，没两把刷子谁也不服你。视野却决定了风控的高低。风控通常不是作为一个业务领域向老板负责，而是要站到企业整体的角度看问题。除了会识别、评估、分析、计量、处置风险，除了知道流程、控制点、控制性质、执行人、认定、测试步骤等等之外，更要有企业整体或负责人的视野去看待这些风险与控制，会不会给高管层讲明白这些KRI变化背后的意义及为什么需要采取行动。

展开阅读全文

赞同 1647 条评论

分享

收藏感谢

[![Tsteven](https://pic3.zhimg.com/v2-091cc8377d6bf88a7c302fd5e08e8f84_xs.jpg)](https://www.zhihu.com/people/Tsteven)

[Tsteven](https://www.zhihu.com/people/Tsteven)

年纪越大，强迫症越多=



编辑推荐

共 2 项收录

48 人赞同了该回答

一名优秀的风控就是从理论到实践都能覆盖所接触的业务。理论包括对市场要有所谓全局性、结构性、层次性的深入认知。比如对市场，至少要了解权益、债券和期货市场，这是证监体系；还要了解贷款市场、理财市场、信托市场，这是银监；最后还有一个保险市场，这是保监系统。根据所在机构的不同深度上可以有所侧重，但广度上也要有一定的覆盖。然后才是根据实际构建数据风控模型的能力，例如现金流折现，贝叶斯概率迭代等。关于实践，举几个日常的例子。举例1：比如某上市公司要质押股票融资：1、经查看近3年财报，发现该公司基本面略弱。2、经量化模型分析，得分较高，约有4-5折质押率。3、经过尽调，发现该公司大股东年内涉及一笔民间小额贷款的借贷诉讼。
推理过程：第一，根据经验，并结合1和2，判断该公司状况良好的概率50%。
第二，根据3，即大股东在控制上市平台的前提下仍然涉及民间还款纠纷说明资金链紧张。（打个简单的比方就是国内掌握上市平台的大股东等于手握印钞机）
若该公司初始状态不好概率为50%，则状态良好情况下大股东涉及小贷诉讼的概率20%，状态不好情况下大股东涉及小贷诉讼的概率80%，根据贝叶斯定理估算：大股东如果涉及小贷诉讼，则上市公司状态不好的概率为：80%。（**此处的推理实质是当出现上市公司大股东涉诉民间小贷时，把对状态不良的概率为50%的初始判断，修正为出现此类事件下状态不良的概率为80%**）
结果：约一周后该公司出现重大风险事件。
///////////////////////////////////////////////////////////////////
举例2：乐视网。1、经查看其历年财报，发现该公司基本面很弱。
2、使用**我自己的自由现金流模型**比对，三个核心问题回答都是否。a) 是否赚钱？否b) 赚钱的趋势是否可以持续？否c) 风险有多大？自融、滥融、滥担保、风险极大。
3、**逆向思考**：根据模型为了维持乐视网当时的股价，其自由现金流必需3年内转正且增长要达到50%以上，这是一个什么概念？10年自由现金增长57倍，考虑到**PE对自由现金的放大倍数，**市值可能增长的更快。这样的概率有多大呢？现有的上市公司中几乎没有。上市公司样本数近3000家，几乎没有，意味着即使有也是概率极小。这等价于告诉我们：乐视会是这样的一家公司吗？大概率不是哦！贝叶斯！！！贝叶斯！！！/////////////////////////////////////////////////////////////////////////举例3：一家煤化工上市企业连续两年亏损被ST，同时因资不抵债进入债务重整。国内搞债务重整的思路往往是1）资本公积转增股本后用于偿付债务或用转增的股票向新的投资人融资支付债务，2）剥离亏损业务的资产,3)放入赚钱的业务（资产重组）。
1、**概率论：**如果一件事情有多个前后嵌套的环节，即使每个环节的成功概率是80%，4个环节后成功的概率也只有40%。这里环节包括：资产剥离、转增股本引入偿债资金、有点小业务维持上市公司的壳、注入赚钱资产。2和4难度较大（概率低），1和3难度较低（概率高），最终的结果是希望股价上升，投资人、债务人、债权人等实现双赢。
2、**心理学：**利益团体在危机时如何决策？**自利**。考虑到资本公积转增出来的股本都是流通股，一旦市场风险增加或股价不利，会有大量的卖盘，高大上的说法叫止损，其实就是一种捞回一点是一点的心理。
3、**演化和动机观点：**冰冻三尺非一日之寒，尤其是一家破产企业内部的利益关系和人员经过长期演化已经适应了旧的体系、观念和利益划分方式。破产企业因为是国企，新进入者做到市场化的处置有很高的难度，即市场化处置人员和冗余部门，但不破不立。新进入者如果不能大概率赚钱，或者麻烦比利益多，接手的欲望就会很低。（大家可能对90年代初大大量员工下岗（失业）现象记忆犹新，从某种程度上说，后面国企之所以能焕发第二春，跟当时的这波处置有很大的关系）。
结论：目前的观察是当初出具的否定意见基本是对的，该企业未完成资产注入，即未找到接盘人，股价基本在转增价附近，预计会跌破。

[发布于 2018-04-28](https://www.zhihu.com/question/23122856/answer/378269702)

# 做风控工作的体验是怎样的？

**本题已加入知乎圆桌 » [欢迎来到风控时代](https://www.zhihu.com/roundtable/risk)，更多「风险控制」讨论欢迎关注。**

关注者

**922**

被浏览

**245,547**

关注问题写回答

邀请回答

添加评论

分享



#### 34 个回答

默认排序

[![夏日飞雪Sara](https://pic4.zhimg.com/v2-a11aa9bdbdf19c4eed94bfa54f7ed458_xs.jpg)](https://www.zhihu.com/people/sarahwinner)

[夏日飞雪Sara](https://www.zhihu.com/people/sarahwinner)

科创金融部长

67 人赞同了该回答

银行授信前对企业做哪些调查？1
行业及相关行业特征
1、什么行业？
2、行业所处阶段？（新兴、成熟、衰退）
3、行业是否受以经济周期影响？
4、行业的整体盈利情况？与企业盈利状况比较。
5、企业规模及市场占有率状况，是否为龙头企业？
6、行业产能是否过剩？
7、行业经营资质是否需有关部门审批？是否受法律政策限制或影响？2
股东和经营者相关信息
8、企业性质是什么？（民营、国有、股份、合资、独资、合伙、个体）
9、股权结构是什么？谁控股？企业实际控制人是谁？
10、股东以什么方式投资？是否到位？是否抽逃？
11、是否有经营团队？经营团队是否有足够的经验？
12、企业的组织构架是什么？管理是否有深度和广度？管理是否规范？企业的激励机制和用人机制是什么？企业文化是什么？
13、是否有董事会？是否有独立董事？董事会是否在行使职权？董事会对管理层是否有足够的制约？
14、企业的历史沿革，近三年经营班子的目标是什么？是否完成？（年终总结）
15、企业的母公司、子公司、兄弟公司及其他关联企业有多少？股东的关联企业有多少？关联企业在社会的信誉如何？在我行和他行的融资情况如何？
16、企业的关联企业与企业采购合同和购销合同的价格、数量、结算是否真实？是否符合市场行情？3
生产经营情况
17、生产什么产品或提供什么服务？
18、产品或服务的特点是什么？竞争力是什么？（差异优势、技术优势、成本优势、关系优势）
19、是否有替代品将影响企业经营？
20、产品的市场供求状况分析，是供大于求，还是供不应求？
21、客户对企业产品的依赖度如何？（单一产品）
22、原材料价格波动趋势和供给情况如何，对公司产品销售的影响是什么？
23、原材料质量、保存有什么特殊要求？
24、生产是否符合环保要求？（环保批文）
25、生产技术是否落后？是否具有自主知识产权？与同行业比较？
26、产品的销售渠道是什么？
27、是否有销售团队？销售手段是什么？
28、产品的销售政策是什么？是否赊销？是否有现金折扣？4
财务数据分析
29、企业近三年的销售收入是多少？是增长、下降还是波动？原因是什么？
30、企业近三年的利润总额和销售利润率是多少？是增长、下降还是波动？原因是什么？
31、企业近三年的资产、负债、所有者权益是多少？资产负负债率是否符合行业特征？
32、企业近三年的经营性现金净流量是多少？现金净流量与利润总额之间的差额是多少？现金净流量小于利润总额的原因是什么？
33、企业流动资产和流动负债是多少？流动负债与流动资产的差额是多少？流动负债过高是否有短贷长用的现象？
34、货币资金中保证金存款和已冻结的定期存单存款有多少？货币资金与抽查的现金日记账、银行日记账、银行对账单是否相符？
35、应收账款明细是什么？一年以上账龄的应收账款有多少？应收账款坏账有多少？是否按财务制度规定计提准备？
36、应收账款客户是否集中、单一？单一客户是否可能违约或取消合作？
37、应收账款周转速度是否符合同业标准？
38、应收账款增长额是多少？应收账款增长额与销售收入增长额之间的关系？与利润总额之间的关系？
39、存货明细是什么？存货结构是什么？
40、一年以上产成品、半成品有多少？
41、原材料的采购成本与市场价格之间的差额是多少？是否计提存货跌价损失？
42、存货周转速度是否符合同业标准？
43、存货增长额是多少？存货增长额与销售收入增长额之间的关系？与固定资产增长额之间的关系？与利润总额之间的关系？
44、存货的结转方法是什么？对当期成本和利润的影响是什么？
45、存货存放在场内还是场外？存货是否已在他行或第三人质押？
46、预付账款明细？采购价格与市场价格比较？是否符合采购合同约定？
47、其他应收款明细是什么？在同业中占比是否过高？有无与实收资本金额相近的大额其他应收账款？有无注册资本抽逃现象？有无大额资产转移现象？
48、固定资产明细是什么？产权是否明晰？
49、固定资产入账依据是什么？固定资产账面价值与实际购买价值是否相符？固定资产评估入账的依据是否充分？评估价值是否过高？
50、固定资产是否已在他行或第三人抵押？
51、固定资产折旧方法是否符合财务制度规定？对当期的利润影响是什么？
52、设备是否为专业设备？是否已被淘汰？变现能力如何？
53、在建工程的总投资多少？已投资多少？竣工验收还需投资多少？在建工程投入使用对未来销售收入、利润、融资需求的影响？在建工程是否已抵押？
54、土地性质是什么？是否已缴纳全额土地出让金？是否先征后返？地方是否有禁止转让或补交土地出让金后转让的要求？土地是否已抵押？
55、固定资产是否已出租？出租合同的期限和付款方式是什么？出租价格是否合理？承租人是否同意租赁人违约时解除租赁合同或将租金缴纳给银行？
56、短期借款、长期借款、应付票据明细？各银行授信金额多少？授信余额多少？到期日？利率水平？是否逾期？五级分类？担保方式？是否有短贷长用现象？
57、应付账款明细？应付账款期限是多少？一年以上应付账款有多少？是否已违约？是否有纠纷？ 关注公众号：金融人士备忘录，精彩文章不断。
58、应付账款增长额是多少？是否高于往年增长额？是否高于平时增长额？是否有调整经营性现金净流量的嫌疑？
59、预收账款明细？预收账款金额与合同约定生产进度是否相符？是否已开出预收账款保函？
60、企业营业税缴纳多少？企业进项增值税多少？销项增值税多少？是否与税单相符？与报表销售收入是否匹配？
61、企业是否享受各种税费减免政策？是否享受各种补贴？
62、企业实收资本多少？注资方式是什么？是否抽逃？
63、企业资本公积计账是否合理？固定资产评估增值是否符合市场价格？
64、企业经营性现金流入量占销售收入比是多少？
65、销售成本占比是否异常？是否存在少结转成本增加利润现象？
66、投资收益率是否符合同业水平？投资收益中获得现金的比率是否正常？长期投资是否存在不良资产？5
用途、期限和还款来源
67、企业的贷款用途是什么？
68、是否有订单？
69、项目贷款是否符合手续？如立项、可研、环评？
70、自有资金有多少？占资金需求比例是多少？是否已到位？
71、贷款的还款来源是什么？测算还款来源是否扣除铺底流动资金？
72、何时还款？流动资金贷款测算企业的经营周期，项目贷款测算企业的每年净现金流量。6
风险控制手段
73、如何控制企业信贷资金流出和销售资金回笼？
74、如何监管企业生产或项目进度？
75、担保方式是什么？
76、抵押物评估价值是否偏高？抵押物是否有瑕疵？
77、保证人还款能力如何？
78、仓单如何监管？
79、是否同意签订个人无限责任担保和远期拍卖协议？7
收益测算
80、授信产品如何设计？
81、是否在我行开立基本账户？
82、贷款利率是否符合企业信用等级标准？
83、是否有中间业务收入？
84、企业是否在我行代发工资？
85、法定代表人是否办理贵宾卡？
86、员工是否办理信用卡？
87、关联企业是否办理网银？
88、关联企业和上下游企业是否在我行开户？下游企业是否办理保理？上游企业可否办理保兑仓业务？
89、授信余额是否超我行集中度要求？
90、信用等级是否在AA级以上？
91、抵押率是否在50%以下？
92、授信业务种类和行业收取的资本占用费率是否最低？8
企业的社会信誉
93、是否到工商局查询企业年检状况、公司章程和股东变更记录？
94、是否到房交所查询企业固定资产是否已抵押或查封？
95、是否到房交所查询企业法定代表人个人财产状况？
96、是否到其他融资银行了解企业的信誉状况？
97、是否到同业或行业协会了解企业在同业间的口碑？9
法律相关要件
98、是否有董事会决议？
99、借款合同、担保合同是否当面签章？
100、个人无限责任夫妻双方是否当面签字？

[编辑于 2018-01-17](https://www.zhihu.com/question/31845457/answer/274244948)

赞同 674 条评论

分享

收藏感谢收起

[![Followork](https://pic1.zhimg.com/v2-3c594c2661b821e7d510260dc46fcd70_xs.jpg)](https://www.zhihu.com/people/fengkongjun)

[Followork](https://www.zhihu.com/people/fengkongjun)

MT4跟单与返佣系统开发

136 人赞同了该回答

风控作为金融企业的核心，承担起了非常重要的角色。其涉及到的工作包括业务审查、风险监测以及业务综合管理。首先，需要风控的企业分为很多种，银行、小额贷款公司、互联网金融企业等等；其次，风控的方向也有很多种，审查、数据分析、建模或者是做产品等等。这里，我主要聊聊在银行内部做风控的感受与体验：★★★ 01 ★★★在风控人的基础素质中，你必须具备的一个能力是，在非常短的时间内，熟悉和了解一家企业，甚至是一个行业。这对一名风控人的要求有多高呢？举个例子，今天突然上报了一笔“两权”抵押贷款，作为国家正在试点，还未正式发文的贷款政策，我们能查阅的案例和法律制度都非常有限。而农业本身是一个非常广的行业，申请“两权”抵押贷款的客户，可能从事的是柑橘种植，也可能是生猪圈养，我们根本很难做到提前对这些每个行业都非常了解。所以，要求我们必须具备短时间，快速了解一个行业的本领，甚至，我们所抓住的核心，是一直从事这些行业中的人，都没有发现的风险。就以房地产行业为例，前几年，房地产行情大好之时，我们经常看到很多房地产开发商，囤地不开工，坐等地价上涨。然而，根据我国《闲置土地处置办法》，土地闲置满两年，政府是有权无偿收回的。这些风险，你会在研究这个行业的时候，通通挖掘出来。这里科普一下，“两权”抵押贷款，是指农村承包土地的经营权和农民住房财产权，是国家试点的最新信贷政策，目前尚未在全国推广。所以，在做风控的期间，只要你愿意去学习、愿意去积累，你可以在很短的时间，对一个行业有深刻的了解，对这些行业中的企业也了如指掌。你能够通过不断的积累，沉淀非常多的知识，无论你谈到哪个行业，你都能马上道出其行业的风险和当前的现状，以及行业的盈利水平，以及企业的运行模式。★★★ 02 ★★★第一点中提到的是做风控最初级的阶段，也是积累经验和能力的重要阶段。当我们的知识储备达到一个全新的层次，我们需要追求的就是风控的第二个阶段，做风险监测。说实话，大数据风控为我们提供了一个非常好的工具，让计算机帮我们去识别风险和监测风险。减少了人为风控的主观性和道德风险。但是，即使再过10年，大数据风控也很难取代一个有经验的风控人对一笔贷款的风险监测能力。举个例子，同样一笔贷款，通过大数据分析得出的结论，可能贷款客户和为该笔贷款提供担保的客户，不存在关联关系。但是，经过风控人员对蛛丝马迹的剥丝抽茧，发现，担保人中的一个股东和贷款客户中的一个股东是亲属关系，并且此二人在两家公司都是大股东。但是，在业务上，确实没有发生过关联。这是目前，我们利用计算机还无法办到的。当然，随着我们数据的完善和算法的优化，我们利用大数据的风控手段，可能会达到这一步，甚至更为先进，但是这一切还不是今天。这在下面一点，我会讲到。所以，一个有经验的风控人，甚至在看完一笔贷款的基础资料后，就能对该笔贷款有一个大致的印象，能做或者风控巨大要控制，心中都能有大概的想法，再通过蛛丝马迹，去验证，其实风控就像是游戏“找茬”，是站在企业角度规避风险，找出贷款的风险隐患。如果，你能够达到这一步，恭喜，你已经是一名优秀的风控人了。但是，同时，做到这一步的风控人会有一个职业病——对很多事物都会持怀疑态度，直到找到证据，证明其合理性。关于这个职业病的好处也有，不容易被骗，而且对待事物都有自己明确的观点，不容易模棱两可。★★★ 03 ★★★关于风控人的综合能力，一方面是对已有的贷款客户进行分析，也就是我们常说的数据处理能力，统计分析能力。最近两年衍生出了一个很多的风控岗位：风控建模。这就涉及到，我在第二点中提到的，大数据疯狂的崛起。风控建模，一般要求是具有一定风控经验，并且有比较扎实的编程基础和统计知识的综合性人才进行担任。强大如阿里巴巴、百度、腾讯等，都在开始布局大数据风控，芝麻信用推出的芝麻信用分，腾讯信用分等等，其使用的信用评分体系，其实就是大数据风控的一次成熟的商业运用。在未来的数年时间中，更优的风控模型，风控算法会不断迭代生产，不断优化更新，直至如同阿尔法狗一样，超越大多数围棋高手。到这一步时，既是风控行业的机遇，也是风控人的挑战，如果不能更新自身的价值和综合能力，迟早会被人工智能所淘汰。要想活下来，我们必须掌握计算机达不到的一种方式，就是复合能力，我们目前的程序包括未来的程序，算法与算法，模型与模型间要想建立起桥梁，打通关节，是很困难的，但是人却可以，我们可以成为两种人：第一种是制造算法和模型的人才；第二种是每个领域都有所涉及，都能复合的人才。在未来的风控大数据体系建设过程中，唯有此二种人才不会被淘汰。**关注微信公众号：\*风控君（sunedu）\***
**回复“信贷” 赠送 450M 信贷知识电子图书 回复“经济” 赠送 700M 宏观经济研究报告 回复“行业” 赠送 1.2G 《行业分析研究报告》 更多精彩内容，可查看历史消息！**

[发布于 2017-02-22](https://www.zhihu.com/question/31845457/answer/147937837)

赞同 1366 条评论

分享

收藏感谢收起

[![Judy](https://pic3.zhimg.com/v2-d685d9a7fb23e35d68496e00803741e0_xs.jpg)](https://www.zhihu.com/people/judy-39-77)

[Judy](https://www.zhihu.com/people/judy-39-77)

风控/电商/支付

[知乎圆桌精选 · 欢迎来到风控时代前往圆桌](https://www.zhihu.com/roundtable/risk)

19 人赞同了该回答

我做电商风控的，就是所谓的审核用户交易，行为。刚开始做跨境风控，你会发现我们经常所说的“土耳其”大骗子并不是一句玩笑话。所有的经验都是通过一定的数据反馈出来的。不是说我们人为的进行地区，人种等诋毁。你是因为一定规律才会导出一个结论。而当这个结论“满城风雨”的时候，那就真的代表问题所在。随后转做国内流行的商户风控。与跨境相比，商户风控流程上更加复杂些，但原理想通。你会更加关注商户的“套利”现象。进而从不同维度去监控拦截。目前来讲国内还没有一套完整的关于第三方平台或者自营的to B,to C风控系统可以直接使用。所以在系统结构、技术上需要建模师去建立包括关联系统等在内的模型。风控是制动器，同时又是润滑剂。结果导向要跟着公司整体战略政策走，这是毋庸置疑的。针对风险事件，我们及时给予制动，但同时促销，给行业树信登公司行为，又会直接影响到你原本设定的风控结果操作。面对外行的指责无原则，你其实更懂什么叫张弛有度。但整体上来说，我们是要刹车>惯性。点在“控”身上。说到转行，你的风控原理是相通的，所以只要是电商模式，行业不是重点，只不过你需要设定的具体维度要有所调整。要适应当前行业的实际情况。

[编辑于 2017-07-26](https://www.zhihu.com/question/31845457/answer/203921048)

赞同 1910 条评论

分享

收藏感谢

[![logo](https://pic3.zhimg.com/v2-3bc45423e63a6e35df0e72a19777d636.jpeg)美摄科技-SDK](https://www.meishesdk.com/editsdk)

广告



不感兴趣[知乎广告介绍](https://www.zhihu.com/promotion-intro)

[美摄SDK-专业短视频解决方案服务商-短视频SDK北京美摄网络科技有限公司，是一家专注于移动端视音频SDK自主研发的解决方案提供商。服务内容包括移动端视音频图像智能处理、识别以及深度学习等，服务领域涵盖移动APP、智能手机、智能硬件、广电及通信运营商等行业客户。查看详情](https://www.meishesdk.com/editsdk)

[![颜城](https://pic3.zhimg.com/1c394c28f_xs.jpg)](https://www.zhihu.com/people/yan-cheng-17-64)

[颜城](https://www.zhihu.com/people/yan-cheng-17-64)

金融，计算机

60 人赞同了该回答

做风控是一种什么样的体验？个人觉得就是反人类，我认识的绝大多数人，做过多年风控的人，都会有一些职业病。
那就是对于所有人都会保持怀疑的态度，任何事情都会喜欢交叉检验。
因为贷款所放出的就是钱，我们会考虑到所有的因为客户企业本身，客户的道德情况，口碑，客户可能出现的任何违约情况，所以对于人性，是会有很多怀疑。我11年开始做风控，接触了大量的中小企业家，听着这些老板神吹海聊，也是一件非常有意思的事情，然后被动的会了解很多行业，了解行业的上下游情况，了解企业如何盈利，成本，了解老板到发家史，然后就是通过企业财务报表了解企业实际的情况。而这些经历会极大的帮助个人的成长，对于这个世界，对于企业，对于人性，对于各种老板，了解他们真正的生活状态，了解他们到发家史。风控几年，经过数百上千的企业，也看到过不少身价上亿的老板，被人逼的跑路跳楼，也看到过开着800万宾利慕尚的老板，却拿不出5万出来还贷款。这种人生经历，使得人能够更加沉重。

[发布于 2016-03-23](https://www.zhihu.com/question/31845457/answer/92040354)

赞同 6025 条评论

分享

收藏感谢

[![大武汉的阿丁](https://pic4.zhimg.com/f93df7b0b643c23a40b0b02fa98b8a34_xs.jpg)](https://www.zhihu.com/people/a-ding-91-10)

[大武汉的阿丁](https://www.zhihu.com/people/a-ding-91-10)

套路与反套路者，肚腩变大者。

57 人赞同了该回答

看到前面个回答说“反人类"的，一口水差点没喷出来，赞。大概刚毕业入行不久，我审批的一个金额较大客户逾期了，一直由我跟进，逾期很长时间后突然又主动联系到我说还款，并讲了很多他在贷款期间的事，故事梗概大概就是如何包装——人真心实意做事业的人，钱也是真实用于生意，但被动、主动地为了贷款做了很多”不好的事“——被各方面角色一步一步带到高利贷的坑里，从一个意气风发的小企业主变成众叛亲离、声名狼藉的“老赖。最后躲债同时也是催债几个月终于收回货款过来结清，钱还了后和我说句“你们干的是什么事！”这种故事其实很平常，但我是从那时才感受到一种来自这个行业的恶意。
这个客户开始来贷款时提交的资料看上去资质不错（后来也承认配合业务员了做了手脚），但面谈中我明显感觉他实际不需要那么多钱，月供会很吃力。我反映上级建议降额被拒绝，因为客户符合放款要求，最终按”流程“放款了。业务员随后又在等待放款期间带其走了另外几家小贷公司，并抽取了相当高的佣金。后来我才知道，审批人员的每一个“建议（降额、追加担保等）”都会被业务员作为理由向客户收取“操作费”，有些客户最终可能会承受高达30%甚至更高的手续费，还不包括利息在内，而客户从始至终都被业务员或同行告知这是“流程需要，而我，是帮你搞定流程的人”。果然客户撑了没两个月开始逾期，剩下的事就是各家公司的猛烈催收，家人、朋友、同事只要能查到有关系的人电话被轮番轰炸，家门口和公司被贴满催款单，时不时还有“道上的朋友”蹲守，客户老婆接了电话就说已经离婚，后来直接带着孩子回老家了，客户本人索性也把公司关了跑外地去追货款了。而这些，都是按“流程”来的，风控员们用各种方式、扮成各种角色——律师、警察、法院、混混——打电话给客户及其联系人，病态的用各种语气——安慰、劝说、激怒、讽刺甚至辱骂——催客户还钱，然后，按部就班的将案子从一个团队转移到另一个团队继续下一轮。所有人都在按“流程”办事，欠债还钱，天经地义，可怜之人必有可恨之处，谁也没有觉得有什么不对，哪怕这个过程中自己展现了自己最阴暗、最刻薄、最虚伪的那面，哪怕名校毕业的同事们像流氓一样提起电话就开骂或者欺骗，读过的书、受过的教育都成了挖苦、编造、恐吓的资本，总之，谁也没有觉得不对，下了班依然是风度翩翩、亮丽光鲜的金融从业人员。有时我就想，如果当时我坚持少放点款给客户会怎样？没有用，他仍然会在其他地方贷款，并盲目觉得自己还钱能力没问题。审批人员能做的事看似很多，其实很少，改变不了利益面前人性的展现。而业务员们会处处尊敬你，讨好你，友善的执行你每一个“建议”，转过身就又多一个借口和客户谈“操作费”。所以说，题主问的“做风控工作体验怎么样？”，我的回答是没有什么特别的体验，和任何一种后台工作一样，都是按“流程”工作，拿着辛苦工作得来的工资，做着属于这个行业的“恶”，可能只有那么一会儿才会问下自己“我是在干的什么事？！”，然后继续埋头工作，就像睡梦中的人惊醒后又继续沉睡过去。

[发布于 2017-01-04](https://www.zhihu.com/question/31845457/answer/139103268)

赞同 577 条评论

分享

收藏感谢收起

[![电眼看金融](https://pic1.zhimg.com/v2-75341f20de52ce41b60c5c85e7e1bda9_xs.jpg)](https://www.zhihu.com/people/dian-yan-kan-jin-rong)

[电眼看金融](https://www.zhihu.com/people/dian-yan-kan-jin-rong)

股权投资

18 人赞同了该回答

哈哈哈哈确实是反人类啊！~我来说一说私募股权投资的风控~风控的目标具体讲就是财务真实性、盈利预测的可靠性、财务规范及上市方案这三方面。财务真实性，就是要挤掉财报中的水分，再现企业真实面貌，尽最大可能消除信息不对称，为业务分析、价值判断及投资估值打好基础。盈利预测的可靠性，就是要结合行业发展规律和竞争态势，多场景、多角度分析企业的成长路径并定量化，做到定性、定量上的准确。财务规范及上市方案，就是从成本效益角度出发，结合上市要求，规范企业实际运营中存在的一些不规范的财务问题，同时对企业的上市工作进行全方位的辅导与帮助。具体到做什么，一般在成熟的股权投资机构，风控工作贯穿于项目立项、尽职调查、评审、投决、投资、投后各个环节。立项主要是根据预研报告决定是否展开现场尽职调查。尽调主要从业务和财务两方面展开，包括识别关键点、内外部访谈，准备尽调报告等方面内容。项目尽职调查报告完成后进入两轮评审环节。初审中会组织深入探讨，全面分析项目价值及风险，并结合评审结论决定是否需要补充尽调。如需补充，项目组会重返现场对上一轮评审中的关键问题进行补充尽调，并修改完善尽调报告，只有这样方可进入第二次评审环节。这一环节再次对项目价值、风险进行定性定量分析、讨论交易结构和关键交易条款，并提交方案至投资决策委员会，最后投资决策委员会对项目整体进行回顾、讨论和决策。最后，投资环节专职法务人员会对交易的各项条款进行专业把控。一直到投资完成后，风控定期对已投项目进行复盘，并根据复盘情况对企业发展提供合理化建议。

[发布于 2017-06-22](https://www.zhihu.com/question/31845457/answer/187445964)

赞同 181 条评论

分享

收藏感谢

[![纸上光阴](https://pic4.zhimg.com/v2-bed10b84d714998aa946562d7d1ed6e9_xs.jpg)](https://www.zhihu.com/people/yaya-44-15)

[纸上光阴](https://www.zhihu.com/people/yaya-44-15)

公众号：纸上光阴。用文字记录生活，陪你到时光深处

8 人赞同了该回答

风控要解决的核心问题：1、平衡好风险和资产规模（一般指在贷余额或AUM）2、平衡好机器和人的作用换个角度，风控是通过一系列的手段实现收益最大化这个终极目标。那么风控一般的流程是怎样的，常用到哪些方法或手段呢？![img](https://pic4.zhimg.com/80/v2-8c2fdbff6eef92166e93fd1f9a280ba3_hd.jpg)图1: 风控的一般流程一般来说风控会参与到整个产品的运营过程中，包括前期产品设计和重点的贷前贷中贷后工作行业研究&设计产品：这是风控工作的基础，首先要进行行业研究，了解用户的需求、痛点，了解竞品情况，了解客群的特点、风险点，完成客户初步画像，并相应的设计产品的额度、利率、期限、准入门槛、规则、模型的细节。对于较多风控从业者来说，这一步可能为直接参与过，当产品已经形成，行业研究和设计产品可能不直接参与，但一般在之后的工作里会间接优化和迭代产品。贷前审核：是风控的第一道防线，主要防范客户的信用风险和欺诈风险。信用风险简单说即客户有没有能力还款，欺诈风险简单说即客户愿想不想还款。贷中监控：涉及搭建监控体系，通过不同维度各类指标监控贷款表现，并通过数据分析调整策略优化产品，和及时做好预警工作为贷后管理做好准备。贷后管理：主要涉及资产的收回，只有将放出去的钱收回才能真正赚钱，主要涉及催收工作，催收方式各种各样，电催、上门催收等。风控中的每个环节都涉及到很多有趣而细致的工作，从事风控的人每天在做什么其实千差万别，不同的岗位职责定位可能完全不同。比如信审人员通常负责客户资料的完整性、真实性审核，要求细致耐心，但相对枯燥。人工审批人员一般通过核实本人或三方电话来控制风险，要求了解产品的风险点、客户可能存在的欺诈或异常行为。风险策略分析师主要负责策略制定和优化，一般要求熟悉行业和客群特点，熟悉各类可能存在风险的行为，最好具备一定的数据分析能力，通过数据调整策略。催收人员是大家比较熟悉的工作，主要负责贷款的催回，目前由于信贷业务爆发式增长，该岗位挺缺人的，好的催后讲究方法和心理战术，也是需要一定的技能的。

之前就风险策略分析师涉及的工作内容有专门拿出来说过（[风控是个有趣的工作（一）](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzU3MTU4NjQwOA%3D%3D%26mid%3D2247483722%26idx%3D1%26sn%3Da2910b42e7bc547140369e09da6421f1%26chksm%3Dfcdca34dcbab2a5b1d0d6dc92832197972df5f895596f5eafff903494fc1403cc6ff20ff9647%26token%3D1800915663%26lang%3Dzh_CN%23rd)），非常有趣和值得思考。比如为什么要年龄要介于18~60岁为什么有些省份直接拒绝做为什么一定要抓取客户的运营商数据以及我怎么才能更大概率申请下贷款~其实风控不仅是个技能，有时也要有一定的心理学知识。

[编辑于 2019-12-05](https://www.zhihu.com/question/31845457/answer/545770907)

赞同 81 条评论

分享

收藏感谢收起

[![pareto](https://pic4.zhimg.com/da8e974dc_xs.jpg)](https://www.zhihu.com/people/tian-abm)

[pareto](https://www.zhihu.com/people/tian-abm)

注册会计师、法律从业资格、券商私募子风控

4 人赞同了该回答

从最初两周否一个IPO项目撤场，到3天否一个股权投资项目，到2小时否一个世界名校投资经理2周的尽调。然后就是反人类的左手接电话右手就知道这家公司啥背景做得咋样变更历史然后就拒绝去面试。朋友聊天也忍不住查他公司背景他的背景。或者虽然去面试了，但是要么就变成了面对方，要么就是被问如果你的领导或同事专业能力不如你你是不是balabala~再然后想回业务动不动就被质疑不能这么细这么较真，不能完美主义倾向~然后眼睁睁看着好项目业务人员推不下来，眼睁睁看着业务部门被裁撤，眼睁睁看着公司乃至风控部门被裁撤~然后需要风控的单位太少，风控失业转业务转财务的好多。

[发布于 2018-04-28](https://www.zhihu.com/question/31845457/answer/378254243)

赞同 41 条评论

分享

收藏感谢

[![小凉菇](https://pic3.zhimg.com/3629d4c4fdec534683bac7a24eb740a4_xs.jpg)](https://www.zhihu.com/people/zhang-ji-37-83)

[小凉菇](https://www.zhihu.com/people/zhang-ji-37-83)

9 人赞同了该回答

对于我，自己有一个风险闭环图，针对每一个case让公司明白有哪些风险，我们可以怎样做转嫁风险。再说点体验方面的事，至少在商业保理公司，风控的重要程度很大比例要看公司高层的经营策略和风险偏好，因为你需要跟业务部门的同事pk的情况一定是经常存在的。

[发布于 2015-07-25](https://www.zhihu.com/question/31845457/answer/56391463)

赞同 95 条评论

分享

收藏感谢

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

12 人赞同了该回答

在小贷公司做副理的，订了门拒规则底线，主任客户经理都嫌太严格，闹着要离职，经理怕人员流失，最后推翻了这个门拒底线。各个公司的客户经理之间甩单甩的特别严重，找到一个资质差不多的客户，业务经理恨不得把所有小贷公司都做个遍。门拒一个客户，客户经理恨不得用眼神杀死我，主任和客户经理在背后不定怎么说我。每天早上8点半上班，后线天天加班到8点半以后，有时候甚至到晚上10点，双休日也要过来加班录单签约。心里面的委屈和无奈太多了，为了每个月的业绩指标，明知道这个客户风险太高了，还是会放款，心里面默默祈祷多还几期再冒出来就好。关键是每天这么辛苦的工作，换来的只是经理、主任和客户经理的埋怨，太心酸了。。。

[发布于 2015-09-18](https://www.zhihu.com/question/31845457/answer/64199085)

赞同 1213 条评论

分享

收藏感谢

[![周不二](https://pic4.zhimg.com/v2-0038dfd8c2b54884b41a81cf777bcd04_xs.jpg)](https://www.zhihu.com/people/zhou-bu-er-12-94-17)

[周不二](https://www.zhihu.com/people/zhou-bu-er-12-94-17)

1 人赞同了该回答

PE风控 离职两个月 准备转行做投资
分前中后期说吧
前期就是杀猪的 再好看的猪脚也要肢解个体无完肤 把整个企业包装撕掉 真实的一面摆在眼前 多数企业这个时期就被pass掉了 原因无他 就是丑 ………
中期就是投后管理期基本就是牧羊犬… 羊不听话了就喊两嗓子疼 遇见狼了解就上去咬 基本到了这个时期 风控特别忙
清算期 的风控反而好做一些 无非就是继续包装下企业 转手扔给另一波人
总体来说 风控啥都要当就是当不了人…

[发布于 2018-11-05](https://www.zhihu.com/question/31845457/answer/525299364)

赞同 11 条评论

分享

收藏感谢

[![决战FRM-Eason](https://pic4.zhimg.com/ab8ee7fd17be29a4d8f246961020223f_xs.jpg)](https://www.zhihu.com/people/jue-zhan-frmeason)

[决战FRM-Eason](https://www.zhihu.com/people/jue-zhan-frmeason)

7 人赞同了该回答

风控工作也得看你在哪个行业哪个部门的，比如银行风险监控：所谓风控，一般指对贷款户及信用卡的风险控制。 贷前监控： 主要是对申请方资产、征信、个人进行调查取证 。贷中监控： 发放贷款后与其频繁接触 及时把控其可能出现的问题回收贷款。
做风控工作，手里没有个FRM证书怎么行呢！！考个FRM证书，才更会被认可。

[编辑于 2015-07-10](https://www.zhihu.com/question/31845457/answer/54545648)

赞同 711 条评论

分享

收藏感谢

[![logo](https://pic3.zhimg.com/v2-fc8b414f313135c0f9d2066fdecf190e_250x250.jpeg)腾讯云](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168748.3168748.3168748&utm_medium=cpc&utm_id=gwzcw.3168748.3168748.3168748)

广告



不感兴趣[知乎广告介绍](https://www.zhihu.com/promotion-intro)

[腾讯云12月专场活动：1核2G云服务器99元/年，爆款秒杀中腾讯云热门云产品限量特惠秒杀，多种机型限时抢购，入门级爆款1核2G云服务器，适用于web、小程序及App开发等场景，首年99元，年末钜惠！查看详情](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168748.3168748.3168748&utm_medium=cpc&utm_id=gwzcw.3168748.3168748.3168748)

[![李伟康](https://pic3.zhimg.com/v2-a2e9253dcdacb44378cc1b97f1c68a01_xs.jpg)](https://www.zhihu.com/people/kangdiao)

[李伟康](https://www.zhihu.com/people/kangdiao)

信贷善后体力工作者，风控民工，职业病-怀疑一切，包括自己

8 人赞同了该回答

本人小贷公司两年多风控经验，公司名字就不说了，公司还算是规模比较大的。主要说一下工作内容，本人从入行外访开始一直晋升到门店风控，外访不用多说，每天上门考察客户实际情况，听老板们胡吹乱侃，当然，不排除有客户情况确实不错的（小贷行业认为的不错），然后回去反馈情况。值得注意一点的就是，整套流程下来，懂行的老板会给你塞好处费，让你回去说好话，潜规则大家都知道，其他人收不收我就不多说了，反正我没收过（做这行的原则），后来小贷这行就取消了上门，至于为什么大家都清楚。重点说一下门店风控，做了门店风控才是你怀疑人生的开始，引用一句“**对于没有实际风控机制外加老板胆识过人的公司，风控就是负责善后的体力工作者**”（ *href="[https://www.baidu.com/link?url=0Yd-EM4I664bCK6Tc255-ryKDAiPGUlVjy5cwWqSE29zGW1NSrgviOZw6ht9rV1k&wd=&eqid=ea6d77c4000567d800000006594aa488](https://link.zhihu.com/?target=https%3A//www.baidu.com/link%3Furl%3D0Yd-EM4I664bCK6Tc255-ryKDAiPGUlVjy5cwWqSE29zGW1NSrgviOZw6ht9rV1k%26wd%3D%26eqid%3Dea6d77c4000567d800000006594aa488)">风控人员负能量段子,看完整个人清爽多了!）***侵权请联系**，做这行你坚持原则，拒绝风险客户，业务端会说你影响公司业绩，动不动就各种谈话，各种电话，各种强制要求你把客户提交放款；客户逾期了，追究责任会问你为什么没有及时发现风险，拒绝客户。门店业绩不好跟你有关系，逾期数据不好也跟你有关系，每一天你都会想：这TM也能放？然后就是无休无止的催回款，再然后就是客户电话不接，客户没钱，客户谩骂，客户投诉。。。总结一句就是**拿着卖白菜的钱，操着卖白粉的心**，直至到你怀疑人生。奉劝一句，如果还没入风控这行的，谨慎！谨慎！谨慎！三思！三思！三思！重要的事情说三遍。风控这一行并没有外人想的那么风光，而且业内还有各种潜规则令你怀疑自己究竟适不适合做这一个岗位，这里就不方便展开描述了。
最后想了想还是不匿了

[编辑于 2017-06-22](https://www.zhihu.com/question/31845457/answer/187251667)

赞同 823 条评论

分享

收藏感谢

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

8 人赞同了该回答

看回答 大多数人都把风控直接等同为信贷风控了，其实信贷的风控只是风控的一部分。不过 职业病确实是有的，我原来学工科的，后来转行做风控，是因为数学基础比较好，目前是做账户安全，跟信贷没啥关系，我说的职业病是我把我所有的免密支付全关了，打滴滴支付宝自动扣款，我打了一天的投诉电话要求他们把我的这个功能关了，坚决不用安卓的手机。设定了各种奇奇怪怪的支付密码。支付的时候，收到验证短信，先看是银行发的还是支付机构发的，然后开始想为什么会给我发短信，然后开始各种改登录密码和支付密码。。。。哎。。。。感觉自己都好烦。

[发布于 2017-07-21](https://www.zhihu.com/question/31845457/answer/201662515)

赞同 84 条评论

分享

收藏感谢

[![米米亚](https://pic3.zhimg.com/v2-fd62f7ce15e66c79e14e5d31411175e6_xs.jpg)](https://www.zhihu.com/people/mi-mi-ya-14)

[米米亚](https://www.zhihu.com/people/mi-mi-ya-14)

尽人事 听天命

6 人赞同了该回答

知乎首答。以前一直是看客=。=
我来讲讲目前比较流行的P2P和B2B或者C2S（反正都差不多吧，大家懂意思就行）这行的风控吧。
怎么说呢。做这行的风控，首先你要摆正心态。因为！！如果你不是风控总监及以上级别的话，你仅仅是一个金融民工而已！！
好了，说正题。1、在必要时候，要为业务开道。金融行业往往都有周期性。不论是银行、P2P、投资机构等等，往往在会因为发展遇到业务瓶颈期或者在每年的特定时候要完成特定指标（比如银行开门红，有的投资公司年底无节操业务）而一定程度的会打破平常的风控规则和标杆，这个时候高层就会弱化风控或者调整风控政策。说大白话，风控这个时候就要给业务低头，但是后期出了大篓子，一样套不了干系。对，就是这样。所以要做好风控，并不是定个大数据模型或者定个准则标杆就了事了，要随着时间、你所在的机构规模要实时调整。
2、良好的社交能力。风控不能靠闭门造车，风控也不能一直在办公室指点江山。鄙人不才，做过P2P和供应链金融的风控。很多刚入门做金融风控的人都有一个误区，只有收到客户材料的时候才开始自己的工作，到这个客户授信完成，就没你什么事了。其实真正的风控，是从营销端接触到客户的那一刻就开始了。一笔信贷业务，贷前，贷中，贷后，处处都是风险，都需要你来把控。和营销端人员保持良好的关系，往往能获取更多客户的真实相关信息。因为在客户眼里，营销人员是在帮他获取这比业务，而风控则是绊脚石。但一定要注意一个度，走太近，不好，因为人无完人，太近太好的关系会左右你的判断；走太远，也不好，天天撕逼吵架被投诉，我想你也不好过。
3、良好的逻辑推理能力，敏锐的洞察力，不要放过任何一个不符合常理细节。这一条真的不是一两句能说完的。在一个合格的风控眼里，任何不符合审查对象行为常理、财务状况、个人/企业发展规律的方面都应该值得深入推敲和怀疑。简单举个例子吧，人生第一笔坏账，是一对小夫妻，女方出来借钱，当时去的时候已经怀孕5个月了，其他一切正常，男方是公务员、人大代表，有房有车，征信完美，女方经营犬舍。当时我最大的疑点就是，是什么原因驱使一个女人，挺着5个月的大肚子出来借钱呢？当时一方面是自己经验不足，一方面也是因为比较忙。这一点忽略了。回头自己再来审查这个客户的时候，自己也发现了很多疑点和漏洞。这个客户已经过去几年了，虽然过去几年了，如果换做今天的自己来重新审查，自己摸着良心，还是会有50%会给她放款的。风控这一行，最怕的就是自身条件处于中等偏上，但是往往已经一屁股债或者就是过来欺诈骗贷的客户了。因为这类客户，融资渠道多样且融资能力强，一不留神，就扑街。
4、少说多做。这个就不多说了，做过的都懂。
一个好销售，不一定能做一个好风控。一个好风控如果去转行做销售，他一定是个好销售。

[发布于 2018-06-07](https://www.zhihu.com/question/31845457/answer/411536385)

赞同 6添加评论

分享

收藏感谢收起

[![风控是个坑](https://pic3.zhimg.com/v2-874faf6684618fa4026212c3ae4af8ca_xs.jpg)](https://www.zhihu.com/people/iceking)

[风控是个坑](https://www.zhihu.com/people/iceking)

公众号：风控是个坑

5 人赞同了该回答

做时间长了会有疑心病，对谁都不相信，对谁都持怀疑态度，职业病还是挺痛苦的，虽然没做多久但已经有这种感觉了，有时一不开心TMD连自己都怀疑

[编辑于 2016-07-11](https://www.zhihu.com/question/31845457/answer/110474257)

赞同 58 条评论

分享

收藏感谢收起

[![杭州有盾](https://pic4.zhimg.com/v2-48004c29f384a3600fa3afd4481ca89d_xs.jpg)](https://www.zhihu.com/org/hang-zhou-you-dun-94)

[杭州有盾](https://www.zhihu.com/org/hang-zhou-you-dun-94)

全球KYC身份认证云平台

做风控当然难了，因为一个不小心就容易让资产打水漂。并且像我们这样为金融客户提供风控服务的，做好风控的每一关是真的辛苦！！！比如，我们得做好前端的客户身份识别，保证人证合一，身份信息真实。但是，有很多不法分子竟然拿着这样，这样，这样的图片来蒙混过关。![img](https://pic1.zhimg.com/80/v2-c89b655165bcf4411702b8ca899a4a32_hd.jpg)幸好我们的设备可以实现活体检测，不然真的要被他们逃过去了。再比如，很多人聚集在一起设法一起到各个软件上借用资产，他们的手机上有一堆软件，这些软件被他们称为“口子”，这些都是他们的“钱口子”“钱口袋”。针对这群人，我们的风控模型已经可以快速准确识别出这群人，及时提醒客户，挽回损失。此外，我们还针对具体的金融应用场景上线了电子签名系统，在商户和用户达成一致时，签署电子合同，进一步保障商户和用户的合法权益。所以，为了做好风控，我们真的时绞尽脑汁！

[编辑于 2018-11-14](https://www.zhihu.com/question/31845457/answer/531392619)

赞同添加评论

分享

收藏感谢

[![一哈](https://pic2.zhimg.com/821f408883ec83dbf8556859e519b382_xs.jpg)](https://www.zhihu.com/people/yiha-76)

[一哈](https://www.zhihu.com/people/yiha-76)

贵乎乙烷

1 人赞同了该回答

控得住的总是少数。不怕有风险，就怕不知道哪里有风险。

[编辑于 2018-02-10](https://www.zhihu.com/question/31845457/answer/316083166)

赞同 1添加评论

分享

收藏感谢

![知乎用户](https://pic4.zhimg.com/da8e974dc_xs.jpg)

知乎用户

10 人赞同了该回答

对于没有实际风控机制外加老板胆识过人的公司，风控就是负责善后的体力工作者——来自隔壁产品狗

[发布于 2015-07-03](https://www.zhihu.com/question/31845457/answer/53700856)

赞同 10添加评论

分享

收藏感谢

[![kmatom](https://pic2.zhimg.com/9f1b64b1c137281c627e3c5c30b646a1_xs.jpg)](https://www.zhihu.com/people/kmatom)

[kmatom](https://www.zhihu.com/people/kmatom)

多行业嫁接银行风险控制

2 人赞同了该回答

市场好做问题贷款多时重视风控，市场难做风控被教育。看领导风格和市场大环境及所在就职地点的风险文化。大行和股份制就区别很大

[发布于 2015-07-21](https://www.zhihu.com/question/31845457/answer/55880530)

赞同 2添加评论

分享

收藏感谢收起

[![Sunallies](https://pic4.zhimg.com/v2-b4e477952867f3979706a8d05ede6d87_xs.jpg)](https://www.zhihu.com/people/xiao-xiao-26-71-91)

[Sunallies](https://www.zhihu.com/people/xiao-xiao-26-71-91)

4 人赞同了该回答

现在信贷风控主要应该包含**产品、流程设计、面审、反欺诈、终审、催收、贷后管理、数据支持、内控、法务**这几类具体的工作。每种工作的功能不同，所需要的技能也各不相同，我建议如果对风控真的感兴趣又有合适的机会的话可以把这些工作都尝试一遍。然后找到自己真正适合又愿意深入钻研的。不过P2P或者小贷的风控的具体工作实际上确实比较简单、入门，唯一比较有技术含量的就是信用评分卡了，这个涉及到比较多的应用统计以及数据分析的知识，还要会编程建模，这个需要大量的知识沉淀以及思考问题方式的培养，是风控进阶的一个发展方向。然后还可以从产品上进行拓展，除了最为简化的个人、小微信贷产品以外，还有企业债权产品、供应链金融，如保理、资产收益权转让、应收账款转让、融资租赁，还有活期理财的现金流风控，甚至是涉及股权的众筹等等。每一种产品的风控都有不同的侧重点，里面会涉及大量的金融、财务、法律知识。所以风控的范畴非常之大，去接触不同的金融产品也是风控进阶的一个发展方向。

[发布于 2017-02-22](https://www.zhihu.com/question/31845457/answer/147880312)

赞同 4添加评论

分享

收藏感谢收起

[![logo](https://pic3.zhimg.com/v2-fc8b414f313135c0f9d2066fdecf190e_250x250.jpeg)腾讯云](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168745.3168745.3168745&utm_medium=cpc&utm_id=gwzcw.3168745.3168745.3168745)

广告



不感兴趣[知乎广告介绍](https://www.zhihu.com/promotion-intro)

[买一台云服务器到底能干什么？腾讯云热门云产品限量特惠秒杀，多种机型限时抢购，入门级爆款1核2G云服务器，适用于web、小程序及App开发等场景，首年99元，年末钜惠！查看详情](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168745.3168745.3168745&utm_medium=cpc&utm_id=gwzcw.3168745.3168745.3168745)

[![ke ni](https://pic1.zhimg.com/bea2468a8bfa47bf3042e1c714c3f046_xs.jpg)](https://www.zhihu.com/people/ke-ni-82)

[ke ni](https://www.zhihu.com/people/ke-ni-82)

法律小民工。

2 人赞同了该回答

刚开始很痛苦，做得严格吧，和客户经理矛盾不断，经常被打报告。不严格吧，又提心吊胆（一方面出现不良风控会被追责，另一方面要尊重自己的工作）。现在调整过来了，反正做自己的风控，让其他人说吧，得罪人总比出现不良好！

[编辑于 2015-07-26](https://www.zhihu.com/question/31845457/answer/56554047)

赞同 22 条评论

分享

收藏感谢收起

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

2 人赞同了该回答

风控工作累！互联网金融风控更累！！要严防老赖，所以要把每一个客户的资质查清楚，这点很重要。可谓降低风险吧。提到查资质，那么怎么查，用什么查就很重要了，大家有什么好的查询工具可以分享吗？（除了小思机、甄查查）

[发布于 2019-05-05](https://www.zhihu.com/question/31845457/answer/673203074)

赞同 2添加评论

分享

收藏感谢

[![BinY](https://pic4.zhimg.com/da8e974dc_xs.jpg)](https://www.zhihu.com/people/robin-yu-54)

[BinY](https://www.zhihu.com/people/robin-yu-54)

互联网/电子产品/消金/风控

1 人赞同了该回答

风控应该是在非黑既白的边界，如何判断是黑，如何归为白，是风控的主要工作。根据不同时期的环境、政策、发展目标要求确定规则。
电商的风控和银行的风控差别很大，配合公安办案确是大家都有的工作

[发布于 2018-02-10](https://www.zhihu.com/question/31845457/answer/316078068)

赞同 1添加评论

分享

收藏感谢

![知乎用户](https://pic4.zhimg.com/da8e974dc_xs.jpg)

知乎用户

看了基本上所有评论，感觉银行和互联网两极分化。

[编辑于 2018-03-16](https://www.zhihu.com/question/31845457/answer/343265925)

赞同添加评论

分享

收藏感谢

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

风险控制的范围非常大，前面所有谈到的风控，基本上是信用风险控制，当然这是最重要的部分，其他风险，看企业怎么定义，大企业如果有几十种风险需要控制的，不会感到奇怪。工作体验的好坏，其实很风控内容关系不大，而是和公司文化，老板性格有很大关系。我们公司的风控，千亿级别吧，大家工作得都很开心，为公司连续工作20年，30年的人不少。

[编辑于 2018-02-26](https://www.zhihu.com/question/31845457/answer/328291066)

赞同2 条评论

分享

收藏感谢

[![光光](https://pic1.zhimg.com/v2-aa38a5660e655167f405750a88542300_xs.jpg)](https://www.zhihu.com/people/yang-guang-de-xiao-xian-nu)

[光光](https://www.zhihu.com/people/yang-guang-de-xiao-xian-nu)

没有简介

谢邀，毕业三年半，入行三年，我来说说信贷公司的风控吧。刚开始做风控会搞得你怀疑自己，怀疑人生。刚开始我们是自己的客户自己审核递交总部审批，审批通过后金额和期限无法更改，也就是说邀请客户来公司签约只有两种结果，放款或拒贷(当然你要拿出十足的理由来，还要面对业务员，团队经理，有时甚至门店经理的各种说辞)，也就是说你不能觉得客户还款能力不足以偿还月还而降额，这就导致本来普惠金融是皆大欢喜之事(非骗贷)，最后却形成了放款容易催收难的现状。所以做信贷客户是很没有实权的一个岗位，明知道客户还款能力不足还是要放款，因为经信审审批的客户没有那么多资质特别烂的，多的是一瓶子不满半瓶子晃荡的，so 只能放任结果的发生。而且前期由于经验有限，挖掘客户情况不够彻底，真的就3期6期就不还款了，有的是。所以做风控还要有良好的心理素质。还好后来去了总部，专门做风控了，不用再给客户面谈签约催收了。综上所述，做风控就是个操心费神的活，一开始觉得接触各行各业的人比较新奇有点意思，后来也就跟别的工作差不多了，全是套路和规则。就酱。

[发布于 2018-02-10](https://www.zhihu.com/question/31845457/answer/316329145)

赞同4 条评论

分享

收藏感谢

[![冷红尘](https://pic4.zhimg.com/v2-56e2b267a844641bbba573eb0dd2eeed_xs.jpg)](https://www.zhihu.com/people/leng-hong-chen-7)

[冷红尘](https://www.zhihu.com/people/leng-hong-chen-7)

村镇银行评审

风控就是和客户经理斗智斗勇。有时真的是比较烂的客户，客户经理和部门负责人认为肯定有把握住这客户，非要放贷，你拒绝嘛，客户经理难过死好话一堆你拒绝也难为情，批了实在有违原则，有时只能压点额度。主要我们小村镇银行，客户经理和风险部的风控部门太熟了，总之，做风控，评审的，在单位地位还是很高的。

[编辑于 2017-08-14](https://www.zhihu.com/question/31845457/answer/214321439)

赞同添加评论

分享

收藏感谢

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

风控是一个得罪人的活，但是在金融从业中又是非常非常重要的一环，没有风控在这个市场早晚完蛋。可是很多时候又会对风控产生误解，觉得风控就是管好最后的止损点。其实风控在发现问题时候的主动提醒干预也是非常重要的。

[编辑于 2017-09-11](https://www.zhihu.com/question/31845457/answer/184341424)

赞同添加评论

分享

收藏感谢

[![link kof](https://pic3.zhimg.com/v2-1b05276ab39942f354afebaa3de370b3_xs.jpg)](https://www.zhihu.com/people/link-kof)

[link kof](https://www.zhihu.com/people/link-kof)

better to run than curse the road

发现能评估的要素太少了。
授信5p原则，还款意愿，还款来源之类的，换成材料也就十几张纸。
这时候总是觉得，有没有其他可靠的数据可以体现这个人的信用度？
征信还需要完善。。。

[编辑于 2017-05-15](https://www.zhihu.com/question/31845457/answer/162248167)

赞同添加评论

分享

收藏感谢

[![logo](https://pic3.zhimg.com/v2-fc8b414f313135c0f9d2066fdecf190e_250x250.jpeg)腾讯云](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168745.3168745.3168745&utm_medium=cpc&utm_id=gwzcw.3168745.3168745.3168745)

广告



不感兴趣[知乎广告介绍](https://www.zhihu.com/promotion-intro)

[买一台云服务器到底能干什么？腾讯云热门云产品限量特惠秒杀，多种机型限时抢购，入门级爆款1核2G云服务器，适用于web、小程序及App开发等场景，首年99元，年末钜惠！查看详情](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168745.3168745.3168745&utm_medium=cpc&utm_id=gwzcw.3168745.3168745.3168745)

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

靠天吃饭

[发布于 2015-12-11](https://www.zhihu.com/question/31845457/answer/76308709)

赞同添加评论

分享

收藏感谢

[![giggling](https://pic4.zhimg.com/v2-d240fa8a3c99f17821762ae8f84a63ec_xs.jpg)](https://www.zhihu.com/people/giggling-25)

[giggling](https://www.zhihu.com/people/giggling-25)

helloyoga 互金行业大数据风控

互金风控来答题了～主要是创新吧，工作2年看着7个app做起来（国内5个，海外2个）从风控决策引擎系统的开发需求繁琐的字段整理到贷前-贷中-贷后策略、分析都会做以及财务预测不过现在辞职创业啦感兴趣可以多多交流一些资料也可以分享helloyoga

[发布于 2019-07-10](https://www.zhihu.com/question/31845457/answer/743393016)

赞同添加评论

分享

收藏感谢

[![Angel郭](https://pic2.zhimg.com/v2-ff75e771c348d47d7d39137dc9e3a857_xs.jpg)](https://www.zhihu.com/people/angelguo-69)

[Angel郭](https://www.zhihu.com/people/angelguo-69)

乐趣科普

小贷风控7年，总结出来就是：反人类！背锅侠！

[发布于 2018-11-01](https://www.zhihu.com/question/31845457/answer/523010566)

赞同添加评论

分享

收藏感谢

![知乎用户](https://pic4.zhimg.com/da8e974dc_xs.jpg)

知乎用户

[https://g.alicdn.com/idleFish-F2e/app-basic/item.html?itemid=565054955728&ut_sk=1.WqSLrwUBW6IDAETDG9H9R%2Bb1_21407387_1526540341754.QRCode.detail.565054955728.787154112&forceFlush=1](https://link.zhihu.com/?target=https%3A//g.alicdn.com/idleFish-F2e/app-basic/item.html%3Fitemid%3D565054955728%26ut_sk%3D1.WqSLrwUBW6IDAETDG9H9R%2Bb1_21407387_1526540341754.QRCode.detail.565054955728.787154112%26forceFlush%3D1) (二维码自动识别)

# 小米风控实践

转载[EthanSheng](https://me.csdn.net/u010736419) 发布于2017-03-31 11:08:50 阅读数 10005 收藏

展开

风控系统从0到1的过程，极具借鉴意义



邓文俊，小米高级研发工程师，2013 年加入小米，参与了数据后台，风控系统，支付等系统的研发工作。



我来自小米支付，今天分享的主题是小米风控实践。为什么选风控这个题目？其实在我看来风控对互联网金融来说，风控就像是内裤，每个人都有，但是不会把它秀给别人看。对其他人来说风控是很神秘，今天带给大家看看小米我们怎么是一步步走过来，在风控方面做了哪些工作。 小米风控可以分为三个历程，尝试、发展和扩展。

![img](http://img1.tuicool.com/3y2UZbi.jpg!web)

#### 一、尝试

2014 年的时候我们发行我们米币短信充值渠道坏账率非常高，高到我们几乎赚不到钱。米币像 QQ 一样，是虚拟币，用米币可以在小米生态圈内购买所有服务。短信什么渠道呢？用户用短信发一条短信给运营商，运营商就会从它的帐户里面扣钱转给我们。运营商每个月给我们结一次钱，他会告诉我们有一些帐是坏账，他不会把钱给我们。他也不会告诉你哪些是坏账，哪些是好帐。我们要自己想办法解决坏账问题，让自己有钱可赚。

我们设定两种风控规则，这是第一种规则，我们叫限额、限次、限频规则。设备、帐户、手机号是一个标识类。另外一个纬度是限制类，限制交易范围，比如时间、业务、渠道等等。最后还有限制方法。我们的版本里面一个规则包括三个部分，一个是标识，一个是范围，一个是限制方法。

![img](http://img1.tuicool.com/uAZ7r2Q.jpg!web)

一个帐户一天之内他的消费金额上限是 100 米币。还有一种情况是策略，大家支付都是用手机，这个设备每小时某个业务交易次数可以限制。还有交易的频率，比如一个帐户这次交易跟上次交易要超过，不然很可能是机器行为。一般用户不会频繁交易，除非你是玩游戏非常上瘾，一般不会出现这样情况。

第二类规则限制是标识属性之间的关系，比如我们一般认为一个帐户只会登录到有限几个设备，不会登录太多。反过来能够登录设备也是有性质，要排除测试情况。有了这两个规则之后，我们迅速开始开发，以互联网的模式用了四周就迅速开发，完成了这样的规则引擎在控制台，控制台可以修改规则也可以看到实时效果。开发完了之后我们没有立刻上线，先试运行 2 周，过程是什么？

![img](http://img0.tuicool.com/yEJnayR.jpg!web)

试运行过程中规则并没有真正的生效。只记录一些交易，会被哪些拦截不成功，有了这些数据之后，我们可以条件规则这些顺序以及阈值，使我们的规则达到最佳效果。运行两周之后有信心，才能真正起来。

上线之后的效果，首先上线一个月之后，运营商一个月之后给我们结钱。一个月之后我们才知道我们的风控效果。上线之后我们发现我们的坏账率比之前最高峰的时候低 1/3。比历史上的坏账率低 1/2。我们渠道成本占到 1/2，我们可以赚钱了。我们一个月的收入多了 50% 左右的增长。

通过这次风控实践尝试，我们有一些经验。第一不要小看简单规则，我们开始的时候我们认为最简单，效果相当好。风控是平衡的，我们目标是达到一种平衡。我们的交易额和我们坏账率之间达到平衡，使我们收益率是最高的。为了达到这个平衡，我们需要不断的利用云的手段，分析数据，调整规则，这是我们决定风控成败很重要的关键。

2014 年底，我们有很多小米用户，如何给小米用户打分，可以是信用分，风险分。信用分可以用于信贷，风险分可以用交易时风险控制。数据有限，我们用米币的形式做模型。

![img](http://img1.tuicool.com/byQvmiv.jpg!web)

我们用三个纬度建立模型：

1. **还款能力** ，包括用户最近三个月的消费额、消费次数以及累计消费次数还有他的消费情况。比如他在游戏、阅读、视频等不同业务说消费情况怎么样。
2. **依赖性** ，对小米生态圈多么依赖，会不会上瘾，如果走了会不会很痛苦。我们在依赖性方面选取他的注册时间，活跃度，每天花多长时间，还有他使用 App 的情况，最长使用 App 有哪些，频率怎么样。
3. **正常度** ，我们看这个人绝大部分正常，也有不正常。我们用之前积累，使用等待充值频率，等待有风险。类似这样的属性，我们给用户进行打分，这个是打分的图，横轴是依赖性，纵轴往上是它的还款能力。X 轴是依赖性，Y 轴是还款能力，Z 轴是正常度。

![img](http://img2.tuicool.com/zQnQbaj.jpg!web)（点击图片全屏缩放）

大家可以看到用户分布是非常集中的。我们本来想通过这个图能不能发现一批还款能力、依赖性和正常度都比较高的用户，最后可以做我们的优质用户，作为未来信贷基础。但是很遗憾，我们数据有限，我们没有找到这样的用户。我们只是发现一个事实，我们绝大多数的用户都是还款能力和依赖度很高的正常用户。

#### 二、发展

我们再看 2015 年之后，我们开始了开发自己的第三方支付。我们为小米网、小米生活等小米生态内的其他业务进行金融服务。我介入服务越来越多，我们发现我们遇到的问题越来越多，我们有时候会遇到突发事件，有了方案之后我需要能够迅速上线一些风控规则。因为我们发现每晚一天可能我们的损失都是百万级，希望快速创建风控规则。

业务越来越多，规则越来越多，规则之间的次序都是有严格的要求。制定规则越来越麻烦，越来越容易出错，如何解决这两个问题？我们最后选择了一个开源 Drools，第一它是开源可以免费使用，第二它是 Java 可以很方便扩展，开发自如，进入自己的系统，第三它非常齐全。

![img](http://img1.tuicool.com/yANFBbN.jpg!web)

这是 Drools 的例子，规则分为三部分，第一是规则名称和它的一些配置属性。第二部分是描述什么事件下会触发这个规则。第三是规则理由。

基于 Drools，我们重新搭建了我们的风控系统，风控系统分成了三个部分，普通规则、CEP 规则和管理后台。

![img](http://img0.tuicool.com/M3Af2if.jpg!web)

CEP 规则引擎和普通规则引擎区别是它是一种状态，能够缓存数据。刚才大家看到规则，数据实施同步到规则引擎中去。

使用了新的风控系统以后，我们的开发效率和我们运营效率明显提升。5 分钟上线规则，迅速止损。新规则上线到上线调整一周到一天。现在规则非常简单，他们也可以来调整规则。业务同学可以调整规则。

当然规则的调整变容易之后，也是把双刃剑，带来一些其他的问题，有时候规则上线，没有经过严格测试，也没有注意观察规则上的效果，只出现过一两次的事故带来一些小的损失。我们之后为了解决这个问题，我们重新搭建了一个灰度风控系统，这个系统上上线新的规则，利用历史订单验证规则效果，验证成功测试再把放在上面去，这个效果非常好。

风控打点，应用系统要主动调用风控，所以风控在业务系统中需要打点，打点多少位置有技巧，太多风控系统有很多数据低于自己的分析，对业务系统来说非常麻烦。我们采取一般打两个点够了，第一是交易前创建订单之前进行第一次调用，第二次是订单完成之后，只需要调用两次就可以了。

虽然我们有了新的风控系统之后，开发效率、研发效率提高，运行效率没有达到我们期望。我们因为风控系统要为业务系统提供服务，风控系统响应时间过长，会影响业务响应时间，会影响用户的体验。第二，我们现在专门的数据缓存，我们数据都放在 CEP 系统中，拿不出来，无法做后续分析。为了解决这两个问题，替换 CEP 系统，自建一个数据累计服务搜集数据。并且对于非实时性其他数据，我们采用日志方式，离线去进行分析。

![img](http://img0.tuicool.com/M3Af2if.jpg!web)

上图是我们之前的风控系统，下图是我们修改之后的风控系统。同时在服务里面把数据导出来实时监控每天每分钟，我们整天的拦截率。

![img](http://img1.tuicool.com/aYraqyi.jpg!web)

我们的风控系统响应时间缩短为以前的 1/4，并且能够实时监控规则运行效果。

![img](http://img1.tuicool.com/EfIZ7nU.jpg!web)（点击图片全屏缩放）

可以看到将数据和计算分离能够解耦带来巨大的好处，另外一方面数据应该尽快用起来，不要只是放在那里，尽快用起来，迭代起来，能够通过反馈搜集更高效的数据。

我们完成了风控系统建立之后，我们回到问题的本质，另外一个问题就是除了拍脑袋，还有其他的规则制定方法吗？我们发现我们其实可以利用机器学习的方式，从案例库中间学习模型，学习规律。同时对于案例库中已知的坏人，我们通过关系找到它的同伙。

从案例库学习方面，我们从案例库中和线上正常交易库中随即挑选两组数据。分别形成我们的训练集和测试集，选取交易数据 17 个交易特征：交易时间、交易者年龄、交易者所使用地理位置、注册地理位置、手机号归属地是否一致等，寻求这些特征，用了四组分类器，在测试集、训练集上进行训练，得到四组模型。最后再用测试集比较这四种模型优劣，最终 我们选择随机森林模型 。

找关系，我们利用交易数据里面用户、设备、手机之间关联关系建立一个关联图，里面很多关联子图。

![img](http://img1.tuicool.com/ZbMZFrR.jpg!web)

从案例库中导入相关的坏人的用户和设备，找到有关系的设备和用户，找到之后，在检查这些设备帐户交易特征。如果发现是坏人就把它加入到黑名单。通过这种方式我们预防了盗刷案件。在随机森林模型上线五天之后，我们发现好几笔盗刷，丰富了黑名单 。从损失和错误中学习，把我们的损失变成我们财富。

随着业务快速发展，我们的经验越来越多，我们积累的案例库越来越多。我们发现很多风控问题一个很重要的问题本质是我们的交易对手是谁？他是不是本人？是不是真人？还是一条狗。我们解决这个问题考虑到我们可以利用小米生态里面海量全面的各种各样的用户数据。我们这里面能够知道一个小米帐号他是男是女，兴趣爱好是什么，年龄，学历等等这方面都是有一个画像的。

![img](http://img2.tuicool.com/z6nqeeB.jpg!web)

（点击图片全屏缩放）

这是我们画像组提供一个页面，这里面他把用户分成用户画像、设备画像。设备画像里面包含了 793 条各种关键属性，我们利用其中设备属性以及消费属性建立相应的规则来检查用户的真实性。这样做了以后，我们的 盗刷案件的比例近几个月来下降 40% 。

#### 三、扩展

给我们的启发是他山之石可以攻玉。最后 2016 年以来小米的业务不断扩充，除了之以外，我们还陆续开展贷款、理财、保险、分期等等等等各种各样的业务。这些业务都需要风控，在小米体系下如何共享资源，建立风控体系？

我们解决思路是 对内共享所有数据，对外分享合作 。首先 CTO 牵头下我们建立一个基础风控组，在小米内部协调资源。如果我们需要建立服务的时候，我们建一份，实名认证服务。一个组建立这个服务，分享给其他组使用。在外部合作方面，一个团队有同盾和前海，也可以分享给同事使用。

小米这几年在金融方面扩展非常快，我们陆续开发各种各样业务，我们也希望这一方面牛人加入我们。谢谢大家。

#### Q&A

#### Q：做风控，你们利用一些简单 Drools，这个 Drools 包括什么？这个 Drools 怎么定的？后续你们用的一个随机森林框架，怎么把 Drools 放在这随机森林里做的。效果提高了大概 40% 左右，您更详细的介绍一下。如果不方面展开，能否简单举两个例子。

邓文俊：比如盗刷，有地理位置，他交易的时候他有一个地理位置。我们知道他注册的时候有地理位置，他手机号归属地有地理位置，他的身份证也是有地理位置。他最近三个月使用的设备在哪登录过，这些都是可以做限制。

#### Q：你们是怎么在风控模型中选用随机森林这个模型，底层是不是用了什么开源技术或者一些开源学习框架？

邓文俊：我们所有东西都是用开源的，怎么用随机森林？现在所有东西是基于刚才看到框架叫风控 Drools 框架，它的规则引擎可以调用外面服务或者外面资源。可以由随机森林模型，可以由别的模型，把每个模型学到的东西都可以做成一个独立的服务或者合到一个服务里面。在规则里面调用这个服务，把参数一些背景信息告诉这个服务，这个服务判断或者是有多少的概率是危险。再由规则本身来决定。我们是由规则引擎进行推理，其他所有服务只提供一些参考，最后规则服务来最终决定。事先学习好之后，以服务形式加载起来，放到内存起来，来调用。

#### Q：训练的时候这个有多少个？

邓文俊：有 17 个。

#### Q：刚刚我看到你们规则引擎开发是四周就可以上线，你们团队规模以及你们现在运营团队是大概什么样的配比？你们进行开源技术选型的时候所考虑这些方面是什么？

邓文俊：

1. 当时风控就两个人，我开发，还有一个定规则。
2. 风控分三个部门，研发、运营、数据，大概二三十人。到了第三方支付牌照之后可以为外部服务。支付宝据我所知至少一千人。
3. 其实主要考虑方面就是一个，第一安全大家都用过，这是最重要。其次是不是很好用很好上手，文档齐全不齐全。第一很重要，是不是用过，是可靠的。

#### Q：您刚才说一开始的模型和后来的模型，模拟的模型是一直在迭代吗？

邓文俊：可以调整阈值，没有用高大上的东西。

#### Q：我看你之前模型一直在，后来走到机器学习，也是四种不同分类器，您选了随机森林。机器学习里面有一个问题，过拟合的问题怎么解决？

邓文俊：不解决，随它去吧。快速开发，快速上线，看迭代。

#### Q：您现在算法也是不断迭代过程当中，可能有一些问题没有暂时解决是吧？

邓文俊：说实话，我自己感觉我们没有过拟合的问题。

#### Q：您采用机器学习算法，有一个问题机器学习如果你样本集和训练集给到合适的划分，划分过程中、训练过程中，如果划分不合适或者算法有时候像过拟合抖动没有到合适地步，可能就会慢慢继续拟合，导致没有没有办法恢复。您在机器算法上面现在走的方向上有什么和大家有一些在互联网金融方向特殊的一些设计吗？

邓文俊：目前没有，我们也是刚刚开使用机器学习的方法，摸着石头过河，走一步看一步。如果我要回答你的问题的话，我给的建议是我们做的时候在企业里面其实不像高校管太多，设计那么完美或者会考虑那么多过拟合方面的科研问题、学术问题。我们先上再说，看效果，适者生存。我们并没有太关注过拟合的情况，算出什么结果就拿来用，有效，我们发现盗刷，发现有用，可以再调整。

#### Q：您刚刚说您样本的这些特征都是通过小米生态平台获得，包括地理位置，可能是一些帐单信息。现在有一个比较争议的问题，您获得这些纬度和用户隐私政策上咱们有什么思路？

邓文俊：小米已成为国内首家和 TRUSTe 公司就用户隐私保护展开合作的手机厂商。我们有两个原则， 第一、收集数据时，收集任何用户隐私数据都是要获得用户允许 ，默认是不许可的，需要用户明确授权。 第二、使用数据时，数据平台保证用户数据是机器可读，人不可读。 我们做分析的时候我们有一个样本的数据做模型，做测试。做完了以后，我们把我们的系统代码或者服务掉到线上跑得时候才是跑的真实的数据库。原来都是看不到，只有机器可以读，人是不可以读。

#### Q：我本身是做大数据研发，我对金融这方面感兴趣，我又读了金融 MBA。您说研发风控有一些系统，开始的时候是一个风控机组给你说一个业务去做。是不是一个人把金融和 IT 技术都掌握的比较好，把这个系统研发好一些，一个人就专业就建立一个好的团队，大家去合作比较好一些？

邓文俊：这个问题超出技术范畴，从我的角度我自己的体验，我觉得首先应该把自己的事情做好，你有余力可以了解其他人的合作。

# 在线支付之风控系统架构选型

- 康大强

阅读数：135882016 年 5 月 14 日 18:54

### **风控系统介绍**

伴随着互联网的发展，游戏、商贸、慈善、博彩、餐饮等各行各业都开始触网。“天下熙熙，皆为利来；天下攘攘，皆为利往”，种类繁多的网络活动直接或间接的都与钱相关，传统的支付不能满足人们快节奏的互联网生活，电子支付应运而生，但电子支付给人们带来方便快捷的同时也给参与支付的各方带来了风险，账号盗用、虚假交易、金融欺诈等事件层出不穷。支付风险自古就存在，在互联网繁荣的今天只是多了些新花样，风控系统就是通过监控交易、渠道、产品、用户，对相关数据进行实时、准实时、定时的分析、挖掘，从而识别交易风险，尽早发现欺诈，采取各种措施降低交易损失。

### **风控系统功能性需求**

- 实时监控——针对各类支付业务交易风险的事中监测与控制。
- 同步反馈——接受并处理各支付业务平台的支付交易信息请求，并由风控系统将处理结果实时返回业务系统。
- 联动控制——对风控系统识别出的风险信息，进行系统自动化（通过人工预置策略实现）交易风险处理。
- 持续迭代——交易风险特征识别方式可以通过系统自动整理、人工设定参数、外部资源共享等方式进行持续动态更新。
- 统计分析——对于风控系统中存在的各类信息和数据，有关人员可以通过组合查询和查阅报告等方式，对系统运行情况、交易风险情况、岗位绩效情况等进行监督。

### **风控系统非功能性需求**

- 灵活性——风控规则需要经常新增以及调整，如何降低风控规则新增、修改的成本是风控系统需要解决的一个问题。此外，风控系统需要能够与不同业务系统进行集成，需要和业务系统保持相对的独立，以利于集成。
- 性能——风控系统响应时间需要小于 100ms 同时能够有很大的吞吐量，风控系统降低风险的同时不能影响用户体验，否则就本末倒置了。
- 准确性——风控系统根据风控规则会自动冻交易相关资源等，如果准确率过低会引起大面积投诉，损害公司信誉、公众形象使用失去信心，给公司带来巨大的损失，所以风控系统识别风险的准确率必需要有一个下限，同时要注意风险识别的准确率和覆盖率是相互影响的两者要达到一个可以接受的平衡。

### **风控系统的误区**

风控系统的目的是在不影响正常业务的同时把交易风险降低到合理的水平，风控系统并不能消灭风险，所以在建设风控系统时不可盲目追求数据的准确性以及一致性。

### **风控系统架构**

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/4e/0a/4e7e7634823f53b331942f61a076ec0a.png)

风控系统主要由以下几个部分构成：风控实时引擎、风控准实时引擎、风控定时引擎、惩罚中心、规则中心等，下面分别进行介绍。

### **风控实时引擎**

支付系统会把当前交易部分信息同步传递给风控实时引擎以获取当前交易的风险评分和处理建议。风险评分总分为 100，分数越高风险越大，-1 代表风控系统不能对当前交易进行评估风险，一般是指风控系统没能获取到当前交易正面或负面的信息。风控实时引擎最大的挑战是性能，实时引擎对支付交易进行风险评估必须在 100ms 内完成，否则会影响用户体验。

风控实时引擎依据公司积累的风控数据以及第三方风控数据对进行风险评估。公司风控数据主要来自风控准实时引擎和风控定时引擎。

风控实时引擎建立在规则引擎 Drools 基础上，目的是为了提高系统的灵活性和可配置性。

下图是风控报告的域模型：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/9e/98/9e5f313db92edcded7f38d00b7118d98.png)

### **规则引擎优点**

风控系统中风控规则变动比较频繁，其它部分相对稳定，通过引入规则引擎可以解耦系统与规则、提高复杂逻辑的可维护性、提高规则的可读性以及可理解性。

### **风控准实时引擎**

交易欺诈行为具备一定的隐蔽性，不是所有风险都能实时的作出正确的评估，某些情况下需要通过对最近一段时间的数据进行分析才能确定欺诈行为，例如：对最近一个月的用户行为进行分析。风控准实时引擎从消息服务器获取交易数据，对交易数据流作异步分析，分析的结果通过风控服务存入风控数据库，供实时风控引擎评估交易风险。风控准实时引擎从发现异常到风控数据生效的时间在 100ms 以内，可以有效防止交易风险扩大。

风控系统初始建设时中风控准实时引擎往往是通过消息监听器消费交易消息，把中间数据存储在 Redis 缓存上，对数据进行多维度分析。由于需要针对每项指标开发相应程序，风控规则开发成本较高、上线周期长，为了解决这个问题以及提高系统的灵活性、可配置性，在风控系统 2.0 版本引入了 CEP 引擎 Esper 以及规则引擎 Drools。

风控准实时引擎需要使用到 Drools、Esper、Esper IO AMQP、Esper Extension、Spring 等组件，其中 Esper Extension 是我们对 Esper 的扩展，主要用来提高 Esper 可配置性以及丰富 Esper IO 功能以及弥补 Esper 缺陷。

下图是风控准实时引擎架构：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/9d/17/9d85324b289a02f0be3216cec64e9a17.png)

### **什么是 CEP**

事件驱动是一种监测、分析信息流从中得出推论的方法。CEP(Complex Event Processing) 也就是复杂事件驱动，是结合多种数据源的数据对信息流进行监测、分析从推理出一些复杂的事件或模式，CEP 的目的是识别出一些有意义的事件，例如：机遇、威胁，并且尽可能快的作出反应。

CEP 引擎已经被一些公司开发出来，用来满足那些需要分析事件并对其作出反应的的需求，下面是一些典型的应用示例：

- 业务流程管理和自动化（流程监控、商业活动监控、报告异常）
- 金融（自动化交易、欺诈检测、风险管理）
- 网络以及应用监控（入侵检测、SLA 监测）
- 传感器网络应用（读取 RFID、生产线调度与控制）

### **CEP 技术选型**

下面列出一些 CEP 产品，大家可以根据自己的情况选用。

开源 CEP 产品：

- JBoss Drools Fusion
- EsperTech Esper
- Triceps

商业 CEP 产品：

- EsperTech Esper Enterprise Edition 
- EsperTech EsperHA
- IBM Operational Decision Manager (IBM ODM)
- Oracle Stream Explorer platform
- TIBCO BusinessEvents
- TIBCO StreamBase

### **Esper 优点**

### **数据窗口机制完善**

Esper 目前支持大约 30 种数据窗口，深入理解窗口是应用 Esper 的关键，下面表格列出常用的几种：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/cc/30/ccc5a4d542918526a7e6f07bd40e8f30.png)

Time Window：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/1a/d3/1acb726ee254319f1ba8ecbd46d077d3.png)

Length Window：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/f7/09/f73fd8e7dcc5baecbf6705a70ca08809.png)

Time Batch Window：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/50/41/50e6f5421623525800aa8515a245fd41.png)

### **EPL 语句的语法与 SQL 相似降低学习成本**

事件处理语言（EPL）是 SQL 标准语言并做了扩展，提供了 SELECT、 FROM、 WHERE、 GROUP BY、HAVING 和 ORDER BY 等子句。

### **使用方式灵活**

Esper 提供了丰富的 API，可以独立部署也可以集成进任何应用。

### **支持多种获取结果方式**

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/b7/95/b74b1614c015e9af5defd30ba0a9b095.png)

### **Esper 缺点**

Esper 统计分析的中间数据全部是存储在内存中，不能跨服务器，只能单机部署，内存有限，存在单点故障，由于全内存操作，系统重启后中间数据就会丢失无法恢复。Esper 的这些缺点风控系统都可以接受，对风控系统没有实质的影响。

### **风控定时引擎**

某些非常隐蔽的交易欺诈通过实时或准实时风控引擎很难发现，这些风险需要通过分析用户跨月或跨年的数据才能识别。定时风控引擎主要用来定时对支付相关等数据进行深度挖掘，建立对应的风控模型，典型应用场景是用户的信用等级模型以及用户行为分析。

定时风控引擎构建在 Hadoop 集群上。

### **惩罚中心**

惩罚中心负责积累风控数据并提供奖励和惩罚的相关服务，风控实时引擎、风控准实时引擎、风控定时引擎会调用惩罚中心的服务查询或保存风控数据。惩罚中心针对不同维度提供多种惩罚策略以及多种奖励策略。风控实时引擎在识别交易风险时根据规则综合考虑奖励以及惩罚相关数据以提高风险识别准确率。

下图是处罚中心域模型：

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/62/be/62f1f3e9f0bddc41ffdfce377f7eadbe.png)

风控系统的建设往往是分阶段实施的，一般分为以下三个阶段：

**第一阶段：核心任务：**

- 搭建基础架构
- 网上应用接入
- 手机应用接入
- 建立起有效的监控团队和工作机制

**第二阶段：提升性任务：**

- 交易监控能力 
- 风控模型提炼 
- 监控团队能力和工作机制 

**第三阶段：后续发展：**

- 持续优化
- 新应用接入

团队技能是逐步积累的，对风控系统以及风控模型的理解也需要时日，如果初始建设阶段求大求全会使建设工作增加不确定性，一旦出现技术或业务方向上的偏差会给公司带来巨大的损失。循序渐进逐步建设，在前一阶段的工作产生效益时再去进行下一阶段的工作阻力会小很多，任何时候保持团队对项目的控制力都是相当重要的，这是我们在建设风控系统的过程中的一点感悟。

### **作者简介**

![在线支付之风控系统架构选型](https://static001.infoq.cn/resource/image/1c/8b/1c49b1595a34fc5208f2713fb909638b.jpg)**康大强**，拥有 14 年企业与互联网开发、设计、架构经验；历任金蝶软件、芒果网、华为、OPPO 架构师；目前专注于文法分析、工作流、高并发系统、大数据以及复杂业务分析处理。

# 京东基于 Spark 的风控系统架构实践和技术细节

- 孟勐
- 张帅
- 陈诚

阅读数：307192016 年 8 月 28 日 17:06

## 1. 背景

互联网的迅速发展，为电子商务兴起提供了肥沃的土壤。2014 年，中国电子商务市场交易规模达到 13.4 万亿元，同比增长 31.4%。其中，B2B 电子商务市场交易额达到 10 万亿元，同比增长 21.9%。这一连串高速增长的数字背后，不法分子对互联网资产的觊觎，针对电商行业的恶意行为也愈演愈烈，这其中，最典型的就是黄牛抢单囤货和商家恶意刷单。黄牛囤货让广大正常用户失去了商家给予的优惠让利；而商家的刷单刷好评，不仅干扰了用户的合理购物选择，更是搅乱了整个市场秩序。

京东作为国内电商的龙头企业，在今天遭受着严酷的风险威胁。**机器注册账号、恶意下单、黄牛抢购、商家刷单**等等问题如果不被有效阻止，会给京东和消费者带来难以估量的损失

互联网行业中，通常使用风控系统抵御这些恶意访问。在技术层面上来讲，风控领域已逐渐由传统的“**rule-base”（基于规则判断）发展到今天的大数据为基础的实时 + 离线双层识别。****Hadoop，Spark 等大数据大集群分布式处理框架的不断发展为风控技术提供了有效的支撑。**

## 2. 什么是“天网”

在此背景下，京东风控部门打造“天网”系统，在经历了多年沉淀后，“天网”目前已全面覆盖京东商城数十个业务节点并有效支撑了京东集团旗下的京东到家及海外购风控相关业务，有效保证了用户利益和京东的业务流程。

“天网“作为京东风控的核心利器，目前搭建了**风控专用的基于 spark 的图计算平台**，主要分析维度主要包括：用户画像，用户社交关系网络，交易风险行为特性模型。

其系统内部既包含了面向业务的交易订单风控系统、爆品抢购风控系统、商家反刷单系统，在其身后还有存储用户风险信用信息及规则识别引擎的风险信用中心（RCS）系统，专注于打造用户风险画像的用户风险评分等级系统。

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/01/44/01b7c95b84e169bc97b5fef64ae63944.jpg)

下面，我们将从用户可以直接感知的前端业务风控系统和后台支撑系统两部分对天网进行剖析：

## 3. 前端业务风控系统

### 1 交易订单风控系统

交易订单风控系统主要致力于控制下单环节的各种恶意行为。该系统根据用户注册手机，收货地址等基本信息结合当前下单行为、历史购买记录等多种维度，对机器刷单、人工批量下单以及异常大额订单等多种非正常订单进行实时判别并实施拦截。

目前该系统针对图书、日用百货、3C 产品、服饰家居等不同类型的商品制定了不同的识别规则，经过多轮的迭代优化，**识别准确率已超过 99%**。对于系统无法精准判别的嫌疑订单，系统会自动将他们推送到后台风控运营团队进行人工审核，运营团队将根据账户的历史订单信息并结合当前订单，判定是否为恶意订单。从系统自动识别到背后人工识别辅助，能够最大限度地保障订单交易的真实有效性。

### 2 爆品抢购风控系统

在京东电商平台，每天都会有定期推出的秒杀商品，这些商品多数来自一线品牌商家在京东平台上进行产品首发或是爆品抢购，因此秒杀商品的价格会相对市场价格有很大的优惠力度。

但这同时也给黄牛带来了巨大的利益诱惑，他们会采用批量机器注册账号，机器抢购软件等多种形式来抢购秒杀商品，数量有限的秒杀商品往往在一瞬间被一抢而空，一般消费者却很难享受到秒杀商品的实惠。针对这样的业务场景，秒杀风控系统这把利剑也就顺势而出。

在实际的秒杀场景中，其特点是瞬间流量巨大。即便如此，“爆品抢购风控系统”这把利剑对这种**高并发、高流量****的机器抢购**行为显示出无穷的威力。目前，京东的集群运算能力能够到达每分钟上亿次并发请求处理和毫秒级实时计算的识别引擎能力，**在秒杀行为中，可以阻拦 98% 以上的黄牛生成订单**，最大限度地为正常用户提供公平的抢购机会。

### 3 商家反刷单系统

随着电商行业的不断发展，很多不轨商家尝试采用刷单、刷评价的方式来提升自己的搜索排名进而提高自家的商品销量。随着第三方卖家平台在京东的引入，一些商家也试图钻这个空子，我们对此类行为提出了 “零容忍”原则，为了达到这个目标，商家反刷单系统也就应运而生。

商家反刷单系统利用京东自建的大数据平台，从订单、商品、用户、物流等多个维度进行分析，分别计算每个维度下面的不同特征值。通过发现商品的历史价格和订单实际价格的差异、商品 SKU 销量异常、物流配送异常、评价异常、用户购买品类异常等**上百个特性**， **结合贝叶斯学习、数据挖掘、神经网络等多种智能算法进行精准定位。**

而被系统识别到的疑似刷单行为，系统会通过后台离线算法，结合订单和用户的信息调用存储在大数据集市中的数据进行**离线的深度挖掘和计算**，继续进行识别，让其无所遁形。而对于这些被识别到的刷单行为，商家反刷单系统将直接把关联商家信息告知运营方做出严厉惩罚，以保证消费者良好的用户体验。

前端业务系统发展到今天，已经基本覆盖了交易环节的全流程，从各个维度打击各种侵害消费者利益的恶意行为。

## 4. 后台支撑系统

天网作为京东的风控系统，每天都在应对不同特性的风险场景。它可能是每分钟数千万的恶意秒杀请求，也可能是遍布全球的黄牛新的刷单手段。**天网是如何通过底层系统建设来解决这一个又一个的难题的呢？**让我们来看一看天网的两大核心系统：风险信用服务 (RCS) 和风控数据支撑系统（RDSS）。

### 1 风险信用服务

风险信用服务（RCS）是埋藏在各个业务系统下的风控核心引擎，它既支持动态规则引擎的高效在线识别，又是打通沉淀数据和业务系统的桥梁。它是风控数据层对外提供服务的唯一途径，重要程度和性能压力不言而喻。

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/87/12/8733b1eb1d2fc7b3526d653005109612.jpg)

#### 1.1 RCS 的服务框架

RCS 作为天网对外提供风控服务的唯一出口，其调用方式依赖于京东自主研发的服务架构框架 JSF，它帮助 RCS 在分布式架构下提供了高效 RPC 调用、高可用的注册中心和完备的容灾特性，同时支持黑白名单、负载均衡、Provider 动态分组、动态切换调用分组等服务治理功能。

面对每分钟千万级别的调用量，RCS 结合 JSF 的负载均衡、动态分组等功能，依据业务特性部署多个分布式集群，按分组提供服务。每个分组都做了跨机房部署，最大程度保障系统的**高可用性**。

#### 1.2 RCS 动态规则引擎的识别原理

RCS 内部实现了一套自主研发的规则动态配置和解析的引擎，用户可以实时提交或者修改在线识别模型。当实时请求过来时，系统会将实时请求的数据依据模型里的核心特性按时间分片在一个高性能中间件中进行高性能统计，一旦模型中特性统计超过阀值时，前端风控系统将立刻进行拦截。

而前面我们所说的高性能中间件系统就是 JIMDB，它同样是自主研发的，主要功能**是基于 Redis 的分布式缓存与高速 Key/Value 存储服务**，采用**“Pre-Sharding”**技术，将缓存数据分摊到多个分片（每个分片上具有相同的构成，比如：都是一主一从两个节点）上，从而可以创建出大容量的缓存。支持读写分离、双写等 I/O 策略，支持动态扩容，还支持异步复制。在 RCS 的在线识别过程中起到了至关重要的作用

#### 1.3 RCS 的数据流转步骤

风险库是 RCS 的核心组件，其中保存有各种维度的基础数据，下图是整个服务体系中的基本数据流转示意图：

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/83/c4/839eea9708657a79a7cbb1faf42453c4.jpg)

1) 各个前端业务风控系统针对各个业务场景进行风险识别，其结果数据将回流至风险库用户后续离线分析及风险值判定。

2) 风险库针对业务风控识别进过数据进行清洗，人工验证，定义并抽取风控指标数据，经过此道工序风险库的元数据可以做到基本可用。

3) 后台数据挖掘工具对各来源数据，依据算法对各类数据进行权重计算，计算结果将用于后续的风险值计算。

4) 风险信用服务一旦接收到风险值查询调用，将通过在 JIMDB 缓存云中实时读取用户的风控指标数据，结合权重配置，使用欧式距离计算得出风险等级值，为各业务风控系统提供实时服务。

#### 1.4 RCS 的技术革新与规划

进入 2015 年以后，RCS 系统面临了巨大的挑战。首先，随着数据量的不断增大，之前的处理框架已无法继续满足需求，与此同时不断更新的恶意行为手段对风控的要求也越来越高，这也就要求风控系统不断增加针对性规则，这同样带来不不小的业务压力。

面对这样的挑战，RCS 更加密切地加强了和京东大数据平台的合作。在实时识别数据的存储方面，**面对每天十几亿的识别流水信息，引入了 Kafka+Presto 的组合。**通过 Presto 对缓存在 Kafka 一周之内的识别数据进行**实时查询**。超过 1 周的数据通过 ETL 写入 Presto 的 HDFS，支持**历史查询**。在 RCS 识别维度提升方面，目前已经与京东用户风险评分等级系统打通流程，目前已拿到超过 1 亿的基于社交网络维度计算的风险等级，用于风险信用识别。在风险等级的实时计算方面，已经逐步切换到大数据部基于 Strom 打造的流式计算计算平台 JRC。

## 5. 风控数据支撑系统

风控数据支撑系统是围绕着京东用户风险评分等级系统搭建起来的一整套风控数据挖掘体系。

### 1RDSS 的核心架构

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/2d/ff/2d68249f6bb7cd14b972f6f6611a17ff.jpg)

1) 数据层

如图所示，**数据层**负责数据的抽取、清洗、预处理。目前 ETL 程序通过 JMQ、Kafka、数据集市、基础信息接口、日志接入了超过 500 个生产系统的业务数据，其中包括大量的非结构化数据。通过对数据的多样性、依赖性、不稳定性进行处理，最终输出完整的、一致性的风控指标数据，并通过数据接口提供给算法引擎层调用。这一层最关键的部分是在对风控指标数据的整理。指标数据质量的好坏直接关联到系统的最终输出结果。目前指标的整理主要从以下三个维度开展：

a) 基于用户生命周期的指标数据整理

对于电商业务而言，一个普通用户基本上都会存在以下几种粘性状态，从尝试注册，到尝试购买；从被深度吸引，到逐渐理性消费。每一种状态总是伴随着一定的消费特征，而这些特征也将成为我们捕获用户异常行为的有利数据。

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/6c/52/6c639911e782466a7951208b04ced352.jpg)

b) 基于用户购买流程的风控指标数据整理

对于一般用户而说，其购买习惯具有相当的共性，例如，通常都会对自己需求的商品进行搜索，对搜索结果中自己感兴趣的品牌进行浏览比较，几经反复才最终做出购买决定。在真正购买之前还要找一下相关的优惠券，在支付过程中也会或多或少有些停顿。而对于黄牛来说，他们目标明确，登录之后直奔主题，爽快支付，这些在**浏览行为**上的差异也是我们寻找恶意用户的有利数据。

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/61/4c/6199512b6f90d074d8bbd71ce429e64c.jpg)

c) 基于用户社交网络的风控指标数据整理

基于用户社交网络的指标数据是建立在当前风控领域的黑色产业链已经逐渐成体系的背景下的。往往那些不怀好意的用户总会在**某些特征上有所聚集**，这背后也就是一家家黄牛，刷单公司，通过这种方式可以实现一个抓出一串，个别找到同伙的效果。

![京东基于Spark的风控系统架构实践和技术细节](https://static001.infoq.cn/resource/image/59/a6/592bd670e2bf6d32ded59c3caae27ba6.jpg)

2) 算法引擎层

算法引擎层集合了各种数据挖掘算法，在系统内被分门别类的封装成各种常用的分类、聚类、关联、推荐等算法集，提供给分析引擎层进行调用。

3) 分析引擎层

分析引擎层是风控数据分析师工作的主要平台，数据分析师可以在分析引擎层依据业务设立项目，并且在平台上开展数据挖掘全流程的工作，最终产出风控模型和识别规则。

4) 决策引擎层

决策引擎层负责模型和规则的管理，所有系统产出的模型及规则都集合在这里进行统一管理更新。

5) 应用层

应用层主要涵盖了决策引擎层产出模型和规则的应用场景，这里最重要的就是风险信用服务 (RCS)，其主要职能是对接底层数据，对外层业务风控系统提供风险识别服务。

而在模型和规则投入使用之前必须要经过我们另外一个重要的系统也就是风控数据分析平台（FBI），因为所有的模型和规则都先将在这个平台中进行评估，其输入就是所有规则和模型的产出数据，输出就是评估结果，评估结果也将反馈到决策引擎层来进行下一步的规则，模型优化。

### 2RDSS 之用户风险评分等级系统

京东用户风险评分等级系统是天网数据挖掘体系孵化出的第一个数据项目。其主要目的在于将所有的京东用户进行分级，明确哪些是忠实用户，哪些又是需要重点关注的恶意用户。其实现原理是依赖前面所描述的社交关系网络去识别京东用户的风险程度。而这种方式在整个数据领域来说都是属于领先的。京东用户风险评分等级系统一期已经产出 1 亿数据，目前已经通过 RCS 系统对外提供服务。根据识别结果评估，识别忠实用户较 RCS 风险库增加 37%，识别的恶意用户较 RCS 风险库增加 10%。

目前，京东用户风险评分等级系统已经实现：

**1)** 数据层基于社交网络的维度产出 50 余个风险指标。

**2)** 通过 PageRank、三角形计数、连通图、社区发现等算法进行点、边定义，并识别出数十万个社区网络。

**3)** 通过经典的加权网络上的能量传播思想，计算上亿用户的风险指数。

## 5. 结语

凡是过去，皆为序曲，京东风控正在打造一套数据定义一切的超级风控计算框架。这套风控框架将统一风控模型管理 (数据模型，识别模型，规则引擎)、统一风控服务管理 (JRC，PRESTO，Streaming)、统一风控数据管理 (HDFS，HBASE，Kafka)，并将横跨云计算、大数据、人工智能，针对瞬息万变的电商交易风险智能调整风控策略实时处理。

## 关于作者

**张帅**，京东成都研究院高级研发工程师，毕业于西华大学，2012 年加入京东风控研发部，参与多个风控业务和数据核心系统的研发。

**陈诚**，京东成都研究院数据产品经理，四川大学硕士，参与多个风控天网系统和数据相关业务系统的研发。

**孟勐**，京东成都研究院高级经理，电子科技大学硕士，主要负责京东风控天网系统后台和数据处理、数据挖掘、决策支持等相关业务系统研发。

[**上一文章**[translate\]实现信息分类以增强数据治理和保护](https://ixyzero.com/blog/archives/4266.html)[**下一文章**[think\]每周分享第4期@20190126](https://ixyzero.com/blog/archives/4274.html)

## 《风控系统/架构的资料收集》上有23条评论

1. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-01-24 20:53](https://ixyzero.com/blog/archives/4270.html#comment-13076)

   58集团风控实战指南
   https://mp.weixin.qq.com/s/KbFWf0wZeKqpfTsWE_caEw
   `风险发现环节：发现什么、怎么发现、怎么快速发现是核心痛点1. 发现什么：什么是我们要解决的安全或风控问题，就发现什么1) 安全漏洞2) 垃圾信息3) 重大舆情4) 黑产资源`

   `2. 怎么发现：通过什么样的手段来发现风险1) SRC、漏洞扫描器（漏洞）2) 聚类分析、信息巡检抽检（垃圾信息）3) 舆情抓取分析（重大舆情）4) IP画像、手机号画像（黑产资源）5) 一些第三方提供的威胁感知能力3. 怎么快速发现：整个监测预警机制的搭建风险分析环节：如何快速分析产生决策是核心痛点。对应着一些核心能力：智能分析平台、风控引擎、算法孵化平台风险处置环节：如何处置、处置哪些。如何处置：我们将用户所有的权益进行总结，以58为例，用户可以拥有：发布的权益、浏览的权益、账户使用的权益、推广的权益等，在每一个关键的权益上都需要有着灵活的处理方法。处置哪些：所有资源类的唯一性数据都是处置的范围，处置的时间范围应该覆盖过去和未来，当一个资源被定性成黑产，那么相关的所有资源都会被处理，最大程度的提升黑产对抗成本。一些核心能力：聚类处理、社区挖掘、策略回溯`

   `效果回归：通过对已产生效果的策略生命周期进行监控，随时关注在业务中的准召率，并及时作出优化`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=13076#respond)

2. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-01-24 20:56](https://ixyzero.com/blog/archives/4270.html#comment-13078)

   关于风控预警体系的搭建方案
   https://mp.weixin.qq.com/s/2r61XB_Po4s3ihkLy46xbA
   `当我们只考虑如何快速发现异常的时候，预警系统的效果是很难到我们的预期的，所以要想搭建一套有效的预警体系必须要解决两个核心问题：1. 如何快速发现异常一、通过核心指标的变化发现异常二、通过聚类手段发现异常三、通过其他手段的异常发现2. 如何准确定义风险`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=13078#respond)

3. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-01-26 19:38](https://ixyzero.com/blog/archives/4270.html#comment-13112)

   业务安全：不只是跑赢最慢的那个人
   https://mp.weixin.qq.com/s/NqsJsC3y5Q-Y0HpMcNFMqw
   `[1] 引子：后有群狼有人讲安全是一场残酷的追逐赛 —— 我们只要跑赢最慢的那个人，身后的老虎就不会扑向我们。殊不知，这个年代的信息安全，追逐我们的并非一只猛虎，而是一队群狼。在这个年代的信息安全环境中，没有人能够幸存，我们已经不再争议谁还没有被黑，只是在考虑，谁才有被黑的价值。`

   `[2] 业务安全，性价比为王安全其实就是这样，垒砌砖墙的目的不是在于其设计工艺的高端和完美，只要能够提高黑客的攻击成本，就是成功。`

   `[3] 海恩法则变身海恩陷阱海恩法则(Heinrich's Law)，是德国飞机涡轮机的发明者德国人帕布斯·海恩提出的一个在航空界关于安全飞行的法则，海恩法则指出： 每一起严重事故的背后，必然有29次轻微事故和300起未遂先兆以及1000起事故隐患。 —— 摘自百度百科但贯彻海恩法则的前提是：业务逻辑的完整性、业务流程的完整性、原始数据、完整数据、线下能力。我们在每次数据采集时，如果并不完整或选择性忽略，一点遗漏就可能谬之千里。于是，海恩法则也就变成了海恩陷阱。`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=13112#respond)

4. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-02-28 15:31](https://ixyzero.com/blog/archives/4270.html#comment-13645)

   唯品会舆情监控系统
   https://mp.weixin.qq.com/s/ClYYfpvylQGlYYHDFBuKpA
   `总体介绍目前，市面上有腾讯企鹅风讯、百度舆情、七麦数据等舆情监控系统，这些系统能对市面的上的主流应用app，通过分布式爬虫抓取各大应用市场、主流论坛、微博等渠道的用户评论，并对爬取到的信息进行汇总、智能分类、报表输出等。这些舆情分析系统能简化运营、产品对用户口碑的收集工作，在提供专业的运营质量分析的同时，节省了项目人力。市面上的这些系统虽然能为我们提供一些分析和参考数据，但是也存在一定的局限性，如数据来源有限（一般只能提供微博、app应用市场、论坛等渠道的用户评论信息）、无法实现定制化需求等，因此非常有必要开发属于唯品会自己的舆情监控系统，实现丰富的数据来源、各种定制化的功能需求等。`

   `当前唯品会舆情系统评论数据订阅来源主要有各大App应用市场用户评论、微信公众号评论和唯品会内部的客服留言。在获取这三部分数据后，会做持久化存储，用于后期的文本挖掘分析。`

   `系统会对获取的这些评论信息进行情感判定、文本分词、评论分类、词频分析等计算分析工作。舆情系统整体架构设计分为舆情采集、舆情分析、舆情应用三大模块。本文将着重介绍舆情分析模块中的几个重要功能模块。`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=13645#respond)

5. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-04-07 10:35](https://ixyzero.com/blog/archives/4270.html#comment-14322)

   咳血的独角兽丨互联网的幕后攻防
   https://mp.weixin.qq.com/s/e8BuhSnR4cOrvqVDsITo4A
   `风险控制，“知道”的人多，“了解”的人少。`

   `我想谈谈一些真实发生的案例，来给大家展示一下风险控制这个职业，能为公司产生什么样的价值或者损失。这些内容我保证是你花钱都买不到的。但可以从中领悟多少进攻或者防守的思路，就全看自己的悟性了。老朋友们应该都知道，我本职工作是做风控的，从线下尽调，信用卡，金融，电商，安全，数据，基本每一个领域的风险管理，我都玩过，并且玩的不错。风险控制，或者说风险管理，在互联网公司中，一直是一个比较尴尬又不上不下的岗位。说风控不重要吧，你去问任何一个公司的老板，都可以balabala说出各种风控的重要性，大道理讲到你吐血。说风控重要吧，在绝大多数公司的实际情况中，风控都是为业务方让路的，运营部门要增长，市场部门要投放，活动部门要大促，这些都有明确的指标考核，而这些部门由于直接影响公司数据，进而影响公司讲故事融资，所以往往特别强势，风控这种做减法的部门，在他们眼中更是业绩的阻碍，最好统统赶走。多数老板为了面子好看，对外大力吹风控；为了里子好看，对内往往是默许业务部门Diss风控甚至搞点小动作的，所以到最后，风控往往里外不是人。某位老板曾经在酒后对我说过，你们这些风控，如果业务没有出现风险，养你们就像养猪；如果业务出了风险，养你们还不如养猪。某种程度上，这话是对的，风控只是业务的辅助。但在另一些维度中，业务营销如果风控放水，那么多少钱都只能打水漂。`

   `以下我讲谈及一些案例，以及其中的诀窍，功防技巧。`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=14322#respond)

6. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-04-16 15:37](https://ixyzero.com/blog/archives/4270.html#comment-14493)

   活动 Web 页面人机识别验证的探索与实践
   https://tech.meituan.com/2019/03/07/humans-and-bots-apart-for-activity-web-security.html
   https://www.jiqizhixin.com/articles/2019-03-08

   锦佰安创始人&CEO 冯继强：AI领域的人机识别对抗 千亿美金的验证码
   https://myslide.cn/slides/2236

   勾选一下就能通过验证的reCAPTCHA人机身份验证是什么原理？
   https://www.zhihu.com/question/51624138
   `没有具体研究过，查询了一下，大概就是基于以下内容做判断：`

   `1. Google自己的风险检测引擎2. 依赖于你的cookie，你必须有一定的活动天数3. 你点击那个单选框的时候计算你的鼠标滑动轨迹，机器人应该没有这个（但是可以通过js模拟）4. 检测你浏览器的user agent是否真实5. 根据浏览器指纹追踪信息进行判断`

   `反正这个判断应该是非常复杂了，基于真实人类的行为做分析，而对机器来说，可能无法模拟或者模拟困难这些行为。`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=14493#respond)

7. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-04-16 15:41](https://ixyzero.com/blog/archives/4270.html#comment-14494)

   https://www.google.com/recaptcha/intro/v3.html
   `IPdeviceID设备信息(IMEI/IDFV/IDFA/WIFI/MAC/...)`

   `Step 0 基础风控拦截基础风控拦截是上面提到的频次、名单等的拦截限制，在 Nginx 层就能直接实施拦截。如果发现是恶意请求，直接将请求过滤返回 403，这是初步的拦截，用户在请求 Web 页面的时候就开始起作用了。Step 1 风控服务端生成 Token 后传给前端Step 0 可能还没进入到活动 Web 页面，进入活动 Web 页面后才真正开始人机识别验证的流程，前端会先开始获取 Token。Step 2 前端生成敏感数据敏感数据应包含用户交互行为数据、设备环境数据、活动业务逻辑数据以及无效数据。Step 3 使用 HTTPS 的签名接口发送数据Token 可以作为 Authorization 的值添加到 Header 中，数据接口的签名可以有效防止 CSRF 的攻击。Step 4 数据接口的校验风控服务端收到请求后，会先验证数据接口签名中的 Token 是否有效。验证完 Token，才会对敏感数据进行解密。数据解密成功，再进一步对人机识别的数据合法性进行校验。Step 5 业务逻辑的处理前面的步骤为了做人机识别验证，这些验证不涉及到业务逻辑。在所有这些验证都通过后，后端业务服务才会开始处理实际的活动业务逻辑。处理完活动业务逻辑，最终才会返回用户参与活动的结果。==人机识别：图片验证码滑块验证码……`

   `身份验证：人脸识别短信验证邮箱验证……`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=14494#respond)

8. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-04-25 22:32](https://ixyzero.com/blog/archives/4270.html#comment-14688)

   咳血的独角兽2 | 互联网幕后攻防
   https://mp.weixin.qq.com/s/O289k21DSl1UxJP2AxUUmg
   `case 1:某电商类知名公司，因为某次数据事故，导致其整体财务数据和业务数据完全对不上，大量历史数据丢失，资方质疑其数据造假，融资断流，突然从业内掉队，从此一蹶不振。所以看文章的各位，是不是在注重业务之余，也要注重一些数仓的权限管控与备份呢？是不是需要内部排查一下此类问题呢？我知道看我文章的很多是各大公司的风控安全，诚恳建议各位排查一下此类问题，权限管理和操作日志是那种看起来没有产出，但关键时刻可能会要人命的东西，要谨慎。可惜了那家本来很有前途的公司，原本是有机会在中国互联网界闯出更大的天地。`

   `case 2:很多互联网公司在做营销拉新的时候，很喜欢做二维码推广，扫码即可XXX，扫码即可获得现金等等。只要别人扫了你分享的二维码并作出简单的操作，你和扫码人都可以获得奖励。这种活动设计的初衷是为了方便传播，尤其是方便在微信传播。但很多公司在扫码得奖的风控设计上不够完善，导致里面存在很多漏洞，大量羊毛党因此获利。既然B扫A的码，AB都可以获得奖励，那么只要A的码可以创造一个足够多的场景，被足够多的人扫到，那么A就可以获得大量奖励。case 3:讲完二维码营销分享，再讲手机号拉新营销分享的一些玩法。所谓手机号拉新，就是我给你发送一个微信卡片，你点进去，可以输入手机号，然后获得一张券，存入这个手机号的账户中。我想大家对于这个已经非常熟悉了，各种外卖APP的红包分享，都是这么玩的，点进去，输入手机号，然后领券，尤其是某咖啡，更是红包不断。而当前存在一种羊毛党，养了大量的手机号，然后登陆微信，潜伏在各个外卖红包群中，只要有人分享，就会点进去抢券，然后把最低价的券，拿出来下单，去买一些硬通货（牛奶等），然后套利。如果产品本身不能买硬通货，那么也不重要，可以做成代下单，在一些二手平台上搜XX券，XX代下单，可以发现有大量人在做这个生意，就是你付一小笔钱给他，给他地址，他帮你下单，货物送到你指定的位置，简单方便。case 4:刷券代下单，只是低端玩法，最近流行起一种新的玩法，也是基于手机号拉新营销的。很多互联网公司在做推广的时候，是允许你邀请朋友的，只要输入朋友的手机号，你们就可以建立一个绑定关系，如果这位朋友后续与这个互联网公司产生了一定的业务交集，那么你作为他的邀请人，是可以获得很多奖励的。就是所谓邀请码和邀请手机号。而这里面，存在了一个很有趣的玩法，就是暴力灌号，占领号段绑定关系。什么叫灌号，就是假如我是A，我要输入BCD的手机号与他们建立绑定关系，BCD下单了，我就有奖励。那么我可以直接穷举号码，例如直接从13000000000一直到19999999999，全都往邀请链接里导入，等于是只要有用户注册使用了他们，不管与我有没有关系，我们都已经建立了绑定关系，我可以躺着收钱，尽管用户本身都不知道我的存在。这种攻击，对于大厂是无效的，但是对于很多初创企业尤其是急着要数据的企业，是非常致命的。case 5:关于灌号，其实还有另一种精准灌号的玩法。就是灌号者，确实是知道这个手机号的主人的某些社会属性。例如从一些无良4S店搞出来的车主手机号，从一些无良物业搞出来的业主手机号，从一些学校搞出来的家长手机号，从一些金融机构搞出来的理财客户手机号，从某些防范不严的网站中脱裤出来的用户手机号。然后拿着这些手机号，做定向灌号，成功率极高，因为这些人本就是互联网公司重金去地推，去广告覆盖，去试图引诱的群体。例如拿学生家长的手机号去灌教育类APP，拿车主手机号去灌车辆交易类APP，拿业主手机号，去灌装修类APP，这种方法可以说是风险最低的套利方式之一了，并且收益较好。黑市上有专门这样的交易渠道，只需要不多的一笔钱，就可以拿到大量具有精准属性标签的用户，很多短信供应商也参与其中，利用自己发短信的优势，偷偷倒卖数据，为了获取更多数据，他们恨不得免费给垂直行业的大公司倒贴钱。case 6:再说个不是很大，但与我们多数人都有关的小漏洞。抢票软件都知道吧。。就是很多时候我们需要买到一些票（例如火车），但是票的数量有限，买的人太多，只能去用一些三方抢票软件。而这些软件，总是各种变着花的收钱，一张票要多收50到100元，甚至更多，堪称新时代互联网黄牛。既然有互联网黄牛，那必然就有坑黄牛的黄牛。这些抢票软件的核心原理是，利用机器调用票务网站的接口，极快的速度刷新和购买，往往速度可以快到1秒钟几千次，正常人根本抢不过他们。12306本身是严禁第三方用这种方法破坏公平的，所以不会提供完整的对外接口出来，他们只能用各种技术手段来利用12306本身的对外合作接口（速成OTA），想尽办法来加快调用。而这就产生了一个很有趣的漏洞。如果黑产的手机上同时装有某某抢票软件和12306，且黑产的抢票软件的付款方式绑定的是借记卡，在发起抢票时，把借记卡余额转走或者借记卡本身就没钱，那么当抢票抢到票时，必然扣款失败。此时，可以登录12306，付款，然后取消抢票。有些抢票软件甚至都是抢到了才让付款，那更简单，连余额和支付失败都不用做，直接打开12306付款即可。好几家著名公司旗下的抢票软件，都存在这个漏洞，但不敢去找消费者的麻烦。因为抢票，加价抢票，本身都是模糊的灰色地带，虽有有苦难言。很多电商网站上的代抢票服务，本质上就是在用这个方法空手套白狼，既白嫖了抢票软件公司，又套了消费者的钱。美哉。51节要到了，抢票大战又开始了，这个漏洞，又要被用起来了。`

   `case 7:再讲一个经典的营销漏洞，与广告有关。很多公司的推广，都是依赖广告的，APP里，网站上，大马路上，都是打广告的好地方。而广告的结算方式有很多，最常见的是CPT,CPC,CPA和CPS。CPT是指时间，按展示时间收费，广告展示长时间，收费XXX元，一般电梯广告都是CPT，部分网站的广告也是CPT。CPC是指的点击收费，点一次，多少钱。例如某些垃圾医院在某些网站上打广告，点一次，可能就是几块钱甚至几十块钱。CPA是指注册收费，每个成功完成注册的用户，多少钱。例如很多贷款超市，很多APP里浮动的页游，都是CPA。而CPS，是指业务发生收费，发生一次业务，多少钱。例如以前盛行的贷款超市，用户下款后，下款金额的一定比例给到贷款超市。再例如外卖软件或打车软件推广，用户注册后完成一单，给推广方XXX元。这些广告计价方式里面，就存在了很多漏洞。点击结算（CPC）和注册结算（CPA），是被刷的重灾区。`

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=14688#respond)

9. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

   [2019-04-29 17:45](https://ixyzero.com/blog/archives/4270.html#comment-14778)

   风控对抗中的常规特征及处置选择
   https://paper.tuisec.win/detail/33db957c8cb3533
   https://zhuanlan.zhihu.com/p/62525083

   [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=14778#respond)

10. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-05-05 16:56](https://ixyzero.com/blog/archives/4270.html#comment-14872)

    起底身份倒卖产业：那些被公开叫卖的人生
    https://mp.weixin.qq.com/s/7H_mVUZfuAzsTBX08pkn4g
    `现代社会中，核实人身份的方法有很多，例如实名银行卡，实名手机号，驾驶证等等等等，但是这些所谓的实名信息，本质上还需要一个源数据来提供真实性兜底。这个数据源，就是身份证。银行卡，手机号等一切所谓实名信息，都是基于身份证的，只是身份证信息的一种承载方式而已。如果没有身份证信息，你没法证明你是你。但假如有了你的身份证信息，则某种程度上，可以证明我是你。一个虚假的身份，对于我们大多数普通人而言，虽然听起来很酷，但是其实没有什么用处，因为我们的生活不需要这些。而对于另一些做特殊产业的人而言，虚假身份则是最重要的生产资料，没有之一，绝大多数黑产的根基，就是身份伪装。有了身份伪装，漏洞攻击，骗贷，薅羊毛，洗钱，伪造注册信息甚至骗补贴等一切违法手段，都有了一层安全的保护。而虚假身份的交易，更是当前黑市最火热的交易品。你有没有想过，世界上可能会有另一个人，披着你的身份生活？`

    `黑产内，对于全套身份伪装信息，有个专有名词，叫做四件套。所谓四件套，是指身份证原件+身份证对应手机卡+身份证对应银行卡+网银U盾，一般来说银行卡都是已经开通网银的的，某些手机卡甚至还会预存话费。四件套算是身份信息中的贵族，一份完整的标准版四件套，黑市价格在400到700元，按照供需关系决定，定制版会更贵一些。之所以需要定制，是因为很多大的机构对于某些地域某些群体，是有特殊限制规则的，例如某些公司坚决不跟某些地域的身份证产生任何业务往来。所以即使是身份证四件套，也是不平等的。像极了生活。这些身份资料被购买后，用途是什么？用途A——隐匿用途B——测试用途C——骗贷+羊毛用途D——洗钱用途E——借壳最低级的黑吃黑是骗钱与假数据。高级的黑吃黑是钓鱼。最高级的黑吃黑，是虚拟货币割韭菜。我们上面说了这么多的身份信息的意义，到买房是，价值，那么关键的问题来了，这些数据，总该有些源头吧？这些数据是从哪里来的？A，是来源于各大安全防范不严密的公司。B，是那些已经完蛋的P2P公司。C，公司内鬼。D，钱包丢失E，社会工程学F.身份证所有者自己出售的说了这么多与身份信息倒卖有关的信息，最后再谈一下如果你知道了自己的信息可能会丢失，应该怎么做。首先你要知道你的信息有没有被拿来使用。A.定期去运营商营业厅查查自己名下究竟有几个手机号，有哪些号是自己不用但还没有注销的。B.定期去银行查查自己名下有几张卡，自己已有的卡中有没有出现一些自己不知道来源的业务和授权。C.经常去企业查询类网站（天眼查启信宝之类），查查自己有没有被某些公司作为法人。`

    `这些操作都不复杂，也不困难，只要你有心。如果查出来发现确实有点问题，怎么办？不要慌，你要记住，你才是资料的主人。应该怎么做？很简单，挂失和注销。身份证疑似泄露，就挂失身份证；银行卡多了或者被人拿走了，就注销银行卡；电话卡多了，就注销电话卡；记住，你才是资料的主人。做完这一切之后，你就暂时安全了，因为当你的身份被任何异常利用之后，你都有足够的证据来证明与自己无关。这种有效证据，基本目前是安全的，所有私信我说资料被人拿走的人，我也都是这么建议的。这套自我排查与自我保护的方法，建议大家扩散给更多身边的人。`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=14872#respond)

11. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-05-14 19:05](https://ixyzero.com/blog/archives/4270.html#comment-15079)

    互联网黑产：那些职业羊毛党到底如何月赚几十万？
    https://mp.weixin.qq.com/s/TrIqZ7FPoCRXyicZnEg6Ow
    `今天，我们就给大家介绍一群生存在互联网灰色地带的职业羊毛党，他们有组织有纪律有完整产业上下游的去利用一些大型互联网公司的运营规则甚至漏洞，套取各种补贴和奖金，少的月收入一两万，多的月赚几十万。`

    `这些人一般活跃在什么平台？有哪些曾经或现在很常见的薅羊毛手段？给你介绍五种。1、套取新用户补贴，年收入百万一般情况下，一款App新用户注册都有补贴，多数是使用门槛很低的优惠券，比如买10块钱的东西就能减9块。如果用户每次买东西都想要优惠，那么每次用新手机号注册就行。一般人因为只有一个手机号，所以都只会注册一次享受一次优惠。但是，有需求，自然就有供给。一条养卡、注册账号、代收短信验证码、薅羊毛的产业链就这样形成了。2、刷单套奖励，月入十万有奖励的地方，就有刷单。3、P2P借贷“黑吃黑”月入十万是基础你看中人家收益，人家看中你的本金。4、做号集团：洗一篇稿赚几万补贴一般是根据阅读量来算，阅读量越高，收益越高。做号集团对各平台内容特点把握得非常到位，能做到量产高阅读量爆文。他们雇佣兼职写手来洗稿，以学生、宝妈和上班族为主，群里领取任务，价格通常为千字10元。也有全职写手，公司开在二三线城市，工资一个月三四千元，加上提成，优秀者月入过万不是问题。5、倒卖付费课程：零边际成本凡是能倒卖的，统统不能放过。知识付费课程火起来时，一些人通过众筹的方式实现低价购买课程，一门课程199，100人众筹每人也就2块钱。既然能众筹，何不自己当二道贩子？只需要把课程复制粘贴，放到某网盘里，转手就能在网上卖几块到几十块，几乎不需要成本。通过网盘分享，后期更新也能做到同步，不用再一个个地重新发给顾客。想学习的人也很喜欢低价课，199的课程，9块9就能买到。二道贩子再通过淘宝，百度贴吧、微信群、个人号等渠道推广，哪有不赚钱的。有些人做倒卖，3个月就赚到20万。从二道贩子买过课程的人，同样做起三道贩子、四道贩子……你永远不知道你买到的课程是几手，但这无所谓，质量都一样。行业竞争大了，有的二道贩子开始注重服务。他们做的服务甚至比平台原版还好。当平台还在单门课程销售时间，他们已经开始做包年服务，一年99元，可以看几乎所有主流平台的内容，包括得到、喜马拉雅、混沌大学、千聊、荔枝微课、网易云课堂等等。论品类，他们已经超越了任何一家平台；论价格，他们也有优势，能卖得不好吗？除了知识付费课程可以转手卖，盗版游戏、电子书等一切付费稀缺资源都成为贩卖对象，单价虽然低，做起来靠量也是一笔不小的收入。`

    `以上介绍的5种互联网黑产薅羊毛手段已经有些过时了，现在互联网平台对付手段也变高明了，薅羊毛的操作空间也越来越少，于是羊毛党开始把对象放到传统企业，这些企业上网后反作弊的经验普遍不足。一个风口过去了，他们又去追逐下一个风口。`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15079#respond)

12. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-05-31 19:31](https://ixyzero.com/blog/archives/4270.html#comment-15411)

    有赞风控规则引擎实践
    https://tech.youzan.com/rules-engine/
    `总的来说，目前有赞面临的主要风险类型包括：`

    `盗卡。例：盗用用户银行卡，在有赞店铺上消费欺诈。例：通过发布低价商品，诱骗消费者购买套现。例：在自己创建的店铺里进行虚假交易用以套现信用卡垃圾信息。例：发布虚假消息、色情等违规商品、页面盗账户。例：黑客用其他平台获取的账户密码通过撞库来非法盗取用户在赞平台的账户以上所列各种违法、违规行为危害到正常商户以及买家利益，同时也会平台带来资损。在减少对正常用户打扰的前提下如何高效的对风险进行防控，是有赞风控的愿景和使命。作为风控架构的“大脑”，规则引擎的运行依赖于其他系统的支撑，包括：1. 实时特征库2. 规则管理中心3. 风控离线任务4. 运营平台及工具选择了使用较为广泛的JBoss公司维护的Drools。Drools是基于RETE算法的开源规则引擎，它具有性能高、可扩展性好、功能全等特点。有赞风控规则引擎基于Drools进行开发，将事件按业务风险类型进行分类，每类布控具体的规则、模型对风险进行防控。`

    `天下武功，唯快不破，当发生一笔潜在案件时，如果不能在短时间内发现并处理，对于资金类案件来说，有资损的风险；对于信息类案件而言，有垃圾信息被大量曝光、损坏平台声誉的风险。有赞实时规则引擎分为事中和事后两类，其中事中引擎采用了有赞内部的统一接口框架youzan-boot，事后采用了Storm实时流处理框架。有赞风控规则引擎可在100ms内检测、拦截潜在的风险行为。`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15411#respond)

13. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-06-05 17:52](https://ixyzero.com/blog/archives/4270.html#comment-15502)

    【反欺诈场景剖析】虚假账号的产生和流转
    https://paper.tuisec.win/detail/a3cbf677c237367
    https://www.4hou.com/info/observation/18288.html
    `【反欺诈场景剖析】是威胁猎人黑灰产报告的一个系列，我们希望通过对反欺诈实际场景的剖析出发，帮助企业发现业务风控过程重的核心关键点。此篇主要介绍反欺诈场景中虚假账号的产生和流转规模化的背后，以及如何对黑灰产做恶的关键节点的监控来实现对企业自身虚假账号风险的管控。根据威胁猎人鬼谷实验室统计，全网恶意注册发起的攻击每日就可达8327380次。虚假账号平均每日活跃量可达1389107次，平均每张黑卡每日进行6次攻击。`

    `恶意注册是业务风险的起点，也是企业风控的核心关键点。 当今黑产以恶意注册为代表的各类攻击资源已经高度的模块化和市场化，产业链不同层级的团伙专注于不同的任务而又配合严密，而究其根本，是强自动化使得攻击变得可复制，进而形成套路化的盈利模式，对企业资产造成威胁。如果企业无法及时发现问题，采取有效对抗策略，将在业务上面临巨大损失。商业模式转变带来黑灰产核心资源的变化以恶意注册为核心资源的黑灰产作恶恶意注册规模化的背后是效率平台的发展：接码平台——提升了整个黑灰产虚假注册的效率发卡平台——提升了黑灰产账号流转的效率`

    `及时捕获黑灰产行为是控制风险的有效手段识别黑灰产资源（包括但不限于手机号、IP、设备等）分析黑产工具（黑灰产的攻击工具承载着黑灰产的攻击逻辑和利用的企业业务漏洞，通过对工具的监控和逆向，企业可以了解到自身存在哪些业务逻辑漏洞或者是哪些风控策略已经失效，从而提升整个攻防对抗的效率）监控黑灰产交易变化（黑灰产交易品类和价格的变动，能够反映出企业一定周期内风控策略的有效性）`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15502#respond)

14. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-06-05 18:30](https://ixyzero.com/blog/archives/4270.html#comment-15508)

    40页PPT详解反欺诈体系与策略规则
    https://mp.weixin.qq.com/s/d7jSGOpy6pzy_GKju1LfEQ

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15508#respond)

15. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-06-17 16:52](https://ixyzero.com/blog/archives/4270.html#comment-15789)

    黑产在IP攻防上的挣扎与进化
    https://mp.weixin.qq.com/s/ljhNo8RckOt70-3H5j_6pQ
    `不论是在IP这个对抗点，还是在手机号、设备指纹、风险流量和行为等其他对抗点上，传统的【先被攻击】，然后【事后发现】，最后【补充规则】的被动式的对抗方式已经完全无法适应当前与黑产的攻防节奏，研究黑产、了解黑产、掌握黑产的最新技术和动向，才能把控更多主动权。`

    `想打赢业务安全的战争，必须由“亡羊补牢”式的攻防形态向“未雨绸缪”式的攻防形态转型。早期：全网的代理IP数量相对有限，且早期代理服务一般都架设在数据中心的服务器上，不少甲方慢慢开始积累代理IP池，进一步打压了黑产使用代理IP的效果。通俗的讲，秒拨的底层思路就是利用国内家用宽带拨号上网（PPPoE）的原理，每一次断线重连就会获取一个新的IP。秒拨的底层思路就是利用国内家用宽带拨号上网（PPPoE）的原理，每一次断线重连就会获取一个新的IP。这在与甲方的IP策略对抗层面，给予秒拨两个天然的优势：1、IP池巨大：假设某秒波机上的宽带资源属于XX地区电信运营商，那么该秒拨机可拨到整个XX地区电信IP池中的IP，少则十万量级，多则百万量级；2、秒拨IP难以识别：因为秒拨IP和正常用户IP取自同一个IP池，秒拨IP的使用周期（通常在秒级或分钟级）结束后，大概率会流转到正常用户手中，所以区分秒拨IP和正常用户IP难度很大。这两个天然的优势也是秒拨是当前黑产主流IP资源的核心原因。此外，黑产对秒拨还做了升级，称为“混拨”，即黑产把多个省市地区的秒拨资源打通，实现在单台秒拨机上就可以拨到全国上百个地区的IP资源。一台混拨机，成本低至48元/月。当前形势下与黑产在IP层面上的对抗，依靠传统地积累IP威胁情报库的方式，根本无法直接应用和落地到业务侧，典型的使用效果是，对黑IP的检出率很高，对正常用户IP的误判率也很高。`

    `所以，识别风险IP的核心依据应该是，该IP是否当下被黑产持有，IP的黑产使用周期和时间有效性这两个指标尤为重要，尤其是对于像家庭宽带IP、数据中心主机IP这种“非共享型”的IP。针对基站、专用出口等“共享型”的IP，由于单个IP背后会有大量用户，风控阈值应该相对更宽松，但是如果能准确识别IP是否当下被黑产使用，也能提供很重要的参考价值。`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15789#respond)

16. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-06-17 22:44](https://ixyzero.com/blog/archives/4270.html#comment-15796)

    重大新闻 | 陌陌风控系统开源啦
    https://mp.weixin.qq.com/s/quk43WU3Vg9cQmub06Azqg

    陌陌风控系统静态规则引擎，零基础简易便捷的配置多种复杂规则，实时高效管控用户异常行为。
    https://github.com/momosecurity/aswan

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15796#respond)

17. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-06-21 16:09](https://ixyzero.com/blog/archives/4270.html#comment-15886)

    整理知识图谱相关学习资料
    https://github.com/husthuke/awesome-knowledge-graph

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=15886#respond)

18. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-06-28 11:31](https://ixyzero.com/blog/archives/4270.html#comment-16039)

    群控进化史，黑产攻击效率提升带来的防守困境
    https://mp.weixin.qq.com/s/MOziZSkEaKL_eEBTfZInbA
    `0.一波又一波“市面上最好用的群控”`

    `1.玩转谷歌和苹果开源项目的黑产1、群控是啥？2、箱控是啥？2.黑产进化，优化攻击效率和成本1、六成攻击场景以量取胜：随着互联网的发展，黑产形成了一些固定的攻击模式和套路，有大量的攻击场景依附于流量，通过伪装成正常业务，再通过不断重复获利。2、重度依赖黑产基础资源：在黑产市场，像设备这样需求庞大而稳定的“资源”还有很多：IP、身份证、银行卡、支付账号、改机工具、自动化攻击软件、过滑动验证码、隐秘变现渠道等。也都逐渐形成了像接码平台一样的“服务型黑产协作平台”，这些平台越来越多，组合成了一张庞大的黑灰产基础资源网络。黑产攻击也严重依赖这些基础资源。黑产在设备上解决批量攻击的方式有这么几种：1、箱控优化点：将通用类的攻击工具打包配套提供服务，降低了攻击的操作门槛2、租赁模式——“云手机”优化点：租赁模式，自由“扩容”，降低了维护设备成本，且方便备份传输设备信息3、中控优化点：解决了传统群控因数据线传输屏幕数据和指令数据造成的设备数量限制问题。4、云控优化点：设备无需在同一地点，脚本命令存储在云端，团伙间交易脚本时无需发送源码，方便了脚本传播和管理大量手机5、群控优化点：早期的批量操作设备解决方案，在脚本开发上限制较多，为避免卡顿，设备数量限制在百台左右。3.如何应对？面对当今黑产这样产业化、专业化、团伙化和链条化的运作模式，攻防对抗将是企业与黑产双方不断厮杀成长的一场持久战，且敌暗我明，该如何应对？通过反欺诈情报（事前预防，事后根据攻击方法找到防护点）+欺诈数据标签（定位攻击流量）的综合对抗。填补认知盲区，打平信息差，了解对方的目标、攻击思路和策略。熟悉对方的作恶成本，了解对方发起攻击所需要的资源、时间、金钱成本、渠道门槛、对接的上下游以及通过攻击得到的营收等。在业务侧，综合审视自己的目标，对比双方资源、调整策略，定位到黑产的攻击账号、流量等，予以打击防护。黑产以量取胜，但也因为如此，批量就一定有迹可循。`

    `黑产有庞大的上游基础资源供应，但同时也非常依赖这些资源，这些是产业链的关键结点，也同时是我们识别、打击和防护的有效结点。`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=16039#respond)

19. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-07-17 15:59](https://ixyzero.com/blog/archives/4270.html#comment-16453)

    海量数据下的舆情分析，该如何搭建？
    https://mp.weixin.qq.com/s/X3RVXKi40uEO7ra8mX_C-w
    `大数据时代下，除了媒体信息以外，商品在各类电商平台的订单量、用户的购买评论，都会对后续的消费者产生很大的影响。商家的产品设计者需要汇总统计和分析各类平台的数据做为依据，决定后续的产品发展，公司的公关和市场部门也需要根据舆情作出相应的及时处理，而这一切也意味着传统的舆情系统升级成为大数据舆情采集和分析系统。具体细化看下大数据舆情系统，对我们的数据存储和计算系统提出了以下需求：`

    `海量原始数据的实时入库：为了实现一整套舆情系统，需要有上游原始输出的采集，也就是爬虫系统。爬虫需要采集各类门户，自媒体的网页内容。在抓取前需要去重，抓取后还需要分析提取，例如进行子网页的抓取。原始网页数据的处理：不论是主流门户还是自媒体的网页信息，抓取后我们需要做一定的数据提取，把原始的网页内容转化为结构化数据，例如文章的标题，摘要等，如果是商品点评类消息也需要提取有效的点评。结构化数据的舆情分析：当各类原始输出变成结构化的数据后，我们需要有一个实时的计算产品把各类输出做合理的分类，进一步对分类后的内容进行情感打标。根据业务的需求这里可能会产生不同的输出，例如品牌当下是否有热点话题，舆情影响力分析，转播路径分析，参与用户统计和画像，舆论情感分析或者是否有重大预警。舆情分析系统中间和结果数据的存储，交互分析查询：从网页原始数据清洗到最终的舆情报表这中间会产生很多类型的数据。这些数据有的会提供给数据分析同学进行舆情分析系统的调优，有的数据会提供给业务部门根据舆情结果进行决策。这些查询可能会很灵活，需要我们的存储系统具备全文检索，多字段组合灵活的交互分析能力。`

    `重大舆情事件的实时预警：对于舆情的结果除了正常的搜索和展示需求以外，当有重大事件出现我们需要能做到实时的预警。`

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=16453#respond)

20. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-09-10 15:26](https://ixyzero.com/blog/archives/4270.html#comment-20752)

    网易严选风控实践（上）-打造现代化的风控体系
    https://sq.163yun.com/blog/article/183304443737464832

    网易严选风控实践（中）-剑走偏锋，我们的搏击技法
    https://sq.163yun.com/blog/article/183314121689489408

    网易严选风控实践（下）-思考与探讨
    https://sq.163yun.com/blog/article/183314611296591872

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=20752#respond)

21. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-09-10 15:26](https://ixyzero.com/blog/archives/4270.html#comment-20753)

    揭秘：去哪儿的安全风控体系
    https://www.infoq.cn/article/4SViis2kB4hNSzc4omoQ

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=20753#respond)

22. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-09-10 15:26](https://ixyzero.com/blog/archives/4270.html#comment-20754)

    对于移动端 App，虚拟机注册或类似作弊行为有何应对良策？ – 梁川的回答 – 知乎
    https://www.zhihu.com/question/33537532/answer/64966375

    第三方支付公司风控系统都有哪些？ – 梁川的回答 – 知乎
    https://www.zhihu.com/question/29222904/answer/56086446

    支付类app，支付功能的测试思路有哪些？ – 梁川的回答 – 知乎
    https://www.zhihu.com/question/26615672/answer/51772106

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=20754#respond)

23. ![img](https://secure.gravatar.com/avatar/e1eb684cb47527e1733ebcf72b5a4385?s=34&d=blank&r=g)**hi**

    [2019-10-13 16:32](https://ixyzero.com/blog/archives/4270.html#comment-24652)

    基于 Apache Flink 和规则引擎的实时风控解决方案 
    https://mp.weixin.qq.com/s/RnUnMtlm4M6nPvjvmo8HWw
    `对一个互联网产品来说，典型的风控场景包括：注册风控、登陆风控、交易风控、活动风控等，而风控的最佳效果是防患于未然，所以事前事中和事后三种实现方案中，又以事前预警和事中控制最好。`

    `这要求风控系统一定要有实时性。本文就介绍一种实时风控解决方案。`

    `1.总体架构2.风控系统2.1 实时风控2.1.1 前置过滤2.1.2 实时数据准备2.2.3 规则判断2.2 准实时数据流3.分析系统前面的东西静态来看是一个完整的风控系统，但动态来看就有缺失了，这种缺失不体现在功能性上，而是体现在演进上。即如果从动态的角度来看一个风控系统的话，我们至少还需要两部分，一是衡量系统的整体效果，一是为系统提供规则/逻辑升级的依据。`
    1.从 Drools 规则引擎到风控反洗钱
    http://archive.keyllo.com/L-编程/drools-从Drools规则引擎到风控反洗钱系统v0.3.2.pdf

    2.基于 Groovy 的规则脚本引擎实战
    https://www.jianshu.com/p/d6f45f91bede

    3.基于规则的风控系统
    https://jinfei21.github.io/2018/09/29/基于规则的风控系统/

    4.网易严选风控实践
    https://sq.163yun.com/blog/article/183314611296591872

    5.网易考拉规则引擎平台架构设计与实践
    https://sq.163yun.com/blog/article/213006222321659904

    6.一个开源 java 风控系统
    https://github.com/sunpeak/riskcontrol

    [回复](https://ixyzero.com/blog/archives/4270.html?replytocom=24652#respond)

## 58集团风控实战指南

原创： 孙亚健 [58安全应急响应中心](javascript:void(0);) *2018-09-30*



**前言**



​    58同城从2005年12月12日成立起至今已经接近13个年头了。一路走来，58同城从一个分类信息网站慢慢变成了58集团。虽然58集团在不断践行自己“让生活简单美好”的使命，但是在前行的过程中，因为58产品模式的特殊性，信息安全永远是备受争议的话题。所以提升信息安全，让用户可以放心的在58同城找工作、找房子、找服务是58人从始至终不变的追求。 



​    在开始整个文章之前，需要针对58当前的风控大环境做一些简要介绍：58集团下业务众多繁杂，覆盖着招聘、房产、黄页、二手等多个业务领域。产品形态绝大多数是listing的信息展现。这种产品形态伴随着大量的UGC内容，并且信息被获取后，一切后续的交流都在站外完成。对于风控来说，大量的UGC内容、非闭环难监督的交易流程决定了58整体风控的难度非常高。对于黑产从业者来说，58的产品形态又非常适合攻击，转化路径相对较短，收益异常丰厚，所以一直以来，58与黑产始终处于一个高强度的对抗中。在不断的对抗过程中，58也积累了很多宝贵的风控经验和方法。



​    这篇文章将会从产品和运营视角来针对风控的方法和手段进行阐述，目的就是将58多年与黑产对抗的经验总结和分享出来，一方面让大众了解下58在信息安全上付出的努力和我们这群站在产品背后的安全人，另一方面也想与各行业的安全从业者共享我们不断在对抗过程中积累出的行之有效的风控方法，希望对大家产生帮助。最后也希望借助这篇文章去搭建起58信息安全部与大家沟通的桥梁，一起为互联网安全贡献一份力，为“天下无贼”的目标而努力。



**一、黑产行业与特点介绍**

 

**黑产行业规模与产值：**



据统计，截止至2017年，中国黑灰产业从业人员已超150万，年产值达千亿级别。从业者分布前三为广东、江苏和浙江。

 

**黑产特点：**

 

**有利益存在的地方就有黑产存在：**

**
**

黑产遍布在互联网的各个领域，无论一个平台提供的是什么样的产品，只要这个产品可以带来收益转化的可能性，这个平台就会成为黑产的攻击目标。如果平台做流量分发，那么黑产就会攫取流量进行多次转化，可能是进行线下欺诈，也可能是流量二次分发转化成直接利益。如果平台做的是交易，那么黑产就会变成羊毛党将原本给予用户的优惠转化成自己的利益。如果平台上存在着有价值的数据，黑产就会通过各种手段获取数据进行倒卖。总之对于黑产来说，产品是什么不重要，利益才是唯一的思考方式。

 

**黑产组织的分工：**

**
**

为了攫取更多的利益，黑产会不断的优化他们的攻击模式和团队分工。每个团队专攻一个垂直方向是效率最优解，效率的提升就代表着成本的降低间接影响着最终收益。所以黑产会分化成很多个小团伙，每个小团伙会专门攻击一个方向，最大可能的榨取这部分的所有价值。



以58同城业务场景举例，黑产主要分化以下几种：



通过贩卖数据获利：这部分黑产会通过抓取手段不断的去获取58的信息，通过数据贩卖来获利。这里面存在竞争对手也存在着专业黑产团队。



通过贩卖账号获利：这部分黑产团队会着重攻击58全站的注册和登录环节，不间断的通过各种手段注册账号，盗取账号。再将账号转卖给下游黑产进行获利。



通过认证进行获利：这部分黑产通过一些不法手段获取公民隐私数据，通过攻击个人认证和企业认证的环节完成白号到认证账号的转变。因为大部分业务都有前置认证的条件，所以完成认证的账号价值可能是白号的100到500倍以上。



通过发布信息获利：这部分会利用QQ群或者一些黑产论坛社区承接需求，通过信息发布服务收取服务费用。一般发布的内容都是违规或欺诈内容。这部分也是黑产对抗最激烈的部分。



通过线下欺诈获利：这部分黑产群体就是黑产链条中最底层的组成部分，同时也是数量最庞大的群体。他们通过虚假信息进行58站到微信或者QQ或者线下的转化，由此完成欺诈行为获取直接金钱收益。



上面是跟58对抗的黑产群体的一个简要画像，其实真实的情况要比描述的复杂很多，很多分工是有交叉或重合的部分，或者存在着更细的分工。同时也存在着一群不直接攻击58,但是为这些黑产从业者提供所需资源的群体，比如一些卡商，隐私数据的二道贩子等。

 

**有获利的可能对抗就不会停止：**

**
**

只要平台存在着价值，就一定有产生利益的可能性，有可能性对抗就会永远进行下去。与黑产的对抗是一场战争，只有当黑产的收益没法覆盖成本的时候，对抗才会逐渐减少。这个时候黑产会向另外的平台或产品进行转移。

 

**二、业务风控的治理经验**

 

​    **风控的核心点：**

**
**

上文提到，只有当黑产的收益无法覆盖成本的时候，对抗才会减弱和转移。那分析黑产的成本组成就是一个比较重要的事情。



黑产的成本按照比较粗的粒度可以分为两类：



第一类是人力成本，一切黑产技术的研发，欺诈的实施等等环节都离不开人的参与。



第二类是资源成本，黑产想要完成攻击要准备很多的资源，比如IP、手机号、设备、身份证信息、银行卡、企业信息等等。每一步的黑产攻击都绝对离不开资源的支持。



所以我们看到，如果想要让黑产的成本不断攀升，我们只需要去提升黑产的人力成本或者资源成本就好。两者对比起来，对人力成本的控制效果难以预估，难度颇大，受影响因素大。而对资源成本的控制对于企业来讲简单可行并且行之有效。



所以通过上面的分析，我们可以得出一个结论：**风控的核心在于对黑产资源的打击。**

**
**

另外补充一点，资源之所以称之为资源，需要具有稳定的唯一性和不可再生的特征，一旦一个资源被打击，这个资源在业务中就再也不会为黑产带来利益。

 

​    **风控治理的切入点**

**
**

​    当遇到需要解决的风控问题时，基于我们一直以来的经验，我们会推荐从以下两个方向去分别思考和解决。



​    第一个是基于业务流程去思考风控方法，第二个是基于治理流程去思考风控方法。

 

   **基于业务流程的风控治理方法：**

**
**

​    在介绍这种方法之前，需要普及两个前提：



​    1.如果一个用户是黑用户，那么他在所有的业务流程中产生某种行为的目的极大概率上是为了提升最终获利转化，那么他在每一个业务节点上产生的行为都大概率是异常的。



​    2.我们无法指望在一个业务节点上解决所有的安全问题，所以基于业务流程去思考风控治理的时候，我们首先要绘制出来完整的用户行为路径。绘制用户行为路径的目的是摸清每一个可能产生异常行为的业务位置，并且通过每一个位置的分析去逐步打击最终实现治理效果。以58的发布为例，我们可以绘制出这样路径：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

​    根据这个路径我们一般会产生这样的解决方案：



​    \1. 当用户只产生流量没有实际userid产生时，分析流量分布和浏览行为，提取异常数据流入注册环节作为辅助数据。

   

​    \2. 当用户注册时，分析这次注册是否为正常注册，如果产生批量注册、养号等异常行为，针对账户或相关资源进行高危标记。如果判断不了，数据留存转入登录环节进行判断。



   \3. 当用户登录时，判断登录行为是否异常，是否是撞库、爆破、异常环境等。如果是，核验账号身份，并且做出标记流转至发布环节判断。



   \4. 当用户发布时，判断发布行为和内容两部分是否异常。如果异常则阻止发布或者进行挑战。并且将数据同步至全部环节作为辅助。



​    \5. 当产生申诉投诉时，回归策略准召率进行相应优化并且妥善处理相关异议。将确认的数据同步至全部环节作为辅助。

 

   可以看到按照这种方法去思考，我们没有在一个业务环节中去解决所有的安全问题，而是将用户的行为进行拆分，在每一个业务节点都努力将问题率控制在最低，这样就达到了各个击破的效果。这种方法在黑产每一个动作上都产生了影响，因为黑产追求高效，有不同的团队分工，所以黑产在行为上不是连贯的而是分离的，所以黑产想完全消除掉这种影响成本非常巨大。这样也就能产生比较好的风控效果。

 

   下面是基于这个方法的一个总结和核心注意事项：



   \1. 每一个关键的业务节点，都应尽可能有效的完成风险控制，不能将所有的风控问题寄托在一个业务节点的风控治理中



   \2. 每个业务节点的数据串联是重中之重，当前业务节点产生的所有有效结论，都应该流入下一个业务节点作为辅助特征。下游节点产生的确切结论，也应反哺上游判断。

   

   \3. 关于异常行为的处理方法：



   (1) 离获利转化越远的业务节点，越不应该做直接阻断和强对抗。比如在注册环节直接拦截注册行为，我们就相当于为黑产提供了试错机制，只要一个账户注册能突破现有策略，那么这个业务节点的风控就相当于完全沦陷。针对这样的业务风控，我们需要做的是做出有效的标记并完成流转。让阻断、封禁、删帖这种类似的处理方法在最后的转化关键节点中完成，这样会给将黑产作弊或攻击的成本提升N倍。



   (2) 各种挑战方式，比如验证码等，如不能明确得出风险结论，则用来采集数据作为后续的风控辅助数据。



​    (3) 因为黑产分工在行为路径上分离的特点，不定时的确认用户在各个业务环节中的身份一致性是一个好方法



   (4) 处理方法应该有轻有重去适用各种策略准召率的情况，处理要尽量做到可以限制每一个关键业务环节的权限



​    \4. 尽量做到有限资源被明确定性之后，一切业务环节都参照相关定性去完善识别能力。

 

​    如果说，上面提到的基于业务流程的风控治理是在确保风控的效果，那么下面介绍的基于治理流程的风控方法就是进入到每一个风控节点去确保效率。

 

   **基于治理流程的风控思考方法：**

**
**

​    当我们基于治理流程去思考的时候，我们需要介绍下在任何一个需要风控的业务场景中，面对风险我们的一般的治理流程：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

​    如果当我们只考虑某一个具体的风控业务场景时，我们最好的方法就是通过去不断提升每一个治理环节的效率去提升整体风控的效率，风控的效率提升了，我们就可以在有限的时间内做出更多有效的决策用于黑产对抗，频率越快给黑产带来的成本增加越高。

 

​    所以基于这种思考方法，我们要做的就是针对每一个风控环节制定产品解决方案，将效率做到极致。下面就是58关于这个流程的一些整理

**
**

   **风险发现环节**：发现什么、怎么发现、怎么快速发现是核心痛点



​    \1. 发现什么：什么是我们要解决的安全或风控问题，就发现什么

​      1) 安全漏洞

​      2) 垃圾信息

​      3) 重大舆情

​      4) 黑产资源



​    \2. 怎么发现：通过什么样的手段来发现风险

​      1) SRC、漏洞扫描器（漏洞）

​      2) 聚类分析、信息巡检抽检（垃圾信息）

​      3) 舆情抓取分析（重大舆情）

​      4) IP画像、手机号画像（黑产资源）

​      5) 一些第三方提供的威胁感知能力



​    \3. 怎么快速发现：整个监测预警机制的搭建

 

​    **风险分析环节：**如何快速分析产生决策是核心痛点。



​    对应着一些核心能力：智能分析平台、风控引擎、算法孵化平台

 

​    **风****险处置环节：**如何处置、处置哪些。



​    如何处置：

​    我们将用户所有的权益进行总结，以58为例，用户可以拥有：发布的权益、浏览的权益、账户使用的权益、推广的权益等，在每一个关键的权益上都需要有着灵活的处理方法。



​    处置哪些：

​    所有资源类的唯一性数据都是处置的范围，处置的时间范围应该覆盖过去和未来，当一个资源被定性成黑产，那么相关的所有资源都会被处理，最大程度的提升黑产对抗成本。



一些核心能力：聚类处理、社区挖掘、策略回溯

**
**

   **效果回归：**通过对已产生效果的策略生命周期进行监控，随时关注在业务中的准召率，并及时作出优化

 

​    以上就是在58风控业务中常用的两个切入点，不同的思考方法适合不同的风控阶段。比如对于风控初期的业务，到处救火是常态，可能基于业务流程的思考方法更加适合，这样就可以从整体上去思考快速建立起一套比较有效的风控体系。如果对于风控稳定期的业务，可能更加追求稳定和可控，基于治理流程的思考方法可以帮助业务进一步的提升风控能力，让每一步产品动作都会产生价值沉淀，每一步的沉淀都会让风控这件事情变得更加得心应手。

 

**写在最后**

 

   以上是关于58在风控这个领域中积累出的一些比较行之有效的方法论，但是因为时间原因很多风控执行的细节、一些核心技术的架构和实现方法都没有做具体的介绍，后续如果有时间，可能会分别针对某一个细节方向相关的风控经验和产品架构做一些分享。这次还是希望能通过这样一个相对还算完整的风控思想体系来为各位安全行业的同学们提供一些思路，对自己的业务产生一些帮助，这样的话，这篇文章的目的就算是达到了。

 

   如果各位有兴趣在风控领域进行一些比较深入的交流，欢迎关注**“58安全应急响应中心”**公众号后台私信我们，让我们一起为互联网安全的发展贡献出一份力。

## 关于风控预警体系的搭建方案

原创： 孙亚健 [58安全应急响应中心](javascript:void(0);) *1月24日*

​    之前的文章讲了关于业务[风控整体](http://mp.weixin.qq.com/s?__biz=MzU4NTMzNjU4Mw==&mid=2247484073&idx=1&sn=1b2727399ce172507e9f77d6a9af4f24&chksm=fd8d50c1cafad9d7ce8ff7a70a0434aea84490ea89ef4a70af579825771209509d5bc0426e03&scene=21#wechat_redirect)的一个架构和基本的思考方法，今天针对风控链路中的“风险发现”环节做一个系统的介绍，由此来帮助大家快速的发现异常，减少对应的业务损失，快速止血。

   在开始介绍之前，我们先来看一下在通常情况下，预警系统都是如何设计和实现的：

   一般的业务在做预警时，通常将”快速发现异常”作为核心问题去解决，通过一些预警规则的设置来进行异常的发现。



举个例子：

当发布量环比增加大于15%，同比增加大于20%，绝对值大于3000时给相关人员下发邮件&发短信&打电话进行预警。

   这种预警方式有两个比较大的弊端：



1、预警规则配置相对死板，阈值大多通过运营或运维人员拍脑袋，预警规则本质上也跟风控规则一样，是需要提取有效特征并且持续保证准召率的。可是绝大部分的预警系统设计只有少的可怜的特征参考和几乎永远都不会去动的阈值。而且维护的指标越多，对应的运营成本越大，越到后面越难以维护。

2、这种预警方式只能定位“异常”却无法确认“风险”。比如说，当某一天的发布量突然暴增，那么按照这种设计方法，运营人员一定会收到相应的报警邮件，可能经过定位后，发现实际上是业务端做了拉新或促活的活动。那这个时候，预警其实只是发现了今天的发布量是不同于平时的，但是关于这个异常到底是因为有黑产大规模攻击还是业务正常增量其实是无从得知的。



   所以因为这两种弊端的存在，我们经常会在预警系统上线初期短暂的关注一下相关报警，时间长了以后，因为经常误报和漏报，我们逐渐的就忽略了报警的存在，那预警系统存在的意义也就大打折扣。

   基于上面的例子我们发现，当我们只考虑如何快速发现异常的时候，预警系统的效果是很难到我们的预期的，所以要想搭建一套有效的预警体系必须要解决两个核心问题：



   \1. 如何快速发现异常

   \2. 如何准确定义风险

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

 **如何快速的发现异常**

   **一、****通过核心指标的变化发现异常**

​    无论我们在负责什么样的工作和项目，核心的指标趋势都是我们关注的重点，一般当核心指标的曲线发生大幅变化的时候，我们就会意识到一些事情发生了，所以关于指标曲线的分析和预测是我们第一个发现异常的方法。

​    在这里我们为了使异常点寻找的更准确，使用了一些算法的能力来达到对核心指标的预测与异常点/片段定位的能力。

​    **智能预测与异常检测的技术架构**

**
**

​    **离线部分：**

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

​    在这部分里，我们通过对一个指标原始数据进行标记，提取相应特征，通过回归模型做出预测，通过分类模型做模型的输出。

​    **实时部分：**



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

​    然后在实时的数据监控中调用离线产生的模型，标记出异常点和异常片段。

​    我们通过这种方法可以做到输入任何一个核心的指标数据，只要这个指标是基于时序的并且周期变化的，就能比较准确的定位到异常的发生。

​    给大家看一下在实际工作中产生的效果：

   **普通异常：**

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

​    **严重异常：**

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

​    **陡变异常：**

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

   通过这样的方法，我们可以几乎无成本的扩充我们的监控范围，可以将某一个指标继续进行细分到最细粒度，也可以大幅扩充不同的指标用来辅助监控。这样当发生异常的时候很容易被我们捕捉到并且定位到最细粒度。



​    **二、****通过聚类手段发现异常**

​    在风控领域，黑产或攻击者为了使收益最大化，会最大限度的利用已有资源，这个资源可以是一段内容，一张图片也可以是一个ip，一个手机号。所以因为这样的原因，当发生风险的时候，一般会产生比较集中的聚集行为，可能是一样的行为轨迹，一样的手法，一样的文本内容等等。所以聚类的分析也是一个发现异常的重要手段。

​    **基于资源的聚类**

​    当某一个资源频繁的出现并且进行一些业务操作时，比如一个手机号，一个账号。我们认为这存在一些异常行为。

​    **基于内容的聚类**

​    当某一段文本，某一张图片频繁的出现的UGC内容中时，我们认为里面存在一些异常行为。

​    **基于行为的聚类**

​    当某一种行为轨迹频繁的复现，我们也认为里面存在着一些异常行为。

​    **基于属性或关系的聚类**

​    通过一些社区挖掘或无监督学习的算法，将一些实体聚集成一个簇或一个群组。当这个簇变得非常大的时候，这里面有很大的可能性存在着异常行为。

​    通过聚类的方式，我们可以察觉到很多通过指标监测难以找到的异常，上面说的方法不是全部，可能还要根据更多维度的聚类行为都可以进行监测或者分析。这部分对于整个安全风险发现效果十分显著。

   **三、通过其他手段的异常发现**

除了针对指标数据的预测和异常提取、通过聚类的异常定位，还有很多其他的手段用于异常发现，比如是否有流畅的反馈机制，是否有前台的巡检或抽检机制。这些机制都可以有效的帮助我们快速的发现异常，不同的手段覆盖的范围不尽相同，但是可以起到相互补充的作用，避免异常被隐藏造成业务影响。

这里如果有其他行之有效的异常发现方式，也欢迎大家私信交流共同进步。

以上就是关于异常发现及定位的方法，有了异常只是预警的第一步，这个异常到底业务的正常波动还是一个重大风险才是我们关注的内容。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**如何准确的定义风险**



上面我们已经通过各种途径获取到了异常，那么我们应该如何将这个异常做一个有效的定义呢？

说到定义，就一定会有人的参与，只有通过人的经验才能有效的判断出某次异常是不是个风险，但是如果定义的工作全部交于产品运营或者技术人员，人力的成本就会巨大，而且会被其他工作打断或搁置。那既然必须有人的参与，为何不让人力成本更低的审核人员或者标注人员在无感知的状态下完成异常的定义呢？所以我们采用的就是这样一个相对取巧的方式。

**风险定义流程**

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==) 

我们将通过各种方式收集到所有的异常拿出来，找到异常对应的实体，比如是信息发布量的异常，就拿到这个异常片段中对应的信息；如果是聚类的异常，就会找到这个簇下的全部实体。将一次异常的实体进行实时的抽样直接流转入审核平台作为审核任务，审核人员就会在无感知的情况下去将相应实体进行审核，得出的审核结果就可以将这个异常对应的实体进行明确判断。这样就可以针对一次异常得出类似80%是虚假信息，20%是正常信息的结论。

得到结论后我们可以根据情况来灵活的调整正常信息与虚假信息比例的阈值，当阈值满足一定的条件时，我们就可以将异常直接定义为风险。甚至可以根据各种异常发现的手段来明确的说明风险发生在什么位置，有着什么样的具体表现。 

以上就是关于风控预警体系搭建的一些心得和方法，我们通过“异常发现”和“定义风险”这两个核心部分来产出靠谱的报警，这套体系因为可以产出明确的结论以及对应的实体分布，在预警体系的下游还可以用一套智能分析引擎去承接，根据产出的明确的正负样本去自动结合现有风控特征进行计算，通过准召率的筛选，产出对应的风控策略推荐或生效策略。这是后话，后面有时间会逐步分享给大家。

## 业务安全：不只是跑赢最慢的那个人

原创： Piz0n [Piz0n](javascript:void(0);) *2018-12-01*



**
**

**[1] 引子：后有群狼**

**
**

有人讲安全是一场残酷的追逐赛 —— 我们只要跑赢最慢的那个人，身后的老虎就不会扑向我们。

殊不知，这个年代的信息安全，追逐我们的并非一只猛虎，而是一队群狼。



在这个年代的信息安全环境中，没有人能够幸存，我们已经不再争议谁还没有被黑，只是在考虑，谁才有被黑的价值。

黑客们所操心的也不再只是黑掉谁，而是如何能从硬盘堆叠的数据里洗出他们想要的目标。



所以，仅仅是跑赢最慢的那个人，我们就能得以幸免么？





**[2] 业务安全，性价比为王**

**
**

在MD5还没有碰撞的年代里，每每提及加密，总是在谈其成本。

一个加密算法强悍到要用当前最先进的计算机跑上一百年，这样的成本是黑客所不能接受的，因此，眼前这种消耗一百年的算法就成为了安全加密的最佳选择。



安全其实就是这样，垒砌砖墙的目的不是在于其设计工艺的高端和完美，只要能够提高黑客的攻击成本，就是成功。

在“银行卡四要素”价格直逼400块的那个时间里，我看到了一款新上线的个人小微贷款平台。四要素一旦验真成功，直接放贷300块 —— 这样的设计，不需要跑赢谁，他们只是跑赢了市场成本。不会有人花近400块的四要素来薅300块的羊毛。如此看似简单粗暴的解决方案，实际上却透露着难得的精致。



其实在信息安全建设过程中无处不透露着这样的性价比计算方式，而业务安全，更为甚之。

毕竟，在这里，每撸一把都是真金白银。黑客眼中的目标也都是以纯粹的性价比来观测，只是跑赢了其他竞品，并不代表跑赢成本，只要有利可图，就会成为目标。



**[3] 海恩法则变身海恩陷阱**

**
**

> 海恩法则(Heinrich's Law)，是德国飞机涡轮机的发明者德国人帕布斯·海恩提出的一个在航空界关于安全飞行的法则，海恩法则指出： 每一起严重事故的背后，必然有29次轻微事故和300起未遂先兆以及1000起事故隐患。
>
> 
>
> —— 摘自百度百科



类似的方法论我听过很多。归结其原理，无非就是在一连串的业务动作中追踪每个可疑的动作，当可疑的动作叠加过多时，便可能由可疑变为非法。

可是设计者们是否考虑过，在海恩法则背后，还有幸存者偏差一说。我们在每次数据采集时，如果并不完整或选择性忽略，一点遗漏就可能谬之千里。于是，海恩法则也就变成了海恩陷阱。



> 幸存者偏差（Survivorship bias），另译为“生存者偏差”或“存活者偏差”，是一种常见的逻辑谬误（“谬误”而不是“偏差”）。指的是只能看到经过某种筛选而产生的结果，而没有意识到筛选的过程，因此忽略了被筛选掉的关键信息。在“沉默的数据”、“死人不会说话”等等日常表达中，涉及幸存者偏差。
>
> 
>
> —— 摘自百度百科



因此，贯彻海恩法则的前提是：业务逻辑的完整性、业务流程的完整性、原始数据、完整数据、线下能力。



- 业务逻辑的完整性，不只是业务**应该如何运转**，而是**业务实际如何运转**。有些事情不能用耳朵听，而是需要用眼睛看。
- 业务流程的完整性，相对业务逻辑来说更强调参与者，有些意想不到的参与者可能就是让海恩变身陷阱的关键。例如，客服。
- 原始数据，对于非原始数据，其加工逻辑一般多是写出来便会常年不变，在岁月的积累和代码的迭代中不断被深藏。当出现问题想要回溯时，这个环节往往就成了被遗忘的角落。所以，规则处理的不应该是已经处理过的数据，而应该是原始数据。
- 完整数据，完整数据并不是强调完整，毕竟一条业务流的数据既要原始又要完整，在实际操作中是不现实的，所以数据的完整性在于对业务逻辑和业务流程的选择性覆盖。
- 线下能力，很多能力并不一定需要在线上完成，而是可以线下完成，减轻线上压力的同时，也能更好的保证几个环节的完整性和原始性。



**[4] 长逻辑规则的衰减**

**
**

海恩法则的应用，多是在业务流动过程中设置多处埋点、等待多个埋点触发异常，进而形成“多个偶然等于一个必然”的效果。



但是，如同信息在传递过程中的衰减一样，这种“长逻辑”的规则，在传递的过程中衰减也是相当严重的。

而且，这种衰减多是隐藏在业务侧和用户侧，再外加一些偶然因素，最终导致难以发现问题根源。

所以，复杂的串行规则必须在每个埋点上精益求精力图**每个埋点覆盖所有可预期场景，并且以100%的覆盖与准确性为目标****。**即便如此，最终获得的结果也必然是一个折扣值。



**[5] 让情报团队走出去**

**
**

业务安全伴随着情报团队的出现，带来了很多更靠前的能力。

然而在实际操作中，却少有业务安全团队利用好情报团队的情况。

我看到更多的情报团队都是在买数据、洗数据、建平台。说起来，这也没毛病 —— 不过这样做的再多都只是锦上添花。

 

业务安全团队原始积累多在业务侧，情报团队的积累多在攻防。

这是一个看起来就很完美的结合。如果情报团队能够再向外延伸一下，看看外面谁在搞我们、用什么搞、怎么搞、多少钱搞、搞到什么程度、搞了赚多少、搞竞对赚多少 ……



如果说市场研究是从正向去梳理一个行业的框架，进而比对行业内不同企业的生存现状与关系的话。

那么，情报团队完全可以做到，从一个黑暗面去梳理这个行业的框架，用黑色的视角来比对、梳理这个行业内各家企业的现状与关系。



**[6] 把战场拉回到眼前**

**
**

情报团队走出去的目的并不是把战场放到外面。

在业务安全对抗中，战场必须在我们的眼前。因为眼前有我们的主场优势，借此优势才可能更快、更准的发现和响应。



而做法，因人而异。很多人喜欢以**进不来*****\*为目标\****。我更喜欢**出不去**。

这并非来自某种与众不同的批号，而是，对手留下的脚印越多，对我们的定位、追踪和打击才会越精确。



这就好像很多人都一定遇到过的场景 —— 爬虫背后的秒拨IP，量大、有效时间短、缺少黑特征。

所以，在第三方厂商的情报团队视角去看，尝试对全网的IP去识别哪些IP是秒拨，难度极大，而且因为时效性等问题，导致这种高难度的标记工作最终准确性很低。

然而在业务侧，利用业务场景做准实时的识别，就会容易的多，而且也更为有效，轻轻松松做到90%的准确率。



**[7] 运营大盘：告警、趋势与分析**

**
**

运营的观测指标，从分类上来看有三类：

- 告警类：准时的展示、拦截；
- 趋势类：饼图、柱图、折线等等。一般以天或小时级别，观测整体的趋势，不适合细粒度分析但可从宏观侧面观测并找到可疑的方向；
- 观测分析类：也以各种饼图、柱图、折线为主，但会比趋势类的展示在某些维度的粒度更细，例如，5-10分钟级别，甚至按地域和用户细分，等等。一方面，用于在可疑方向上进一步确定问题，给分析人员指向原始数据内的分析方向；另一方面，也可在不那么微观、但也不那么宏观的层面上，通过流动性的走势发现一些在原始数据和宏观数据里都无法发现的问题。



观测分析类的盘面，往往是几分钟甚至一两分钟就刷新一次，因此很热容易审美疲劳，导致其价值容易被忽略。



**[8] 标准化才能不折腾**

**
**

有人觉得安全运营很折腾。

有这种感觉的话可以评估一下，日常标准化（是标准化，不是自动化）工作内容所耗费时长（人*小时）占据整个团队的工作时长（人*小时）。

这个指标并没有什么黄金比例数据可以参考。但在我看起来，标准化工作应该占据到60% 以上，甚至更多。简言之，好的运营应该偶尔有些刺激但多数略显无聊才对。



什么是标准化。

标准化不等于自动化，就好像设备装配流水线一样，每个环节装什么、装到什么程度、如果出现什么意外则应该如何处置，这是标准化。

很多人觉得团队已经做了很多标准化的工作，但实际上，标准化的很多工作会细致到无法想象。



单说一个事件触发后的响应动作中，确认事件是否需要启动响应的一个环节：

- 要查什么；
- 要去哪里查；
- 查询工具是什么；
- 工具的输入是什么；
- 不同情况的输出分别代表什么；
- 每种输出所代表的内容，又对应了什么样的后续动作；
- 结果通过什么形式反馈；
- 结果都需要反馈给谁；
- 事件该如何记录；
- 事件是否需要复盘；
- 是否有可改进的指标；



很多所谓的标准化，大概就是一个动作外加一个“是”或“否”。对于有经验的团队来说，这样两步走的标准化确实足够了。

但如果想组建一个长期保持高效率、高性价比的运营团队的话，就必须采取更详尽的形式了。



至于为什么。

这其中的原因很多，不单只是技术的考量，更多的是从打造团队的更大视角去考虑。



接下来再说60%的问题。 

标准化的制定过程，如果围绕的是非常具体的事件，就会发现，事件的数量是无穷无尽的。

而标准化若是围绕着一个合理的分类去进行的话，那就能够确保有足够好的覆盖度。

所以本质上来说，我觉得运营的根基工作在于识别与分类能力。

运营团队的leader 应该花极大的精力关注在这个问题上。

如果你觉得运营团队在标准化方面不好，或是效率低下，或是每天都在无序的变化。

那么，可以考察一下这个团队leader在归纳总结方面的能力，必有收获。



**【9】结尾**



反正，就是个结尾。

## 唯品会舆情监控系统

姚彬炎 [唯技术](javascript:void(0);) *2月26日*

**背景和现状**



唯品会作为国内发展迅速的大型电商之一，在微博、微信、贴吧、app应用市场等各大网络渠道上，每天会有大量关于唯品会的用户交流、评论、反馈等舆情信息产生。而这些舆情信息中，往往包含着对公司的各种建议、用户心声、体验反馈等有用信息。因此，收集并分析用户的评论反馈，对于企业了解用户的心声和需求、提升用户体验、提高运营效率等方面将有较大的帮助，同时也是产品制定需求的重要参考依据。不过，目前的用户反馈、评论收集、评论分析工作存在着如下主要问题：



- 各个渠道的用户反馈评论信息分散、琐碎，不利于收集，人工爬取评论的速度较慢，成本较高；
- 评论的数量很多且非结构化,分类及语义分析依靠人工效率低下；
- 预警的速度较慢，出现问题无法及时预警，等到发现时，损失已造成；
- 无法对线上舆情形成长期有效的监控，可读性不好，用户体验差。





而互联网舆情监控系统可以很好地解决上述问题，它利用爬虫、搜索引擎、文本挖掘等技术，通过对网络上相关的信息自动采集处理、智能聚类分类、统计分析等，实现各方对自己相关网络舆情监督管理的需要，最终及时形成舆情分析报告、舆情预警等信息，为相关人员全面掌握舆情动态、了解用户心声、调整制定方针政策，提供分析依据。

 

**总体介绍**



目前，市面上有腾讯企鹅风讯、百度舆情、七麦数据等舆情监控系统，这些系统能对市面的上的主流应用app，通过分布式爬虫抓取各大应用市场、主流论坛、微博等渠道的用户评论，并对爬取到的信息进行汇总、智能分类、报表输出等。这些舆情分析系统能简化运营、产品对用户口碑的收集工作，在提供专业的运营质量分析的同时，节省了项目人力。市面上的这些系统虽然能为我们提供一些分析和参考数据，但是也存在一定的局限性，如数据来源有限（一般只能提供微博、app应用市场、论坛等渠道的用户评论信息）、无法实现定制化需求等，因此非常有必要开发属于唯品会自己的舆情监控系统，实现丰富的数据来源、各种定制化的功能需求等。



当前唯品会舆情系统评论数据订阅来源主要有各大App应用市场用户评论、微信公众号评论和唯品会内部的客服留言。在获取这三部分数据后，会做持久化存储，用于后期的文本挖掘分析，如图1所示。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)图1：数据来源

 

系统会对获取的这些评论信息进行情感判定、文本分词、评论分类、词频分析等计算分析工作。舆情系统整体架构设计如图2所示，分为**舆情采集**、**舆情分析**、**舆情应用**三大模块。图3是我们已经上线的舆情系统，本文将着重介绍舆情分析模块中的几个重要功能模块。

 

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图2：舆情系统主要模块

 

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图3：系统展示

 

**系统架构**



上面已经简单介绍过唯品会舆情系统的主要模块，围绕这些模块，我们实现了整个系统，其基本架构如图4所示，下面将详细介绍**情感分析**、**文本分词**、**词频分析**、**分类分析**四个核心系统功能模块的实现。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图4：系统架构图

 

- **情感分析**

传统的文本情感分类一般基于情感词典，它是对人的记忆和思维判断的简单的模拟，如图5所示。首先通过学习来记忆一些基本语料词汇，比如积极、消极和否定词语，这些基本词汇在人们的大脑中形成一个基本的语料库。然后，我们再对输入的语句进行拆分，看所记忆的词汇表中是否存在相应的词语，最后根据这些记忆中的词语类别来判断情感。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图5：传统情感分析

 

基于上述思路，我们设计了自己的基于词典的情感分析模块，主要如下：



1、情感词典设计

与传统方法不同的是，我们的情感词典分为三个部分：积极肯定情感语料库、消极否定情感语料库和干扰语料库，如图6所示。为了得到更加完整的情感词典，我们从网络上收集了若干个情感词典，并且对它们进行了去重整合和调整。对于收集而来的词典并非进行简单地整合，而是有针对性地对词典进行了去杂和更新，以达到尽可能高的准确率。比如，加入了针对我们电商行业相关的一些行业词汇，以增加准确率。此外，引入干扰语料库的目的是排除一些如“能不能”、“可不可以”等容易误判为积极肯定或者消极否定的词。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图6：情感词典

 

2、基本算法

基于情感词典的文本情感分类规则算法比较简单，它将每个情感词语赋予的一定的权重值：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)（权重值需要根据具体行业、业务等做调整），一般来说，积极肯定的词语赋予正数值，我们用：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==) 表示，而消极否定的词赋予负数值我们用：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==) 表示，并且情感权重值满足线性叠加原理。每条评论在剔除干扰词汇后，分别进行积极肯定和消极否定的权重计算。例如，评论中既包含积极肯定词汇也包含消极否定词汇，将评论命中的积极肯定的权重值线性叠加，得到该条评论的积极肯定权重值：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

而将命中的消极否定的权重值线性叠加得到消极否定权重值：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

极性综合判定将得到的积极权重值和消极权重值线性叠加，然后根据用户设定的评论极性权重阀值，最终判定评论的极性，整个情感判定逻辑如图7所示。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图7：情感分析逻辑图

 

3、实现效果

基于上述架构，实现了舆情系统的情感分析模块，它会对每条评论信息自动进行极性的五级（极好评、好评、中评、差评、极差评）划分，并对应5-1分的评分。在评定完一定周期内所有评论的评分后，系统会计算出该周期内所有评论的综合平均分（1-5分，对应一星到五星），类似于部分应用市场的五星等级评价。目前该模块主要针对应用市场的评论进行五级情感划分，如图8所示。通过情感划分，能看到用户对我们唯品会app的一个整体满意度情况。相比于人工筛选划分，能极大的降低人工筛选时间，减少工作量。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图8：应用市场评论五星分级

 

- **文本分词**

一般来说，做文本挖掘首先要做的预处理就是分词。在英语中，英文单词天然的空格有助于计算机迅速识别单词间边界。而中文由于没有空格，让计算机颇为困惑，处理起来难度较大，因此中文分词就是一个需要专门去解决的问题了。



1、分词现状

目前现有的中文分词方法大致可分为三大类：基于字符串匹配的词典分词方法、基于理解的分词方法和基于统计的分词方法。比如，基于字符串匹配的正向最大匹配法、逆向最大匹配法，基于统计的N-gram模型思想等等。目前比较流行的中文分词工具有jieba、SnowNLP、THULAC、HanLP等等。

 

2、实现算法

我们舆情系统的文本分词采用的是基于词典的N最短路径算法。N最短路径算法是中科院分词工具NLPIR进行分词用到的一个重要算法，张华平、刘群老师发表的论文《基于N-最短路径方法的中文词语粗分模型》中做了比较详细地介绍。该算法的基本思想就是给定一待处理中文字符串，然后根据词典，找出词典中所有可能的词，构造出字串的一个有向无环图，也称为DAG(Directed Acyclic Graph)，算出从开始到结束所有路径中最短的前N条路径。每个可能分词对应DAG的一条边，每条边有一定的权重值，表示该词出现的概率。最简单的做法是采用词频作为权值, 也可以采用TF-IDF值作为权值提高对低频词的分词准确度。因此，分词问题转化成了求DAG中起点到终点的最短路径问题。



以“同事说明天下午休假”为例，按照人们的理解，我们一般能找到“同事/说/明天/下午/休假”和“同事/说明/天下/午休/假”两种分词方式，如图9所示。那么计算机如何实现这个想法呢？首先，它将字串分为单个的字，每个字用图中相邻的两个结点表示，故对于长度为n的字串，需要n+1个结点。两节点间若有边，则表示两节点间所包含的所有结点构成的词，比如图中结点3、4、5构成词“明天”。通过跟已有词典比较，构造出有向无环图，图构造出来后，接下来就要针对图计算各种路径中的最短路径。N-最短路径是基于Dijkstra算法的一种简单扩展，它在每个结点处记录了N个最短路径值与该结点的前驱。关于这个算法的描述，在网上、教科书中都有很多详细介绍，这里就不再赘述了。

 

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图9：分词分析举例

 

此外，在现实情况中，每条边的权值不可能都设为1，因为否则随着字串长度n和最短路径N的增大，长度相同的路径数将会急剧增加，并且这样的分法也不够准确。为了解决这个问题，我们需要通过某种策略为有向图的边赋权重，如前文中所述，其实就是该词出现的可能性，也即该词出现的概率。那这个概率该如何计算呢？假设我们输入的字串为C，可能划分的词串为：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)，其中i=1,2,...,m，表示对字串C有m种可能的划分。因此，我们要求的就是概率：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==) 最大的N个，然后根据贝叶斯定理，以及训练语料库，即可得出概率。当然，这个概率也可以通过一些开源的训练语料库直接得到。进而可以求出整个有向图的路径，最终我们可以得到N种字串划分结果，从而找出路径最短的分词划分。文本分词结果是我们系统中其他模块的基础，如词频分析等。

 

- **词频分析**

词频分析模块是唯品会舆情监控系统的重要组成部分，它是基于上面介绍的文本分词的结果进行的分析，后面将介绍词频的基本算法和实现。



1、基本概念

首先，我们先介绍几个概念——词频和逆向文件频率。词频 (Term Frequency, TF) 指的是某一个给定的词语在该文件中出现的次数，这个数字通常会被归一化(一般是词频除以文章总词数), 以防止它偏向长的文件。提到TF，必然需要了解逆向文件频率 (Inverse Document Frequency,IDF)，它的主要思想是：如果包含词条w的文档越少, IDF越大，则说明该词条w具有很好的类别区分能力。某一特定词语的IDF，可以由总文件数目除以包含该词语的文件的数目，再将得到的商取对数得到。而他们的组合TF-IDF是一种统计方法，用以评估某个词条对于一个文件集或一个语料库中的其中一份文件的重要程度。TF-IDF的含义总结就是, 一个词语在一篇文章中出现次数越多, 同时在所有文档中出现次数越少, 越能够代表该篇文章。因此，TF-IDF倾向于过滤掉常见的词语，保留重要的词语。关于TF-IDF的算法有很多资料，这里就不再详细说明。

 

2、实现算法

唯品会舆情系统的词频算法也是基于上述TF-IDF算法思想，并进行了改进以满足我们系统自身需求。对用户评论的词频分析，是希望分析出在不同周期内（如一周、一个月），哪些词条在当前周期相对于上个周期有明显地上升，而这些明显上升的关键词条往往是用户集中反馈的一些问题或者关注的热点，具有较高的挖掘价值。当然，关键词条的上升判断，不能简单地通过某个词条数目绝对数量的多少，或者比上个周期有所增加就判定为热点词汇。因为每个周期内，分词词条样本数量是不同的，简单地看某个词的绝对数量并不能说明问题，就如TF-IDF的算法所述，需要过滤掉常见的词语，保留重要的词语。



图10为我们词频分析的算法逻辑实现图，它首先根据分词结果分别计算当前周期内和上个周期内每个分词W的占比，其样本值为各自周期内的所有分词词条数目，词条总数在当前周期表示为：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)，上个周期表示为：![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)，因此当前周期和上个周期内每个分词的占比可以分别用：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

和

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

表示，其中i=1,2,3,...,N，j=1,2,3,...,M，这里N和M分别为当前周期和上个周期内所有分词的个数。

随后,对两个周期内的每个分词的占比![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)和![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)分别做排序，每个周期中分别选取其中占比最大的n（n可以根据自身情况设定，如100、200、500等）个词条，将筛选出来的词条和对应占比表示为![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)和![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)，其中*x,y*=1,2,3,...,n。

将不同周期内的前n个词条占比![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)和![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)采用差分算法，计算出当前周期中每个分词占比值相对于上个周期提升的幅度，并按照从大到小排列，这样我们就能找出当前周期内热度值最高，并且相对于上个周期有明显提升的关键词条。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图10：词频分析逻辑

 

3、实现效果

图11为用户留言反馈计算得到的最终词频结果示例。此外，词频分析会按照用户设定的不同评论分类的维度来分别进行计算，这样能找出各个分类中的一些热点词汇，为及时发现热点问题、用户敏感问题、线上Bug等提供参考依据。如图11，切换右边已设置的分类，我们能查看对应的词频分析结果。此外，点击分词词条对应的柱状图，能查看词条对应的具体评论信息，方便用户查询和定位问题，如图12所示。目前，系统会对来自于App应用市场和客服留言的评论做词频分析，并且通过词频分析，我们发现了如App闪退问题、会员俱乐部无法进入、在线客服打不开等部分线上Bug。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图11：词频分析结果

 

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图12：词频关键词对应的评论信息详情

 

- **分类分析**

对用户评论信息按照设定的分类进行归类，能方便使用者针对不同方面需求进行查看及相关信息统计。在评论信息量较大的时候，人工分类虽然比较精准，但是效率非常低下，因此我们需要对评论自动进行归类，这样能极大地降低人工分类筛选成本。



1、分类器现状

目前，中文文本分类常用的分类器包括：朴素贝叶斯、决策树、深度学习、人工神经网络、KNN、SVM、Adaboosting、Rocchio算法、LDA模型等等。这些分类器有各自的优缺点，比如人工神经网络，其优点是分类的准确度高、并行分布处理能力强、分布存储及学习能力强，以及对噪声神经有较强的鲁棒性和容错能力等，但它也有自己的缺点，比如需要大量的参数，如网络拓扑结构、权值和阈值的初始值，学习时间过长，甚至可能达不到学习的目的等。

 

2、实现逻辑

由于我们电商产品的一些特点，用户评论反馈的信息一般集中在选购流程、支付、商品质量、物流、会员权益、营销活动等几个相对固定的大类，其分类相对简单。因此，考虑自身产品的特点、系统复杂度以及性能等各种因素影响，唯品会舆情系统并未采用上述分类算法，而是采用较为简单的自研算法。



其算法逻辑如图13所示，采用分类关键词(k)设定及关键词权重![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)计算的方法来对评论进行每个分类的权重计算，得到该条评论在某个分类命中的所有关键词权重和：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

其中(i=0,...,n，j=0,...,m，这里n为评论命中某个分类的关键词数量，m为设置的分类数量)，然后将每个分类的权重和：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

排序，权重和最大的分类：

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

即为该评论的最终分类。此种算法虽比较简单，但是对于大量非结构化评论，是很有效的分类方法，其分类准确性比较高，能达到90%以上。分类关键词的设定及管理可以通过系统提供的分类管理和关键词管理两个功能模块进行管理。图14为用户评论按照分类统计的趋势结果，其词频分析结果也是按照分类维度来统计，如前面的图11所示。

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)图13：分类分析逻辑

 

![img](https://mmbiz.qpic.cn/mmbiz_png/qvASV0U0sTGJkhvDeAXtu75pDBhRc0zrCDcf2BX0l95QBMb1ficQVibXudiaqIDLbxYGGUOR1iaKYEyeTx471nTdJA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

图14：评论反馈分类趋势

 

此外，用户评论详情查询也支持按照设定的分类来查看，方便用户按照感兴趣的分类查询、搜索相关评论详情，如图15所示。



![img](https://mmbiz.qpic.cn/mmbiz_png/wIBWhsMhicga7GACmWgchKIP5W61IZibfrBcUsRqgZ0R09LQ4xibO91zqmQtoqBzxyROicHs5bxxKWKdSO0FzicTrpg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

图15：评论详情按照分类查询

 

**实践效果**



系统自上线以来已有来自产品、开发、测试、金融等各个部门将近300位的公司内部用户，为公司各部门了解用户的心声和需求、提升用户体验、制定产品计划、发现线上问题等方面提供了一定的参考依据。在线上质量监控方面，舆情系统通过词频分析、分类分析等功能发现了app兼容问题、会员俱乐部无法进入、在线客服打不开、品牌收藏没有展示等约几十个各种线上问题，为发现并及时修复问题提供了重要参考，改善了用户体验、减少了部分经济损失。

 

**计划展望**



如前所述，舆情系统通过词频分析发现的线上问题和用户热点问题较多。因此，在后面的迭代计划中会增加词频预警功能，通过邮件等渠道向用户提供实时的词频分析结果，供巡检人员发现和查询需要及时处理的热点、关键问题。此外，系统用户也可以根据自身的需要设置并订阅感兴趣的词频关键词，在词频分析结果中有匹配时，及时向相关用户发送预警邮件，做到问题的及时发现和处理。

# [活动 Web 页面人机识别验证的探索与实践](https://tech.meituan.com/2019/03/07/humans-and-bots-apart-for-activity-web-security.html)

2019年03月07日 作者: 益国 [文章链接](https://tech.meituan.com/2019/03/07/humans-and-bots-apart-for-activity-web-security.html) 5835字 12分钟阅读

在电商行业，线上的营销活动特别多。在移动互联网时代，一般为了活动的快速上线和内容的即时更新，大部分的业务场景仍然通过 Web 页面来承载。但由于 Web 页面天生“环境透明”，相较于移动客户端页面在安全性上存在更大的挑战。本文主要以移动端 Web 页面为基础来讲述如何提升页面安全性。

## 活动 Web 页面的安全挑战

对于营销活动类的 Web 页面，领券、领红包、抽奖等活动方式很常见。此类活动对于普通用户来说大多数时候就是“拼手气”，而对于非正常用户来说，可以通过直接刷活动 API 接口的“作弊”方式来提升“手气”。这样的话，对普通用户来说，就变得很不公平。

对于活动运营的主办方来说，如果风控措施做的不好，这类刷接口的“拼手气”方式可能会对企业造成较大的损失。如本来计划按 7 天发放的红包，在上线 1 天就被刷光了，活动的营销成本就会被意外提升。主办方想发放给用户的满减券、红包，却大部分被黄牛使用自动脚本刷走，而真正想参与活动的用，却无法享受活动优惠。

终端用户到底是人还是机器，网络请求是否为真实用户发起，是否存在安全漏洞并且已被“羊毛党”恶意利用等等，这些都是运营主办方要担心的问题。

## 安全防范的基本流程

为了提升活动 Web 页面的安全性，通常会引入专业的风控服务。引入风控服务后，安全防护的流程大致如图所示。

![img](http://p0.meituan.net/scarlett/25016588314ff5433ac647e2fdff938132973.png@680w)

- Web 前端：用户通过 Web 页面来参与活动，同时 Web 前端也会收集用于人机识别验证的用户交互行为数据。由于不同终端（移动端 H5 页面和 PC 端页面）交互形式不同，收集用户交互行为数据的侧重点也会有所不同。
- 风控服务：一般大公司都会有专业的风控团队来提供风控服务，在美团内部有智能反爬系统来基于地理位置、IP地址等大数据来提供频次限制、黑白名单限制等常规的基础风控拦截服务。甚至还有依托于海量的全业务场景的用户大数据，使用贝叶斯模型、神经网络等来构建专业度较深的服务。风控服务可以为 Web 前端提供通用的独立验证 SDK：验证码、滑块验证等区分人机的“图灵验证”，也可以为服务端提供 Web API 接口的验证等。
- 后端业务服务：负责处理活动业务逻辑，如给用户发券、发红包，处理用户抽奖等。请求需要经过风控服务的验证，确保其安全性，然后再来处理实际业务逻辑，通常，在处理完实际业务逻辑时，还会有针对业务本身的风控防范。

对于活动 Web 页面来说，加入的风控服务主要为了做人机识别验证。在人机识别验证的专业领域上，我们可以先看看业界巨头 Google 是怎么做的。

## Google 如何处理人机验证

Google 使用的人机验证服务是著名的 reCAPTCHA（Completely Automated Public Turing Test To Tell Computers and Humans Apart，区分人机的全自动图灵测试系统），也是应用最广的验证码系统。早年的 reCAPTCHA 验证码是这样的：

![img](http://p1.meituan.net/scarlett/6f5077bc14b5ea604dc8ea678801735a21741.png)

如今的 reCAPTCHA 已经不再需要人工输入难以识别的字符，它会检测用户的终端环境，追踪用户的鼠标轨迹，只需用户点击“我不是机器人”就能进行人机验证（reCAPTCHA骗用户进行数据标注而进行AI训练的验证另说）。

![img](http://p0.meituan.net/scarlett/0a10a249e191ac2648c6447dac1d66f7194112.gif)

reCAPTCHA 的验证方式从早先的输入字符到现在的轻点按钮，在用户体验上，有了较大的提升。

而在活动场景中引入人机识别验证，如果只是简单粗暴地增加验证码，或者只是像 reCAPTCHA 那样增加点击“我不是机器人”的验证，都会牺牲用户体验，降低用户参加活动的积极性。

Google 的普通 Web 页面的浏览和有强交互的活动 Web 页面虽是不同的业务场景，但对于活动 Web 页面来说，强交互恰好为人机识别验证提供了用户交互行为数据收集的契机。

## 人机识别验证的技术挑战

理想的方案是在用户无感知的情况下做人机识别验证，这样既确保了安全又对用户体验无损伤。

从实际的业务场景出发再结合 Web 本身的环境，如果想实现理想的方案，可能会面临如下的技术挑战：

- （1）需要根据用户的使用场景来定制人机识别验证的算法：Web 前端负责收集、上报用户交互行为数据，风控服务端校验上报的数据是否符合正常的用户行为逻辑。
- （2）确保 Web 前端和风控服务端之间通信和数据传输的安全性。
- （3）确保上述两大挑战中提到的逻辑和算法不会被代码反编译来破解。

在上述的三个挑战中，（1）已经实现了人机识别验证的功能，而（2）和（3）都是为了确保人机识别验证不被破解而做的安全防范。接下来，本文会分别针对这三个技术挑战来说明如何设计技术方案。

## 挑战一：根据用户使用场景来定制人机识别验证算法

先来分析一下用户的使用场景，正常用户参与活动的步骤是用户进入活动页面后，会有短暂的停留，然后点击按钮参与活动。这里所说的“参与活动”，最终都会在活动页面发起一个接口的请求。如果是非正常用户，可以直接跳过以上的实际动作而去直接请求参与活动的接口。

那么区别于正常用户和非正常用户就是那些被跳过的动作，对实际动作进一步归纳如下：

1. 进入页面。
2. 短暂的停留。
3. 滚动页面。
4. 点击按钮。

以上的动作又可以分为必需的操作和可选的操作。对这一连串动作产生的日志数据进行收集，在请求参与活动的接口时，将这些数据提交至后端，验证其合法性。这就是一个简单的人机识别验证。

在验证动作的合法性时，需要考虑到这些动作数据是不是能被轻易模拟。另外，动作的发生应该有一条时间线，可以给每个动作都增加一个时间戳，比如点击按钮肯定是在进入页面之后发生的。

一些特定的动作的日志数据也会有合理的区间，进入页面的动作如果以 JS 资源加载的时间为基准，那么加载时间可能大于 100 毫秒，小于 5 秒。而对于移动端的按钮点击，点击时记录的坐标值也会有对应的合理区间，这些合理的区间会根据实际的环境和情况来进行设置。

除此之外，设备环境的数据也可以进行收集，包括用户参与活动时使用的终端类型、浏览器的类型、浏览器是否为客户端的容器等，如果使用了客户端，客户端是否会携带特殊的标识等。

最后，还可以收集一些“无效”的数据，这些数据用于障人耳目，验证算法会将其忽略。尽管收集数据的动作是透明的，但是验证数据合法性不是透明的，攻击者无法知道，验证的算法中怎么区分哪些是有效、哪些是无效。这已经有点“蜜罐数据”的意思了。

## 挑战二：确保通信的安全性

收集的敏感数据要发送给风控服务端，进而确保通信过程的安全。

1. Web API 接口不能被中途拦截和篡改，通信协议使用 HTTPS 是最基本的要求；同时还要让服务端生成唯一的 Token，在通信过程中都要携带该 Token。
2. 接口携带的敏感数据不能是明文的，敏感数据要进行加密，这样攻击者无法通过网络抓包来详细了解敏感数据的内容。

### Token 的设计

Token 是一个简短的字符串，主要为了确保通信的安全。用户进入活动 Web 页面后，请求参与活动的接口之前，会从服务端获取 Token。该 Token 的生成算法要确保 Token 的唯一性，通过接口或 Cookie 传递给前端，然后，前端在真正请求参与活动的接口时需要带上该 Token，风控服务端需要验证 Token 的合法性。也就是说，Token 由服务端生成，传给前端，前端再原封不动的回传给服务端。一旦加入了 Token 的步骤，攻击者就不能直接去请求参与活动的接口了。

Token 由风控服务端基于用户的身份，根据一定的算法来生成，无法伪造，为了提升安全等级，Token 需要具有时效性，比如 10 分钟。可以使用 Redis 这类缓存服务来存储 Token，使用用户身份标识和 Token 建立 KV 映射表，并设置过期时间为 10 分钟。

虽然前端在 Cookie 中可以获取到 Token，但是前端不能对 Token 做持久化的缓存。一旦在 Cookie 中获取到了 Token，那么前端可以立即从 Cookie 中删除该 Token，这样能尽量确保 Token 的安全性和时效性。Token 存储在 Redis 中，也不会因为用户在参与活动时频繁的切换页面请求，而对服务造成太大的压力。

另外，Token 还可以有更多的用处：

- 标识参与活动用户的有效性。
- 敏感数据对称加密时生成动态密钥。
- API 接口的数字签名。

### 敏感数据加密

通信时，传递的敏感数据可以使用常见的对称加密算法进行加密。

为了提升加密的安全等级，加密时的密钥可以动态生成，前端和风控服务端约定好动态密钥的生成规则即可。加密的算法和密钥也要确保不被暴露。

通过对敏感数据加密，攻击者在不了解敏感数据内容的前提下就更别提模拟构造请求内容了。

## 挑战三：化解纸老虎的尴尬

有经验的 Web 开发者看到这里，可能已经开始质疑了：在透明的前端环境中折腾安全不是白折腾吗？这就好比费了很大的劲却只是造了一个“纸老虎”，质疑是有道理的，但是且慢，通过一些安全机制的加强是可以让“纸老虎”尽可能的逼真。

本文一再提及的 Web 环境的透明性，是因为在实际的生产环境中的问题：前端的代码在压缩后，通过使用浏览器自带的格式化工具和断点工具，仍然具备一定的可读性，花点时间仍然可以理解代码的逻辑，这就给攻击者提供了大好的代码反编译机会。

如果要化解“纸老虎”的尴尬，就要对前端的代码进行混淆。

### 前端代码混淆

前端的 JS 代码压缩工具基本都是对变量、函数名称等进行缩短，压缩对于混淆的作用是比较弱。除了对代码进行压缩，还需要进行专门的混淆。

对代码进行混淆可以降低可读性，混淆工具有条件的话最好自研，开源的工具要慎用。或者基于 Uglify.js 来自定义混淆的规则，混淆程度越高可读性就越低。

代码混淆也需要把握一个度，太复杂的混淆可能会让代码无法运行，也有可能会影响本身的执行效率。同时还需要兼顾混淆后的代码体积，混淆前后的体积不能有太大的差距，合理的混淆程度很重要。

![img](http://p0.meituan.net/scarlett/ff719172c0afa591a7a173c3f6a0fd05260530.png@800w)

断点工具的防范会更麻烦些。在使用断点工具时通常都会导致代码延迟执行，而正常的业务逻辑都会立即执行，这是一个可以利用的点，可以考虑在代码执行间隔上来防范断点工具。

通过代码混淆和对代码进行特殊的处理，可以让格式化工具和断点工具变得没有用武之地。唯一有些小遗憾，就是处理后的代码也不能正常使用 Source Map 的功能了。

有了代码混淆，反编译的成本会非常高，这样“纸老虎”已经变得很逼真了。

## 技术方案设计

在讲解完如何解决关键的技术挑战后，就可以把相应的方案串起来，然后设计成一套可以实施的技术方案了。相对理想的技术方案架构图如下：

![img](http://p1.meituan.net/scarlett/b147b264d60d4067662ab86279505326211342.png@860w)

下面会按步骤来讲解技术方案的处理流程：

**Step 0 基础风控拦截**

基础风控拦截是上面提到的频次、名单等的拦截限制，在 Nginx 层就能直接实施拦截。如果发现是恶意请求，直接将请求过滤返回 403，这是初步的拦截，用户在请求 Web 页面的时候就开始起作用了。

**Step 1 风控服务端生成 Token 后传给前端**

Step 0 可能还没进入到活动 Web 页面，进入活动 Web 页面后才真正开始人机识别验证的流程，前端会先开始获取 Token。

**Step 2 前端生成敏感数据**

敏感数据应包含用户交互行为数据、设备环境数据、活动业务逻辑数据以及无效数据。

**Step 3 使用 HTTPS 的签名接口发送数据**

Token 可以作为 Authorization 的值添加到 Header 中，数据接口的签名可以有效防止 CSRF 的攻击。

**Step 4 数据接口的校验**

风控服务端收到请求后，会先验证数据接口签名中的 Token 是否有效。验证完 Token，才会对敏感数据进行解密。数据解密成功，再进一步对人机识别的数据合法性进行校验。

**Step 5 业务逻辑的处理**

前面的步骤为了做人机识别验证，这些验证不涉及到业务逻辑。在所有这些验证都通过后，后端业务服务才会开始处理实际的活动业务逻辑。处理完活动业务逻辑，最终才会返回用户参与活动的结果。

## 总结

为了提升活动 Web 页面的安全性，使用了各种各样的技术方案，我们将这些技术方案组合起来才能发挥安全防范的作用，如果其中某个环节处理不当，都可能会被当作漏洞来利用，从而导致整个验证方案被攻破。

为了验证技术方案的有效性，可以持续观察活动 API 接口的请求成功率。从请求成功率的数据中进一步分析“误伤”和“拦截”的数据，以进一步确定是否要对方案进行调优。

通过上述的人机识别验证的组合方案，可以大幅提升活动 Web 页面的安全性。在活动 Web 页面应作为一个标准化的安全防范流程，除了美团，像淘宝和天猫也有类似的流程。由于活动运营的环节和方法多且复杂，仅仅提升了 Web 页面也不敢保证就是铁板一块，安全需要关注的环节还很多，安全攻防是一项长期的“拉锯升级战”，安全防范措施也需要持续地优化升级。

## 参考资料

- https://www.google.com/recaptcha/intro/v3.html
- https://segmentfault.com/a/1190000006226236
- https://www.freebuf.com/articles/web/102269.html

## 作者简介

益国，美团点评 Web 前端开发工程师。2015年加入美团，曾先后负责过风控前端SDK和活动运营平台的研发，现负责大数据平台的研发工作。

# 勾选一下就能通过验证的reCAPTCHA人机身份验证是什么原理？

[图片] 国外某些网站上的reCAPTCHA的人机身份验证，勾选之后过一会儿就可以通过验证，请问是何原理？…显示全部

关注者

**162**

被浏览

**26,160**

关注问题写回答

邀请回答

3 条评论

分享



#### 7 个回答

默认排序

[![陈北保](https://pic4.zhimg.com/da8e974dc_xs.jpg)](https://www.zhihu.com/people/chen-bei-bao)

[陈北保](https://www.zhihu.com/people/chen-bei-bao)

995312人关注他

4 人赞同了该回答

其实简单点说，当你点击勾选按钮后的几秒中的时间，该网站已经检测了你的浏览器、ip地址、网络环境、cookie时间、国家端口、机器码等信息，它也是以此作为判断你是否是正常的用户，如果勾选之后出现绿色的勾选的话代表你已经通过了reCAPTCHA的人机身份验证，如果检测你有异常，它会出现九个或者是更多的验证图片让你选择带有XXX的图片进行点击，如果选择正确则可以通过，如果选择错误则会让你重新选择，直到你选择正确为止，另外如果您有任何reCAPTCHA的相关的问题，那么建议你到reCAPTCHA中文论坛看看，我相信你搜到这个问答，肯定是遇到了reCAPTCHA相关的问题 了，我也是遇到问题才搜到reCAPTCHA中文论坛的：[recaptcha.cnrecaptcha.cn](https://link.zhihu.com/?target=http%3A//recaptcha.cn)

[发布于 2018-02-21](https://www.zhihu.com/question/51624138/answer/324282704)

赞同 41 条评论

分享

收藏感谢

![知乎用户](https://pic4.zhimg.com/da8e974dc_xs.jpg)

知乎用户

21 人赞同了该回答

没有具体研究过，查询了一下，大概就是基于以下内容做判断：1. Google自己的风险检测引擎
\2. 依赖于你的cookie，你必须有一定的活动天数
\3. 你点击那个单选框的时候计算你的鼠标滑动轨迹，机器人应该没有这个（但是可以通过js模拟）
\4. 检测你浏览器的user agent是否真实
\5. 根据浏览器指纹追踪信息进行判断反正这个判断应该是非常复杂了，基于真实人类的行为做分析，而对机器来说，可能无法模拟或者模拟困难这些行为。谢邀。

[编辑于 2017-02-08](https://www.zhihu.com/question/51624138/answer/145247164)

赞同 21添加评论

分享

收藏感谢

[![Fine](https://pic1.zhimg.com/v2-acf403018b3894021edbf254bcd0ae2d_xs.jpg)](https://www.zhihu.com/people/recursion917)

[Fine](https://www.zhihu.com/people/recursion917)

孤独的人他就在海上 撑着船帆

2 人赞同了该回答

分析常用ip或者cookie，这都是常用的方法，还有就是分析鼠标轨迹，涉及到机器学习，通过分析鼠标轨迹来判断是不是机器人。但攻击者可通过黑产工具产生类人轨迹批量操作以绕过检测。这就是一个不断机器学习，不断升级的过程。

[发布于 2017-05-07](https://www.zhihu.com/question/51624138/answer/165783528)

赞同 2添加评论

分享

收藏感谢

[![logo](https://pic3.zhimg.com/v2-fc8b414f313135c0f9d2066fdecf190e_250x250.jpeg)腾讯云](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168745.3168745.3168745&utm_medium=cpc&utm_id=gwzcw.3168745.3168745.3168745)

广告



不感兴趣[知乎广告介绍](https://www.zhihu.com/promotion-intro)

[买一台云服务器到底能干什么？腾讯云热门云产品限量特惠秒杀，多种机型限时抢购，入门级爆款1核2G云服务器，适用于web、小程序及App开发等场景，首年99元，年末钜惠！查看详情](https://cloud.tencent.com/act/seckill?fromSource=gwzcw.3168745.3168745.3168745&utm_medium=cpc&utm_id=gwzcw.3168745.3168745.3168745)

[![不老刘](https://pic1.zhimg.com/ea4e3c64a028a072f80935be87481ee3_xs.jpg)](https://www.zhihu.com/people/letian)

[不老刘](https://www.zhihu.com/people/letian)

这种验证方式确实比传统输入字符的验证、鼠标点击字符、选择图片或是拖动图片的验证都更简单。效果也不差！验证码的进步！

[编辑于 2017-01-22](https://www.zhihu.com/question/51624138/answer/142194548)

赞同1 条评论

分享

收藏感谢

[![DiSoul凌空](https://pic3.zhimg.com/v2-1c745db0327b82604f95b13d35326f6c_xs.jpg)](https://www.zhihu.com/people/disoul-st)

[DiSoul凌空](https://www.zhihu.com/people/disoul-st)

一个想开面包店的程序员

1.设备指纹和浏览器环境界定，这里不会通过单纯的http头来判断你属于哪个浏览器，一般来说列举几种方法。
a. 绘制一个webgl
b.canvas上绘制字体2.下一步我猜测可能是用无埋点的方案统计鼠标事件，然后可能是依赖机器学习之类的方案训练一个输出风险等级的网络

[发布于 2017-10-04](https://www.zhihu.com/question/51624138/answer/239229691)

赞同添加评论

分享

收藏感谢

[![天蝎来的](https://pic2.zhimg.com/v2-c7fc777a796c9b23966f2b3e90c4020b_xs.jpg)](https://www.zhihu.com/people/wu-han-25-37)

[天蝎来的](https://www.zhihu.com/people/wu-han-25-37)

天蝎来的

上面基本说的差不多了，还可以去reCAPTCHA官方看一下：[I'm not a robot](https://link.zhihu.com/?target=https%3A//developers.google.com/recaptcha/docs/display)谷歌验证服务的使用者把谷歌为用户点击事件颁发的一个token，以及其他参数打包，调用谷歌验证api [Verifying the user's response](https://link.zhihu.com/?target=https%3A//developers.google.com/recaptcha/docs/verify) 检查用户身份。

[发布于 2018-05-30](https://www.zhihu.com/question/51624138/answer/404885845)

赞同添加评论

分享

收藏感谢

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

谢邀，我是个麻瓜不懂为什么会被邀。
原理大概是，分析你的浏览环境以及或许有点击行为，收集一堆迷之数据，根据大数据，利用机器学习，判断你是人还是机器。大概就是这样了。

## 起底身份倒卖产业：那些被公开叫卖的人生

原创： 半佛仙人 [半佛仙人](javascript:void(0);) *4月29日*



**【这是半佛仙人的第68篇原创】**



**0**



今天这篇文章，与我们每一个人的生活都密切相关。



这两天有3个新闻同时出现，让我突然有了写这篇文章的冲动。



一个是潜逃近三年的北大高材生弑母案嫌疑人吴谢宇在重庆被捕，被抓时身份身上携带三十多张身份证，靠着不停变换身份，躲避着追捕。



一个是网传京东被人拖库，5000万条含用户身份资料的账户信息被泄露，京东官方第一时间出面辟谣，表示相关信息非京东账户信息。



第三个比较少人知道，但最重要，NCC Group公布了高通芯片的旁路漏洞，收到波及的高通芯片有近40款，这个漏洞可用来窃取用户信息，高通于本月初修复了这个漏洞。



除了苹果和华为，绝大多数安卓手机的核心芯片，是高通，这次漏洞，与每一个安卓用户有关，此次漏洞最高可能波及全球数十亿手机，你的手机可能就是其中之一。



作为专业风控，我看到这三个新闻的第一反应不是情绪，而是关于身份信息泄露与交易市场的一些事情，应该被更多人知道。



**1**



现代社会中，核实人身份的方法有很多，例如实名银行卡，实名手机号，驾驶证等等等等，但是这些所谓的实名信息，本质上还需要一个源数据来提供真实性兜底。



这个数据源，就是身份证。



银行卡，手机号等一切所谓实名信息，都是基于身份证的，只是身份证信息的一种承载方式而已。



如果没有身份证信息，你没法证明你是你。



但假如有了你的身份证信息，则某种程度上，可以证明我是你。



一个虚假的身份，对于我们大多数普通人而言，虽然听起来很酷，但是其实没有什么用处，因为我们的生活不需要这些。



而对于另一些做特殊产业的人而言，虚假身份则是最重要的生产资料，没有之一，绝大多数黑产的根基，就是身份伪装。



有了身份伪装，漏洞攻击，骗贷，薅羊毛，洗钱，伪造注册信息甚至骗补贴等一切违法手段，都有了一层安全的保护。



而虚假身份的交易，更是当前黑市最火热的交易品。



你有没有想过，世界上可能会有另一个人，披着你的身份生活？



**2**



黑产内，对于全套身份伪装信息，有个专有名词，叫做四件套。



所谓四件套，是指身份证原件+身份证对应手机卡+身份证对应银行卡+网银U盾，一般来说银行卡都是已经开通网银的的，某些手机卡甚至还会预存话费。



例如这样（图片来自网络）。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



比较成熟的四件套贩子，甚至可以为买家定制具体的籍贯，性别，年龄，手机卡运营商，开户银行等。



只要买家愿意加钱并且耐心等待，这些都不难做到。



当前市场中最受欢迎的开户银行是四大行中的某家，因为这家银行的U盾普遍不需要插电脑，只需要输入盾的验证码即可，毕竟少一次物理交互，就少一次麻烦和破绽。



四件套算是身份信息中的贵族，一份完整的标准版四件套，黑市价格在400到700元，按照供需关系决定，定制版会更贵一些。



之所以需要定制，是因为很多大的机构对于某些地域某些群体，是有特殊限制规则的，例如某些公司坚决不跟某些地域的身份证产生任何业务往来。



所以即使是身份证四件套，也是不平等的。



像极了生活。



**3**



四件套，属于身份信息中的中高端产品，交易起来也相对复杂。



刨除四件套之外，最常见且频繁的身份信息，更多的是大量的身份证正反面照片，手机号，工作收入情况，以及本人手持身份证照片。



这些资料往往都是成批出售的，在暗网，在一些小众聊天APP，走虚拟货币交易。



例如这样（图片来自网络）。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](https://mmbiz.qpic.cn/mmbiz_png/3Xbx2HV4F3doXvROiaDRbujPlM0DwmISBUHp9oMsSaT183GZdJ1X4SkEXXEBQP7rlNTn7icz0wN8zicvWZCuwhP9Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



这种叫卖数据的行为，在暗网中非常常见。



这些数据的涵盖面比较广，有的只是部分精准手机号，例如4S店车主手机号，小区业主手机号，股民手机号等等，这些主要用于打营销电话。



稍微复杂一点的，大量的身份证正反面照片，手机号，工作收入情况，以及本人手持身份证照片，用于伪装身份骗贷款。



这些名目繁多的各类资料，是黑市交易的主流，也是重点打击的对象。



**倒卖用户信息，是非常严重的违法行为，不止是坐牢那么简单。**



**4**



这些身份信息的交易信息是如何传达的？



如果你用身份证，网银之类的关键词去搜索，那么必然是查不到任何有效信息的，搜索引擎也知道要屏蔽敏感词。



但是这些群体非常聪明，他们知道各大网站都在打击，所以他们采取了很多隐蔽的方式。



例如不会用敏感词作为索引，而是使用某些代码，银行卡=YHK这样。



例如潜伏在各大论坛，贴吧，群，二手交易网站里，只要圈内人使用圈内代码，就可以找到他们。



甚至他们的广告都打到了视频网站的评论栏和弹幕里，各种+我看片之类的广告背后，都有这种见不得光的生意。



除了利用国内的一些设施，他们的主要交流根据地在国外。



在很多小众化的，国外的聊天APP中，他们有特定的群组，专门交流此类信息，并且IP多在国外。



非常难以打击。



实名制对他们意义不大，因为他们本身都是实名的，只不过实的不是自己的名。



最高明的隐藏，是不隐藏。



**5**



当找到接口人，谈好价格后，这些信息是如何交易的？



如果是各种虚拟资料的话，付款走虚拟货币，资料传输走境外网盘，相对比较方便。



如果是四件套的话，相对会麻烦一些，因为涉及实物快递。



一般这样的货物交易，都是走快递到付，如果和快递员关系好，或者和买家交易比较久，甚至支持先验货再付款。



付款基本都是到付或者特定二维码收款，一般都不会通过微信，支付宝或者其他第三方支付通道（例如银联），因为会被检测到异常。



交易只走到付，快递员有自己的方式收款，整条产业链中，物流网点是很重要的一环。



甚至很多专业黑产会自己盘下某些网点，方便自己来交易。



各种加盟不规范的小物流小快递，是他们最爱的工具。



说不定你下楼拿快递的时候，隔壁的箱子里，就藏着你的一生。



**6**



这些身份资料被购买后，用途是什么？



**用途A——隐匿**



常见于新闻报道中的犯罪分子，这类群体对于身份信息是刚需，因为他们需要摆脱警方的追捕，同时需要让自己可以过上一些正常人的生活，例如弑母案中的吴谢宇，他被捕时的三十多个身份证，就是用来伪装自己身份的。



很多人会问，现在不是有各种人脸识别和酒店登记了吗？为什么还是能用假身份？



朋友，在很多小地方，这些技术根本不普及。而且就算是在大城市，用假身份租个房子，和房东个人签协议，要多简单有多简单。



实际上吴谢宇要不是出现在机场，有人脸识别与公安打通，他还不知道能潜逃多久。



你身边的人，到底是不是这个人呢？



**用途B——测试**



某些支付公司和互联网公司的测试使用。



可能很多人没有意识到这个用途，很多与交易有关的互联网公司，在测试自己产品的付款与提现功能时（尤其是电商与互金），不同银行的银行卡兼容性非常重要。



全国这么多银行，需要这么多银行卡，身份信息（绑定时用），尤其是测试的时候需要反复测试不同组合的兼容性，还需要对这些资料的绝对掌控。



你说，某些公司的测试资料，是从哪里来的呢？



**用途C——骗贷+羊毛**



拥有四件套，某种程度上就代表了你可以在互联网环境中伪造成这个人，并用他们的信息来做一些事情。



例如很多P2P公司都有注册送钱的活动，这些信息可以拿去用。



例如很多互联网公司都有实名注册送奖励的活动，这些信息可以拿去用。



例如很多高利贷公司闭着眼给白户放714高炮，这些信息就可以拿去骗贷，在7天内（7天后各大黑名单就开始记录了）尽可能多的申请贷款，然后下款后把钱转走，最后手机卡一掰，随便潇洒，反正一切记录都是身份信息的那个人，和自己无关。



一套完整资料500块，运气好可以在7天内薅出数万元的贷款，甚至很多贷款流量超市自己就买这种证件来骗自己客户的钱。



这种黑吃黑的套路，多不胜数。



有人说贷款都有人脸识别，用假身份过不了人脸，我只能说天真。



给你大家现场展示。



这是静态图



![img](https://mmbiz.qpic.cn/mmbiz_png/3Xbx2HV4F3eRDls2P3MXwmia3L0LiawxGIhZYwLvga4mVGNXxqAFmwm3hGmZDaNyM0mIEPEWicOEoicvbcLdX4Mt9w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



这是制作过的动态图。







如果这个技术不是用在肖像上，而是用在身份证和手持身份证的照片上呢？



你还觉得人脸无懈可击么？你还能证明你不是你么？



你所见到的，未必就是真相。



**用途D——洗钱**



这是虚假身份市场最初诞生的原因，就是洗钱。



洗钱这件事，说穿就是把一笔笔来路不明的钱，通过各种转账以及搭配业务场景的模式，变为干净的钱或者说是变为可以控制的钱。



近些年我国对于洗钱的打击越来越重，银行对于洗钱规则的审核越来越严苛，所以很多黑产不得不升级手段。



而虚假身份的用途就在这里，通过一个个虚假的身份，把大额的资金分散为小额的个人转账，然后利用地下钱庄把钱搞到境外。



这些钱往往是非法所得。



近些年最大的金主，是东南亚网络博彩，由于网络博彩的充值金额很高，且充值方式复杂（各种二维码），所以他们是近些年身份信息倒卖最大的需求方。



最赚钱的生意，都在刑法里。



**用途E——借壳**



这是一个比较罕见，但真实存在的用途。



往往是很多不法行为，需要有公司的壳来完成，而这些身份信息，就会被拿来注册成一个个壳公司的法人，最后出了问题，反正也只是身份证上的人倒霉。



更高级一点的借壳，是利用伪装身份，来持有股份。



很多公司的股权架构非常复杂和混乱，里面往往有很多分子公司交叉持股，这堆分子公司里面的很多法人与股东，是搞来的身份证注册的。



之前甚至出现过部分上市公司的前十位个人股东中出现了假身份的，对方实际上只是个普通农民的案例。



农民在一无所知的前提下掌控了上市公司，荒谬又真实。



**7**



由于贩卖身份信息，在我国是非常非常严重的违法行为，发现就抓，绝不姑息。



就代表，这一行见不得光。



而做这一行的，多数都是只认钱。



当一个行业见不得光且只认钱。



那么必然混乱与黑吃黑丛生，大家各凭本事，在黑暗丛林里厮杀。



所有礼仪道德廉耻都是虚的，只有到手的钱，才值得信任。



**最低级的黑吃黑是骗钱与假数据。**



在暗网中，这一整套交易环节，都是有邀请制的，你随随便便就去跟卖家聊，多数时候是不理你的，因为担心泄露被抓。



而那些公开叫卖的数据，里面十个人里起码九个是有有问题的，要么数据有问题，要么卖的人有问题。



或许买回来的几千万条数据里，有一般是系统随机生成的数据；



或许买回来的数据，最后其实是一部《葫芦娃》。



又或许对方要你付定金，但最后连《葫芦娃》都不给你。



**高级的黑吃黑是钓鱼。**



很多人买回来一堆身份信息四件套，想搞骗贷或者洗钱。



但很有可能，买回来的是卖家的鱼饵。



当买家自己拼命用这些信息骗到了贷款，又或者把搞黄赌毒弄来的钱分散进去企图开始洗刷刷的时候，会发现这些钱都不翼而飞了。



卖家收网了。



本来这些信息就是卖家卖出的，想对这些账户做出操作连挂失都不用。



花了钱还给人打白工，还没法说理去。



很多突然倒下的公司与P2P，其实背后遇到了这样的钓鱼，老板本来想通过洗钱来潜逃，最后被人钓了鱼，所有钱都没有了，而且还没法解释。



只能老实自首。



近期P2P又开始暴雷了，其中有多少是蠢鱼呢？



讽刺的是，如果这些P2P公司不被钓鱼，他们还会骗更多人。



所以钓鱼是杀，还是救？



这堪称当代善恶体系的一个重大难题。



**最高级的黑吃黑，是虚拟货币割韭菜。**



不管直接骗钱也好，钓鱼也好，总归是要与买家有直接接触的，还是存在风险。



最高级的黑吃黑，某种程度上已经脱离了单纯黑吃黑的范畴。



他们发币。



只要成为黑产交易的等价物，那么某种程度上，就等于是掌握了自己印钱的能力。



并且由于虚拟货币的匿名属性与不可追踪属性，又是极度安全的，甚至都不需要参与交易。



等他们玩腻了，要收手了，只需要在某些交易所大量抛售，并且用另外的身份做空，就能再赚尽最后一笔钱，然后深藏功与名。



很多突然崩溃的虚拟货币，往往与某位大佬的洗白行动有关。



**很多韭菜，到死都不知道自己是怎么死的。**



**8**



我们上面说了这么多的身份信息的意义，到买房是，价值，那么关键的问题来了，这些数据，总该有些源头吧？这些数据是从哪里来的？



**A，是来源于各大安全防范不严密的公司。**



以前做渗透安全测试的时候，我往往发出感叹，国内很多所谓牛逼的公司，业务规模无比牛叉，但信息安全做的惨不忍睹。



他们很多的数据库没有做到内外网分离，甚至很多密码都是默认的admin和guest，还有123456，若是碰上别有用心且不惧法律的黑客，可以轻松把数据搞出来然后丢到黑市上打包卖掉。



各种某某公司被脱裤，用户信息泄露贩卖的新闻，在网上已经算不得新闻了。



**B，是那些已经完蛋的P2P公司。**



暴雷了这么多公司，这些公司里有这么用户的敏感数据，公司完蛋后，数据呢？



很多被P2P坑了的人，还没有意识到，自己的信息，同样也被暴露了。



一地鸡毛。



**C，公司内鬼。**



现在融资环境不好，很多早期烧钱过头的公司，已经快要挺不下去了。



当一个公司面临快要终结的命运时，为了筹钱，没有什么事情是老板做不出来的，包括贩卖用户数据，反正都是一死，早死不如晚死。



另外很多公司里能接触到用户数据的技术人员太多了，而很多公司的数据仓库对于跳板机和账户监控又太松散了，很多关键数据都是可以被一键无痕复制出来的。



这个诱惑非常大，我每年都会送进去一些手脚不干净的人。



**D，钱包丢失**



大量丢失钱包中的身份证，被拿去做成了四件套。



**E，社会工程学**



人才市场里面的招聘摊位，大学校园里的兼职招募，这些日常的场景中，潜藏着很多黑产，他们用各种手段创造一个合理的用途，来让你心甘情愿配合，把身份证复印件以及手持身份证照片交出去，并且毫无感知。



另外据听说，很多大学里的学生干部，在帮老师忙的同时，是有权限接触到学生详细信息的，很多时候只需要一个U盘，就够了。



快递公司，房产中介，4S点，营业厅，某个库管，无数岗位在面对用户资料时，一个U盘，就够了。



某些免费的WIFI，某些公共场所被劫持的网络，只要你连上，你就透明了。



我自己是从来不连任何公共场所的未加密WIFI的，某些以免费WIFI为主打的产品，本身的盈利模式就有用户信息。



攻破网络防御，或许很难；但诱惑人心，没那么难。



**F.身份证所有者自己出售的**



随着科技的进步，想单纯靠一张偷来骗来的身份证做出4件套越来越难。



但这个行业又十分暴利。



暴利，可以催生一切。



很多某些偏远地方的人，对于自己的身份资料并不看重，他们觉得自己一辈子不太会和外面的世界有什么交集，卖也就卖了，他们往往把自己的身份信息当做商品，卖给黑产贩子。



这就是为什么身份证籍贯和年龄在黑市上是支持定制的原因。



当然也有一些走投无路的人，大多数赌鬼或者高利贷债务崩盘的人，对他们而言，自己的身份资料能换回来几百块，非常划算。



钱都没了，要身份还有什么用呢？



**9**



说了这么多与身份信息倒卖有关的信息，最后再谈一下如果你知道了自己的信息可能会丢失，应该怎么做。



首先你要知道你的信息有没有被拿来使用。



**A.定期去运营商营业厅查查自己名下究竟有几个手机号，有哪些号是自己不用但还没有注销的。**



**B.定期去银行查查自己名下有几张卡，自己已有的卡中有没有出现一些自己不知道来源的业务和授权。**



**C.经常去企业查询类网站（天眼查启信宝之类），查查自己有没有被某些公司作为法人。**



这些操作都不复杂，也不困难，只要你有心。



如果查出来发现确实有点问题，怎么办？



不要慌，你要记住，你才是资料的主人。



应该怎么做？



很简单，挂失和注销。



身份证疑似泄露，就挂失身份证；



银行卡多了或者被人拿走了，就注销银行卡；



电话卡多了，就注销电话卡；



记住，你才是资料的主人。



做完这一切之后，你就暂时安全了，因为当你的身份被任何异常利用之后，你都有足够的证据来证明与自己无关。



这种有效证据，基本目前是安全的，所有私信我说资料被人拿走的人，我也都是这么建议的。



这套自我排查与自我保护的方法，建议大家扩散给更多身边的人。 



**10**





在我国，贩卖身份信息，是严重的违法行为。



即使交易是在国外发生，贩卖中国人的身份信息，依然是触犯中国法律，且中国享有管辖权，各国政府对于这类行为也是普遍严打的。



每隔一段时间，就会有一批身份贩子被打掉，警方对于身份资料贩卖的打击是极端的严厉。



但这丝毫阻止不了黑产的猖獗，甚至每一次大规模整治之后，都会导致黑市价格的暴涨。



现在黑市上甚至出现了一部分囤积资料，靠价格波动来获利的中间商，他们就是在价格便宜时吃下大量资料，严打后高价抛售，盆满钵满。



堪称黑产证券化，有中间商赚差价。



于此同时，随着00后的登场，黑市上出现的身份信息，也开始越来越年轻。



现在黑市上已经出现了08年出生的身份信息，连成年都没有，这些身份信息都被拿出来叫卖，让人想不到应用场景是什么，就连注册刷羊毛，很多公司也都要求成年。



后来我想明白了，这不重要，因为只要有身份信息，就可以卖钱。



想想一个还在读小学或者还没上学的孩子，他的身份资料就有可能已经在黑市上被倒卖了无数手，可能是用于注册各类教育APP薅羊毛。



等到他年龄满18岁的时候，这些泄露的信息会被拿来做更多坏事。



极端情况下，他可能还未踏上社会，就已背负巨额债务，人生陷入深渊。



而在黑产眼中，这些都不重要，身份资料只是一堆数据，只是生产资料，能换钱就好。



而我们这些身份信息都不知道被倒卖过多少手的普通人，唯一能安慰自己的，只能是自己的隐私不值钱，自己只是普通人，强行让自己看不见这一切。



但就算是这不值大钱信息，也是我们的一生。



是我们努力，勤劳，辛苦又无可替代的一生。



众生皆苦。

## 互联网黑产：那些职业羊毛党到底如何月赚几十万？

原创： 惟乔 [蛋解创业](javascript:void(0);) *5月7日*

![img](https://mmbiz.qpic.cn/mmbiz_gif/iaBzXFiaky1uQVzCfZjOvTNibvhCU6ibYjHzVhE1NIQPq1Z8f24seYB3cWqnOxjaemP8KibRic5PS39qC51zbSItiaYag/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)

> 世界上有没有一种职业
>
> 可以用最少成本赚最多的钱？
>
> 可以用最少时间获得最多的回报？
>
> 可以没有技能赚得却比有颜有才的人多？
>
> 甚至可以在四五线城市赚一二线城市的钱？

看这篇文章之前，相信你和我之前的答案一样，掷地有声两个字：“没有”，因为不劳而获躺赚都是骗人的。但看完文章，相信你也会和我一样感慨：**“原来还真有”。**



今天，我们就给大家**介绍一群生存在互联网灰色地带的****职业羊毛党****，**他们有组织有纪律有完整产业上下游的去利用一些大型互联网公司的运营规则甚至漏洞，套取各种补贴和奖金，少的月收入一两万，多的月赚几十万。



**这些人一般活跃在什么平台？有哪些曾经或现在很常见的薅羊毛手段？给你介绍****五****种****。**

**
**

![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uRbYPooqyIe38CiaVmWGDJ3vuSKibeiahQkgwBVxMwBoI4ibgyvPG7XhSgg7FoVtKoHRND9v1MGKb2lLg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**套取新用户补贴，年收入百万**



要说这群职业羊毛党从什么时候就开始有了，应该就是从大型互联网公司有新用户补贴那天开始。



所以我们介绍的**第一种方法就是套取新用户补贴，这也是一种行之有效的手段。**



一般情况下，一款App新用户注册都有补贴，多数是使用门槛很低的优惠券，比如买10块钱的东西就能减9块。如果用户每次买东西都想要优惠，那么每次用新手机号注册就行。 



一般人因为只有一个手机号，所以都只会注册一次享受一次优惠。但是，有需求，自然就有供给。一条养卡、注册账号、代收短信验证码、薅羊毛的产业链就这样形成了。



![img]()

图片来源：新京报

**
**

**产业链的上游是卡商，**他们用猫池养着大量的手机卡，猫池是一种可同时支持多张手机卡的设备，根据机型不同，插口从8到2048不等。通过猫池，手机卡可以直接拨号和接收短信，而上游卡商就靠售卖卡号和验证码赚钱。



**中游是卡商平台，又称为验证码平台，这个平台上活跃着两类人，上游卡商和下游羊毛党。**卡商将手机卡号码和验证码放到平台售卖，羊毛党可以在平台购买，平台提供软件支持、业务结算，赚取分成。根据验证码属性不同，平台与卡商分成比例也不同。



据之前媒体报道，语音类验证码五五开，短信类验证码三七开，卡商占七成。目前较大的卡商平台有星辰、Thewolf、爱乐赞、玉米、爱码等。平台手机卡很多，有的平台能提供上万个网站的接收验证码服务，几百万张手机号。



![img]()

图片来源网络



除了手机号，微信号也成了销售对象。根据《腾讯网络安全与犯罪研究基地》公众号发布的黑产市场微信号价格的变化趋势数据，2018年6月，微信新号的价格8元一个，老号价格70元一个。

 

**下游数量庞大的羊毛党一般活跃在贴吧、社区、QQ群等社交媒体，**发布各种薅羊毛信息，还形成一套师傅带徒弟的体系，收费从88元到888元不等。据《第一财经》报道，目前羊毛党的直接从业者超过40万人。

 

**有些时候，羊毛党厉害到能搞垮一个产品。**

 

2015年11月，快操盘推出“充1分钱返500元”的活动，无限制提款，一夜被薅近亿。



2018年12月，星巴克上线“星巴克App注册新人礼”活动。羊毛党迅速注册大量虚假账号，领取活动优惠券，导致星巴克紧急下线活动。网络安全厂商“威胁猎人”估计，短短一天半时间，按普通中杯售价估算，星巴克损失可能达1000万。

 

**为了防止被薅羊毛，互联网公司也使出一些手段，**比如短信验证码变成语音验证码，提高技术门槛；用户手机号与手机识别码绑定，一机一码才认定为新用户。但是**这些手段并不能杜绝羊毛党，只能让薅羊毛的成本越来越高。**

 

不过，也存在一些公司为了冲用户量，找到羊毛党。

 

普通用户是用户，羊毛党也是用户，找羊毛党，营销成本低，难度也低。尤其是互联网金融行业，常规获客成本极高，找羊毛党则低得多。一本财经曾报道，互金公司百万的预算，如果全用羊毛党，只需30-50万，剩下的几十万的利润分成。一名互金行业运营人员，靠着频繁跳槽，哪家公司预算高就去哪家，5年跳了7家公司，年收入早就过了**百万**。

 

这么容易赚的钱，偶尔**薅翻车**的情况也有。

 

2018年，斐讯在京东推出0元购。路由器标价399元，返现399元，钱返到合作的互金平台联壁金融App中，一个月后可以提现。羊毛党一拥而上，想通过返现白拿一个路由器，结果遇到P2P行业爆雷，联壁公司涉嫌违法犯罪被公安部门侦察，399也拿不回来了。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**刷单套奖励，月入十万**



**有奖励的地方，就有刷单。**

 

**O2O打车软件大战时，刷单非常疯狂，特别是Uber。**2015年时，Uber在中国每天有上百万的订单，不过，有媒体爆出30%-40%是刷单。当然也是Uber初入中国，完全低估了国人的小智慧。

 

Uber的补贴政策是每天跑满10单奖励120元，15单170元，20单220元。新入司机每天完成20单甚至还有500元奖励。

 

为了快速完成补贴单量，有的司机接到单，未到目的地提前结束，让乘客再下一单，乘客可以使用两次优惠券，司机跑一趟也有两单。



![img]()



Uber车主还建了刷单群，在群里有专门的黑话，辅助刷单的叫【护士】，车主称为【病人】，刷单就是【打针】。车主根据自己的位置让【护士】下一单，然后开着空车跑一趟，完成后再把乘车费和佣金转给【护士】。车主则获得平台的奖励。**这种刷单手段还需要空跑一趟，要油费，最为初级。**

 

**高级一点的做法是带着一堆手机坐地铁，坐公交，坐火车，**油费都省了，不仅车主可以刷，没有车的人PS一张驾驶证和行驶证，在大街上随便拍一辆车，照样可以注册成为车主。

 

**更高级的做法是利用模拟软件+虚拟定位，足不出户就能刷单。**只需要买一个可以修改串号的安卓手机，同时登录几个乘客和司机账号，通过电脑虚拟操作，模拟跑一圈就完成一单。可变成本几乎为零。通过刷单，月净收入可以达到1.5-2.5万。



![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMicbiahzicvpbMLib6xgBoz4cJmDc0XNemmuWtzmJaNmq0q9FJUpib0D356jg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



**也有职业刷单人，专门帮司机刷单，一个月最高月入****10万****。**

 

如今去打车，遇到一些司机还能给你讲一讲当年的盛况，言语间流露出自豪。 后来，只剩下一家公司，打车刷单也就消亡了。

 

但是刷单仍然活跃网上，哪里有补贴，哪里就有刷单。外卖，拼团，生鲜电商，互联网金融，统统不能幸免。 双12线下活动时，武汉出现一名刷单哥，带着百部手机代刷优惠，一天赚上千元。



![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMickjWF1RcvmvjFNrsCiaChyloPRADO8JibUV1kXT78vpKWGFbB0zo5gEXQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



**手动刷单，这种薅法，不侵权不作弊，平台拿你也没办法，缺点就是成本有点高。**

**
**

![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uRbYPooqyIe38CiaVmWGDJ3v3IwXpcqC53JHmUYbbJJwN4AUSo2mG1p9tsxDcQf13vy4FFNCey9elQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**P2P借贷“黑吃黑”月入十万是基础**



你看中人家收益，人家看中你的本金。



P2P爆雷让很多参与者倾家荡产，观望者望而怯之，但在一些人看来，爆雷算什么，714高炮算什么，从来都不害怕和紧张，他们看到的全是捞钱的机会。他们就是撸贷大军，P2P网贷的另一端用户。



平台有1000%的年化利率，照样贷，因为他们根本就没有打算还钱。

![img]()



撸贷者只需要买一张电话卡，养卡半年，一次性下载几百个网贷App，挨个贷款，贷完后立马剪卡，从此人间蒸发。电话卡里的所有通话记录都是伪造的，亲朋好友都不会被催收，身份证地址也找不到人。



撸贷大军在网上至少有几十万人，有撸得多的，一次性撸出**50万**。他们从不认为自己不道德，反而还站在道德高地：**我们不是老赖，我们只是高利贷的终结者。**

 

**2017年底，现金贷监管后，一部分人还清贷款，上岸重新做人。**



![img]()



这样做风险非常大，你必须和现在的朋友圈断绝关系，不能再用自己的身份证办手机卡，还可能成为老赖。

 

**于是有P2P从业人员不自己撸贷，而是下海当起了中介教别人撸贷。**他们熟悉平台的规则和风控体系，知道如何才能撸更多的钱，甚至还会买通一些现金贷的风控主管。

 

中介从内蒙古、甘肃等西部地区寻找客户，这些地方信息相对闭塞，还不知道现金贷是什么，当地人也没有违约等不良信息。中介教他们用现金贷贷款，贷到钱后对半分，几天之内就能下款6万。贷款的人拿3万，中介拿3万，当地人收入一个月才两三千，这比他们一年的收入还多。



有的中介提成更高，甚至高达70%-80%，也就是贷1000块，中介拿七八百，贷款人只有两三百。干得好的中介，一个月最高有50多万收入，少的时候也有10多万。

 

**中介一般还搞培训，教别人如何撸贷，一个月下来，培训费就能赚几十万。**

 

还有些客户资质太差，贷不款，中介就会将这些信息收集起来，与平台合作，注册账号，但不下款，每个账号也有8-10元的返佣，一个月下来也是两三万收入。



**总之，无论你有钱没钱，贷不贷款，每一位客户的价值，都要榨干。**

 

在撸贷大军的行动下，平台被撸垮也是常见的。有平台创始人透露，自家产品被撸贷大军看中，当自己正高兴用户增长时，却发现一个还款都没有，一天损失高达70万。

 

这些撸贷者从来不怕催收，网贷平台通常用“呼死你”来催收，而他们开发了防爆软件，只要输入手机号、身份证号和贷款平台名称，平台的催收座机就会被拦截。撸贷者还会主动进攻，反向轰炸催收电话。在很多反催收的群里，只要提供被骚扰的截图，一些老哥会免费帮网友轰炸催收。



**PS:薅羊毛有风险，搞不好被罚款，还可能坐牢。**

*
*

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**做号集团：洗一篇稿赚几万**



今年3月份，知名自媒体三表龙门阵写了篇文章，自述企鹅号被盗经历，一名叫露露的河南女子，用他的号平均每天发五篇娱乐八卦文章，六十天收益高达7.5万，最高一篇文章分了1.2万。而自己之前日常更新文章却根本没赚到钱。



![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMicWkNA6cxpddaib9SIoaINvUWFW0iaoml08rycMo7ZbKnI8IoqSYic6v91w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

相信，全天下自媒体人都会好奇，内容平台一出手补贴几个亿，但**自己辛苦更新原创，一共也就赚了几十块钱，补贴都到哪里去了？**



在露露的背后，就是做号集团，补贴都被他们拿去了。

 

**补贴一般是根据阅读量来算，阅读量越高，收益越高。**做号集团对各平台内容特点把握得非常到位，能做到量产高阅读量爆文。

 

他们雇佣兼职写手来洗稿，以学生、宝妈和上班族为主，群里领取任务，价格通常为千字10元。也有全职写手，公司开在二三线城市，工资一个月三四千元，加上提成，优秀者月入过万不是问题。



![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMicFCddNvVMZCXwicP79g4mOWyXXWjXVcH5SaL4v8NPHWk5r1EBV7libzKw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



通常，洗稿内容集中在娱乐明星八卦故事，利用明星效应，调动起读者窥私欲，再靠着劲爆的标题和捕风捉影的内容，能带来大量阅读。



![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMicwg8JAcvjwwutUW00BicOrsNZuYvtl8fD9KuZhrLo53vpH6AvJZYS8rg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

图片文章可能出自大妈之手

 

**一篇文章阅读量过百万，广告分成+补贴，收益多的上万元。**据新榜报道，30人的做号集团，一个月平台分成**700多万**。还有UC平台上有留言，一日收益达900元；两年拿下一辆路虎；期待下月收入破4万。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMic17mp0EDeyibWmoQcBKsMYk9jbwtc4Fw25ct4tZKVFGAwS0JnFvakYYQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

 

![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uRbYPooqyIe38CiaVmWGDJ3vK36D616dpJ09m7D4VYDs3bQ69WeuvHUFvR1JjXgArxia59qeNlibIbRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**倒卖付费课程：零边际成本**



**凡是能倒卖的，统统不能放过。**



知识付费课程火起来时，一些人通过众筹的方式实现低价购买课程，一门课程199，100人众筹每人也就2块钱。



既然能众筹，何不自己当二道贩子？只需要把课程复制粘贴，放到某网盘里，转手就能在网上卖几块到几十块，几乎不需要成本。通过网盘分享，后期更新也能做到同步，不用再一个个地重新发给顾客。

 

想学习的人也很喜欢低价课，199的课程，9块9就能买到。

 

二道贩子再通过淘宝，百度贴吧、微信群、个人号等渠道推广，哪有不赚钱的。有些人做倒卖，3个月就赚到**20万**。



![img](https://mmbiz.qpic.cn/mmbiz_png/iaBzXFiaky1uR8V7wQSSmU13LJkBF5OhMicVO4ibIWyl8gtR4mRrKZY6FOdRKn0cdwWR1Ql09Sic5Kk1j9QWE3QR6cw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



从二道贩子买过课程的人，同样做起三道贩子、四道贩子……**你永远不知道你买到的课程是几手，但这无所谓，质量都一样。**

 

**行业竞争大了，有的二道贩子开始注重服务。他们做的服务甚至比平台原版还好。**当平台还在单门课程销售时间，他们已经开始做包年服务，一年99元，可以看几乎所有主流平台的内容，包括得到、喜马拉雅、混沌大学、千聊、荔枝微课、网易云课堂等等。论品类，他们已经超越了任何一家平台；论价格，他们也有优势，能卖得不好吗？



**除了知识付费课程可以转手卖，盗版游戏、电子书等一切付费稀缺资源都成为贩卖对象，单价虽然低，做起来靠量也是一笔不小的收入。**



**以上介绍的5种互联网黑产薅羊毛手段已经有些过时了，现在互联网平台对付手段也变高明了，薅羊毛的操作空间也越来越少，于是羊毛党开始把对象放到传统企业，这些企业上网后反作弊的经验普遍不足。一个风口过去了，他们又去追逐下一个风口。**

 

***最后，蛋解创业编辑部还是提醒每一位：空手套白狼，大家都爱。但是，互联网黑产薅羊毛有风险，有些罚款有些甚至要入狱，我们仍然坚信“一分耕耘一分收获”。\***

# 有赞风控规则引擎实践

![img](https://tech.youzan.com/rules-engine/)

## 引言 

作为一家SaaS公司，有赞向商家提供强大的微商城系统和完整的移动电商解决方案。伴随着公司产品受众不断增长的同时，灰黑产业也慢慢伸出了触角，妄图利用有赞便捷的支付、传播等能力获取非法的利益，因此如何高效的遏制灰黑产业的侵蚀，是我们面临的一个重要挑战。总的来说，目前有赞面临的主要风险类型包括：

- 盗卡。例：盗用用户银行卡，在有赞店铺上消费
- 欺诈。例：通过发布低价商品，诱骗消费者购买
- 套现。例：在自己创建的店铺里进行虚假交易用以套现信用卡
- 垃圾信息。例：发布虚假消息、色情等违规商品、页面
- 盗账户。例：黑客用其他平台获取的账户密码通过撞库来非法盗取用户在赞平台的账户

以上所列各种违法、违规行为危害到正常商户以及买家利益，同时也会平台带来资损。在减少对正常用户打扰的前提下如何高效的对风险进行防控，是有赞风控的愿景和使命。

## 有赞风控架构 

作为风控架构的“大脑”，规则引擎的运行依赖于其他系统的支撑，包括：

\1. 实时特征库
顾名思义，特征库为实时规则引擎提供必要的特征支持。举个例子，当一笔订单传入规则引擎时，我们不仅希望得到该笔订单对应的各种静态特征（谁何时在某地花费了多少代价做了什么），也希望得到该人累加交易情况，这样做出的判断才更有说服力，这里累加交易情况的任务主要由实时特征库来完成，我们的风控特征库主要采用Storm架构，通过接入NSQ消息，将消息内的各种特征进行剥离、汇总、统计，统一存入数据库及缓存中，为规则引擎提供实时统计数据。

\2. 规则管理中心
有赞风控规则管理中心是供运营配置线上规则的入口，并保持与规则引擎的定时同步，规则使用数据仓库组织，底层数据用数据库进行存储。通过规则管理中心，将开发人员从繁杂的规则编码中解放出来，只需要专心开发特征即可。

\3. 风控离线任务
风控离线任务分为离线规则任务、离线特征计算任务。离线规则任务主要运行离线规则以及满足运营的离线数据需求，离线特征计算任务提供规则引擎所需的深度定制特征（如用户评分、可信特征），主要计算框架为Hive/Spark。

\4. 运营平台及工具
包括审核中心、事件表、处罚中心、信息反查中心、黑白灰名单系统、操作日志查询、案件库、规则评估系统等。 风控是一项和业务结合特别紧密的工作，风控系统的好坏说到底需要业务指标来衡量。对整个风控系统而言，运营平台是最终的展示方，同时运营通过这些工具也为规则引擎提供了数据支撑，完成了风控系统的闭环。

### 风控系统架构图  

![img](https://tech.youzan.com/content/images/2017/08/flow_chart_new-7.png)

## 有赞风控规则引擎 

在规则引擎构建之初，我们考虑过多种规则引擎选型方案，包括自建规则引擎内核以满足自身业务的个性化需求，而后考虑到：

- 自建规则引擎对中小型公司并不适用，开发人员重复造轮子耗费大量的人力物力
- 部分开源的规则引擎内嵌了优化算法，保证了规则执行效率
- 部分开源的规则引擎有大量的社区及成功案例支持，可方便的对所遇到问题进行反馈

最终，我们选择了使用较为广泛的JBoss公司维护的Drools。

Drools是基于RETE算法的开源规则引擎，它具有性能高、可扩展性好、功能全等特点。有赞风控规则引擎基于Drools进行开发，将事件按业务风险类型进行分类，每类布控具体的规则、模型对风险进行防控。

天下武功，唯快不破，当发生一笔潜在案件时，如果不能在短时间内发现并处理，对于资金类案件来说，有资损的风险；对于信息类案件而言，有垃圾信息被大量曝光、损坏平台声誉的风险。有赞实时规则引擎分为事中和事后两类，其中事中引擎采用了有赞内部的统一接口框架youzan-boot，事后采用了Storm实时流处理框架。有赞风控规则引擎可在100ms内检测、拦截潜在的风险行为。

规则引擎代码示例

```Logger
// 反欺诈订单业务
String bizName = "antiCheat";  
String bizModel = "order";  
Order order = new Order();  
order.setShopScore(86);  
order.setOrderNo("E2017xxxxxxxxxx");  
order.setPay(100L);  
order.setPayTime("2017-01-01 00:00:00");  
order.setPayPlace("浙江省杭州市");

// 获取已初始化的规则数据
KnowledgeBase kBase = LoadRuleBase.knowledgeBase;  
FactType modelType = kBase.getFactType(bizName, bizModel);

// 新建无状态的会话
StatelessKnowledgeSession session = kBase.newStatelessKnowledgeSession();

// 会话中添加监听器
TrackingAgendaEventListener trackingAgendaEventListener = new TrackingAgendaEventListener();  
session.addEventListener(trackingAgendaEventListener);  
Object modelObj = null;  
try {  
    // 将业务模型数据转化为相应的规则引擎模型数据
    modelObj = order.bizMO2rMO(modelType);
    // 执行规则
    session.execute(modelObj);
} catch (Exception e) {
    logger.error("Exception occurs, orderNo:{}, detail:{}", order.getOrderNo(), ExceptionUtil.getTrace(e));
}

// 获取激活规则信息
List<Activation> activations = trackingAgendaEventListener.getActivationList();  
if (null != activations) {  
    for (Activation act : activations) {
        String actRuleName = act.getRuleName();
        logger.info("订单:{}, 激活规则:{}", order.getOrderNo(), actRuleName);
    }
}

// 获取规则执行后，引擎的返回值
Integer actionCode = (Integer) modelType.get(modelObj, "action_code");  
String actionReason = (String) modelType.get(modelObj, "action_reason");  
String actionRes = "actionCode: " + String.valueOf(actionCode) + "  actionReason: " + actionReason;  
logger.info("订单:{}, 执行结果:{}", order.getOrderNo(), actionRes);  
AntiCheatRiskDTO acrDTO = new AntiCheatRiskDTO();  
acrDTO.setActionCode(actionCode);  
acrDTO.setActionReason(actionReason);  
return acrDTO;  
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748
```

其中，每个规则的执行后的返回值是由运营人员根据业务需求事先配置好的。需要说明的是，我们不需关心每个规则具体返回的结果，运营人员通过在规则管理中心调整规则的优先级及执行逻辑，最终返回的执行结果将是最符合业务逻辑的值。

除了会让具体的事件（登录、下单、支付、发布微页面等）过相应的规则外，有赞风控规则引擎还内嵌了一些与业务契合度较高的算法，如GBDT、FM、优化的Bayes等，作为规则的重要补充，这些算法训练出来的模型，可以抓取到规则未覆盖或难以覆盖的案件。

以GBDT为例，下面介绍下算法模型在有赞规则引擎中的使用方法。

GBDT(Gradient Boosting Decision Tree)，是一种迭代的决策树模型，与传统的boost方法不同的是，它的每一次优化都是利用梯度下降方法往残差减少的方向进行。这里因为我们是二分类任务（例：判断一笔订单是有无欺诈嫌疑），因此我们采Friedman论文中的negative binomial log-likelihood作为损失函数:
![img](https://tech.youzan.com/content/images/2017/08/WechatIMG675.jpeg)其中，![img](https://tech.youzan.com/content/images/2017/08/WechatIMG676.jpeg)并依次设置好残差、叶子节点值。

\1. 特征提取
要训练出高可用的模型，好的特征必不可少。好的特征的重要特点是区分度较高，这就需要算法开发人员和业务敏感度高的风控运营人员紧密配合，对配置的规则进行分析，提取出较好的规则因子，同时，算法开发人员还应对业务流程非常熟悉，发挥自己的想象力，结合实际情况，创造出高可用的特征。对实际业务而言，很多情况下，一个好的特征的加入比模型参数调优甚至模型优化更加有效，同时，好的特征还可以防止过拟合的发生。 将确定好的特征，利用Spark（出于性能方面考虑，主要采用Spark Sql导入到Hive中（对于如已知收货电话，需要求取收货电话归属地等需要二次加工的情况，采用PySpark对数据进行处理），将Hive表分区作为相应的版本号（方便对数据质量进行评估），作为单次训练样本。

\2. 模型训练
机器学习一个重要的需求就是样本的数量要尽可能的多，然而风控业务天然有这方面的缺陷，以交易为例，实际被风控的案例极少，这就导致正负样本数量极不平衡，因此我们采用重采样的方法增加正样本（有风险订单）的数量，具体方法是将样本包含的数值化特征采用SMOTE方法进行重采样，对标签化特征采用随机选择的方法重采样，最后将二者组合成新的样本。 实际训练过程中，需要对算法包含的最大迭代次数、步长、最大树深等参数进行多次适当的调节，选择出识别率最高的参数。这里，考虑到GBDT采用的boosting方法的进化能力较快，同时为维护性能，我们的数深在5-7层之间，最大迭代次数在5-10次之间。

\3. 规则引擎中运行代码示例

```//
GBDTTree[] gbdtTree = new GBDTTree[treeNum];  
for (int i=0 ;i < treeNum; i++){  
    String treeString = treeStringList[i];
    gbdtTree[i] = new GBDTTree();
    gbdtTree[i].getGBDTTreeFromString(treeString);
}

// 传入字符型和分类型数据
order.setNumeric1(num1);  
order.setNumeric2(num2);  
order.setNumeric3(num3);  
order.setCategoricalA(categoryA);  
order.setCategoricalB(categoryB);  
order.setCategoricalC(categoryC);

// 得到样本为正样本（可疑订单）的概率
float fValue = 0.0f;  
for (int i = 0; i < treeNum; i++) {  
    float value = gbdtTree[i].getPredictValue(order);
    fValue += learnRate * value;
}
float posRate = 1 / (1 + Math.exp(-2 * fValue));  
// 超过预设阈值，上传至审核中心
if (posRate > GBDT_CHEAT_THRESHOLD) {  
    upLoad2ReviewCenter(order);
}
1234567891011121314151617181920212223242526
```

代码中，由于业务的敏感性，将具体特征名称隐去。

## 小结 

基于Drools开发的有赞规则引擎，在Storm、Spark/Hive等流数据及分布式处理引擎的计算支撑下、多种算法模型的“法力加持下”，目前很好的满足了有赞的风控需求，但随着公司业务的增长，未来规则引擎的稳定性、性能、有效性也面临着更大的挑战，总体而言，后续还是会从规则引擎本身及算法模型两方面出发，在增强规则引擎框架的同时继续研究更多机器学习算法在风控业务上的作用。

### 参考 

[Drools](https://www.drools.org/)
[GBDT](https://statweb.stanford.edu/~jhf/ftp/trebst.pdf)
[SMOTE: Synthetic Minority Over-sampling Technique](https://www.jair.org/media/953/live-953-2037-jair.pdf)

# 【反欺诈场景剖析】虚假账号的产生和流转

永安在线反欺诈 [观察](https://www.4hou.com/category/info/observation) 2019年5月29日发布

收藏

导语：此篇主要介绍反欺诈场景中虚假账号的产生和流转规模化的背后，以及如何对黑灰产做恶的关键节点的监控来实现对企业自身虚假账号风险的管控。

【反欺诈场景剖析】是威胁猎人黑灰产报告的一个系列，我们希望通过对反欺诈实际场景的剖析出发，帮助企业发现业务风控过程重的核心关键点。此篇主要介绍反欺诈场景中虚假账号的产生和流转规模化的背后，以及如何对黑灰产做恶的关键节点的监控来实现对企业自身虚假账号风险的管控。根据威胁猎人鬼谷实验室统计，全网恶意注册发起的攻击每日就可达8327380次。虚假账号平均每日活跃量可达1389107次，平均每张黑卡每日进行6次攻击。

恶意注册是业务风险的起点，也是企业风控的核心关键点。 当今黑产以恶意注册为代表的各类攻击资源已经高度的模块化和市场化，产业链不同层级的团伙专注于不同的任务而又配合严密，而究其根本，是强自动化使得攻击变得可复制，进而形成套路化的盈利模式，对企业资产造成威胁。如果企业无法及时发现问题，采取有效对抗策略，将在业务上面临巨大损失。

**商业模式转变带来黑灰产核心资源的变化**

黑灰产这条产业链伴随国内互联网发展二十余载，可以说是非常执着，也占尽了便宜。 早些年， 黑灰产就开始控制个人电脑做为肉鸡来进行Ddos、刷广告、安装流氓软件等变现。一台台实际的物理电脑就是黑灰产的核心资源，谁控制的越多，谁就赚的越多。
这个时代下的互联网黑灰产之所以是这种逻辑，也是因为互联网早期的商业模式非常集中在线上广告，在PC互联网时代这种线上广告的结算逻辑是以电脑设备为单位，各个互联网厂商也是以安装量、激活量及活跃量等来构建自己核心商业逻辑。
彼时，设备数量不只是当时互联网黑灰产的核心资源，同时也是当时整个互联网的核心资源。
2007年第一台iPhone发布，打开了移动互联网的豁口，PC互联网世界经历大洗牌。 智能手机问世以后，开始把曾经存在在PC上的媒介、市场逐渐招揽到移动端来。
很快，互联网承载的业务场景因为移动属性呈现出爆发式增长，商业模式上个人付费能力及意愿也在快速增强，越来越多的人愿意享受内容付费带来的服务，如，开通VIP会员，购买线上课程等等。这时互联网产生的连接已经不再只是内容和设备的连接，而是场景和个体的连接。
互联网的核心资源也从设备变成到了个体，存在于互联网中的每一个网民就是新互联网时代的争夺对象。
与此同时，黑灰产也逐渐向移动互联网的场景转移。 我们清楚地观察到，互联网黑灰产从之前的通过色情流量下发木马到用户电脑，取得电脑控制权后变现的模式，变成了通过大量手机号在各个互联网核心业务场景注册恶意账号，并通过这些账号在业务场景中变现的方式。

**以恶意注册为核心资源的黑灰产作恶**

随着商业模式的变化，电商平台薅羊毛、直播平台刷量、社交平台刷粉、网络诈骗等各种以虚假账号为核心资源的黑灰产攻击开始涌现。
以直播平台刷量为例，通过刷量可以帮助主播上各种排行榜；给主播购买僵尸粉，可以增加主播的粉丝数；在主播的直播间购买水军，可以增加直播间人气等等。一方面，这些数据可以直接在平台折现成现金奖励，由此获利；另一方面，伪造人气可以吸引更多的粉丝，进而通过粉丝打赏获利。
根据威胁猎人鬼谷实验室统计，全网恶意注册发起的攻击每日就可达8327380次。这背后涉及到的黑卡资源，平均每日活跃量可达1539107张，平均每张黑卡每日进行6次攻击。其中，受恶意注册影响最严重的行业有金融、电商、媒体、社交和生活服务。可以明显发现，恶意注册攻击的目标一般具有高盈利性质或是高流量性质，可见下游的变现需求是驱动恶意注册进行的根本。

![【反欺诈场景剖析】虚假账号的产生和流转](https://www.4hou.com/uploads/20190529/1559121030409879.png)

每张黑卡的重复使用率都非常高，因为在中国国情下的黑灰产攻击具有明显的流动性，即同一行业往往面临共通的黑灰产攻击，攻击门槛更低、防护较弱的企业产品更容易吸引攻击。当某厂商攻击难度提高后，相关人员会迅速的转向同类别的其他厂商。各大企业在解决问题上的思路与措施有一定的相似性，也造成了黑产绕过方式与攻击工具的可复制性非常高。
在这样的情况下，如果企业不了解的黑灰产的攻击手段，无法识别其掌握的大量虚假账号，就不能结合企业自身情况制定最低成本与最低损害正常业务的策略进行防守。

**恶意注册规模化的背后是效率平台的发展**

当今黑产以恶意账号为代表的各类攻击资源已经高度的模块化和市场化，产业链不同层级的团伙专注于不同的任务而又配合严密，而究其根本，是强自动化使得攻击变得可复制，进而形成套路化的盈利模式，对企业资产造成威胁。
根据威胁猎人鬼谷实验室的研究分析发现， 恶意注册所得账号为消耗型商品，各厂商通过各式安全策略处理作恶账号的同时，新生的恶意注册账号会不断填充被处理作恶账号缺失的部分。虽然有些账号在封禁后，可以通过发送短信、接收语音验证码等方式对账号进行解封，但实际解封率极低，原因有两点：一是黑产解封一个账号花费的时间远长于注册账号所需的时间；二是在很多场景下，黑灰产在账号封禁前已经完成了变现，此时解封一个封禁账号的价格成本远高于注册一个新账号。
如下图，是同一时期内，新生恶意注册账号和二次解封账号的比例：

![【反欺诈场景剖析】虚假账号的产生和流转](https://www.4hou.com/uploads/20190529/1559121075188459.png)

图为：恶意注册账号新生量与解封量对比

可以看出，在同一时期内，恶意账号的新注册量远远大于解封量。于是，在整个大批量恶意注册的过程中，如何提升整个运作过程的效率和降低恶意注册的成本，是作恶的核心关键点。
于是在整个黑灰产的发展过程中，“接码平台”“发卡平台”及其相关产业成为了恶意注册产业链中至关重要的一环。

![【反欺诈场景剖析】虚假账号的产生和流转](https://www.4hou.com/uploads/20190529/1559121096451807.png)

图为：利用接码平台、发卡平台完成的产业链协作

**接码平台——提升了整个黑灰产虚假注册的效率**
接码平台实际上是一个接收短信验证码平台，它诞生在移动互联网早期。当时黑灰产购买猫池设备，再插上上百张手机卡来模拟上百个自然人，完成对业务场景的恶意注册。恶意注册完之后再把设备和电话卡转卖或者租用给另外一个黑灰产团队用于不同业务场景的恶意注册。
这个过程其实非常低效。因为一个黑灰产要负责三个环节：

![【反欺诈场景剖析】虚假账号的产生和流转](https://www.4hou.com/uploads/20190529/1559121112862003.png)

图为：过去利用猫池完成恶意注册

接码平台的诞生就像是一个黑灰产的“交易平台”，它的价值产生在特定两个互联网黑灰产业链节点之间。
账号资源是众多黑产链最上游、最基础的需求，而数量众多的卡源卡商，通过接码平台可以直接在线上把手机卡的价值卖给出于中游的大量号商，取得高回报。
号商，通过接码平台的网页端，可以直接获取手机号和验证码，完全不需要买入手机卡及相关设备，就能完成账号的注册。

![【反欺诈场景剖析】虚假账号的产生和流转](https://www.4hou.com/uploads/20190529/1559121130597357.png)

图为：利用接码平台完成恶意注册

接码平台负责连接卡商和有手机验证码需求的群体，提供软件支持、业务结算等平台服务，通过业务分成获利，一般为30%左右。
2016年11月，当时规模最大的接码平台爱码被警方查处，缴获黑卡700余万张，自此很多接码平台转入地下，有些平台也通过关闭新用户注册等措施来降低风险。以接码平台爱乐赞为例，在2018年1月关闭了新用户注册，导致平台一号难求，其平台账号甚至达到每个100元。目前市场已有的接码平台非常多，比较活跃的有：火云、爱乐赞、ema666、60码、thewolf、玉米等。
随着验证码对抗的升级，注册项目不再是通过单一的短信验证，有些需要语音验证，有些则需要二次验证，即需要注册用户使用注册的手机号向指定号码发送一条验证短信。接码平台也紧随市场变化不断升级，衍生出接收语音验证码、二次取号、发送短信的服务。
**发卡平台——提升了黑灰产账号流转的效率**
发卡平台是把数字商品做自动化交易的平台，在号商完成大量账号的注册后，他们会把恶意账号整理后集中在发卡平台中列出，供处在产业链下游的用号方直接线上批量采购。
这就像在淘宝买一张话费充值卡一样，只是在应用的场景上，发卡平台现在已经是互联网黑灰产的主要交易通道和协作平台。
用号方会根据自身作恶场景，通过发卡平台买入对应的虚假账号，用以薅羊毛，平台刷量，账号诈骗等场景。

![【反欺诈场景剖析】虚假账号的产生和流转](https://www.4hou.com/uploads/20190529/1559121146973860.png)

图为：利用发卡平台完成账号交易

根据威胁猎人对黑灰产的长期监测和资源统计，目前参与到发卡平台交易的黑灰产从业人员超过1万人，涉及的商品种类将近数千种，商品数量超过百万，年产值数亿元。
此外，通过追踪发卡平台上灰色商品的价格，我们发现，价格是体现企业风控策略有效性和市场需求变化的一个非常直观的因素，商品价格越高，代表企业风控策略越有效，使得黑灰产作恶成本变高。但同时黑灰产通过攻击获得的收益也在提升，因此，在高成本的情况下，黑产依然会发起攻击，企业需要采取进一步的措施防范风险。

**及时捕获黑灰产行为是控制风险的有效手段**

在整个企业与黑灰产攻防战中，不同企业的业务场景不同会让整个攻防格局有区别。但黑灰产的核心资源始终是其控制的虚假账号， 只要能在恶意注册这个点上对黑灰产施加有效的控制，对企业业务风控整体的风险就是相对可控的。
**识别黑灰产资源**
黑灰产在作恶和变现时都重度依赖于其手中持有的基础资源，包括但不限于手机号、IP、设备等。而这些黑灰产资源对于企业方来说，是全黑的数据，如果能将将这些数据与自身业务数据进行匹配，就可以直接识别出恶意帐号或黑灰产恶意行为，针对性的进行相应的风险控制。
**分析黑产工具**
黑灰产的攻击工具承载着黑灰产的攻击逻辑和利用的企业业务漏洞，通过对工具的监控和逆向，企业可以了解到自身存在哪些业务逻辑漏洞或者是哪些风控策略已经失效，从而提升整个攻防对抗的效率。
**监控黑灰产交易变化**
黑灰产交易品类和价格的变动，能够反映出企业一定周期内风控策略的有效性。例如，即使企业上线了风控策略，但是黑灰产仍然能够以很低的成本完成恶意帐号的注册，则表示企业的风控策略失效了；另一方面，如果发现黑灰产交易价格变高，反映出黑灰产攻击成本的上升，则可以看出企业的风控策略有了一定的效果。有效的风险评估，能更好地推动业务安全的落地和迭代。

## 40页PPT详解反欺诈体系与策略规则

原创： Jackie Liang [金科应用研院](javascript:void(0);) *5月13日*

银行、非银金融机构在欺诈防范中，目前到底做到什么程度？知识图谱、复杂网络这些“黑科技”在反欺诈真实场景中应用的如何？反欺诈中大家都有做的舆情分析在不同梯队的金融企业中，应用程度上有什么差异？



对于没有从事过反欺诈相关工作者，想必对于这些问题是一知半解甚至一头雾水。



金融科技应用研究院（简称FAL）通过以下研究报告，从“**互联网领域欺诈风险**”、“**常见欺诈案例及攻防**”、“**风控反欺诈体系和外部舆情监控**”、“**线上引流项目的反欺诈风险管理****”、“反欺诈策略探索”**五个方面解析新金融业的反欺诈体系和策略规则分析，希望读者朋友有所获！



![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibUjmGvibxCwmfVbJVlayltiaCyBibRx545ibc3aVtKoADutvJeicoCknbPDA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibUI1lNxCHTaTaEApfjWuSO92Gd2fw4qicy592TgDDfPU2ATa9qgvheibg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibfccHZmfuPibj0yTwUJ6Acyg3y53vbxvhoW3PcgJSOdbxdTsyO4ZSUww/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibN2wBstzNcR1fUSWic58qb8JotJlpvIe1EIzXC6JlOuTg4C5GPWJiaAvw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibvu2rQkj6WklmRkdicgCrumPib52PkTPTias4MyMmHyU4IZXuBRljSmmsg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibqMaXfl8UKicibjpQdDGWdXX7sHQ7FwKUESlRss2HvPSohnVQfWA1I7Dw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibib6fLNfSicpNgZhpKHfWiaQd8tVKR4epxljtOibiaadiaia8AIhIiac7B3b1wA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoib97F3R0jzmV9alTUPia8ncIY4yTSUNcqaAaK9vkPuGqM4nsfLrxP8beA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibExvvj6WVZZX3HBicYjLHrAkAs0VxYsMsqtbKS9ECyHCvdibGMib0F9muQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibw6n7vnvbBN4Pv9l1HRSSajicqlG2JgicfCeDKibAoSStF9VB2d4S5loiaQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



因公众号贴图排版要求，小编就不在文章里贴全部的报告资料，如果读者朋友们想要获取完整版PPT报告，可以通过如下方式获取《风控反欺诈体系与策略规则》研究报告。

后台提交转发朋友圈截图+留言“反欺诈+邮箱”，报告资格统计时间截止到5月17日PM 5:30，报告统一邮件发送时间为5月17日PM 6:00！



⚠️报告中线上引流项目的反欺诈分析、反欺诈策略探索分析这些案例分析无法在报告中详细展现数据分析过程，FAL特此开发本周日的讲解直播课程，对课程有兴趣的读者朋友可以扫描下面课程海报报名学习。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibu6n6BzwwuYMWDxibtIqroPxbqk3HIlrICfNwrQ8xalTZSWcQntS9w6A/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/94gNibiapbNpvxrID2gAUj3VM1hLribhufV4jMKRbD9A6WZic1HrhwnZuNymEecODZTeibib4x6EPrwjNiaeHHr4YeOHQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

End

![img](https://mmbiz.qpic.cn/mmbiz_jpg/94gNibiapbNpvxrID2gAUj3VM1hLribhufVggjQ0AT9NjDPT4tNnh9yG5ZX52PbUhsjsIH5hpUYZHufqjVnFNyfrw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibNWrBk0YV9L7oJd7qeOuZwF2RUv9m7bDdoDia58KnKkgDylYicfcw2vow/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFP9jlAy5PHhpZyyJ9Zd8icicoibGrlxCcEJcVickF17yibJxXnrrp7vMJM7JLSibiafmJQsS9NiavZ4VEvYRqw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



往期精彩回顾

[40页PPT详解金融业智能反欺诈的应用](http://mp.weixin.qq.com/s?__biz=MzUzNDYyNjk3MA==&mid=2247485412&idx=1&sn=5cc640cbbbeb16b492d1e91e6219aedc&chksm=fa909011cde719072c0e811b03241ef7fb5f4071963c056f77652dd3e51366d08eda0dfcdea6&scene=21#wechat_redirect)

[欺诈行内黑话大集锦](http://mp.weixin.qq.com/s?__biz=MzUzNDYyNjk3MA==&mid=2247485819&idx=1&sn=2f69518178a1b66b6f237ad19090245d&chksm=fa909e8ecde71798093a8dffc7783099c98998254813340b52170d7af4be97422553cd461edd&scene=21#wechat_redirect)

[<人人都是数据科学家>从新开始用Python学习数据科学的完整教程P3](http://mp.weixin.qq.com/s?__biz=MzUzNDYyNjk3MA==&mid=2247485811&idx=1&sn=38043e7edb2defbc8baebea627a16018&chksm=fa909e86cde71790dae48a1c2fdd9e6881b08b480a31b9d99f2482a11f9d88896f39bfe133d4&scene=21#wechat_redirect)

[40页PPT详解智能风险定损方法在金融业的应用](http://mp.weixin.qq.com/s?__biz=MzUzNDYyNjk3MA==&mid=2247485768&idx=1&sn=5c0ad738dd31b9365c6477cb72bde0b6&chksm=fa909ebdcde717ab3c9565f55c87e665f47adf40e9ea724c54072ee37a0ce4651c8eda76ac00&scene=21#wechat_redirect)

[一条案例：如何选择合适的第三方数据源](http://mp.weixin.qq.com/s?__biz=MzUzNDYyNjk3MA==&mid=2247485410&idx=1&sn=1d25d470450ead25a574df58fcec7d49&chksm=fa909017cde719016300503361327d255b99d6296dfead62b2a888541637e6b674e717c6d673&scene=21#wechat_redirect)

[你真的了解欺诈吗？最全欺诈风险防范经验手册](http://mp.weixin.qq.com/s?__biz=MzU4NjI4MTUyNg==&mid=2247484953&idx=1&sn=23f0be9b514bf467afd99b517c4abd3f&chksm=fdfce140ca8b685620c6915a39adf57d8ebcc639349c856f6633eb12ef340bf991976b12e7b1&scene=21#wechat_redirect)

[40张PPT详解信用风险模型在金融科技中的开发和应用](http://mp.weixin.qq.com/s?__biz=MzU4NjI4MTUyNg==&mid=2247484784&idx=1&sn=f40dcede4767b00a59e005160e4dd14e&chksm=fdfce229ca8b6b3f6b69d0d1b33ec5f3bb6853a2d90ab059309361946b93223f01684a5cd68c&scene=21#wechat_redirect)



![img](https://mmbiz.qpic.cn/mmbiz_jpg/PghPhpmtFPicQWYtFsxYGke2oSfL9ysuqPWB2bEL5I5wH3DLvN0kibOTnhtkpj2hiayYPDv5xQuibrialtPrwrB3b0w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

## 黑产在IP攻防上的挣扎与进化

原创： 威胁猎人 [永安在线反欺诈](javascript:void(0);) *6月5日*

这是威胁猎人黑灰产研究报告的系列文章。本文梳理了黑产IP资源的进化史，并着重阐述了威胁猎人对秒拨技术和资源相关研究，以及如何突破秒拨IP的识别问题。**文章由威胁猎人（ID：ThreatHunter）原创发布，并受法律保护。如需转载、摘编或利用其它方式使用本报告文字或者观点的， 请与我们联系。违反上述声明者，将追究其相关法律责任。**











1





**前言**


IP，作为互联网空间中最基础的身份标识，一直以来都是黑产与甲方争夺对抗最激烈的攻防点。

然而，在威胁猎人深耕业务安全领域数年的时间里，发现黑产技术迭代进化的速度令人咋舌，但是不少甲方却对黑产的研究和认知依旧停留在早些年的初级阶段。黑产发展迅速，而甲方对黑产的了解却停滞不前，必然造成在攻防过程中的信息不对成，防御难度加大，防守响应滞后，效率和效果大打折扣。

举个例子，对于黑产而言，“秒拨”早已不是一个新词，秒拨IP资源早已成为当下主流的黑产IP资源，可是，威胁猎人在与多个甲方客户沟通交流的过程中发现，很多在甲方做业务安全的同学对秒拨的概念一知半解，甚至完全不了解。

这个现象值得反思，秒拨在2014年前后已经是成熟的IP资源解决方案，到现在2019年，被广泛用于批量注册、投票、刷量等短时间内需要大量IP资源的风险场景，并且由于秒拨IP难以识别的特性，对当前互联网业务安全场景已造成巨大危害，但是很多安全行业的同学居然觉得这个东西很新鲜。

不论是在IP这个对抗点，还是在手机号、设备指纹、风险流量和行为等其他对抗点上，传统的【先被攻击】，然后【事后发现】，最后【补充规则】的被动式的对抗方式已经完全无法适应当前与黑产的攻防节奏，研究黑产、了解黑产、掌握黑产的最新技术和动向，才能把控更多主动权。

**想打赢业务安全的战争，必须由\**“\**亡羊补牢\**”\**式的攻防形态向\**“\**未雨绸缪\**”\**式的攻防形态转型。**

下文梳理了黑产IP资源的进化史，并着重阐述了威胁猎人对秒拨技术和资源相关研究。









2





**秒拨的前世今生**



自从甲方开始在IP层面根据一些简单的规则（如设定单位时间内IP的访问次数阈值、限制触发特定行为的IP等）做风控起，就正式向黑产在IP战场上宣战。

早期黑产主要是通过代理IP的方式绕过甲方的风控规则，售卖代理IP的网站便如雨后春笋般涌现。这些网站收集代理IP的方式主要利用高性能的服务器对全网进行扫描，扫描开放代理服务的服务器，或者是直接爬取其他代理网站的数据，收录有效代理IP和端口，以免费或者付费的形式交付给用户。此方式最大的弊端是代理IP的有效性和数量无法把控，代理网站无法把控，用户更无法把控，这就非常影响黑产做自动化攻击的效率。也有黑产利用VPN绕过甲方风控，VPN相对稳定，但是成本更高且有效IP数量有限，并不适用于黑产大规模批量化的攻击。

全网的代理IP数量相对有限，且早期代理服务一般都架设在数据中心的服务器上，不少甲方慢慢开始积累代理IP池，进一步打压了黑产使用代理IP的效果。





分割线



不少做业务安全的同学对黑产IP资源的认知就停留在了此处。



分割线




然而不甘心的黑产开始做资源升级，研发出秒拨的技术。

通俗的讲，**秒拨的底层思路就是利用国内家用宽带拨号上网（PPPoE）的原理，每一次断线重连就会获取一个新的IP**。与时俱进的黑产掌握大量宽带线路资源，利用虚拟化和云计算的技术整体打包成了云服务，并利用ROS(软路由)对虚拟主机以及宽带资源做统一调配和管理。这种云服务交付给黑产用户其实就是云主机（俗称“秒拨机”），黑产用户可安装Windows或Linux系统，通过RDP、VNC或者SSH连接，部署自动断线重连切换IP以及攻击的工具后，便可发起攻击。

秒拨机web管理页面截图：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


秒拨机桌面以及某拨号软件截图（黑产用户可在秒级切换IP）：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



上文中提到了，秒拨的底层思路就是利用国内家用宽带拨号上网（PPPoE）的原理，每一次断线重连就会获取一个新的IP。这在与甲方的IP策略对抗层面，给予秒拨两个天然的优势：



- **IP池巨大**：假设某秒波机上的宽带资源属于XX地区电信运营商，那么该秒拨机可拨到整个XX地区电信IP池中的IP，少则十万量级，多则百万量级；
- **秒拨IP难以识别**：因为秒拨IP和正常用户IP取自同一个IP池，秒拨IP的使用周期（通常在秒级或分钟级）结束后，大概率会流转到正常用户手中，所以区分秒拨IP和正常用户IP难度很大。



这两个天然的优势也是秒拨是当前黑产主流IP资源的核心原因。

一台秒拨机上发现大量注册机以及其他黑产工具和资源：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


此外，黑产对秒拨还做了升级，称为“混拨”，即黑产把多个省市地区的秒拨资源打通，实现在单台秒拨机上就可以拨到全国上百个地区的IP资源。一台混拨机，成本低至48元/月。

威胁猎人对市面上提供秒拨机的主流平台做了统计，其提供的秒拨IP可覆盖全国所有约300个城市。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



黑产秒拨IP资源分布前十的省份为：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


另外，黑产秒拨IP资源运营商比例分别为：



![img](https://mmbiz.qpic.cn/mmbiz_png/4mAgZtBianqGnQmXcylKVGqL0fak54O5BH2Pg5U3SCnFBQm8B8nm7z49Uulic4WPTM24ic4YgbBiaXgkic0pWVSvzhQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)


黑产还在不断扩大覆盖其秒拨IP资源的地域覆盖范围，甚至部分平台也可以提供美国、韩国。香港等非大陆IP资源。

另外，前文中提到过，早期黑产收集代理IP的方式是全网扫描，可用性无法保证。其实黑产早已把秒拨的技术应用于代理IP，黑产利用秒拨技术积蓄代理IP池，再提供给下游黑产用户，并且此类代理IP继承了秒拨IP的优势，一是IP池巨大，二是难以识别。秒拨型代理IP常见的实现方式是动态转发，如下图所示：


![img](https://mmbiz.qpic.cn/mmbiz_png/4mAgZtBianqGnQmXcylKVGqL0fak54O5BlpS4AfHrxLRxdKBPXSEf28twGJJhGAiafEWt14MUhCz3L3gM8hDEQ7w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)


威胁猎人情报监测平台数据显示，当前黑产使用的代理IP资源中，秒拨型代理IP占74.56%，传统型代理IP仅占25.44%。甲方如果还想以积累IP池的传统方式与黑产对抗，必然会引入大量误报。


![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


此外，使用代理平台提供的Windows/Android/iOS客户端，通过PPTP/LT2P等VPN协议，可把黑产终端直接变成“秒拨机”，大大提高了黑产作恶的便捷性。









3





**写在最后**



总之，秒拨已然成为支撑黑产与甲方在IP层面攻防的核心技术，也是当下业务安全行业的痛点之一。文中提到秒拨的两个天然优势，对于黑产而言，是两道天然的屏障，但是给甲方在风险IP识别和判定上带来极大的难度。


当前形势下与黑产在IP层面上的对抗，依靠传统地积累IP威胁情报库的方式，根本无法直接应用和落地到业务侧，典型的使用效果是，对黑IP的检出率很高，对正常用户IP的误判率也很高。

所以，识别风险IP的核心依据应该是，**该****IP是否当下被黑产持有，IP的黑产使用周期和时间有效性**这两个指标尤为重要，尤其是对于像家庭宽带IP、数据中心主机IP这种“非共享型”的IP。针对基站、专用出口等“共享型”的IP，由于单个IP背后会有大量用户，风控阈值应该相对更宽松，但是如果能准确识别IP是否当下被黑产使用，也能提供很重要的参考价值。

威胁猎人长期致力于黑产IP资源的研究，旨在帮助甲方解决业务安全场景下风险IP的识别问题，并于近日实现突破，**通过对黑产ROS秒拨节点的布控，可实时监控和收集黑产当下使用的秒拨IP**。威胁猎人愿与各方共同交流与努力，一起攻克行业性技术难题。



我们很快会推出新一篇技术解读文章，剖析秒拨IP识别技术在实际案例中的应用，并阐释其中的技术原理，敬请期待！







**精彩回顾**





[【反欺诈场景剖析】虚假账号的产生和流转](http://mp.weixin.qq.com/s?__biz=MzI3NDY3NDUxNg==&mid=2247484993&idx=1&sn=2a1e0368b61833476a21cf38066f43a5&chksm=eb11207adc66a96cc9d1aa6b66c1f7a6b42cff3b7557538d4dcadd3639b74fb276d523af185f&scene=21#wechat_redirect)

[黑灰产规模化的背后 —— 由发卡平台组成的资源交易网](http://mp.weixin.qq.com/s?__biz=MzI3NDY3NDUxNg==&mid=2247484881&idx=1&sn=dc8d34acfcb5bed1255b66829712475d&chksm=eb1123eadc66aafce516a3824329041ff0aea672151b7fc5571a1b3e464da473055060b11180&scene=21#wechat_redirect)

[如何利用开源风控系统（星云）防止撞库？](http://mp.weixin.qq.com/s?__biz=MzI3NDY3NDUxNg==&mid=2247484939&idx=1&sn=8ebe64a5a1fece7e67c978ae0b9011dc&chksm=eb112030dc66a92680cc9f58e9d85c227dc15bfae2c8273b6183a03bd7d8e1f2397d62dd906a&scene=21#wechat_redirect)

[黑产大数据 | 在线视频流量欺诈黑灰产研究报告](http://mp.weixin.qq.com/s?__biz=MzI3NDY3NDUxNg==&mid=2247484702&idx=1&sn=e634a0097846574f008e88a278c7b315&chksm=eb112325dc66aa339cae0d648f17dfaf9cf5168f53461213b8fe52b31c0f6046352bee88e2a5&scene=21#wechat_redirect)



------



**关于我们**



威胁猎人是一家以业务安全情报能力见长的创新型安全企业，旨在为客户提供业务攻防情报，从防控到打击的全方位业务安全解决方案。自成立始，公司投入大量资源，打造了一整套国内领先的业务安全情报监控与预警体系，形成强大的黑灰产布控能力，为客户提供黑灰产情报及业务风控解决方案。目前已为腾讯、百度、阿里、华为等互联网企业提供业务安全服务。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/4mAgZtBianqF56uzw0dib0tYK9gXEV0omnJARJbNaKGib6xBynlGRqRR5Ct37tqfcD5L5IIDECTN1oK1viaMUkkBSw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

## 重大新闻 | 陌陌风控系统开源啦

原创： 开源小分队 [陌陌安全](javascript:void(0);) *6月17日*

![img](https://mmbiz.qpic.cn/mmbiz/yqVAqoZvDibF3x0SNh9B9biafDD4KB7yQuoknNUQ8ibfCKA7fickT4wnuQuBCrHiaVuETmrIJnChFBbJyhFsjFj51jg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



**沃·兹基硕德小贴士**

开源一时爽

一直开源一直爽

![img](https://mmbiz.qpic.cn/mmbiz/yqVAqoZvDibF3x0SNh9B9biafDD4KB7yQuickOp9iczpXqIvOMKjRGeF78tbmDNfO9bCc5OqBrL2QdRKBicy7rSG4Og/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)







陌陌风控系统静态规则引擎，零基础简易便捷的配置多种复杂规则，实时高效管控用户异常行为。

![img](https://mmbiz.qpic.cn/mmbiz_png/1YLJUhm0ZtlAjaW0M2HKZT5eRKu0pzV3jALxVibKychY2gxV8JfQqz24jtKsQsyYhp96ibF9uymibwYT7VsLOao0Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

【名词解释】
策略原子：基于用户行为数据进行异常判断的基础元素，如设备黑名单、手机号黑名单等
管控原子：用户命中策略原子后对应的管控措施，如短信验证码、滑动验证码等；
规则：基于不同业务点建立的规则ID，由多条策略原子+管控原子构成；
错误提示码：用于前端规则命中后的提示，便于运营人员排查问题，解决问题。

【方案设计简介】
规则配置：用于不同业务点的规则配置；
策略配置：用于设置策略原子及策略原子；
数据源配置：基于业务数据而设置的数据来源key，用于风控策略的运算；
数据统计：用户命中规则的数据统计与展示；

【使用说明】
当一个业务需要接入风控系统进行管控时，通过以下步骤进行配置
\1. 建立该业务数据源，业务方需要向此数据源推送业务相关数据；
\2. 建立该业务所需要的策略原子，部分策略原子需要依赖该业务数据源；
\3. 新建规则配置，设置策略名称、权重、策略原子组、管控原子、提示语，完成规则配置；
\4. 业务方调用此配置，进行业务风控；

【注意事项】
本次开源版仅包含陌陌业务安全风控系统静态规则引擎中的部分功能，后续根据实际情况逐步扩展功能。



【地址】

GitHub地址：https://github.com/momosecurity/aswan

或者点击阅读全文即可查看。



这次我们的惊喜玩儿个大的，截止6月20日 17:00，评论里面点赞前三名赠送MMSRC 7月初直播抽奖白帽子名额一份儿，问我抽奖礼品是什么？上次三星T5 1TB移动硬盘、ikbc键盘等等等等应有尽有，这期奖品依旧很给力！

## 群控进化史，黑产攻击效率提升带来的防守困境

原创： 威胁猎人 [永安在线反欺诈](javascript:void(0);) *6月20日*

![img](https://mmbiz.qpic.cn/mmbiz_png/4mAgZtBianqFWFuQ8oOsVJOJiaAaQbYyjmX3AIVgOibnhg1hnk1r1R1C1I6vwo3HynLn3McIWkGpLZwWMAvZeMIRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

![img](https://mmbiz.qpic.cn/mmbiz_png/4mAgZtBianqFWFuQ8oOsVJOJiaAaQbYyjmX3AIVgOibnhg1hnk1r1R1C1I6vwo3HynLn3McIWkGpLZwWMAvZeMIRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**导语**



导语：黑灰产研究报告系列又和大家见面了。在这篇新报告中，猎人君将带大家了解群控及其进化史，揭秘攻击效率提升背后的逻辑，并提供有效的应对措施。**文章由威胁猎人（ID：ThreatHunter）原创发布，并受法律保护。转载、摘编或利用其它方式使用本报告文字或者观点的，如需转载请与我们联系。违反上述声明者，将追究其相关法律责任。**





0







**一波又一波“市面上最好用的群控”**



2018年下半年的时候，出现了一家号称“市面上最好用群控”的设备厂商，大肆地鼓吹和宣传自己的产品，据说光占地面积就要比传统群控节约95%。


好奇的猎人君买了一台，并且“采访”了一个大量采购的土豪“工作室”，在此之前他已经拥有了六万台移动设备、十万余个微X账号，大佬做流量生意，刷量啊、投票啊、引流啊，时机合适薅薅羊毛啊……



——“啊，死号率可以的，一到三成吧，抖X、微X都还行，拿facebooX做外贸基本都能保证效果。”


——“主要节约小工，我这儿每个人力2500一个月，提成按他出的量结算，我一块他五毛这种（这里指像“卖茶叶的姑娘”那样，通过伪装人设和大量撒网加人，用诱导诈骗等方式促成购买消费。），原来一个人做一百控（一控即一部手机），就管理设备啊、和加的人聊天，现在一个人能操作两三百个（相当于240~360台手机）吧，分到聊天上的时间多，出的量也跟着涨，他高兴我也高兴……”


——“养号操作比原来快，其他操作他都打包了，不用好几个软件跳（伪装设备指纹的软件，挂代理IP的软件等），确实节约时间。”

还真是，蛮量化的评价呢…


猎人君动手拆了自己的设备，打算一探究竟。这是一个箱型设备，需要连接网线和电源线，以下姑且简称它为箱控。





1







**玩转谷歌和苹果开源项目的黑产**



**1、群控是啥？**

群控——一种通过操作多台手机进行批量攻击的方式，可以说是黑产工作室的刚需了，在市场需求的催生下，群控类设备的供应商都非常擅长与利用各类技术对其进行升级优化。以下是某工作室的群控设备照片。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**
**

**2、箱控是啥？**

下图这次的主角——箱控的内部构造。将十二台安卓手机主板通过电路集成方式集成至一块大主板，进行统一供电和管理。



**问：手机屏幕呢？**



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



**答：扔掉。**我们用Apple提供的Darwin Streaming Server 传输手机画面到电脑上。（DSS是一款开源实时流媒体播放服务程序，是很多远程教育、网络监控、视频点播类系统的流媒体解决方案。）


至于设备数量问题，它通过切割内存的方式，将每个手机主板切割为十个分身。最终达到，操作一台箱控相当于操作一百二十个不同手机的观感。原本需要一个大厅存储的手机设备，现在只需要几个货架，大幅缩减了黑产的设备运营成本。
 
**设备数量的问题解决了，如何批量操作呢？**

企业大部分业务接口的关键参数都设置有特定算法，在无法对其破解进行直接攻击的时候，黑产常常需要通过模拟点击的方式伪装正常用户操作，达到攻击目的。常见的模拟点击方案是通过识别颜色、文字、形状来定位到需要点击的坐标，这种方式经常需要进行容错判断，再一次通过识别颜色形状等，来判断自己是否点击进入了目标页面，每次识别要消耗时间，速度相对较慢。

箱控使用了appium——基于Google UiAutomator2的安卓自动化测试工具，通过文字、控件id、控件名称等直接定位到APP的控件进行操作，也就是说和上述方式相比，不用每次点击后截图，也不用根据图片一个像素一个像素的判断该点击的位置，速度得到了提升，而很多企业自身产品的自动化测试就是采用appium完成的……

回想“群控”一路的进化变种，再结合近来的种种事件，猎人君发现了一些规律。





2







**黑产进化，优化攻击效率和成本**



当前互联网黑灰产攻击有两个特点：

**1、六成攻击场景以量取胜：**

随着互联网的发展，黑产形成了一些固定的攻击模式和套路，有大量的攻击场景依附于流量，通过伪装成正常业务，再通过不断重复获利。 



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


**2、重度依赖黑产基础资源：**

在黑产市场，像设备这样需求庞大而稳定的“资源”还有很多：IP、身份证、银行卡、支付账号、改机工具、自动化攻击软件、过滑动验证码、隐秘变现渠道等。也都逐渐形成了像接码平台一样的“服务型黑产协作平台”，这些平台越来越多，组合成了一张庞大的黑灰产基础资源网络。黑产攻击也严重依赖这些基础资源。 



下图我们列举了黑产需求及他们对应的解决方案：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


由于攻防逻辑和上游服务资源均趋于固定，黑产目前已经从攻防逻辑迭代的时代逐渐过渡到攻击效率和成本的优化迭代上。依旧以攻击设备为例，我们来一探其变化过程。

黑产在设备上解决批量攻击的方式有这么几种：

**1、箱控**

**优化点**：将通用类的攻击工具打包配套提供服务，降低了攻击的操作门槛

黑产在群控类的设备与服务商，均表现出将秒拨IP、改机工具等一些通用类型的功能进行打包集合的趋势（秒拨和改机工具之前的文章我们有详细讲过，[点击查看](http://mp.weixin.qq.com/s?__biz=MzI3NDY3NDUxNg==&mid=2247485082&idx=1&sn=59f321b906006f76a4a3eb86d0685464&chksm=eb1120a1dc66a9b7985eeeb118b50a897121f25aeda740de42951a8ffff0ef5a6d7475ed6b22&scene=21#wechat_redirect)）。



将VPN功能和改机功能、虚拟定位功能内置，并且提供了云端备份能力，黑产可以将一套攻击环境连同环境上登录的账号一并上传备份，通过还原快照的方式切换环境，从而进行大量攻击。箱控也提供了内存管理等能力，更好的满足了群控类设备的目标——降低运营成本，即可以用更少的人力操作更多的设备，攻击的效率和频次均得到了有效提升。

除了运营成本和攻击效率以外，这种打包的方式，也有效降低了黑产的操作和技术门槛，小白只需要保证配置正确即可，意味着黑产可以在对“技术要点”了解更少的情况下发起攻击，防守方将面临更多更杂的攻击人员。 



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)


**2、租赁模式——“云手机”**

**优化点**：租赁模式，自由“扩容”，降低了维护设备成本，且方便备份传输设备信息

“云手机”是一种攻击设备租用模式，操作者可以通过客户端或浏览器直接对远端的手机（或虚拟手机）进行操作，发起攻击。

云手机与“群控”类设备的趋势相同，越来越多的云手机将“一键新机”、虚拟定位和代理IP进行打包销售，这样的打包服务价格4元/天。加上手机号接码成本和网络成本，几十元到百元就可以拿到游戏的入场券。其成本远远低于传统实体手机的攻击方式。企业面临攻击人员更复杂广阔的现实问题。

黑产熟手还可以在需要时，利用云手机对自己的攻击设备群进行即时“扩容”，模式实在灵活。

原本受到盈利低于攻击成本或是设备数量限制，而无法进行攻击的场景，由于攻击效率的提升和灵活的租用模式，现在均可进行攻击，真实环境中，大部分工作室基本都是固定攻击某个行业的某些厂商，同时关注营销活动，在合适的时机，利用设备的空闲剩余价值，“捎带”一些副业进行盈利。 



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图：某云手机操作页面 


**3、中控**

**优化点**：解决了传统群控因数据线传输屏幕数据和指令数据造成的设备数量限制问题。

手机设备中安装客户端，用户在PC端客户端上统一管理手机并向其下发命令，由网络传输后手机客户端执行模拟点击完成攻击。


**4、云控**

**优化点**：设备无需在同一地点，脚本命令存储在云端，团伙间交易脚本时无需发送源码，方便了脚本传播和管理大量手机

一个广域网版本的“中控”，操作者通过任意浏览器对手机进行管理和下达命令。

**5、群控**

**优化点**：早期的批量操作设备解决方案，在脚本开发上限制较多，为避免卡顿，设备数量限制在百台左右。

采用屏幕映射的方式将手机屏幕映射到电脑，通过集线器将手机与电脑通过数据线连接，从而传出屏幕内容和操作指令。





3







**如何应对**



面对当今黑产这样产业化、专业化、团伙化和链条化的运作模式，攻防对抗将是企业与黑产双方不断厮杀成长的一场持久战，且敌暗我明，该如何应对？

**通过反欺诈情报（事前预防，事后根据攻击方法找到防护点）+欺诈数据标签（定位攻击流量）****的综合对抗。填补认知盲区，打平信息差，了解对方的目标、攻击思路和策略。**熟悉对方的作恶成本，了解对方发起攻击所需要的资源、时间、金钱成本、渠道门槛、对接的上下游以及通过攻击得到的营收等。在业务侧，综合审视自己的目标，对比双方资源、调整策略，定位到黑产的攻击账号、流量等，予以打击防护。

黑产以量取胜，但也因为如此，批量就一定有迹可循。


黑产有庞大的上游基础资源供应，但同时也非常依赖这些资源，这些是产业链的关键结点，也同时是我们识别、打击和防护的有效结点。

下图我们对黑产攻击方式给出了企业风控可以做的相应的对抗点的建议：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



- **反欺诈情报——业务安全攻防中的隐性力量**



从全产业链上下游视角出发的布控和收集的情报，可以作为风控策略的解释与支撑。同时欺诈情报如黑产舆情和趋势也能有效反馈企业风控策略的有效性，并帮助企业控制攻防成本。反欺诈情报一般包括：黑产准备攻击的接口、所涉及到的交易平台、攻击的目标接口、所利用的攻击工具、所涉及到的相关资源（手机号、IP）等。通过这些节点的布控，可以有效的在黑产资源准备时就及时发现风险，并了解黑产的攻击路径和逻辑，提前做好风控策略。



- **欺诈数据标签——高效落地的判别方案**



不管黑产的技术上、设备上如何迭代，他们发起攻击时总绕不过一些基础的欺诈资源的储备，例如注册用的手机号和访问的IP。据我们统计，全网每日黑产发起的恶意注册攻击达到800W次，每日活跃欺诈手机号150W以上，平均每个手机号每日进行6次攻击。如果从黑产角度对其使用的基础资源进行监控，识别出企业业务场景下的黑产欺诈资源，则可以针对这些黑灰产做恶的虚假账号进行直接的拦截或降权。从黑产基础资源识别的风控方式，能够一定程度上降低风控的误判率并提高可解释性。



------

**
**

**关于我们**



威胁猎人致力于基于对黑灰产的布控能力，提供互联网及金融行业提供反欺诈解决方案，为公安提供网络犯罪打击工具。反欺诈产品包括：反欺诈监测平台、手机号画像、IP画像、业务欺诈评估等；目前已与多家互联网TOP企业、政府、公安合作，例如：百度、腾讯、今日头条、快手、小米、虎扑、中国互联网应急响应中心等

## 海量数据下的舆情分析，该如何搭建？

宇珩 [阿里技术](javascript:void(0);) *7月12日*

![img](https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIJbz5BTJvsJfcnQ9tN3vyzanJ0FsxzMF9jgqtGsojn6xlhibU7icpmHygBA07ILZCDxvqgyHVzpklg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

阿里妹导读：互联网的飞速发展促进了很多新媒体的发展，不论是知名的大V，明星还是围观群众都可以通过手机在微博、朋友圈或者点评网站上发表动态，分享自己的所见所想，使得“人人都有了麦克风”。不论是热点新闻还是娱乐八卦，传播速度远超我们的想象，一则信息可以在短短数分钟内，有数万计转发，数百万的阅读。海量信息可以得到爆炸式的传播，那么如何实时把握信息并作出对应的处理呢？是不是真的难以应对？今天，阿里云智能事业群的宇珩来跟我们聊聊大数据舆情系统对数据存储和计算系统会有哪些需求，如何根据需求来进行系统设计。



工程师的世界，不止代码，还应有对未来的洞察与从容。**阿里首部技术经验精选集：《不止代码》，可免费下载阅读。**阿里多位P9、P10技术大牛现身说法，用十多年阅历和经验，陪你“打怪升级”。点击下方按钮，立刻下载！



[![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](https://mp.weixin.qq.com/s/X3RVXKi40uEO7ra8mX_C-w)



大数据时代下，除了媒体信息以外，商品在各类电商平台的订单量、用户的购买评论，都会对后续的消费者产生很大的影响。商家的产品设计者需要汇总统计和分析各类平台的数据做为依据，决定后续的产品发展，公司的公关和市场部门也需要根据舆情作出相应的及时处理，而这一切也意味着传统的舆情系统升级成为大数据舆情采集和分析系统。具体细化看下大数据舆情系统，对我们的数据存储和计算系统提出了以下需求：



- **海量原始数据的实时入库：**为了实现一整套舆情系统，需要有上游原始输出的采集，也就是爬虫系统。爬虫需要采集各类门户，自媒体的网页内容。在抓取前需要去重，抓取后还需要分析提取，例如进行子网页的抓取。

  

- **原始网页数据的处理：**不论是主流门户还是自媒体的网页信息，抓取后我们需要做一定的数据提取，把原始的网页内容转化为结构化数据，例如文章的标题，摘要等，如果是商品点评类消息也需要提取有效的点评。



- **结构化数据的舆情分析：**当各类原始输出变成结构化的数据后，我们需要有一个实时的计算产品把各类输出做合理的分类，进一步对分类后的内容进行情感打标。根据业务的需求这里可能会产生不同的输出，例如品牌当下是否有热点话题，舆情影响力分析，转播路径分析，参与用户统计和画像，舆论情感分析或者是否有重大预警。



- **舆情分析系统中间和结果数据的存储，交互分析查询：**从网页原始数据清洗到最终的舆情报表这中间会产生很多类型的数据。这些数据有的会提供给数据分析同学进行舆情分析系统的调优，有的数据会提供给业务部门根据舆情结果进行决策。这些查询可能会很灵活，需要我们的存储系统具备全文检索，多字段组合灵活的交互分析能力。



- **重大舆情事件的实时预警：**对于舆情的结果除了正常的搜索和展示需求以外，当有重大事件出现我们需要能做到实时的预警。



本文主要是提供**架构设计**，会先介绍时下主流的大数据计算架构，并分析一些优缺点，然后引入舆情大数据架构。



**系统设计**



**需求分析**



结合文章开头对舆情系统的描述，海量大数据舆情分析系统流程图大体如下：

![image.png](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图1 舆情系统业务流程



- 原始网页存储库，这个库需要能支持海量数据，低成本，低延时写入。网页数据写入后，要做实时结构化提取，提取出来的数据再进行降噪，分词，图片ocr处理等。对分词文本，图片进行情感识别产生舆情数据结果集。传统的离线全量计算很难满足舆情系统的时效性需求。



- 计算引擎在做数据处理时，可能还需要从存储库中获取一些元数据，例如用户信息，情感词元数据信息等。

  

- 除了实时的计算链路，对存量数据定期要做一些聚类，优化我们的情感词识别库，或者上游根据业务需要触发情感处理规则更新，根据新的情感打标库对存量数据做一次舆情计算。



- 舆情的结果数据集有不同类的使用需求。对于重大舆情，需要做实时的预警。完整的舆情结果数据展示层需要支持全文检索，灵活的属性字段组合查询。业务上可能根据属性字段中的置信度，舆情时间，或者关键词组合进行分析。



根据前面的介绍，舆情大数据分析系统需要两类计算，一类是实时计算，包括海量网页内容实时抽取，情感词分析并进行网页舆情结果存储。另一类是离线计算，系统需要对历史数据进行回溯，结合人工标注等方式优化情感词库，对一些实时计算的结果进行矫正等。所以在系统设计上，需要选择一套既可以做实时计算又能做批量离线计算的系统。在开源大数据解决方案中，Lambda架构恰好可以满足这些需求，下面我们来介绍下Lambda的架构。



**Lambda架构 （wiki）**



#### 

![image.png](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图2 Lambda架构图



Lambda架构可以说是Hadoop，Spark体系下最火的大数据架构。这套架构的最大优势就是在支持海量数据批量计算处理（也就是离线处理）同时也支持流式的实时处理（即热数据处理）。



具体是如何实现的呢，首先上游一般是一个队列服务例如kafka，实时存储数据的写入。kafka队列会有两个订阅者，一个是全量数据即图片中上半部分，全量数据会被存储在类似HDFS这样的存储介质上。当有离线计算任务到来，计算资源（例如Hadoop）会访问存储系统上的全量数据，进行全量批计算的处理逻辑。



经过map/reduce环节后全量的结果会被写入一个结构化的存储引擎例如Hbase中，提供给业务方查询。队列的另一个消费订阅方是流计算引擎，流计算引擎往往会实时的消费队列中的数据进行计算处理，例如Spark Streaming实时订阅Kafka的数据，流计算结果也会写入一个结构化数据引擎。批量计算和流计算的结果写入的结构化存储引擎即上图标注3的"Serving Layer"，这一层主要提供结果数据的展示和查询。



在这套架构中，批量计算的特点是需要支持处理海量的数据，并根据业务的需求，关联一些其他业务指标进行计算。批量计算的好处是计算逻辑可以根据业务需求灵活调整，同时计算结果可以反复重算，同样的计算逻辑多次计算结果不会改变。批量计算的缺点是计算周期相对较长，很难满足实时出结果的需求，所以随着大数据计算的演进，提出了实时计算的需求。



实时计算在Lambda架构中是通过实时数据流来实现，相比批处理，数据增量流的处理方式决定了数据往往是最近新产生的数据，也就是热数据。正因为热数据这一特点，流计算可以满足业务对计算的低延时需求，例如在舆情分析系统中，我们往往希望舆情信息可以在网页抓取下来后，分钟级别拿到计算结果，给业务方充足的时间进行舆情反馈。下面我们就来具体看一下，基于Lambda架构的思想如何实现一套完整的舆情大数据架构。



**开源舆情大数据方案**



通过这个流程图，让我们了解了整个舆情系统的建设过程中，需要经过不同的存储和计算系统。对数据的组织和查询有不同的需求。在业界基于开源的大数据系统并结合Lambda架构，整套系统可以设计如下：



![image.png](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图3 开源舆情架构图



\1. 系统的最上游是分布式的爬虫引擎，根据抓取任务抓取订阅的网页原文内容。爬虫会把抓取到的网页内容实时写入Kafka队列，进入Kafka队列的数据根据前面描述的计算需求，会实时流入流计算引擎（例如Spark或者Flink），也会持久化存储在Hbase，进行全量数据的存储。全量网页的存储可以满足网页爬取去重，批量离线计算的需求。



\2. 流计算会对原始网页进行结构化提取，将非结构化网页内容转化为结构数据并进行分词，例如提取出网页的标题、作者、摘要等，对正文和摘要内容进行分词。提取和分词结果会写回Hbase。结构化提取和分词后，流计算引擎会结合情感词库进行网页情感分析，判断是否有舆情产生。



\3. 流计算引擎分析的舆情结果存储Mysql或者Hbase数据库中，为了方便结果集的搜索查看，需要把数据同步到一个搜索引擎例如Elasticsearch，方便进行属性字段的组合查询。如果是重大的舆情时间，需要写入Kafka队列触发舆情报警。



\4. 全量的结构化数据会定期通过Spark系统进行离线计算，更新情感词库或者接受新的计算策略重新计算历史数据修正实时计算的结果。



**开源架构分析**



上面的舆情大数据架构，通过Kafka对接流计算，Hbase对接批计算来实现Lambda架构中的“batch view”和“real-time view”，整套架构还是比较清晰的，可以很好的满足在线和离线两类计算需求。但是把这一套系统应用在生产并不是一件容易的事情，主要有下面一些原因：



- 整套架构涉及到非常多的存储和计算系统包括：Kafka，Hbase，Spark，Flink，Elasticsearch。数据会在不同的存储和计算系统中流动，运维好整套架构中的每一个开源产品都是一个很大的挑战。任何一个产品或者是产品间的通道出现故障，对整个舆情分析结果的时效性都会产生影响。



- 为了实现批计算和流计算，原始的网页需要分别存储在Kafka和Hbase中，离线计算是消费hbase中的数据，流计算消费Kafka的数据，这样会带来存储资源的冗余，同时也导致需要维护两套计算逻辑，计算代码开发和维护成本也会上升。



- 舆情的计算结果存储在Mysql或者Hbase，为了丰富组合查询语句，需要把数据同步构建到Elasticsearch中。查询的时候可能需要组合Mysql和Elasticsearch的查询结果。这里没有跳过数据库，直接把结果数据写入Elasticsearch这类搜索系统，是因为搜索系统的数据实时写入能力和数据可靠性不如数据库，业界通常是把数据库和搜索系统整合，整合下的系统兼备了数据库和搜索系统的优势，但是两个引擎之间数据的同步和跨系统查询对运维和开发带来很多额外的成本。



**新的大数据架构Lambda plus**



通过前面的分析，相信大家都会有一个疑问，有没有简化的的大数据架构，在可以满足Lambda对计算需求的假设，又能减少存储计算以及模块的个数呢？



Linkedin的Jay Kreps提出了Kappa架构，关于Lambda和Kappa的对比可以参考文末的文献，这里不展开详细对比，简单说下，Kappa为了简化两份存储，取消了全量的数据存储库，通过在Kafka保留更长日志，当有回溯重新计算需求到来时，重新从队列的头部开始订阅数据，再一次用流的方式处理Kafka队列中保存的所有数据。这样设计的好处是解决了需要维护两份存储和两套计算逻辑的痛点，美中不足的地方是队列可以保留的历史数据毕竟有限，难以做到无时间限制的回溯。



分析到这里，我们沿着Kappa针对Lambda的改进思路，向前多思考一些：假如有一个存储引擎，既满足数据库可以高效的写入和随机查询，又能像队列服务，满足先进先出，是不是就可以把Lambda和Kappa架构揉合在一起，打造一个Lambda plus架构呢？



**新架构在Lambda的基础上可以提升以下几点：**



1. 在支持流计算和批计算的同时，让计算逻辑可以复用，实现“一套代码两类需求”。
2. 统一历史数据全量和在线实时增量数据的存储，实现“一份存储两类计算”。
3. 为了方便舆情结果查询需求，“batch view”和“real-time view”存储在既可以支持高吞吐的实时写入，也可以支持多字段组合搜索和全文检索。



总结起来就是整套新架构的核心是解决存储的问题，以及如何灵活的对接计算。我们希望整套方案是类似下面的架构：



![image.png](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

图4 Lambda Plus架构



1. 数据流实时写入一个分布式的数据库，借助于数据库查询能力，全量数据可以轻松的对接批量计算系统进行离线处理。
2. 数据库通过数据库日志接口，支持增量读取，实现对接流计算引擎进行实时计算。
3. 批计算和流计算的结果写回分布式数据库，分布式数据库提供丰富的查询语意，实现计算结果的交互式查询。



整套架构中，存储层面通过结合数据库主表数据和数据库日志来取代大数据架构中的队列服务，计算系统选取天然支持批和流的计算引擎例如Flink或者Spark。这样一来，我们既可以像Lambda进行无限制的历史数据回溯，又可以像Kappa架构一样一套逻辑，存储处理两类计算任务。这样的一套架构我们取名为“Lambda plus”，下面就详细展开如何在阿里云上打造这样的一套大数据架构。



**云上舆情系统架构**



在阿里云众多存储和计算产品中，贴合上述大数据架构的需求，我们选用两款产品来实现整套舆情大数据系统。存储层面使用阿里云自研的分布式多模型数据库Tablestore，计算层选用Blink来实现流批一体计算。



![image.png](https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naIxGkHedEfUUHicHUlusJgoOzYEmnaZ8JibCljrWYibXHVQP9XEY4mibAIHM7ibYWHzLrXSd783zzqreyw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

图5 云上舆情大数据架构



这套架构在存储层面，全部基于Tablestore，一个数据库解决不同存储需求，根据之前舆情系统的介绍，网页爬虫数据在系统流动中会有四个阶段分别是原始网页内容，网页结构化数据，分析规则元数据和舆情结果，舆情结果索引。



我们利用Tablestore宽行和schema free的特性，合并原始网页和网页结构化数据成一张网页数据。网页数据表和计算系统通过Tablestore新功能通道服务进行对接。通道服务基于数据库日志，数据的组织结构按照数据的写入顺序进行存储，正是这一特性，赋能数据库具备了队列流式消费能力。使得存储引擎既可以具备数据库的随机访问，也可以具备队列的按照写入顺序访问，这也就满足我们上面提到整合Lambda和kappa架构的需求。分析规则元数据表由分析规则，情感词库组层，对应实时计算中的维表。



计算系统这里选用阿里云实时流计算产品Blink，Blink是一款支持流计算和批计算一体的实时计算产品。并且类似Tablestore可以很容易的做到分布式水平扩展，让计算资源随着业务数据增长弹性扩容。使用Tablestore + Blink的优势有以下几点：



1. Tablestore已经深度和Blink进行整合，支持源表，维表和目的表，业务无需为数据流动开发代码。

   

2. 整套架构大幅降低组建个数，从开源产品的6～7个组建减少到2个，Tablestore和Blink都是全托管0运维的产品，并且都能做到很好的水平弹性，业务峰值扩展无压力，使得大数据架构的运维成本大幅降低。

   

3. 业务方只需要关注数据的处理部分逻辑，和Tablestore的交互逻辑都已经集成在Blink中。

   

4. 开源方案中，如果数据库源希望对接实时计算，还需要双写一个队列，让流计算引擎消费队列中的数据。我们的架构中数据库既作为数据表，又是队列通道可以实时增量数据消费。大大简化了架构的开发和使用成本。

   

5. 流批一体，在舆情系统中实时性是至关重要的，所以我们需要一个实时计算引擎，而Blink除了实时计算以外，也支持批处理Tablestore的数据， 在业务低峰期，往往也需要批量处理一些数据并作为反馈结果写回Tablestore，例如情感分析反馈等。那么一套架构既可以支持流处理又可以支持批处理是再好不过。一套架构带来的优势是，一套分析代码既可以做实时流计算又可以离线批处理。



![img](https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIJbz5BTJvsJfcnQ9tN3vyzMiaqiaOALyycf2cqrVIxl7giciccSJicVu0LoaQj0iaJLI94mKTZlcFKcmdg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



整个计算流程会产生实时的舆情计算结果。重大舆情事件的预警，通过Tablestore和函数计算触发器对接来实现。Tablestore和函数计算做了增量数据的无缝对接，通过结果表写入事件，可以轻松的通过函数计算触发短信或者邮件通知。完整的舆情分析结果和展示搜索利用了Tablestore的新功能多元索引，彻底解决了开源Hbase+Solr 多引擎的痛点：



1. 运维复杂，需要有运维hbase和solr两套系统的能力，同时还需要维护数据同步的链路。
2. Solr数据一致性不如Hbase，在Hbase和Solr数据语意并不是完全一致，加上Solr/Elasticsearch在数据一致性很难做到像数据库那么严格。在一些极端情况下会出现数据不一致的问题，开源方案也很难做到跨系统的一致性比对。
3. 查询接口需要维护两套API，需要同时使用Hbase client和Solr client，索引中没有的字段需要主动反查Hbase，易用性较差。



参考文献

Lambda大数据架构：

https://mapr.com/tech-briefs/stream-processing-mapr/

Kappa大数据架构：

https://www.oreilly.com/ideas/questioning-the-lambda-architecture

Lambda和Kappa架构对比：

https://www.ericsson.com/en/blog/2015/11/data-processing-architectures--lambda-and-kappa

# 网易严选风控实践（上）-打造现代化的风控体系

[![img](https://nos.netease.com/cloud-website-bucket/201806131910024d0d8682-fbbf-4f1a-95f0-09da7ac00c9a.jpg)达芬奇密码](https://sq.163yun.com/user/165240397716357120)2018-08-02 10:55

最近一段时间，公司许多产品的风控团队跟我们做了很多技术上的交流，大家对严选的风控体系很有兴趣。因此，我们打算在KS平台上给同学们介绍下这一年来严选风控体系的建立过程，抛砖引玉，期待引来大家的建议。



严选的风控体系最近半年的变化非常巨大。初期我们只是做了简单的下单频率控制，能满足部分业务场景，但是随着严选的迅速发展，灰产用户引发的资损情况变得越来越严峻。



 ![img](https://nos.netease.com/cloud-website-bucket/2018080210522030b52b6b-f078-4b4e-ad07-c13f0aa2f009.png)







图1 灰产用户卖严选券



 



到了今年7月份的时候我们开始腾出手来设计严选的风控体系。我们先后与美团，支付宝，阿里巴巴，京东等风控团队做了大量的技术交流，结合我们的情况确立了严选风控体系的建设目标：



\1.   **主动**。立足于大数据，利用算法模型主动发现异常特征，提前识别。



\2.   **快速**。严选大量的核心业务会同步依赖风控接口，因此我们认为风控接口的latency超过**100ms**，就没什么价值。核心风控接口(下单控制等)延迟的及格线应该是50ms。才能尽量降低对业务的影响。



\3.   **灵敏**。用户的异常行为需要能实时反馈。当用户出现异常行为时（比如用户鼠标以匀速的状态在移动），所有风控模型都需要立刻重新评估他的信誉情况。并在毫秒级时间完成重新评估，从而保证能立刻拦截他之后可能的违规行为。



\4.   **灵活。**风控与业务逻辑，运营策略等联系非常紧密。风控的策略需要能够做到随时变更，随时生效，与严选业务共同呼吸。



我们的目标是构建符合以上设计目标的现代化风控体系。

## 严选的风控体系架构



我们把严选的风控体系建设分成4个部分：**团队建设，构建以数据为核心的风险识别与分析系统，高性能的异常行为拦截系统，黑科技。**在这个体系中，风控的策略，模型，规则，拦截等是高举高打的正规作战方式；而黑科技则是剑走偏锋，谋奇效的方法。

![img](https://nos.netease.com/cloud-website-bucket/2018080210523134e4a475-7497-4c71-a844-cb0c9022e350.png)







图2 严选风控体系



 



上图是严选风控体系的一个简单示意图，围绕着风险控制的各个阶段，我们把工作简单划分成了3部分：风险识别，异常拦截，业务支持。风控系统架构是整个建设工作中最为简单，直白的一部分，最为关键和复杂的工作是把架构落地，产生价值。由于文字表达能力和篇幅的限制，我就不具体展开说明我们把上述架构落地的详细过程了。我们稍微介绍下我们系统是如何来实现风控：**主动，快速，灵敏，灵活**这4个设计目标的。





**业务目标指导团队建设**。为了完成以上4个设计目标，我们组建了包括模型研发，数据分析，系统研发，风控业务等角色的6人组小规模战斗团队，团队中大部分同学一人兼多角色，确保大家能充分理解各个模块的功能，减少角色之间的沟通，理解成本，提升战斗力和工作效率。







![img](https://nos.netease.com/cloud-website-bucket/20180802105249e9fd8700-f3f1-49c7-b08d-492f7d5f528a.png)~~~~



图3 严选风控两级防护模型--护城河+城墙



 



在开始之前，我先简单说明一下我们的风控模型之间的相互关系——我们把它们具像为护城河+城墙的防护关系。用户在过护城河的时候要被检查一下基础信誉，如有异常则会被拒绝入内，当用户尝试使用可能引发严选资损的业务时，还需要再次确认下是否有足够的信誉来进入对应的城门。如不满足，也会被拒绝在外。



**主动 & 灵敏**



风控业务本质上是基于大数据的一个数据产品。我们要实现**主动和灵敏**这两个设计目标，就需要把数据作为风控体系的核心，把思考点落在如何来玩好这些数据。幸福的是，我们底层的基础设施已经非常完备。严选的离线数据计算系统和实时数据计算系统(ATOM)等基础设施在今年9月份构建完毕。





怎么做到对风险的主动和灵敏？我觉得第一个重要的是要明确，我们系统要对什么风险主动，要对什么风险灵敏？对于严选业务而言，我认为是：资产损失。严选风控定义的资产损失包括两个部分：**公司资产损失**和**用户资产损失**。严选风控的首要目标是保护这两者，减少他们的损失。



攻与防是风控的基调。我们听到了很多攻防双方见招拆招的例子，包括我们自己也积累了大量的这种例子。但我认为见招拆招其实是一种很被动的情况，防守一方一旦疲于应付，就会面临道高一尺，魔高一丈的局面。



我们的策略是避免沉迷在各种攻防细节中，主动构建安全的城墙和护城河。我们对每一个严选用户，他们使用的设备，使用的手机号，IP等建立了信誉度模型。模型为会每一个用户单独打分，评估他们的信誉情况，这套基础的信誉评估体系就是严选业务的护城河。当用户需要使用严选时，他首先需要走过这条护城河上的桥，通过的凭证就是他的信誉。



当用户走过护城河时，他面临的是一道城墙。严选风控系统为每个业务在城墙上单独开了一扇门，每扇门都会有单独的算法模型来评估用户的情况。当然，用户对护城河与城墙的存在正常情况下是不感知的，只有当他被拦截在外时才会发现：咦，你们怎么知道我要来干坏事？





我们通过护城河与城墙来构建用户与严选业务系统之间的安全距离。模型研发的同学大部分时候的工作都是在加固这两道防线。 



我们的模型系统在7月份发布了第一版，按T+1的时效更新。由于模型依赖的交易数据，访问数据等都是T+1生成的，从而导致模型本身的时效不足，对用户异常行为的反应不够灵敏。这是一个致命的问题，严选负责实时计算的团队在今年8月份开展了严选DataHub项目。目标是把严选的核心数据源：MySQL，DDB，MongoDB，日志等所有数据实时化，在次之前，我们的实时计算平台只能把日志部分的数据实时化，而MySQL，DDB，MongoDB等产生的数据只能T+1通过sqoop导入到猛犸的方式来获取。





**日志。**我们简单的利用了flume+kafka的收集方案，通过严选DataHub数据交换服务可以方便的把严选产生的日志数据实时的接入实时计算平台。



**MySQL & DDB。**严选DataHub服务将自己伪装为MySQL数据库的镜像库（我们修改了开源服务canal来实现这个特性），利用MySQL主从同步协议，实时的获取了MySQL的binlog。同时通过一定的规则，将每张数据库表的实时变更消息以毫秒级的延迟映射到实时通道。完成这个项目后，我们风控依赖的关键数据库数据就足够灵敏了。



**MongoDB。**严选DataHub研发了MongoDB的OPLog实时获取，分析，解析与入HIVE库的服务。确保MongoDB产生的业务数据也能在严选实时平台上以毫秒级的延迟被访问到。



严选DataHub项目完成后，风控模型系统开始重构，完成了基于实时数据的模型，确保了整个风控系统的灵敏度。只要用户产生了异常行为，他的护城河通行证，城墙通行证上的信誉度都会在毫秒级内完成重新评估。在他干坏事之间就拦截他。 



**快速**



风控系统对业务要做到有效支撑，非常关键的是系统的整体性能。我们的目标是关键业务的风控接口需要在50ms内完成，时效容忍度较高的业务需要在200ms内完成。我们知道风控系统决定是否拦截某个用户行为（比如下单），会有大量的规则需要计算，部分还可能有同步的模型计算，要完成这样的目标挑战不小。



我们的设计思路很简单，**计算提前**。严选的风控系统在用户一开始访问严选时，就在监控与计算他的行为，我们称为全链路监控与全链路计算。



用户每行动一步，实时平台上的风控任务就会开始调整他护城河的通行证以及所有业务的通行证的信誉值，并执行相应的规则引擎来判定他是否可以通过。也就是说，用户刚到严选门口浏览时，护城河门口与各个城墙门口都已经算好了他是否可以通过，并且这个通过的决策是时刻根据他的具体行为实时在调整的。比如，用户一开始用在淘宝买了一个全新的帐号，然后用了一个灰产专用虚拟机登录了下，当他尝试使用免单券去下单前，在下单业务的城墙门口已经张贴了一条告示：用户XXX违规使用异常的CPU架构，禁止使用免单券。城墙门口的守卫只需要根据他的名字去查下告示就行，O(1)的时间复杂度，可以确保查询足够快，不会导致城墙门口堆积了要办事的人群。



提前计算，全链路监控是确保整套风控系统对外接口高性能的关键。



**灵活**



严选风控面对的是频繁变化的业务场景，风控系统要有足够的能力应对这种变化，做到与严选共同呼吸。



因此，我们从架构上把风险识别与拦截做了拆分，风险的识别相对稳定，而风险的拦截规则是会频繁变更的。所以提高系统灵活性的关键是提高严选风控规则引擎的灵活性。我们采用了可视化的方式来编辑风险拦截的规则，可以确保风控的规则管理人员能在10分钟内完成拦截规则的变更。



一般公司会采用Drools规则引擎来描述和执行风控规则，Drools虽然使用方便，但表达能力和灵活度都比较差，因此我们采用了相对不一样的方式来描述风控规则。严选采用**Groovy脚本语言**和**Drools规则系统**相结合的方式来作为严选的规则引擎。



Groovy脚本语言提供了非常强大的表达能力。ATOM实时计算平台提供了对这两个规则引擎的支持。 

## 收尾 & 预告



在这里，我们主要给大家介绍了严选风控体系建设的概要情况以及我们的一些设计思想。我们还准备了另外两篇分享，分别是：



**严选风控实践（中）-剑走偏锋，我们的搏击技法**，



**严选风控实践（下）-一些值得探讨的问题**。

# 网易严选风控实践（中）-剑走偏锋，我们的搏击技法

[![img](https://nos.netease.com/cloud-website-bucket/201806131910024d0d8682-fbbf-4f1a-95f0-09da7ac00c9a.jpg)达芬奇密码](https://sq.163yun.com/user/165240397716357120)2018-08-02 11:34

网易严选风控团队成立了一个风控基础设施虚拟项目组，项目组的主要工作是构建一些能给风控业务带来巨大帮助的工具链，帮忙我们更精准的识别用户的异常。目前基础设施项目落地的服务主要包括了：严选APP可信ID服务，严选浏览器ID服务，严选虚拟机识别服务，IP反查服务，Nginx Canal Module；正在研发中的服务包括TMD-安全Nginx集群，用户页面行为跟踪等。在这篇分享中我简单为大家介绍其中几个小而有趣的项目



### 客户端技术



**虚拟机识别服务**



风控的一个重要议题就是人机识别，虚拟机是人机识别的一个重要指标；同时由于虚拟机的关键设备特征不持续（设备号，imei，mac地址等），也常常被灰产用户用于破解各种基于设备信息的识别模型。因此，准确的识别虚拟机对于风控系统而言非常关键。



严选风控的设备虚拟机识别包括两部分：**APP端收集核心指标，服务端做出决策**。



我们先说服务端决策。有些虚拟机的识别需要一些比较持续的指标，常见的比如非充电状态下的用电量，手机抖动频率等，往往需要根据6个小时，或者12个小时以上的数据才能做出准确的决策。因此虚拟机识别服务端有一个单独的模型运行在实时计算平台上。



当然其实，我们有更加简单直接的办法。严选APP开发同学研究发现ARM架构的CPU与普通虚拟机依赖的CPU对一些关键内存区域，以及一些机器指令的执行权限控制上有着比较明显的差异。这些CPU架构上的差异是很好的虚拟机特征。我们测试了市面上主流的各种模拟器和50多种安卓真机，识别正确率为100%，误判率为0%。



​                 ![img](https://nos.netease.com/cloud-website-bucket/201808021133118919a301-02f6-41a1-bb45-cf76d7834314.png)

​                                     ![img](https://nos.netease.com/cloud-website-bucket/2018080211331909ffc815-698d-4ca4-8ffd-ccb7f16c1c09.png)









​                                         图1 感谢ARM同志



 



**可信ID服务**



用户的设备，特别是安卓设备，它的基础信息，比如mac地址，imei，序列号，蓝牙mac等等都可以通过接口层hook的方式来修改，从而导致依赖这些基础信息生成的设备序列号变的不可靠。灰产使用只要使用对应的工具对这些基础信息进行修改，那么他的设备就能在严选变成一个全新的设备，从而躲避各种风控的模型检测。因此，需要有一个唯一可信的ID来标识一个唯一的设备。有一些第三方公司，比如数盟等在出售可信ID服务。严选APP研发团队与风控团队一起对可信ID做了调研，觉得这个服务的研发成本比较低，技术门槛不高，需要投入的人力很少，因此决定自己研发。



跟虚拟机识别服务的做法类似，可信ID的识别依然是**app收集核心数据，服务端生成可信ID**。这么处理的优势比较明显：



\1.   当识别算法出现误判时，能及时调整；而不需要app发布版本。



\2.   当出现新的特征时，能及时加强算法，适应新的情况，而不需要app发布版本。



可信ID可以使用在很多不同的风控场景，除了常见的新用户下单，优惠券领取，积分获取等场景；还可以用于识别渠道刷量欺诈等情况。



### 浏览器技术



可信ID服务和虚拟机识别服务上线后，灰产们都比较郁闷，总不能不停的买新设备来刷严选吧——这样成本太高了。所以他们转战了战场，他们的异常行为集中在了iOS的某些版本（容易越狱），集中在了WAP页面和PC页面，这种没有唯一ID标识的场景。我们的数据监控也证实了这一点。这都我们来说是好事，坏人的特征越集中，越容易被我们掌控。



我们也把战场延续到了没有唯一ID环境的浏览器中。浏览器没有唯一特征，用户只要清空Cookie，买一个新帐号，买一个新手机号，我们风控就很难发现原因他是一个我们熟识的坏人了。



我们的做法也很简单，为浏览器分配一个唯一ID。这个ID可以不必跟浏览器具体的指纹（比如插件列表，系统信息等等）绑定，它只需要确保唯一就行。我们工作的重点是怎么想办法把这个服务器生成的唯一ID在浏览器端存储下来。狡兔三窟，浏览器有很多办法让我们把ID默默的存储下来，比如Cookie，比如LocalStorage，再比如，浏览器会对浏览过的一些图片做个缓存等等。相关细节就不详述了。



当然，所有的策略都是可以被破解的，构建永不被破的防线也不是我们风控系统的工作目标，我们的核心目标是提高他们的作恶成本。让他们知难而退。



有黑客在一些羊毛群里提供破解严选风控，代替下单的服务。这个服务的价格从5毛一单，到1块一单，再到2块一单，到2.5快一单，成本不断的在提高，甚至部分黑客已经不提供这种服务了，因为他每接一单不光没得赚，还可能引起亏损——一旦风控系统认为他的行为特别恶劣，对应帐号里的高价值券可能会被冻结。其实这也是风控的成果所在。



有一些论文从其他方向提供了解决浏览器没有唯一ID的办法：为每一个用户构建单独的行为模型，无论是灰产，还是正常用户，还是机器人，他的行为特征都是比较明确的，明确到可以使用一个单独的模型来描述。我们可以根据这个模型来标识唯一性。当然这个计算成本比较高，风控的模型研发同学也在做一些这方面的尝试。



### 业务护城河



这里提到的护城河跟前文提到的护城河-城墙模型是两个不同的概念。严选风控在跟灰产斗争的过程中，每次赢得胜利，都会引来黑客疯狂的报复——接口层面的攻击。在双十一大促期间，黑客的报复到了丧心病狂的地步：一天有上亿次尝试下单行为。因此，严选风控系统与严选主站研发团队需要共同构建业务层面的护城河，来面对这种报复行为。



我们的严选业务防护体系架构上也很简单：入口Nginx分流，保护业务tomcat；业务层tomcat频控，保护后端基础服务。



#### Canal & Safe Nginx Cluster



Canal是一个风控研发团队提供的Nginx模块，部署在入口Nginx服务中，针对用户的一些特征，比如IP，Username等，对特定的接口做频控，正常情况下，用户的访问能通过Canal的频控审查，直接转发到业务tomcat进行处理。当请求被标识**为可疑时**，Canal模块会将其ProxyPass到一个Safe Nginx Cluster. 这个风控的Nginx集群会对用户请求做更细致的审查，确认有问题时会直接拒绝这个请求，通过审查后，继续按原有流程转发到业务层tomcat。目标是尽量提前丢弃明确有问题的请求，尽量降低tomcat层的无差别频控，避免遭受攻击时，影响正常用户使用严选。当请求流转到业务tomcat时，依然会按原先的风控流程，重新做审核。





[网易严选风控实践（上）-打造现代化的风控体系](https://sq.163yun.com/blog/article/183304443737464832)

[网易严选风控实践（中）-剑走偏锋，我们的搏击技法](https://sq.163yun.com/blog/article/183314121689489408)

[网易严选风控实践（下）-思考与探讨](https://sq.163yun.com/blog/article/183314611296591872)



\~~~~

# 网易严选风控实践（下）-思考与探讨

[![img](https://nos.netease.com/cloud-website-bucket/201806131910024d0d8682-fbbf-4f1a-95f0-09da7ac00c9a.jpg)达芬奇密码](https://sq.163yun.com/user/165240397716357120)2018-08-02 11:36

经过大半年的风控实践，我们基本想明白了要怎么搭建风控系统，怎么构建防线，怎么主动出击。这个过程中，我们沉淀了很多经验，也留下了很多困惑，这些经验与困惑指引着严选风控下一步工作的方向，我趁此机会整理下这些零散的思考点，跟大家一起探讨。



### People or Machine？



这是我们在组建风控团队的时候考虑的问题，我们需要构建一个什么样的团队，团队的工作主要是什么？针对这个问题，不同的公司，不同的产品有不同的回答。有的公司会安排大量的风控业务审核人员冲在最前线（专家系统），他们依赖审核人员的经验和直觉来解决问题；而有的公司只有很少或者几乎没有这样的人工审核职位存在。不同的业务目标和组织文化会有不同的团队组成，这两者之间并没有优劣之分。



在严选，风控团队是一个精练的技术团队，我们把团队主要工作定位在依赖数据分析与算法，构建防线，研发新型武器，躲在实验室里跟敌人作战；我们并不希望组建一个大型军队，有大量士兵去人肉冲锋陷阵。对严选的情况而言，这两者的人力成本和维护复杂度都不在一个层面。



人思考问题，让机器处理问题。



### One Model Fits All？



严选风控模型一开始考虑的是构建一个统一的大模型(Universal Model), 包括了风控业务的方方面面，通过这个模型来回答所有有关用户行为风险的问题。有些公司，比如支付宝早期的策略也类似。One model fits all的方式有很多好处，比如维护的简单，回归方便，训练集构建方便，对外有统一的输出。但是渐渐的，我们发现这个模型的维护越来越复杂，当模型加入太多业务相关的特征时，特征间的正交性就越来越弱，不同业务之间的特征互相影响，从而导致模型的可靠性越来越差，牵一发而动全身。我们开始觉得这是一条不长久的路。我们重新设计了模型的结构，采用前文提到的类似护城河-城门方案。统一模型就是护城河，核心关注用户的核心指标，然后将场景相关的模型抽离出来，构建防护城墙。



### Model or Rule？



风控在什么情况下使用规则，什么情况下使用AI模型？传统的风控方式经常使用**专家判断+规则系统**来实现风控系统。这种方式有许多的优点，比如**可解释系强，简单直观，能快速响应业务变化，动态更新**等。但缺陷也非常明显，规则很容易有漏洞，很容易被灰产攻破；换个角度说就是规则的效果很容易衰减。时间一长，系统不得不维护大量的规则来应对现实情况，而各个规则依赖的参数因子，规则的效果，规则的优先级都会指数增长。这样的系统不具有可持续性。完全依赖规则的风控容易演变成需要依赖大量业务审核人员来人工处理风险的状态。



我们在这个问题上的策略是充分结合规则与AI模型的优势，这也是大数据风控常见的策略。严选利用AI模型来分析与识别风险，利用规则系统根据模型的计算结果来拦截风险。这样的方式充分利用了**规则系统贴近业务，快速灵活的优点**；同时又避免规则容易快速衰退，维护复杂度容易指数级增长的缺陷。



### Next ?



关于接下来的工作，目前我们在考虑几个方面：1. 风控的策略管理 2. 算法模型的优化，如何更快的自动化发现新的异常行为特征？3. 风控除了拦截风险行为，还能做什么？



\1.   今年严选风控系统主要关注的核心还是模型与规则。接下来我们需要更多的关注策略的层面规划。重新审视我们的风控业务，将其划分业务事前的风控策略，事中的风控策略，以及事后的风控策略。以更清晰直接的思路来切入业务。



\2.   模型的下一步优化？局部化的风控模型主要依赖的是决策树算法，比如随机森林等，简单，快速，疗效好，但是局限性也比较明显。下一步模型研发的工作需要把关注点放的更远一些，需要能够回答以下几个问题：



a)   如何在挖掘出即将产生破坏的用户组合，这些即将干坏事的用户与正常用户在产生下单等行为之前，算法是否能够将其划分为两个关联性不大的子网络？2016年有一些会议论文有比较详细的讨论这个问题，京东等公司也在这方面做了比较多的工作，并且有比较好的成果。



b)   尝试使用非监督的方式？



c)   是否能使用全链路监控，从用户行为时序的角度，使用神经网络算法来识别异常行为？这部分我们已经在做研发。



\3.   风控除了拦截风险行为，还能做什么？这部分我们思考的不是很多，思路也不是特别清晰，尚未体系化。目前，我们在做的是利用风控模型的信誉评分机制作为CRM分发不同类型优惠券的参考，以求达到更好的运营效果；利用风控信誉评分模型来优化用户在严选上的使用体验——比如做为急速退换货的参考，尽量避免让好的用户使用语音验证码，上行短信等这种体验伤害比较大又效果一般的验证方法。等等。





[网易严选风控实践（上）-打造现代化的风控体系](https://sq.163yun.com/blog/article/183304443737464832)

[网易严选风控实践（中）-剑走偏锋，我们的搏击技法](https://sq.163yun.com/blog/article/183314121689489408)

[网易严选风控实践（下）-思考与探讨](https://sq.163yun.com/blog/article/183314611296591872)



\~~~~

网易云新用户大礼包：[https://www.163yun.com/gift](https://www.163yun.com/gift?tag=M_sq_)

本文来自网易实践者社区，经作者陈炬授权发布。

# 对于移动端 App，虚拟机注册或类似作弊行为有何应对良策？

关注者

**749**

被浏览

**31,435**

关注问题写回答

邀请回答

3 条评论

分享



[查看全部 20 个回答](https://www.zhihu.com/question/33537532)

[![梁川](https://pic4.zhimg.com/b99e588a6ad7a6abaeed34057525c7e5_xs.jpg)](https://www.zhihu.com/people/chuanliang)

[梁川](https://www.zhihu.com/people/chuanliang)

[互联网金融](https://www.zhihu.com/people/chuanliang/creations/19586987) 话题的优秀回答者



编辑推荐

130 人赞同了该回答

这是典型的反欺诈问题，在金融/互联网金融、搜索引擎广告、电信、电商等领域都是反欺诈/风控的重点关注点。对于虚拟机的反欺诈，核心的思路还是：知道怎样攻，方能知道怎样防。一般采用虚拟机进行反欺诈，主要还是针对某款APP进行攻击，以获取利益，例如模拟爬虫爬APP数据、给APP用户推送广告（微信的摇一摇、批量导入通讯录加好友，然后群发广告消息等等）、手游的练级过关等等。**1、APP攻击大致策略**
对APP进行攻击的一般思路包括反编译APP代码、破解APP通讯协议、安装虚拟机自动化模拟：a、首先看能否反编译APP代码（例如Android APP），如果能够反编译，从代码层面理清APP业务逻辑（例如新用户注册），则直接在攻击软件中模拟此部分逻辑，相对于破解通讯协议及安装虚拟机自动化模拟而言，此种攻击方法是所有攻击者最优的选择方案。
反欺诈手段：代码混淆、核心算法加密（例如微信 android app）等。b、如果无法反编译代码，则攻击者一般会选择通过对网络通讯协议抓包，破解通讯协议。
反欺诈手段：保证通讯协议的安全，例如采用SSL、防止中间人攻击（MITM）、报文签名、动态token等。c、如果反编译代码及破解通讯协议都不管用情况下，一般才会采用安装bluestacks或android/iOS虚拟机安装APP进行攻击的方式。当然以上策略很多情况下是综合使用的。**2、虚拟机反欺诈策略
**对于虚拟机反欺诈核心的策略在于：获取能够标识用户身份特征的信息（数字指纹），然后对用户身份的真实性采用综合策略进行鉴定。一般采用虚拟机进行攻击的手段**：
1）、采用ADSL、3G/4G、Proxy、VPN或IP池端等方式获取动态IP，规避对IP地址的反欺诈限制**
反欺诈手段：IP黑名单、Proxy 检测、GeoIP等等**2）、伪造IMEI、GUID/UUID、MAC地址等硬件设备信息
**反欺诈手段：没什么好的手段，只能通过建立用户数字指纹库、黑名单库**，**结合访问规则、行为特征等其他策略进行防护。**3）、篡改虚拟机特征信息（例如user-agent、ROOT/越狱），伪装为真实系统**
反欺诈手段：只能尽量多研究各种虚拟机的特征信息，对这些特征信息进行检测，抓住攻击者疏漏的信息。
例如陌陌曾经对安装的bluestacks上的陌陌进行提示：你当前的设备存在安全隐患而无法登录，建议使用正规手机或Pad来使用陌陌，或提示为盗版等。
其原理在于：检测是否存在/data/Bluestacks.prop 文件，如果存在，则可以判定为bluestacks 虚拟机。**4）、篡改GPS位置等动态信息，例如针对微信、陌陌的mock gps等软件
**反欺诈手段：只能采用GPS模拟检测、用户访问规则、行为特征等综合策略进行防护。**

5）、对虚拟机进行ROOT或越狱，配合WIFI、DNS/MAC攻击等攻击手段，对服务器端漏洞进行攻击
**典型例子是iOS上的IAP支付欺诈问题，使用IAP Tracker和IAP Free这样的越狱插件伪造交易凭证。**
[iOS游戏使用苹果的IAP支付，客户端回调服务器之后，服务器收到之后如何做校验？ - 梁川的回答](http://www.zhihu.com/question/35252481/answer/62049852)

6）、页面安全攻击**
对采用webview的页面进行XSS、SQL注入等攻击，尤其是结合虚拟机及自动化软件（例如篡改user-agent）
反欺诈手段：与虚拟机关系不大，本质上是服务器端的安全问题。**7）、本地安全攻击**
对虚拟机进行ROOT或越狱，然后获取对APP本地存储数据的读写权限，篡改数据或盗取数据。
反欺诈手段：数据加密存储；敏感数据别存放在本地。**5）、采用按键精灵/sikuli/触摸精灵等自动化工具 +虚拟机方式进行批量注册、自动化登录、模拟人工自动化操作**
这是采用模拟器反欺诈最核心的问题。反欺诈手段：
**a、高大上的生物探针技术（类似支付宝 APP）：**
采用所谓的生物探针技术，识别用户独一无二的操作行为。
原理：正如签名笔迹一样，每个人的行为习惯都是独一无二的，如屏幕敲击频率、点击位置偏好等。通过机器学习，为每一个用户建立多维度的行为模型，称之为用户画像。将用户当前操作与模型进行匹配，可以准确地识别出风险及异常。**b、黑名单库
**这里的黑名单库本质上是综合性策略，包括用户黑名单、邮件地址黑名单、手机号黑名单、IP黑名单、代理服务器黑名单、数字指纹黑名单、身份证黑名单、银行卡黑名单、区域黑名单（例如某个区域是作弊、骗取贷款高发地区）等等。**c、基于用户身份特征信息验证
**例如手机号绑定+短信验证码、同一手机号只能注册绑定一个用户、同一用户同时在线数限制、在不同手机使用登录重新登陆策略等等。**

d、在业务流程中，保证用户体验的前提下，增加一些互动元素，切断自动化操作
**一个典型例子是，微信打飞机流行时候，用户首次安装登录微信时候，会出现打飞机的主界面，且跳过按钮不固定，要在虚拟机自动化注册、登录就极为麻烦。**

e、基于用户访问规则、行为特征反欺诈**
用户访问规则的例子：用户通过IP地址黑名单访问；用户通过代理服务器访问；两个用户通过同样的浏览器ID访问（钓鱼）；用户短时间内通过两个地理上非常远的地方登录；用户从不同的IP地址，通过一个会话进行两个或两个以上的操作（中间人攻击）
用户行为特征的例子：用户在一个不常见的地址做特殊的操作、用户在一个不常见的地址做异常的操作、在短时间内很多用户做相同的操作、用户的行为与已有的欺诈类似。**f、反欺诈引擎/风控引擎**
基于APP及业务积累的各种大数据，采用机器学习算法，建立反欺诈引擎/风控引擎，综合以上手段，对各种欺诈事件进行综合性防护。反欺诈方案其实并无优劣之分，与公司业务类型（例如手游、支付、广告等）、发展阶段、业务规模、研发能力等等密切相关。因此结合自己公司当前现实情况，在用户体验与反欺诈间取得一个平衡点至关重要。反欺诈不是（也不可能）要完全规避掉风险，只能是提高作弊者的作弊成本及作弊门槛，降低公司的运营成本及风险损失。所谓“道高一尺魔高一丈”，反欺诈手段一般都延迟于欺诈攻击者，反欺诈手段也必须根据欺诈手段与时俱进甚至提前防范，长期的持续运营积累对反欺诈及风控极为重要。在产品设计及运营层面学习借鉴业内优秀产品的反欺诈方案不失为一种快捷提升能力的一种手段，像微信 app，在反欺诈上就有诸多值得学习的地方。
以前的一些回答，虽然与虚拟机欺诈关系不大，仅供参考
[第三方支付公司风控系统都有哪些？ - 梁川的回答](http://www.zhihu.com/question/29222904/answer/56086446)
[支付类app，支付功能的测试思路有哪些？ - 梁川的回答](http://www.zhihu.com/question/26615672/answer/51772106)

[编辑于 2015-09-24](https://www.zhihu.com/question/33537532/answer/64966375)

赞同 1308 条评论

分享

收藏感谢收起

#### 更多回答

[![aviat](https://pic3.zhimg.com/3c2ccc0ac_xs.jpg)](https://www.zhihu.com/people/aviat)

[aviat](https://www.zhihu.com/people/aviat)

淫欲、暴食、贪婪、怠惰、暴怒、嫉妒、傲慢

22 人赞同了该回答

看了一下，上面的回答，其实已经综合了很多手段，这里总结一下：
1、技术手段，什么唯一码，防伪码，人机对应，短信注册……里面的讨论也有很多对抗方案，比如虚拟机可以伪造而攻破任何的anti策略；
2、运营手段，尽可能少的减少产生恶意动机的行为这里再补充一些，还是顺着以前我简单说的反恶意的核心原则来的：
1、尽可能高的抬高恶意作恶的成本；
2、找到恶意产业链条的薄弱环节；
3、多策略联动，避免大而全
4、只能遏制不能停止那么可以再延伸思考这个问题，一个是注册、一个是使用？
1、恶意注册的化，就思考恶意注册是用来干什么？注册前、和注册后，是否有环节可以太高成本？毕竟没有几个平台值得恶意大户盯住，屯号晒号放几年的……只要是来用的，那么就有迹可寻...
2、恶意注册后立刻使用，那么正常的注册用户立即的使用行为是什么？间隔多久会进行写操作，写操作前是否随机访问什么内容？这里频率间隔就可以用来进行判断。3、恶意注册后，恶意使用，那么即使这次登录到作恶即使装的很像正常用户，但是如果挖掘其注册后的行为来说，肯定也和普通用户有很大差异....你增加上一些历史指标来参考，比如
1、登录方面：月日均登录天、登录时间点的规律性、GPS地点的范围性、IP的规律性
2、读：读的规律性，访问内容与其自身是否具备关联性？比如附近的人应该固定在一定范围，不可能经常进行跳变……如果是UGC类的，读的内容应该是最近发生的，不可能都是挖坟阅读……
3、写：写操作的规律性，写的内容风格、敏感字检查、……这里可监测的很多这些任何一个提取与正常用户差异显著的阀值（95%）作为审计的指标，然后提供可扩展指标的打击策略，几个策略就降低了误伤真实用户的概率了，就能慢慢把对方成本抬升上去了，其实误伤不要担心的，如果真是你的潜在用户，在误伤的时候给一条活路或话语安慰，该是你的用户还是你的用户……这里损失不会大过恶意造成的整体伤害的。但是上述都做了，人工检测来看还是存在恶意，要么就是你平台的用户本身都是恶意，所以阀值失效，要么就是你对手方已经化无形于你期望的用户行为了。

[发布于 2015-09-23](https://www.zhihu.com/question/33537532/answer/64880839)

赞同 222 条评论

分享

收藏感谢

[![网易云](https://pic2.zhimg.com/v2-3fc19732b50ceaa07c9adf5fe78cfd1a_xs.jpg)](https://www.zhihu.com/org/wang-yi-yun-54-1)

[网易云](https://www.zhihu.com/org/wang-yi-yun-54-1)

已认证的官方帐号

8 人赞同了该回答

在说如何应对之前，我们先来谈一谈对于移动端APP可能遇到哪些作弊风险。1. 渠道商刷量，伪造大量的下载量和装机量，但没有新用户注册；2. 对于电商、P2P、外卖等平台，会面临散户或者团队刷子的注册->领券（参加活动）->利用平台规则获利或变现；3. 对于UGC社区或带有UGC属性的其他类型社区，会面临各种垃圾注册后在社区内发大量广告用于引流的风险。
应对作弊的方案针对风险不同会略有不同。**1. 对于刷量作弊**反作弊核心在于是否存在使用模拟器安装APP，反复安装APP情况，收集数据提取相关证明即可。**2. 对于电商等平台作弊**对于该类型的作弊，需要有三种途径分别解决：a) 【技术层面】检测是否模拟器，检测设备是否处于可以被篡改机器特征（尝试破解设备指纹）的环境中，检测网络特征是否位于同一网络环境下。b) 【业务层面】需要在注册、登陆、重点被刷的活动分别布防，以设备指纹为基础，检测是否有存在类似于设备注册/登录多账号类的高频特征，对账号进行打标，在后续的关键节点中再对账号进行处理，尽量避免和刷手进行面对面的攻防对抗。c) 【活动层面】分析历史作弊数据，优化活动奖励。对于作弊的流量，采用堵不如疏的策略，与其强硬的一刀切，不如提升攻击成本，减少获利。**3. 对于UGC社区**与电商平台类似，UGC社区同样需要技术层面和业务层面的检测，另外为对抗大量的人工和手工刷手，需对文本内容进行反垃圾。
相关阅读：[如何判断一个注册帐号是不是Spam 帐号，比如机器注册的？](https://www.zhihu.com/question/22687507/answer/402792264)利益相关**：网易云安全（易盾）**提供的**反垃圾**服务，20年专业的反垃圾经验，为客户提供极速智能的广告过滤、智能鉴黄、暴恐识别、涉政检测云服务，助力打造互联网纯净内容生态。**[点击可免费试用](https://link.zhihu.com/?target=https%3A//www.163yun.com/product/antispam%3Ftag%3DM_zhihu_33537532)**

[编辑于 2018-07-19](https://www.zhihu.com/question/33537532/answer/446262723)

# 第三方支付公司风控系统都有哪些？

云风控与本地风控的各自优势？

关注者

**409**

被浏览

**27,333**

关注问题写回答

邀请回答

1 条评论

分享



[查看全部 8 个回答](https://www.zhihu.com/question/29222904)

[![梁川](https://pic4.zhimg.com/b99e588a6ad7a6abaeed34057525c7e5_xs.jpg)](https://www.zhihu.com/people/chuanliang)

[梁川](https://www.zhihu.com/people/chuanliang)

[互联网金融](https://www.zhihu.com/people/chuanliang/creations/19586987) 话题的优秀回答者



编辑推荐

106 人赞同了该回答

风控系统与所在行业、区域（国家）、业务模式、业务数据量积累、生产运营经验等都有密切关系，指望直接采购一套现成的软件系统或使用在线风控（云风控）来解决所有风险控制问题基本不靠谱。**个人认为评价一套成熟风控系统的一些标准：**
**1、在特定行业/领域长期的运营经验积累**
只有经历过较为长期生产运营过程，才能够真正洞察一个行业的业务风险关键点，才能积累特定行业或领域的历史数据供系统挖掘和持续优化，也才可能总结出针对特定行业行之有效的风控规则及风控模式。**2、在特定行业/领域相对成熟的风控规则、风控模式最佳实践经验**
纯粹只有一套系统，即便架构极为NB，但如果没有针对特定行业或领域的风控规则积累及对应的风控模式的最佳实践经验，那正如人光有骨架但缺少肌肉和精神。例如国外FICO、Experian、CyberSource之类的风控系统肯定很牛，但直接放到中国市场来使用，也会水土不服，很难马上发挥作用。3、与之配套的风控体系、运营模式（方法论）4、系统架构具有扩展性**风控系统本质上要解决两大类问题：**
**1、交易主体**
核心问题：
交易主体身份识别：IP地址是否为黑名单IP、代理服务器、设备指纹获取、客户端是否为虚拟机、手机操作系统是否ROOT/越狱、信用卡是否为盗卡、用户是否为实名等等。
交易主体信用：例如P2P中借款人的信用评分、征信系统的信用评级等。**2、交易本身的风险****回到题主的问题：**
**关于云风控：**
目前云风控大致有如下几类：
**1、依托特定行业/领域长期历史数据积累提供的服务：**
像外卡收单的Retail Decisions(ReD)针对盗卡之类的服务、Maxmind提供的针对GeoIP的IP黑名单库、IP代理服务器检测等服务。
当然也包括诸如国政通、公安部身份证认证系统之类依靠垄断提供的服务。**2、针对特定领域提供风控服务：**
目前云风控都刚起步，指望大而全的服务基本上都不靠谱。
参考以上成熟风控的评价标准可以看出：目前市面上诸多云风控厂商在特定行业的历史数据积累和运营经验没有、业务风控规则的积累也没有，单纯有一套忽悠人用的方法论及所谓的NB系统。
只不过市面上一些公司的服务在特定领域还是有价值（当然这些公司都希望转型为提供大而全风控服务的厂商），像一些公司提供信用评级算法服务、基于设备指纹识别的反欺诈服务等。**3、征信服务**
除了央行的征信系统、蚂蚁金服的征信系统外，个人认为短期内鼓吹征信服务或提供全面风控体系解决方案的都是耍流氓。**关于自建风控系统：**
整体而言，个人倾向于：
1、在特定领域使用专业厂商的风控服务，例如盗卡、IP库、设备指纹识别等
2、在风控系统IT规划上，学习借鉴成熟厂商的系统架构、方法论
3、在风控系统建设上，采用开源解决方案+自主研发的方式
个人推荐方案：规则引擎（Drools）+ CEP（Drools Fusion、Esper或Spark）+机器学习算法（scikit-learn）

[发布于 2015-07-23](https://www.zhihu.com/question/29222904/answer/56086446)

赞同 1066 条评论

分享

收藏感谢收起

#### 更多回答

[![岂安科技](https://pic2.zhimg.com/v2-f1b7ad9fe2b72f04f5ad22eab778c50d_xs.jpg)](https://www.zhihu.com/org/qi-an-ke-ji)

[岂安科技](https://www.zhihu.com/org/qi-an-ke-ji)

线上行为分析解决方案专家

16 人赞同了该回答

这个问题我邀请了我们岂安科技CTO陆文进行回答。从他的角度对一些风险相关的概念进行通俗化的阐述，希望能讲明我们想要针对的问题是什么，技术的角度看需要去做什么，为什么要这么做。
**以下，GO~**
弹指间，创业已有两年，累与成果并存，痛并快乐着，自不用多提，应该是这一行从业者的普遍感受了。现在每每反思以往，总结不足，其中一条就是技术团队过于封闭，闷着头干活，发声不足，既不利于引入别人的好的经验，也没法将自身的成果拿出去接受批判，这其实与我们的技术宗旨是不符合的，还是需要挤出时间往外看，向外喊。
**什么是风险**笔者学术时代的老板是作可信计算的，当年的课题便是信任与风险，所以恰巧也算是国内较早在计算机领域对风险一块有所涉猎的人之一，当时最头痛的是，虽然很多人在这些方向都有相关的学术工作，但是对“信任”和”风险“这两个模糊的概念，从来就没有清晰公认的定义，大家都是自说自话，概念上都是迁就自己的工作，对信任和风险都有着自己的见解，以至于光综述里总结的定义就有上百种。现在工业界也出现了类似的情况，电商已经烧了好些年头，互联网金融最近也大火，征信风控的字眼更是随处可见，几番交道打下来，大家基本上还是在风险之上谈风险，很少对其本身去作过多的定义和阐述，具体手段也限于传统金融业经验往线上的照搬，或者是具体漏洞的补缺，有些像手里拿着把箭在扫射。我依然执拗以为，一定要先说清楚自己面对的问题是什么，才能更加的明白自己在做什么，做起事来才能有的放矢，不至于陷入被动的攻防战。 废话一箩筐，直接给出我个人比较认可的通俗定义，来方便阐述本文后续的概念：
**风险 = probability + outcome**
这是我看到的一种比较全面的解释。很多人认为风险是带来损失的概率，也有很多人觉得风险就是最终带来的损失。就好像很多人认为坐汽车风险高（因为车祸几率高），另一部分人觉得飞机更危险（基本就是挂了），大家的侧重点不同。而作为风险相关的从业者，个人认为两者都需要考虑，所以和很多人一样，直接做了加法，既包含可能性，也包含潜在的损失。
**什么是风控**风险本身只是人对客观事实的一个评估，重要的是如何去计算它，之后又如何去用来帮我们实现利益的最大化，这里给一张简单抽象的图来描述所谓的风控逻辑上是一个什么样的流程：![img](https://pic3.zhimg.com/80/v2-cd5ba69bc3272ac329dd1396e272f54c_hd.jpg)

这里面对信任的定义是当年从哲学论文里面摘出来的，算是相对靠谱的定义：
**Trust = knowledge (weak) reduction**
简要的介绍：
1、所谓的信任，就是利用一切可以用的知识（通俗常称为证据，或者情报等），进行一定的归纳，这些知识包括：
一些常规的检查工作，主要是做一些身份识别，合规的工作。这种是最常见的。社交信息，主要是一些关联信息，可以通过交易、ip、手机号能找到一批其他个体的信息，可以有效的帮助判断。历史行为，被评估者的历史行为有着极为重要的作用。上下文，当前交易/活动的具体特征，对当下的判断非常重要。其他信息。
事实上，要做信任判断还需要很多其他额外的知识。只是越多越准确，那么所谓的uncertainty就越小，后续的决策才会越准确。 现在一般传统的就是作一些合规操作，时髦一点的就是在历史行为和社交信息这一块大做文章，来弥补传统方式信息量的不足，还可以标榜“大数据”，我们岂安科技也属于后者。
2、所谓的风险决策。就是利用收集的信任信息，对所有可能的结果做一个损失（损失是基本客观存在的）和概率（主要靠信任信息来推断）的判断，最终形成一个风险轮廓，来方便决策3、后续的就好办了，有了具体的风险轮廓，根据企业的风险承受能力和商业模式作指引，就可以做出相应的决策了。一般而言，如果需要降低风险，需要采取措施去降低风险，或者是损失。以现在流行的p2p举例，要么是让借贷人提供更多的材料去证明他违约的概率比较小；要么是平台会收取一定比例的担保费用，来减少违约带来的损失。
**现在的风控系统是啥样的**对风控的描述比较空泛，只是给出逻辑概念。目前大多数的企业和机构应该都是这么干的，只是有的干得比较好，有的干的更好而已：
成熟度。大型、新型的企业会有一整套风控框架，里面相关的人数量和角色也多，比较成熟；小公司往往投入不足，做法也山寨。量化能力。小一点的企业往往只能作到定性分析，就事论事，最后主要靠拍脑袋。牛一点的可以做到定量分析，这样能有个科学的定义和计算模型，才能脑袋拍得轻些。持久性。小一点的企业往往只做当前的case；大一点的公司整个流程是持续迭代的，而且是正反馈的，这样它整个风控模型就能不断修正和完善。
至于如何去做一套完善的风控系统，这个领域已经有大量的投入和专家，可以去参考借鉴。我个人的资历比较有限，只能提供两个参考：
如果想从流程上去改善，如果你对类似CMM这样的成熟度模型感兴趣，不放参考Octave(Operationally Critical Threat, Asset, and Vulnerability Evaluation)，这同样是CMU的SEI推出的，目的是提出缓解企业信息安全风险的方法论，它本身不是一套计算机系统，但在流程、理念、逻辑结构、方法论上能有比较好的启发。如果想建一套完善的计算模型，可以参考paypal的架构。paypal应该是互联网内风控玩的最早最成熟的公司，笔者也有幸成为其国内的第一批开发，学习到很多。这个公司的商业模式就是建立在风控上，所以投入也大，虽然就技术上而言非常保守，但其整体框架绝对值得一提：![img](https://pic1.zhimg.com/80/v2-681a7d28c176f173dbd9fb2f5ac1e1f0_hd.jpg)
上图是我以前画过的我印象中P公司是如何处理risk的（依然是简单概念图）：
最大的投入是通过运营作人工分析，一方面可以更细致更准确的去处理各种高风险交易；另一方面在于找到了很多新的攻击，人工标注产生了很多样本，这点是最关键的。大量的分析师通过数据仓库去做模型、做规则。最早的时候还没有hadoop，他们靠商业的teradata来作这件事，算是先驱了。大部分模型、规则也简单，顶多是logistic regression，胜在数据量大，以及庞大的ops团队支撑。相当数量的开发人员，去开发模型需要的数据，从数据库里面计算出来，形成统一的变量接口，然后线上的系统就是在不停的跑了。整个过程是循环的，在线系统标注的高危交易会被继续人工分析，然后成为新一轮的素材来实现整套风控系统的不断演化和改进（Ocatave也是提出了类似这种迭代的模型）。开发、ops、分析师三个角色明确分工，有机结合在一起。这是目前国内大部分公司是很缺乏的。
整套系统里面每一块都比较保守，有各自固有的问题，但胜在整个框架很好。体制的优势决定了其依然是现存的最成功的风控系统，岂安科技的两大系统（warden和redq）也都是受此影响很多。
然而，以上只是描述了一个有钱公司的成熟系统是啥样的，现实世界中，只有极少数公司能做到这个程度。很多公司（尤其是中小型互联网公司）是这样干的：
![img](https://pic3.zhimg.com/80/v2-12cc3de1627d87d8929d459d49cd7beb_hd.jpg)

系统的脆弱点比较多，尤其是业务搬迁到互联网后，暴露点增多。各种漏洞（技术上的和业务上的）层出不穷，黑产业的日益发达也带来了更多的影响。资源较少。一些金融相关的可能还好，大部分公司对此投入不足，忙不过来。可利用的现成的技术少。风控通常是比较复杂和昂贵的，只有大公司用的起，小公司投入不起，往往就是穿个裤衩就要面对各种攻击了。
上述几点造成，大部分公司根本没能力去做详尽的数据收集和量化计算，也就很难有个成熟的风控模型或是系统去应对互联网上频繁出现的攻击，最终就变成了打地鼠模式：
每当恶意（带来损失）的事件发生，被动的去应对，而且只能作事后处理每次事件的处理只能作就事论事的防范。这次一锤子不能帮你打下一锤子量化能力上还是比较难对风险作定量分析，关注的指标只能是命中率（打中多少衰神加分）和误杀率（打中多少福神扣分）当带来风险的主体比较难区分，伪装的比较好的时候，这锤子就敲不下去了。比如现在一大危害羊毛党，很难和正常用户区分开来，造成无法防范当风险攻击来得异常频繁和快速，锤子也来不及敲。最近短信轰炸的攻击行为忽然冒起，没有健壮的风控系统保护，只能素手无策。
**这个就是我们感受到的骨感的现实。**

[编辑于 2017-08-10](https://www.zhihu.com/question/29222904/answer/210083132)

赞同 161 条评论

分享

收藏感谢收起

[![甜甜](https://pic1.zhimg.com/v2-6e40fa911f0bc085ecbbffd4b185242a_xs.jpg)](https://www.zhihu.com/people/feng-rui-tian-tian)

[甜甜](https://www.zhihu.com/people/feng-rui-tian-tian)

第一，支付机构风控系统旨在支持支付机构实现风控规则控制和管理功能，与支付系统紧密关联，本地化应更符合现行监管政策。　　根据现有关于支付机构业务设施技术的监管政策，支付机构的业务系统中风险控制的重点是关注账户风险和交易风险，账户风险包括支付账户用户实名和安全控制要求，交易风险包括交易金额限制、可疑交易如套现等。同时，要求支付系统具有事前、事中和事后处理机制，并根据业务实际情况确定是否需要人工参与。综此分析，支付机构的机房本地化，支付系统布置在本地，更能符合监管要求。　　第二，在金融监管逐步收紧，机构遵守监管要求的成本不断增加的情况下，利用云计算、大数据等新兴数字技术建立所谓“云风控”体系，值得研究。　　通过对海量的公开和私有数据进行自动化分析、风险建模、情景分析、实时监测、身份验证，不仅可帮助机构更准确地“了解客户”，也能够更有效地符合支付业务、反洗钱及反恐怖融资等监管政策，提高机构的合规效率。以客户身份识别为例。根据《反洗钱法》等要求，机构开展支付等金融业务需了解和登记的客户信息不仅包括有效身份证件信息，还包括一些隐私信息，如职业、单位、联系方式、交易信息（如交易目的、资金来源与去向）等等。有效身份证件信息易得，但其他隐私信息难得。这就导致在仅有本地风控、数据信息有限、交叉检查认证不具可行性等情况下，机构关于客户身份识别的有效性不足，欺诈欺骗风险存在，也导致机构普遍不符合监管要求。大数据背景下，客户信息的分析挖掘将使主妇做饭既有米（数据信息更全面）、又有巧手（技术手段），对可疑数据进行微观分析发现线索，宏观分析发现违法违规趋势，能使机构的风险防控工作更有的放矢、防患未然。　　第三，无论现行本地风控，还是未来云风控，防控的支付机构经营风险因素相同。　　主要包括，源自业务处理相关主体（比如付款方、银行、清算机构等）不能或未能按照约定履行义务引发的流动性风险，外包服务商玩忽职守、欺诈欺骗、管理不善或者能力不足等给支付机构带来的信用风险、声誉损失，市场竞争环境日趋紧张、机构自身经营策略执行不力、应对竞争不力等给支付机构带来的经营风险，支付机构业务系统或内部处理中的缺陷、人为错误、管理不善或者外部干扰等都可能造成系统宕机、服务中断、服务差错等运行风险。云计算、大数据等新兴技术在风险防控系统中的应用，不能让风险消失不见，但良性应用可助支付机构在风险识别发现环节更有效率。

# 支付类app，支付功能的测试思路有哪些？

如题，手头有一个支付app，要对支付功能着重测试。我该如何编写测试用例、大纲？ 测试过程中该侧重哪些方面？网络？安全性？响应速度？资金的进程跟踪？ 有什么…显示全部

关注者

**90**

被浏览

**18,317**

关注问题写回答

邀请回答

添加评论

分享



[查看全部 3 个回答](https://www.zhihu.com/question/26615672)

[![梁川](https://pic4.zhimg.com/b99e588a6ad7a6abaeed34057525c7e5_xs.jpg)](https://www.zhihu.com/people/chuanliang)

[梁川](https://www.zhihu.com/people/chuanliang)

[互联网金融](https://www.zhihu.com/people/chuanliang/creations/19586987) 话题的优秀回答者

22 人赞同了该回答

一些思路，供参考：
**1、基础服务相关：**
网络通信：WIFI/多运营商/多网络制式（2G、3G、4G）下的可靠性、稳定性、响应速度、流量大小
安全：本地安全（本地存储数据安全、混淆反编译、安全控件、安全键盘等）、通讯安全（DNS劫持、SSL、短信劫持等）、页面安全（采用webview的页面的XSS、SQL注入等）
反欺诈相关：设备指纹获取、虚拟机检测、是否ROOT/越狱等
通用服务：消息推送、缓存、升级
**2、应用服务相关：**
与第三方应用集成：第三方应用调用支付APP完成支付；支付APP调用其他APP或SDK（例如友盟）。
正常业务流程逻辑
应用安全：接口协议安全、账户安全、手机遗失掉/登陆密码遗忘/交易密码遗忘的安全处理
业务边界及异常处理：例如APP没收到支付结果，APP的处理
APP+服务器端结合的业务及数据正确性、完整性
风控相关**3、用户体验相关：**
终端适配
APP业务流程、UI界面的用户体验

[发布于 2015-06-18](https://www.zhihu.com/question/26615672/answer/51772106)

赞同 22添加评论

分享

收藏感谢

#### 更多回答

[![陈武贤](https://pic3.zhimg.com/6046c0cc81853b98a9a003b7b8bde00c_xs.jpg)](https://www.zhihu.com/people/chen-wu-xian)

[陈武贤](https://www.zhihu.com/people/chen-wu-xian)

公众号：测试有话说

4 人赞同了该回答

涉及到资金安全方面，我一般都是从接口层面介入验证，之前在个人公众号有介绍过其他接口设计上有安全隐患的查找方式，有兴趣可以前往了解： [接口这样设计，资金没了都不知道为啥。](https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzU2MTM2MjU1OQ%3D%3D%26mid%3D2247483653%26idx%3D1%26sn%3Dc4dd24b83415681be49090cd502ba7dd%26chksm%3Dfc78a215cb0f2b03db969b38dc54ea554d8cc6aa1ad46f3a2c4cc46eecde29fb2d263a78da7d%26scene%3D21%23wechat_redirect)接下来介绍下稍微使用高级一点的手段介绍下如何测试资金是否安全。1、欺骗充值充值指的是向应用程序充钱到自己的账号，欺骗充值指的就是欺骗应用程序说自己已经充值成功了，让自己的账号没有经过实际支付就增加余额。下面以小程序为例，来讲下怎么做到欺骗。首先，看下小程序支付交互的流程：
![img](https://pic1.zhimg.com/80/v2-896cba25522bce3760a0e74dbd6c6336_hd.jpg)↑↑小程序官方交互图↑↑从上图可以看出，支付状态是由微信后台通知商户系统后，再由商户系统更新状态的。根据官方推荐的做法一般不会出什么幺蛾子，但是有些初学者不按套路来，直接在小程序收到支付结果中的回调函数中调用后端接口进行更新状态（小程序回调没有上图中画出），这就留下了祸根了。我们可以尝试在发起支付接口后，不进行真实支付，通过模拟回调函数中调用的接口直接调用，看看订单的状态是否改变，如果真的改变了，余额新增了，那么恭喜你，找到一个大bug了。这种系统不是新手就是临时工开发的，毕竟这类bug现在已经少而又少，比较常见的案例是0.01元充100话费。2、超领红包什么是超领？正常的话，一个拼手气红包每个人只可以领取一次，超领就是一个拼手气红包被一个人领了多次。这类bug分为两种，下面来说说怎么找：第一种是比较低级的：用户能不能领取全由前端控制，后端不做校验，交互图如下：![img](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1080' height='920'></svg>)
从UI上看，找不出不出什么bug来，但是从接口上就很容易绕过，每次直接调用领取红包接口，就能实现不断的领取红包了。这么来说，是不是后端加上校验就行了？话是这么说，但是也要看是怎么个校验法，如果是单纯在领取结果前的查下数据库是否领取就算校验的话，那就要留个心眼了。交互如下：![img](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1080' height='796'></svg>)
现在开始介绍第二种稍微高级一丢丢的超领方法：那就是并发请求。同时发起10个甚至100个请求，领取同一个红包，所有并发请求同一时间到达数据库判断的时刻，判断结果都是没有领取过，这样有概率再一次实现超领了。（怎么发起并发就不用做过多介绍了吧？）这里，我推荐的是在数据库中的红包领取表中添加唯一约束，将红包id与领取人id设置为为唯一约束，这样插入领取信息的时候，数据库就会报错拉。当然我只是测试，没有实战过，有经验的开发者可以留言推荐更好的解决方法。3、超额提现&并发提现其实超额提现&并发提醒这两类bug是跟上面介绍的红包超领如出一辙的，只是场景不同而已。超额提现的问题是出在：只由前端限制可提现金额，后端没有做任何校验，导致调用提现接口就能直接超额提现。并发提现就是后端做了校验的前提下，通过并发同时调用提现接口100次，校验做的不好，公司的实际金额就这样被盗走了。关于异常提现，我建议的是追加两种方案来应对：加至少24小时的审核机制：这样就可以在审核期间检查是否有异常提现数据了。自动对账机制：通过人工来审核是不合理的事，系统应该是要每天自动检查出入账金额是否正确，有异常及时告警，避免造成资金损失。看到这，各位可以去试一试自家的产品是否有被并发超领的情况咯，场景不限于：领红包、抽奖、提现等。如果你有其他奇招，欢迎一起交流。[http://weixin.qq.com/r/qS-I0JzEP8FArdiz93q7](https://link.zhihu.com/?target=http%3A//weixin.qq.com/r/qS-I0JzEP8FArdiz93q7) (二维码自动识别)

展开阅读全文

赞同 4添加评论

分享

收藏感谢

![匿名用户](https://pic1.zhimg.com/aadd7b895_xs.jpg)

匿名用户

1 人赞同了该回答

不管是支付类App还是其他App，对于上面说的用户体验相关的测试，都是非常重要且不可忽视的,机型不足导致终端适配不全，App每次迭代的反复功能测试等等，都是很让人头疼的问题。交给第三方测试，不失为一个好办法，目前有几家做的比较好的第三方可以推荐给大家：[TestBird](https://link.zhihu.com/?target=https%3A//www.testbird.com/)：基于全球首创的对象识别技术，TestBird可以为客户提供深入到移动APP&游戏内部所有功能的深度解析能力。通过自助[App功能测试](https://link.zhihu.com/?target=https%3A//www.testbird.com/)、远程真机调试、真机[兼容性测试](https://link.zhihu.com/?target=https%3A//www.testbird.com/compatibility-test/)（终端适配）、真人体验测试、 真人压力测试和崩溃分析等产品，TestBird建立了云手机、云测试和云分析三大测试平台，为移动应用提供从研发到上线再到运营的一站式质量管理服务，帮助移动应用企业建立完善的质量管理体系和能力，全面提高移动应用的DAU、留存率以及付费情况。[百度](https://link.zhihu.com/?target=http%3A//mtc.baidu.com/)[MTC](https://link.zhihu.com/?target=http%3A//mtc.baidu.com/):百度移动云测试中心，支持Robotium脚本，提供兼容测试、性能测试、遍历测试、安全漏洞扫描。另外它也提供一个众测功能。[腾讯bita](https://link.zhihu.com/?target=http%3A//bita.qq.com/)：由腾讯推出的真机自动化测试服务，主要面向Android开发者。官方号称有1000+台设备供测试。能够进行测试应用的自动登录，并进行兼容测试、遍历测试、性能测试、功能测试、稳定性测试。[阿里MQC](https://link.zhihu.com/?target=http%3A//mqc.aliyun.com/)：全称为阿里移动质量中心，是阿里巴巴淘测试下的一个产品。支持Robotium框架编写的脚本对应用进行测试。它一个比较有特色的地方是支持HTML5的真机测试，开发者可提交一个URL，以检测页面在不同设备的上的渲染和性能问题。

## 基于 Apache Flink 和规则引擎的实时风控解决方案 

原创： 郭华（付空） [Ververica](javascript:void(0);) *10月10日*

对一个互联网产品来说，典型的风控场景包括：注册风控、登陆风控、交易风控、活动风控等，而风控的最佳效果是防患于未然，所以事前事中和事后三种实现方案中，又以事前预警和事中控制最好。



这要求风控系统一定要有实时性。本文就介绍一种实时风控解决方案。



**1.总体架构**



风控是业务场景的产物，风控系统直接服务于业务系统，与之相关的还有惩罚系统和分析系统，各系统关系与角色如下：



![img](https://mmbiz.qpic.cn/mmbiz_png/8AsYBicEePu5qTzK9oSphbPm2QbmEHdUBibTaL4lYicZBcxhibKYmPkzBSuANcRkbb1m0fvWL6vn2JTibQibzRtSdHcA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



业务系统，通常是 APP + 后台 或者 web，是互联网业务的载体，风险从业务系统触发；



- **风控系统**，为业务系统提供支持，根据业务系统传来的数据或埋点信息来判断当前用户或事件有无风险；
- **惩罚系统**，业务系统根据风控系统的结果来调用，对有风险的用户或事件进行控制或惩罚，比如增加验证码、限制登陆、禁止下单等等；
- **分析系统**，该系统用以支持风控系统，根据数据来衡量风控系统的表现，比如某策略拦截率突然降低，那可能意味着该策略已经失效，又比如活动商品被抢完的时间突然变短，这表明总体活动策略可能有问题等等，该系统也应支持运营/分析人员发现新策略；



其中风控系统和分析系统是本文讨论的重点，而为了方便讨论，我们假设业务场景如下：



- 电商业务；

- 风控范围包括：

- - 注册，虚假注册；
  - 登陆，盗号登陆；
  - 交易，盗刷客户余额；
  - 活动，优惠活动薅羊毛；

- 风控实现方案：事中风控，目标为拦截异常事件；

##  

**2.风控系统**



风控系统有规则和模型两种技术路线，规则的优点是简单直观、可解释性强、灵活，所以长期活跃在风控系统之中，但缺点是容易被攻破，一但被黑产猜中就会失效，于是在实际的风控系统中，往往需要再结合上基于模型的风控环节来增加健壮性。但限于篇幅，本文中我们只重点讨论一种基于规则的风控系统架构，当然如果有模型风控的诉求，该架构也完全支持。



规则就是针对事物的条件判断，我们针对注册、登陆、交易、活动分别假设几条规则，比如：



- 用户名与身份证姓名不一致；
- 某 IP 最近 1 小时注册账号数超过 10 个；
- 某账号最近 3 分钟登陆次数大于 5 次；
- 某账号群体最近 1 小时购买优惠商品超过 100 件；
- 某账号最近 3 分钟领券超过 3 张；



规则可以组合成规则组，为了简单起见，我们这里只讨论规则。



规则其实包括三个部分：



- **事实**，即被判断的主体和属性，如上面规则的账号及登陆次数、IP 和注册次数等；
- **条件**，判断的逻辑，如某事实的某属性大于某个指标；
- **指标阈值**，判断的依据，比如登陆次数的临界阈值，注册账号数的临界阈值等；



规则可由运营专家凭经验填写，也可由数据分析师根据历史数据发掘，但因为规则在与黑产的攻防之中会被猜中导致失效，所以无一例外都需要动态调整。



基于上边的讨论，我们设计一个风控系统方案如下：



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



该系统有三条数据流向：



- **实时风控数据流**，由红线标识，同步调用，为风控调用的核心链路；
- **准实时指标数据流**，由蓝线标识，异步写入，为实时风控部分准备指标数据；
- **准实时/离线分析数据流**，由绿线标识，异步写入，为风控系统的表现分析提供数据；



本节先介绍前两部分，分析系统在下一节介绍。



 

**2.1 实时风控**



实时风控是整个系统的核心，被业务系统同步调用，完成对应的风控判断。



前面提到规则往往由人编写并且需要动态调整，所以我们会把风控判断部分与规则管理部分拆开。规则管理后台为运营服务，由运营人员去进行相关操作：



- **场景管理**，决定某个场景是否实施风控，比如活动场景，在活动结束后可以关闭该场景；
- **黑白名单**，人工/程序找到系统的黑白名单，直接过滤；
- **规则管理**，管理规则，包括增删或修改，比如登陆新增 IP 地址判断，比如下单新增频率校验等；
- **阈值管理**，管理指标的阈值，比如规则为某 IP 最近 1 小时注册账号数不能超过 10 个，那 1 和 10 都属于阈值；



讲完管理后台，那规则判断部分的逻辑也就十分清晰了，分别包括前置过滤、事实数据准备、规则判断三个环节。



#### **2.1.1 前置过滤**



业务系统在特定事件（如注册、登陆、下单、参加活动等）被触发后同步调用风控系统，附带相关上下文，比如 IP 地址，事件标识等，规则判断部分会根据管理后台的配置决定是否进行判断，如果是，接着进行黑白名单过滤，都通过后进入下一个环节。



这部分逻辑非常简单。



#### **2.1.2 实时数据准备**



在进行判断之前，系统必须要准备一些事实数据，比如：



- 注册场景，假如规则为单一 IP 最近 1 小时注册账号数不超过 10 个，那系统需要根据 IP 地址去 Redis/Hbase 找到该 IP 最近 1 小时注册账号的数目，比如 15；
- 登陆场景，假如规则为单一账号最近 3 分钟登陆次数不超过 5 次，那系统需要根据账号去 Redis/Hbase 找到该账号最近 3 分钟登陆的次数，比如 8；



Redis/Hbase 的数据产出我们会在第 2.2 节准实时数据流中进行介绍。



#### **2.2.3 规则判断**



在得到事实数据之后，系统会根据规则和阈值进行判断，然后返回结果，整个过程便结束了。



整个过程逻辑上是清晰的，我们常说的规则引擎主要在这部分起作用，一般来说这个过程有两种实现方式：



- 借助成熟的规则引擎，比如 Drools，Drools 和 Java 环境结合的非常好，本身也非常完善，支持很多特性，不过使用比较繁琐，有较高门槛，可参考文章【1】；
- 基于 Groovy 等动态语言自己完成，这里不做赘述。可参考文章【2】；



这两种方案都支持规则的动态更新。





 **2.2 准实时数据流**



这部分属于后台逻辑，为风控系统服务，准备事实数据。



把数据准备与逻辑判断拆分，是出于系统的性能/可扩展性的角度考虑的。



前边提到，做规则判断需要事实的相关指标，比如最近一小时登陆次数，最近一小时注册账号数等等，这些指标通常有一段时间跨度，是某种状态或聚合，很难在实时风控过程中根据原始数据进行计算，因为风控的规则引擎往往是无状态的，不会记录前面的结果。



同时，这部分原始数据量很大，因为用户活动的原始数据都要传过来进行计算，所以这部分往往由一个流式大数据系统来完成。在这里我们选择 Flink，Flink 是当今流计算领域无可争议的 No.1，不管是性能还是功能，都能很好的完成这部分工作。



这部分数据流非常简单：



- 业务系统把埋点数据发送到 Kafka；
- Flink 订阅 Kafka，完成原子粒度的聚合；







**注：**Flink 仅完成原子粒度的聚合是和规则的动态变更逻辑相关的。举例来说，在注册场景中，运营同学会根据效果一会要判断某 IP 最近 1 小时的注册账号数，一会要判断最近 3 小时的注册账号数，一会又要判断最近 5 小时的注册账号数……也就是说这个最近 N 小时的 N 是动态调整的。那 Flink 在计算时只应该计算 1 小时的账号数，在判断过程中根据规则来读取最近 3 个 1 小时还是 5 个 1 小时，然后聚合后进行判断。因为在 Flink 的运行机制中，作业提交后会持续运行，如果调整逻辑需要停止作业，修改代码，然后重启，相当麻烦；同时因为 Flink 中间状态的问题，重启还面临着中间状态能否复用的问题。所以假如直接由 Flink 完成 N 小时的聚合的话，每次 N 的变动都需要重复上面的操作，有时还需要追数据，非常繁琐。



- 

- Flink 把汇总的指标结果写入 Redis 或 Hbase，供实时风控系统查询。两者问题都不大，根据场景选择即可。



通过把数据计算和逻辑判断拆分开来并引入 Flink，我们的风控系统可以应对极大的用户规模。



**3.分析系统**



前面的东西静态来看是一个完整的风控系统，但动态来看就有缺失了，这种缺失不体现在功能性上，而是体现在演进上。即如果从动态的角度来看一个风控系统的话，我们至少还需要两部分，一是衡量系统的整体效果，一是为系统提供规则/逻辑升级的依据。



在衡量整体效果方面，我们需要：



- 判断规则是否失效，比如拦截率的突然降低；
- 判断规则是否多余，比如某规则从来没拦截过任何事件；
- 判断规则是否有漏洞，比如在举办某个促销活动或发放代金券后，福利被领完了，但没有达到预期效果；



在为系统提供规则/逻辑升级依据方面，我们需要：



- **发现全局规则**，比如某人在电子产品的花费突然增长了 100 倍，单独来看是有问题的，但整体来看，可能很多人都出现了这个现象，原来是苹果发新品了……
- **识别某种行为的组合**，单次行为是正常的，但组合是异常的，比如用户买菜刀是正常的，买车票是正常的，买绳子也是正常的，去加油站加油也是正常的，但短时间内同时做这些事情就不是正常的。
- **群体识别**，比如通过图分析技术，发现某个群体，然后给给这个群体的所有账号都打上群体标签，防止出现那种每个账号表现都正常，但整个群体却在集中薅羊毛的情况。



这便是分析系统的角色定位，在他的工作中有部分是确定性的，也有部分是探索性的，为了完成这种工作，该系统需要尽可能多的数据支持，如：



- 业务系统的数据，业务的埋点数据，记录详细的用户、交易或活动数据；
- 风控拦截数据，风控系统的埋点数据，比如某个用户在具有某些特征的状态下因为某条规则而被拦截，这条拦截本身就是一个事件数据；



这是一个典型的大数据分析场景，架构也比较灵活，我仅仅给出一种建议的方式。



![img](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)



相对来说这个系统是最开放的，既有固定的指标分析，也可以使用机器学习/数据分析技术发现更多新的规则或模式，限于篇幅，这里就不详细展开了。



**4.参考资料**



1.从 Drools 规则引擎到风控反洗钱 

http://archive.keyllo.com/L-编程/drools-从Drools规则引擎到风控反洗钱系统v0.3.2.pdf

2.基于 Groovy 的规则脚本引擎实战

https://www.jianshu.com/p/d6f45f91bede

3.基于规则的风控系统

https://jinfei21.github.io/2018/09/29/基于规则的风控系统/

4.网易严选风控实践

https://sq.163yun.com/blog/article/183314611296591872

5.网易考拉规则引擎平台架构设计与实践

https://sq.163yun.com/blog/article/213006222321659904

6.一个开源 java 风控系统

https://github.com/sunpeak/riskcontrol

# 基于Groovy的规则脚本引擎实战

[![img](https://cdn2.jianshu.io/assets/default_avatar/11-4d7c6ca89f439111aff57b23be1c73ba.jpg)](https://www.jianshu.com/u/fa00113e0b13)

[lyowish](https://www.jianshu.com/u/fa00113e0b13)关注

12018.08.15 19:25:27字数 3,428阅读 1,302

# 前言

因为之前在项目中使用了Groovy对业务进行一些抽象，效果比较好，过程中也踩了一些坑，所以简单记录分享一下自己如何一步一步实现的，在这里你可以了解：
1、为什么选用groovy作为规则脚本引擎
2、了解Groovy的基本原理和Java如何集成
3、分析Groovy与java集成的一些问题和坑
4、在项目中使用时做了哪些性能优化
5、实际使用时需考虑的一些tips

# 规则脚本可解决的问题

互联网时代随着业务的飞速发展，迭代和产品接入的速度越来越快，需要一些灵活的配置。办法通常有如下几个方面：
1、最为传统的方式是java程序直接写死提供几个可调节的参数配置然后封装成为独立的业务模块组件，在增加参数或简单调整规则后，重新调上线。
2、使用开源方案，例如drools规则引擎，此类引擎适合业务较复杂的系统
3、使用动态脚本引擎：groovy，simpleEl，QLExpress
引入规则脚本对业务进行抽象可大大提升效率。
例如，笔者之前开发的贷款审核系统中，贷款的订单在收单后会经过多个流程的扭转：收单后需根据风控系统给出结果决定订单的流程，而不同的产品的订单的扭转规则是不一致的，每接入一个新产品，码农都要写一堆对于此产品的流程逻辑；现有的产品的规则也经常需要更换。所以想利用脚本引擎的动态解析执行，到使用规则脚本将流程的扭转抽象出来，提升效率。

# 如何选轮子

考虑到基于自身的业务的复杂性，传统的开源方案如Acitivities和drools，对于我的业务来说，过于重了。
再对于脚本引擎来说最常见的其实就是groovy了，ali有一些开源项目 ，对于不同的规则脚本，选型时需要考虑性能、稳定性、语法灵活性，综合考虑下选择Groovy有如下几点原因。
1、历史悠久、使用范围大，坑少
2、和java兼容性强：无缝衔接java代码，即使不懂groovy语法也没关系
3、语法糖
4、项目周期短，上线时间紧急😢

# 项目流程的抽象

因为不同业务在流程扭转时对于逻辑的处理是不一致的。我们先考虑一种简单的情况：
本身的项目在业务上会对不同的贷款订单进行流程扭转，例如订单可以从流程A扭到流程B或者流程C，取决于每一个Strategy Unit的执行情况（如下图）：每个Strategy Unit执行后会返回Boolean值。具体的逻辑可以自己定义，在这里我们假设：如果满足所有Strategy Unit A的的条件（即每个执行单元都返回true），那么订单就会扭转至Scenario B；如果满足所有Strategy Unit B的的条件，那么订单就会扭转至Scenario C。
为什么设计成多个StrategyLogicUnit呢？是因为我的项目中，为了方便配置，将整个流程的StrategyLogicUnit的配置展示在了UI上，可读性更强、修改时也只需要修改某一个unit中的执行逻辑。



![img](https://upload-images.jianshu.io/upload_images/13624174-d47b460649a157d1.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

1536844912066.jpg

每个StrategyLogicUnit执行时依赖的数据我们可以把它抽象为一个Context，context中包含两部分数据：一部分是业务上的数据：例如订单的产品，订单依赖的风控数据等，另一部分是规则执行数据：包括当前执行的node、所属的策略组信息、当前的流程、下一个流程等，这一部分规则引擎执行数据的context 可以根据不同的业务进行设计，设计时主要考虑断点重跑、策略组等：比如可以设计不同策略组与产品的关联，这一部分业务耦合性比较大，本文主要focus在groovy上。
可以把Context理解为StrategyLogicUnit的输入和输出，StrategyLogicUnit在Groovy中进行执行，我们可以对每一个执行的StrategyLogicUnit进行可配置化的展示和配置。执行过程中可以根据context中含有的不同的信息进行逻辑判断，也可以改变context对象中的值。

# 基于流程将Groovy与Java的集成

那么基于如上流程，我们如何结合Groovy和java呢？
基于上面的设计，Groovy脚本的执行本质上只是接受context对象，并且基于context对象中的关键信息进行逻辑判断，输出结果。而结果也保存在context中。
先看看Groovy与java集成的方式：

##### GroovyClassLoader

用 Groovy 的 GroovyClassLoader ，它会动态地加载一个脚本并执行它。GroovyClassLoader是一个Groovy定制的类装载器，负责解析加载Java类中用到的Groovy类。

##### GroovyShell

GroovyShell允许在Java类中（甚至Groovy类）求任意Groovy表达式的值。您可使用Binding对象输入参数给表达式，并最终通过GroovyShell返回Groovy表达式的计算结果。

##### GroovyScriptEngine

GroovyShell多用于推求对立的脚本或表达式，如果换成相互关联的多个脚本，使用GroovyScriptEngine会更好些。GroovyScriptEngine从您指定的位置（文件系统，URL，数据库，等等）加载Groovy脚本，并且随着脚本变化而重新加载它们。如同GroovyShell一样，GroovyScriptEngine也允许您传入参数值，并能返回脚本的值。

##### 以GroovyClassLoader为例

三种方式都可以实现，现在我们以GroovyClassLoader为例，展示一下如何实现与java的集成：

###### 例如：我们假设申请金额大于20000的订单进入流程B

在SpringBoot项目中maven中引入



```xml
<dependency>
            <groupId>org.codehaus.groovy</groupId>
            <artifactId>groovy-all</artifactId>
            <version>2.4.10</version>
</dependency>
```

定义Groovy执行的java接口：



```java
public interface EngineGroovyModuleRule {
    boolean run(Object context);
}
```

抽象出一个Groovy模板文件,放在resource下面以便加载：



```java
import com.groovyexample.groovy.*
class %s implements EngineGroovyModuleRule {
    boolean run(Object context){
        %s //业务执行逻辑：可配置化
    }
}
```

接下来主要是解析Groovy的模板文件，可以将模板文件缓存起来，解析我是通过spring的PathMatchingResourcePatternResolver进行的；下面的StrategyLogicUnit这个String就是具体的业务规则的逻辑，把这一部分的逻辑进行一个配置化。
例如：我们假设执行的逻辑是：申请订单的金额大于20000时，走流程A，代码简单实例如下：



```dart
        //解析Groovy模板文件
        ConcurrentHashMap<String,String> concurrentHashMap = new ConcurrentHashMap(128);
        final String path = "classpath*:*.groovy_template";
        PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        Arrays.stream(resolver.getResources(path))
                .parallel()
                .forEach(resource -> {
                    try {
                        String fileName = resource.getFilename();
                        InputStream input = resource.getInputStream();
                        InputStreamReader reader = new InputStreamReader(input);
                        BufferedReader br = new BufferedReader(reader);
                        StringBuilder template = new StringBuilder();
                        for (String line; (line = br.readLine()) != null; ) {
                            template.append(line).append("\n");
                        }
                        concurrentHashMap.put(fileName, template.toString());
                    } catch (Exception e) {
                        log.error("resolve file failed", e);
                    }
                });
        String scriptBuilder = concurrentHashMap.get("ScriptTemplate.groovy_template");
        String scriptClassName = "testGroovy";
        //这一部分String的获取逻辑进行可配置化
        String StrategyLogicUnit = "if(context.amount>=20000){\n" +
                "            context.nextScenario='A'\n" +
                "            return true\n" +
                "        }\n" +
                "        ";
        String fullScript = String.format(scriptBuilder, scriptClassName, StrategyLogicUnit);
```



```cpp
    GroovyClassLoader classLoader = new GroovyClassLoader();
    Class<EngineGroovyModuleRule> aClass = classLoader.parseClass(fullScript);
    Context context = new Context();
    context.setAmount(30000);
    try {
        EngineGroovyModuleRule engineGroovyModuleRule = aClass.newInstance();
        log.info("Groovy Script returns:{} "+engineGroovyModuleRule.run(context));
        log.info("Next Scenario is {}"+context.getNextScenario());
    }
    catch (Exception e){
       log.error("error...")
    }
```

执行上述代码：



```csharp
Groovy Script returns: true
Next Scenario is A
```

# 集成过程中的坑和性能优化

项目在测试时就发现随着收单的数量增加，进行频繁的Full GC，测试环境复现后查看日志显示：



```json
[Full GC (Metadata GC Threshold) [PSYoungGen: 64K->0K(43008K)] [ParOldGen: 3479K->3482K(87552K)] 3543K->3482K(130560K), [Metaspace: 15031K->15031K(1062912K)], 0.0093409 secs] [Times: user=0.03 sys=0.00, real=0.01 secs] 
```

日志中可以看出是mataspace空间不足，并且无法被full gc回收。
通过JVisualVM可以查看具体的情况：



![img](https://upload-images.jianshu.io/upload_images/13624174-ab70f668a3d26b7a.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

1537278779824.jpg



发现class太多了，有2326个，导致metaspace满了。我们先回顾一下metaspace

##### metaspace和permgen

这是jdk在1.8中才有的东西，并且1.8讲将permgen去除了，其中的方法区移到non-heap中的Metaspace。



![img](https://upload-images.jianshu.io/upload_images/13624174-929559fd3fd76b50.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

1537279213725.jpg



这个区域主要存放：存储类的信息、常量池、方法数据、方法代码等。
分析主要问题有两方面：

###### 问题1：Class数量问题：可能是引入groovy导致加载的类过多了，但实际上项目只配置了10个StrategyLogicUnit，不同的订单执行同一个StrategyLogicUnit时应该对应同一个class。class的数量过于异常。

###### 问题2：就算Class数量过多，Full GC为何没有办法回收？

下面我们带着问题来学习。

##### GroovyClassLoader的加载

我们先分析Groovy执行的过程，最关键的代码是如下几部分：



```cpp
 GroovyClassLoader classLoader = new GroovyClassLoader();
 Class<EngineGroovyModuleRule> aClass = classLoader.parseClass(fullScript);
 EngineGroovyModuleRule engineGroovyModuleRule = aClass.newInstance();
engineGroovyModuleRule.run(context)
```

GroovyClassLoader是一个定制的类装载器，在代码执行时动态加载groovy脚本为java对象。大家都知道classloader的双亲委派，我们先来分析一下这个GroovyClassloader，看看它的祖先分别是啥：



```kotlin
def cl = this.class.classLoader  
while (cl) {  
    println cl  
    cl = cl.parent  
}  
```

输出：



```ruby
groovy.lang.GroovyClassLoader$InnerLoader@13322f3  
groovy.lang.GroovyClassLoader@127c1db  
org.codehaus.groovy.tools.RootLoader@176db54  
sun.misc.Launcher$AppClassLoader@199d342  
sun.misc.Launcher$ExtClassLoader@6327fd  
```

从而得出：



```cpp
    Bootstrap ClassLoader  
             ↑  
sun.misc.Launcher.ExtClassLoader      // 即Extension ClassLoader  
             ↑  
sun.misc.Launcher.AppClassLoader      // 即System ClassLoader  
             ↑  
org.codehaus.groovy.tools.RootLoader  // 以下为User Custom ClassLoader  
             ↑  
groovy.lang.GroovyClassLoader  
             ↑  
groovy.lang.GroovyClassLoader.InnerLoader  
```

查看关键的GroovyClassLoader.parseClass方法，发现如下代码：



```cpp
    public Class parseClass(String text) throws CompilationFailedException {
        return parseClass(text, "script" + System.currentTimeMillis() +
                Math.abs(text.hashCode()) + ".groovy");
    }
```



```csharp
    protected ClassCollector createCollector(CompilationUnit unit, SourceUnit su) {
        InnerLoader loader = AccessController.doPrivileged(new PrivilegedAction<InnerLoader>() {
            public InnerLoader run() {
                return new InnerLoader(GroovyClassLoader.this);
            }
        });
        return new ClassCollector(loader, unit, su);
    }
```

这两处代码的意思是：
groovy每执行一次脚本，都会生成一个脚本的class对象，这个class对象的名字由 "script" + System.currentTimeMillis() +
Math.abs(text.hashCode()组成，对于问题1：每次订单执行同一个StrategyLogicUnit时，产生的class都不同，每次执行规则脚本都会产品一个新的class。

接着看问题2InnerLoader部分：
groovy每执行一次脚本都会new一个InnerLoader去加载这个对象，而对于问题2，我们可以推测：InnerLoader和脚本对象都无法在fullGC的时候被回收，因此运行一段时间后将PERM占满，一直触发fullGC。

###### 为什么需要有innerLoader呢？

结合双亲委派模型，由于一个ClassLoader对于同一个名字的类只能加载一次，如果都由GroovyClassLoader加载，那么当一个脚本里定义了C这个类之后，另外一个脚本再定义一个C类的话，GroovyClassLoader就无法加载了。

###### 由于当一个类的ClassLoader被GC之后，这个类才能被GC。

如果由GroovyClassLoader加载所有的类，那么只有当GroovyClassLoader被GC了，所有这些类才能被GC，而如果用InnerLoader的话，由于编译完源代码之后，已经没有对它的外部引用，除了它加载的类，所以只要它加载的类没有被引用之后，它以及它加载的类就都可以被GC了。

###### Class回收的条件（摘自《深入理解JVM虚拟机》）

JVM中的Class只有满足以下三个条件，才能被GC回收，也就是该Class被卸载（unload）：
1、该类所有的实例都已经被GC，也就是JVM中不存在该Class的任何实例。
2、加载该类的ClassLoader已经被GC。
3、该类的java.lang.Class 对象没有在任何地方被引用，如不能在任何地方通过反射访问该类的方法.
一个一个分析这三点：
第一点被排除：
查看GroovyClassLoader.parseClass()代码，总结：Groovy会把脚本编译为一个名为Scriptxx的类，这个脚本类运行时用反射生成一个实例并调用它的MAIN函数执行，这个动作只会被执行一次，在应用里面不会有其他地方引用该类或它生成的实例；
第二点被排除：
关于InnerLoader：Groovy专门在编译每个脚本时new一个InnerLoader就是为了解决GC的问题，所以InnerLoader应该是独立的，并且在应用中不会被引用；
只剩下第三种可能：
该类的Class对象有被引用，继续查看代码：



```java
    /**
     * sets an entry in the class cache.
     *
     * @param cls the class
     * @see #removeClassCacheEntry(String)
     * @see #getClassCacheEntry(String)
     * @see #clearCache()
     */
    protected void setClassCacheEntry(Class cls) {
        synchronized (classCache) {
            classCache.put(cls.getName(), cls);
        }
    }
```

可以复现问题并查看原因：具体思路是无限循环解析脚本，jmap -clsstat查看classloader的情况，并结合导出dump查看引用关系。
所以总结原因是：每次groovy parse脚本后，会缓存脚本的Class，下次解析该脚本时，会优先从缓存中读取。这个缓存的Map由GroovyClassLoader持有，key是脚本的类名，value是class，class对象的命名规则为：
"script" + System.currentTimeMillis() + Math.abs(text.hashCode()) + ".groovy"
因此，每次编译的对象名都不同，都会在缓存中添加一个class对象，导致class对象不可释放，随着次数的增加，编译的class对象将PERM区撑满。

###### 解决方案

大多数的情况下，Groovy都是编译后执行的，实际在本次的应用场景中，虽然是脚本是以参数传入，但其实大多数脚本的内容是相同的。解决方案就是在项目启动时通过InitializingBean接口对于 parseClass 后生成的 Class 对象进行缓存，key 为 groovyScript 脚本的md5值，并且在配置端修改配置后可进行缓存刷新。
这样做的好处有两点：
1、解决metaspace爆满的问题
2、因为不需要在运行时编译加载，所以可以加快脚本执行的速度

# 总结

Groovy适合在业务变化较多、较快的情况下进行一些可配置化的处理，它容易上手：其本质上也是运行在jvm的java代码，我们在使用时需了解清楚它的类加载机制，对于内存存储的基础烂熟于心，并通过缓存解决一些潜在的问题。适合规则数量相对较小的且不会频繁更新规则的规则引擎。
之后有机会会整理一些关键代码到GitHub。

# 网易考拉规则引擎平台架构设计与实践

[![img](https://nos.netease.com/cloud-website-bucket/20180613095716018eccd9-1496-46e6-a23c-7e6133f106f6.jpeg)勿忘初心](https://sq.163yun.com/user/142765323174236160)2018-10-23 10:00

此文已由作者肖凡授权网易云社区发布。

欢迎访问[网易云社区](https://sq.163yun.com/blog?tag=M_tg_487_73)，了解更多网易技术产品运营经验。

# 背景 

考拉安全部技术这块目前主要负责两块业务：一个是内审，主要是通过敏感日志管理平台搜集考拉所有后台系统的操作日志，数据导入到es后，结合storm进行实时计算，主要有行为查询、数据监控、事件追溯、风险大盘等功能；一个是业务风控，主要是下单、支付、优惠券、红包、签到等行为的风险控制，对抗的风险行为包括黄牛刷单、恶意占用库存、机器领券、撸羊毛等。这两块业务其实有一个共通点，就是有大量需要进行规则决策的场景，比如内审中需要进行实时监控，当同一个人在一天时间内的导出操作超过多少次后进行告警，当登录时不是常用地登录并且设备指纹不是该账号使用过的设备指纹时告警。而在业务风控中需要使用到规则决策的场景更多，由于涉及规则的保密性，这里就不展开了。总之，基于这个出发点，安全部决定开发出一个通用的规则引擎平台，来满足以上场景。



# 写在前面 

在给出整体架构前，想跟大家聊聊关于架构的一些想法。目前架构上的分层设计思想已经深入人心，大家都知道要分成controller,server,dao等，是因为我们刚接触到编码的时候，mvc的模型已经大行其道，早期的jsp里面包含大量业务代码逻辑的方式已经基本绝迹。但是这并不是一种面向对象的思考方式，而往往我们是以一种面向过程的思维去编程。举个简单例子，我们要实现一个网银账户之间转账的需求，往往会是下面这种实现方式：

1. 设计一个账户交易服务接口AccountingService，设计一个服务方法transfer()，并提供一个具体实现类AccountingServiceImpl，所有账户交易业务的业务逻辑都置于该服务类中。
2. 提供一个AccountInfo和一个Account，前者是一个用于与展示层交换账户数据的账户数据传输对象，后者是一个账户实体（相当于一个EntityBean），这两个对象都是普通的JavaBean，具有相关属性和简单的get/set方法。
3. 然后在transfer方法中，首先获取A账户的余额，判断是否大于转账的金额，如果大于则扣减A账户的余额，并增加对应的金额到B账户。



这种设计在需求简单的情况下看上去没啥问题，但是当需求变得复杂后，会导致代码变得越来越难以维护，整个架构也会变的腐烂。比如现在需要增加账户的信用等级，不同等级的账户每笔转账的最大金额不同，那么我们就需要在service里面加上这个逻辑。后来又需要记录转账明细，我们又需要在service里面增加相应的代码逻辑。最后service代码会由于需求的不断变化变得越来越长，最终变成别人眼中的“祖传代码”。导致这个问题的根源，我认为就是我们使用的是一种面向过程的编程思想。那么如何去解决这种问题呢？主要还是思维方式上需要改变，我们需要一种真正的面向对象的思维方式。比如一个“人”，除了有id、姓名、性别这些属性外，还应该有“走路”、“吃饭”等这些行为，这些行为是天然属于“人”这个实体的，而我们定义的bean都是一种“失血模型”，只有get/set等简单方法，所有的行为逻辑全部上升到了service层，这就导致了service层过于臃肿，并且很难复用已有的逻辑，最后形成了各个service之间错综复杂的关联关系，在做服务拆分的时候，很难划清业务边界，导致服务化进程陷入泥潭。



对应上面的问题，我们可以在Account这个实体中加入本应该就属于这个实体的行为，比如借记、贷记、转账等。每一笔转账都对应着一笔交易明细，我们根据交易明细可以计算出账户的余额，这个是一个潜在的业务规则，这种业务规则都需要交由实体本身来维护。另外新增账户信用实体，提供账户单笔转账的最大金额计算逻辑。这样我们就把原本全部在service里面的逻辑划入到不同的负责相关职责的“领域对象”当中了，service的逻辑变得非常清楚明了，想实现A给B转账，直接获取A实体，然后调用A实体中的转账方法即可。service将不再关注转账的细节，只负责将相关的实体组织起来，完成复杂的业务逻辑处理。



上面的这种架构设计方式，其实就是一种典型的“领域驱动设计(DDD)”思想，在这里就不展开说明了（主要是自己理解的还不够深入，怕误导大家了）。DDD也是目前非常热门的一种架构设计思想了，它不能减少你的代码量，但是能使你的代码具有很高的内聚性，当你的项目变得越来越复杂时，能保持架构的稳定而不至于过快的腐烂掉，不了解的同学可以查看相关资料。要说明的是，没有一种架构设计是万能的、是能解决所有问题的，我们需要做的是吸收好的架构设计思维方式，真正架构落地时还是需要根据实际情况选择合适的架构。



# 整体架构设计 

上面说了些架构设计方面的想法，现在我们回到规则引擎平台本身。我们抽象出了四个分层，从上到下分别为：服务层、引擎层、计算层和存储层，整个逻辑层架构见下图：

![img](https://nos.netease.com/cloud-website-bucket/20181023100347a180e927-34bd-427a-b58e-622d5181972f.png)~~~~





- 服务层：服务层主要是对外提供服务的入口层，提供的服务包括数据分析、风险检测、业务决策等，所有的服务全部都是通过数据接入模块接入数据，具体后面讲
- 引擎层：引擎层是整个平台的核心，主要包括了执行规则的规则引擎、还原事件现场和聚合查询分析的查询引擎以及模型预测的模型引擎
- 计算层：计算层主要包括了指标计算模块和模型训练模块。指标会在规则引擎中配置规则时使用到，而模型训练则是为模型预测做准备
- 存储层：存储层包括了指标计算结果的存储、事件信息详情的存储以及模型样本、模型文件的存储



在各个分层的逻辑架构划定后，我们就可以开始分析整个平台的业务功能模块。主要包括了事件接入模块、指标计算模块、规则引擎模块、运营中心模块，整个业务架构如下图：

![img](https://nos.netease.com/cloud-website-bucket/201810231004018de9943c-8de0-46cd-bb0c-7e758a62f50e.png)~~~~





## 1.事件接入中心



事件接入中心主要包括事件接入模块和数据管理模块。数据接入模块是整个规则引擎的数据流入口，所有的业务方都是通过这个模块接入到平台中来。提供了实时(dubbo)、准实时（kafka）和离线（hive）三种数据接入方式。数据管理模块主要是进行事件的元数据管理、标准化接入数据、补全必要的字段，如下图： 

![img](https://nos.netease.com/cloud-website-bucket/201810231004121c018977-e1f5-45c6-968d-39ff3500f366.png)~~~~



## 2.指标计算模块



指标计算模块主要是进行指标计算。一个指标由主维度、从维度、时间窗口等组成，其中主维度至少有一个，从维度最多有一个。如下图： 

![img](https://nos.netease.com/cloud-website-bucket/2018102310042476116e86-4f15-4960-9920-d8f76f0d4015.jpg)~~~~

举个例子，若有这样一个指标：“最近10分钟，同一个账号在同一个商家的下单金额”，那么主维度就是下单账号+商家id，从维度就是订单金额。可以看到，这里的主维度相当于sql里面的group by，从维度相当于count，数值累加相当于sum。从关于指标计算，有几点说明下：



1. key的构成。我们的指标存储是用的redis，那么这里会涉及到一个key该如何构建的问题。我们目前的做法是：key=指标id+版本号+主维度值+时间间隔序号。

   > 

2. - 指标id就是指标的唯一标示；
   - 版本号是指标对象的版本，每次更新完指标都会更新对应的版本号，这样可以让就的指标一次全部失效；
   - 主维度值是指当前事件对象中，主维度字段对应的值，比如一个下单事件，主维度是用户账号，那么这里就是对应的类似XXX@163.com，如果有多个主维度则需要全部组装上去；
   - 如果主维度的值出现中文，这样直接拼接在key里面会有问题，可以采用转义或者md5的方式进行。
   - 时间间隔序号是指当前时间减去指标最后更新时间，得到的差值再除以采样周期，得到一个序号。这么做主要是为了实现指标的滑动窗口计算，下面会讲

3. 滑动窗口计算。比如我们的指标是最近10分钟的同一用户的下单量，那么我们就需要实现一种类似的滑动窗口算法，以便任何时候都能拿到“最近10分钟”的数据。这里我们采用的是一种简单的算法：创建指标时，指定好采样次数。比如要获取“最近10分钟”的数据，采样次数设置成30次，这样我们会把每隔20秒的数据会放入一个key里面。每次一个下单事件过来时，计算出时间间隔序号（见第1点），然后组装好key之后看该key是否存在，存在则进行累计，否则往redis中添加该key。

4. 如何批量获取key。每次获取指标值时，我们都是先计算出需要的key集合（比如我要获取“单个账号最近10分钟的下单量”，我可能需要获取30个key，因为每个key的跨度是20s），然后获取到对应的value集合，再进行累加。而实际上我们只是需要累加后的值，这里可以通过redis+lua脚本进行优化，脚本里面直接根据key集合获取value后进行累加然后返回给客户端，这样就较少了每次响应的数据量。

5. 如何保证指标的计算结果不丢失？目前的指标是存储在redis里面的，后来会切到solo-ldb，ldb提供了持久化的存储引擎，可以保证数据不丢失。



## 3.规则引擎模块 

计划开始做规则引擎时进行过调研，发现很多类似的平台都会使用drools。而我们从一开始就放弃了drools而全部使用groovy脚本实现，主要是有以下几点考虑：

- drools相对来说有点重，而且它的规则语言不管对于开发还是运营来说都有学习成本
- drools使用起来没有groovy脚本灵活。groovy可以和spring完美结合，并且可以自定义各种组件实现插件化开发。
- 当规则集变得复杂起来时，使用drools管理起来有点力不从心。

当然还有另外一种方式是将drools和groovy结合起来，综合双方的优点，也是一种不错的选择，大家可以尝试一下。

规则引擎模块是整个平台的核心，我们将整个模块分成了以下几个部分： 

![img](https://nos.netease.com/cloud-website-bucket/20181023100506855d3855-69fb-48fb-95a5-c0c047fa9e1e.png)~~~~

规则引擎在设计中也碰到了一些问题，这里给大家分享下一些心得：

- 使用插件的方式加载各种组件到上下文中，极大的方便了功能开发的灵活性。
- 使用预加载的方式加载已有的规则，并将加载后的对象缓存起来，每次规则变更时重新load整条规则，极大的提升了引擎的执行效率
- 计数器引入AtomicLongFieldUpdater工具类，来减少计数器的内存消耗
- 灵活的上下文使用方式，方便定制规则执行的流程（规则执行顺序、同步异步执行、跳过某些规则、规则集短路等），灵活定义返回结果（可以返回整个上下文，可以返回每条规则的结果，也可以返回最后一条规则的结果），这些都可以通过设置上下文来实现。
- groovy的方法查找策略，默认是从metaClass里面查找，再从上下文里找，为了提升性能，我们重写了metaClass，修改了这个查询逻辑：先从上下文里找，再从metaClass里面找。



规则配置如下图所示：

![img](https://nos.netease.com/cloud-website-bucket/20181023100521f9aa1be6-f746-49a4-bbf6-6661dcb0ad5c.jpg)~~~~





# 未来规划 

后面规则引擎平台主要会围绕下面几点来做：



1. 指标存储计划从redis切换到hbase。目前的指标计算方式会导致缓存key的暴涨，获取一个指标值可能需要N个key来做累加，而换成hbase之后，一个指标就只需要一条记录来维护，使用hbase的列族来实现滑动窗口的计算。
2. 规则的灰度上线。当一条新规则创建后，如果不进行灰度的测试，直接上线是可能会带来灾难的。后面再规则上线流程中新增灰度上线环节，整个引擎会根据配置的灰度比例，复制一定的流量到灰度规则中，并对灰度规则的效果进行展示，达到预期效果并稳定后才能审批上线。
3. 事件接入的自动化。dubbo这块可以采用泛化调用，http接口需要统一调用标准，消息需要统一格式。有了统一的标准就可以实现事件自动接入而不需要修改代码上线，这样也可以保证整个引擎的稳定性。
4. 模型生命周期管理。目前模型这块都是通过在猛犸平台上提交jar包的方式，离线跑一个model出来，没有一个统一的平台去管控整个模型的生命周期。现在杭研已经有类似的平台了，后续需要考虑如何介入。
5. 数据展示优化。现在整个平台的数字化做的比较弱，没法形成数据驱动业务。而风控的运营往往是需要大量的数据去驱动规则的优化的，比如规则阈值的调试、规则命中率、风险大盘等都需要大量数据的支撑。

# 基于规则的风控系统

 发表于 2018-09-29 | 分类于 [技术 ](https://jinfei21.github.io/categories/技术/)| *阅读量* 2167次

  转岗到平研创新Team一直在忙于风险系统的优化升级。上一次聊到对系统问题如何解决的方法论，这次碰到的就是这类问题，因为不是简单的线性问题，所以不能通过优化一个单点解决问题。今天就聊聊这一个多月忙的事情。
  当前互联网企业存在很多风险，特别是金融行业，一直被羊毛党，刷单党光顾。比如像一些账号问题，由于用户的使用习惯，会在各个站点注册账号使用相同的用户名和密码，这就给了黑产份子可乘之机。他们会找相对比较小安全防护不严的网站利用SQL注入或者其他漏洞进行拖库，获取用户的账号信息，然后对密码进行清洗，俗称洗库，最后拿到用户登录账号明文信息到一些知名网站去试，俗称撞库，这有可能对用户造成损失。
  由于以上一些问题的存在，要面对互联网上的实时攻击。风控系统需要解决如下问题：

- 哪些业务是有风险的，注册、登录、交易、活动等等，这需要业务方埋点传入合适的参数。
- 什么事件是有风险的，这需要用到统计学，对异常用户的历史数据做统计分析，找出异于正常用户的特征。
- 实时性，而且对风险事件必须是毫秒级的响应，有些场景需要尽快拦截，及时给用户挽回损失。
- 低误报，需要人工风控经验，对各种场景的风险阈值和评分设置，需要长期不断的调整。
- 支持对历史数据的回溯，能够发现以前的未发现的风险，对现有的策略设定提供参考。

  公司现有的风控系统架构如下所示：
[![img](https://jinfei21.github.io/2018/09/29/%E5%9F%BA%E4%BA%8E%E8%A7%84%E5%88%99%E7%9A%84%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F/%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84.png)](https://jinfei21.github.io/2018/09/29/基于规则的风控系统/风控系统架构.png)
  整个系统是一个单体结构，外部系统直接通过接口调用得到实时的风险等级标识，然后业务系统根据风险等级标识采取相应的措施，比如验证码或者拒绝阻塞。接口需要传入策略名称，策略是规则引擎定义的模型对应一组规则，每个规则都对应一组指标。风控系统的核心就是规则引擎，一个好的规则引擎可以方便业务方随时变更验证逻辑而不用重启服务。既要保证服务的稳定又要不失灵活性。规则引擎我们是采用执行groovy脚本，可以灵活变更规则逻辑。这需要对领域模型进行抽象，目前抽象出了策略、规则和指标关系如下图所示：
[![img](https://jinfei21.github.io/2018/09/29/%E5%9F%BA%E4%BA%8E%E8%A7%84%E5%88%99%E7%9A%84%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F/%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E.png)](https://jinfei21.github.io/2018/09/29/基于规则的风控系统/规则引擎.png)
  可以把策略理解成规则集合，策略是最终判别风险的依据。系统根据所有规则的分值汇总得到总和，总和越大说明风险等级越高。规则就是需要执行的脚本逻辑，会查询指标然后和阈值比对，如果大于阈值就返回相应的分值。对业务方而言只需要关心策略配置和阈值等级设定，脚本逻辑不需要关心。脚本逻辑是应对各种场景的关键，里面有一些逻辑处理，需要查询存储数据库查找对应指标值和历史数据。
  业务方在接入时首先传入策略名称，这是风控系统定位规则集合的唯一标识，拿到规则集合后会执行相应的规则脚本汇总分值，再根据业务方在后台系统配置的等级规则判别相应的等级，最后返回给业务方，业务方拿到风险等级后再去做一些风险处理。整个过程不是很复杂，但是因为是单体结构，很多代码逻辑耦合在一起，难于维护而且也不好改进。因为一旦涉及到改动就会影响原有逻辑，总结一下目前系统架构有如下不足：

- 只有统计规则和静态规则，像一些行为规则和关联规则支持不了。
- 规则阈值和风险等级的设定没有客观评价指标。
- 系统功能耦合在一起，数据采集、限流和指标计算都在一个接口中。
- 没有充分利用缓存，仅仅把缓存当配置中心使用。
- 接入场景单一，只支持同步接入同步处理风险。

  以上是目前系统痛点，更关键的是如果单纯的从系统层面优化没有多大意义。因为对业务方来说是想要需要知道策略的实际效果，进行风险识别时是否影响到了用户体验，是否预防到了真正风险，这些都没有一个离线分析的指标做参考。所以下图所示的一个反馈闭环很重要：
[![img](https://jinfei21.github.io/2018/09/29/%E5%9F%BA%E4%BA%8E%E8%A7%84%E5%88%99%E7%9A%84%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F/%E9%97%AD%E7%8E%AF.png)](https://jinfei21.github.io/2018/09/29/基于规则的风控系统/闭环.png)
  一般来说业务方在接入风控系统时需要先配置策略规则，然后设定每个规则对应的阈值和分值等级，完了就可以应用上线观测实际预测的效果，实际的预测结果只能依赖离线分析，可能需要对用户历史操作轨迹进行分析，如果预测结果拦截的都是正常操作的用户，这时可能就需要调整阈值。有了这个闭环就知道接下来需要做的事情了，后面所有的架构都是围绕这个闭环来进行。经过重新梳理后架构图如下：
[![img](https://jinfei21.github.io/2018/09/29/%E5%9F%BA%E4%BA%8E%E8%A7%84%E5%88%99%E7%9A%84%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F/%E6%96%B0%E6%9E%B6%E6%9E%84.png)](https://jinfei21.github.io/2018/09/29/基于规则的风控系统/新架构.png)
  新架构对原有逻辑功能进行了拆分。接入层主要是进行数据格式检查和信息丰富，比如ip地址可能需要转化为地区城市，浏览器类型需要打标识，然后将数据落地写入kafka，以便接下来的离线分析和回溯。核心层就是规则同步和策略匹配，这块是比较核心的东西，会随着业务变化架构层面不直接对接业务，所以下沉在接入层后面，接入层对外是不可变的。数据落地后有实时Job进行一些指标分析入库，这样用户在设定指标阈值时可以根据历史数据参考，比如同一个ip最近7天登录次数，这个次数阈值可以基于历史用户来设定，这样业务方在设定阈值时也有一个预期大概会拦截多少用户，多少用户会受影响。接入方式可以有同步和异步，同步需要实时响应用户告诉用户风险等级。异步就是用户发来数据就完事了，后台的实时job会读取kafka的数据利用CEP模型的esper框架进行风险预测然后采取相应的动作。
  在功能层面也会更丰富一些，老的架构是直接写入druid，指标分析是实时去查druid的数据做汇总统计。这样做的好处就是实现简单，但性能随着调用量增多会下降，如果能事先把一些指标计算好，使用时直接来查不用做实时计算性能会提升很大。同时加强了后台管理的能力，用户和管理员各自关注不同领域。
[![img](https://jinfei21.github.io/2018/09/29/%E5%9F%BA%E4%BA%8E%E8%A7%84%E5%88%99%E7%9A%84%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F/%E8%A7%84%E5%88%99%E5%BA%93.png)](https://jinfei21.github.io/2018/09/29/基于规则的风控系统/规则库.png)
  开发者也就是管理员会根据业务需求编写规则脚本，然后业务方再配置这些规则脚本的阈值和分值。规则方面可以支持四种：

- 静态规则
  基于某个静态值的限制性规则，比如三元验证一致、是否命中黑名单、常用联系人验证、电信服务使用地理范围验证等
- 统计规则
  用统计计算的值来作为验证的条件，如来自某个设备或者IP的申请次数大于某个值
- 关联规则
  指用户在进行了某个操作之后，又执行另外一个操作，带来的风险。例如，修改账号密码后，进行交易操作
- 行为规则
  指用户的异常行为，例如用户在常驻地址或者某个特殊的时间如深夜，进行了交易操作，一般也认为具备一定的风险

  风控系统实际是包含两部分内容，一是识别风险，二是对识别后的风险或是自动的或是人工的进行处理。后台系统增加了惩罚管理，相对于原先风险处理硬编码在业务逻辑中，惩罚管理可以做到配置化的分级处理，当然响应可能没有以前及时，但也是近实时的。整体流程如下所示。
[![img](https://jinfei21.github.io/2018/09/29/%E5%9F%BA%E4%BA%8E%E8%A7%84%E5%88%99%E7%9A%84%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F/%E5%A4%84%E7%BD%9A.png)](https://jinfei21.github.io/2018/09/29/基于规则的风控系统/处罚.png)
  以上就是最近一段时间梳理的风控系统架构。目前只是对原有的逻辑进行拆分，为后期离线分析打下基础。后期会利用elasticsearch做一个超级cube的指标系统，参考平安spark+hive+es的方案，对用户历史行为轨迹做不同维度的分析。让业务方对用户更了解，逐步形成数据驱动风险策略的设定。

