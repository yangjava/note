---
layout: post
categories: [Note]
description: none
keywords: Note
---
# 信审系统设计
信审系统:

给需要资金的人提供审核
给业务操作人员提供审核服务

角色:
内部操作人员==审核人员
借款申请人

流程

进件申请===系统规则审核

清白件===分单===审核流程

====签订==签订合同

====放款

大流程: 进件==审核==签订合同==放款==贷后催收
销售系统,宜人贷 ==信审系统 ===综合信贷 ===结算中心

信审系统要求
提高审核效率 自动化
风险控制   智能化
报表统计 数据化













数据库结构
****************
进件表 transport
进件资料表 transport_image
借款人信息表 apply
客户信息表customer 银行卡信息支付结算
产品表 product
审核任务表 task

用户权限表等
用户 User
角色 role
数据权限 dataPermission
权限资源 resource
部门 department
****************


销售进件
进件接口内容
进件编号[内部]
外部编号
进件来源
产品类型 e人贷 e车贷 e房贷 e企贷
销售人员信息
借款人信息
借款人金额
1.判断是否重复进件
out_tid 外部进件编号
2.验证产品是否存在
Product_id
产品金额区间 利率区间 产品分期区间  进件资料类型 产品流程处理
插入到数据库中
插入进件信息transport
插入申请人信息apply
插入客户信息customer====account
3.同步给征信系统
4.同步给大数据中心


//同步给数据
//使用技术 异步多线程
//消息队列
产品信息
配置信息

调用规则信息
进件大纲规则，信息异常规则，申请人行信息比对规则，人行拒贷规则，自动批贷规则，反欺诈分单规则，稳定性规则，人行月负债规则，FICO拒贷规则，城市风险等级规则。
结果
进件 高危 疑似 清白
FICO评分是什么

FICO评分是Fair Isaac公司开发的信用评分系统，也是目前美国应用得最广泛的一种。FICO评分系统得出的信用分数范围在300～850分之间，分数越高，说明客户的信用风险越小，它采集客户的人口统计学信息、历史贷款还款信息、历史金融交易信息、人民银行征信信息等，通过逻辑回归模型计算客户的还款能力，预测客户在未来一年违约的概率：
1.?人口统计学信息：如客户年龄、家庭结构、住房情况、工作类别及时间等；
2. 历史贷款还款信息：即过去6个月或12个月的付款方式、逾期次数等；
3. 历史金融交易信息：即过去6个月或12个月的平均月交易笔数、金额等；
4. 银行征信信息：如过去12个月中新开的账户总数、所有账户的总额度、账户是否逾期等。
   看，以上这些信息都是FICO评分模型的自变量，最终会通过逻辑回归模型输出最终分数。
   INS反欺诈
   黑名单


Score level
分单


分单规则 进件分配给个人
权限规则
额度规则
数量规则
1.未处理所有订单 该进件的订单 当天历史单最少的人
逻辑
查询今天所有未处理订单
group by userId 最少

查询每个用户 今天的所有未完成订单
所有该类型的订单


业务流程跳转(改造)

产品类型  流程节点
链表形式
产品类型 节点状态 节点条件 下一个节点 节点分配权限
开始==>  A 是 B  b是 c b否 a
表达式 el表达式

进件流程表
Snaker流程引擎

初审审核信息

个人信息
家庭信息
面审调查
个人信用信息
终审信息
额度信息
是否可以提额
Drools规则引擎
通过到销售系统或者综合信贷 签订合同’
解析word 解析pdf等 导出excel
Excel4j
统计功能 报表功能


信审1.0 信审2.0系统
我的任务:

接口对接51k计划 同盾借口 安荣会中报告
人行报告解析
分单规则改造 手动分单 自动分单
异步借口改为同步借口
日志追踪
慢sql改造
分库分表技术
使用技术
Struts2 spring mybatis poi drools
Webservice  activieMQ sia


订单系统
账户系统
账务系统
支付系统
路由系统
代收付系统
清结算系统
对账系统
风控系统
营销系统[红包]
电商系统

使用技术
Spring mybatis mvc redis mq
Mogodb nginx slb mysql  mycat
Fastdfs

现在做的系统
动动兔商家版
动动兔客户端
东东兔pcduan6

以前做的系统
互联网主带项目
主要用于资产方和资金方系统戳和
分布式系统
Springcloud
四个子系统

Credit  信贷系统
institute  资产方和资金方管理
Accout 账户管理
Contract 合同管理









风控决策引擎系统的搭建设计指南

skyson??订阅专栏
为什么不写文章了？因为足够强大。
2017-05-28?3.4万?142?32
从零开始学运营，10年经验运营总监亲授，2天线下集训+1年在线学习，做个有竞争力的运营人。了解详情
释放双眼，带上耳机，听听看~！
00:00
00:00
归结而言，风控的本质是数据，探索数据与数据之间关联关系，根据其演变的规律，为业务所用。

消费金融的门槛核心在于风控系统，面向C端客群的线上产品线，如消费分期、现金贷及信用卡代偿等业务方向，其需实时支持大量业务的自动化处理，风控系统将承担贷前、贷中和贷后的风控评估、处理及预警的角色，极大地解放人工处理的瓶颈与效率。
优先级
风控决策引擎是一堆风控规则的集合，通过不同的分支、层层规则的递进关系进行运算。而既然是组合的概念，则在这些规则中，以什么样的顺序与优先级执行便额外重要。
风控系统的作用在于识别绝对风控与标识相对风险，如果是绝对风控，则整套风控的审核结果便将是“拒绝”。既然结果必然是“拒绝”，则没必要运行完所有的风控规则，而主要单条触发“拒绝”即可停止剩余规则的校验。因为所有规则的运行，是需要大量的时间、金钱与性能成本的。所以，整套风控决策引擎的搭建设计思路，基于规则优先级运算的注意要点如下：
自有规则优先于外部规则运行
举例说明：自有本地的黑名单库优先于外部的黑名单数据源运行，如果触发自有本地的黑名单则风控结果可直接终止及输出“拒绝”结论。
无成本或低成本的规则优先于高成本的规则运行
举例说明：借款用户的身份特定不符合风控要求的，诸如低于18岁的用户，则可优先运行。而一些通过对接外部三方征信的风控规则，需支出相关查询费用的，则靠后运行。此外，在外部三方征信的规则中，命中式收费的风控规则（如黑名单与反欺诈）又可以优先于每次查询式收费的风控规则（如征信报告）运行。
消耗低性能的规则优先于高性能消耗的规则运行
举例说明：直接基于用户现有属性的数值，如当前用户的民族是否非少数民族，则可优先运行。而一些风控规则，需借助爬虫接口，且需待将爬取到的数据经过二次加工与汇合之后，再对汇合的总值进行判断，如手机运营商账单中的月总通话分钟时长，则此类风控规则应后置运行。
可调整
风控的核心思路是基于大量真实的样本数据，将逾期用户的身份、行为与数据特征进行提炼，从概率学的角度上进行剔除，从而保障到剩余用户群的逾期概率处于一个相对较低的区间。而对数据的提炼与作用过程，将使用到“参数”的定义。“参数”决定了区间和上下限范围，一条风控规则通常作用于某一数据类型，依据此数值是否满足“参数”的定义范围，得出是否可通过风控的结论。
由于风控最终还是数据“喂出来”的结果，而非主观臆断的设限，故而，随着数据样本与内容的不断发展，必然将会涉及到一些动态的调整，后期可能会发现原本设定的“参数”过于严谨而导致审核通过较低，或者是设定得过于宽松而导致逾期率较高等。所以，整个风控决策引擎的搭建设计思路，基于可调整与可维护的注意要点如下：
非刚需与必要的风控规则，能够“开关化”
举例说明：一些必要的风控规则，如用户的银行4要素验证是否一致性，这是必要规则，就无需可开关。而一些如校验用户的芝麻信用分是否高于500分，则可做成“开关”。待该规则上线后，可通过分析此项规则的触发率得出是否合理的判断。因为芝麻信用分是否可作为决策依据将主要取决于业务方向与用户群体，因为理论上芝麻信用分的高低主要与用户在芝麻信用体系内的数据绑定维度的多与少相关，并不一定绝对反映用户的信用程度。
风控规则上的“参数”可调整与灵活配置
举例说明：很多风控体系通常会加入对手机运营商的校验，所以有一些风控规则，诸如校验用户手机号的使用时间长度是否大于6个月。其中的“6个月”便是所定义的参数，此处最好可调整与配置。因为去验证用户的稳定性，是否用“6个月”，还是用“3个月”的长度更合适？具体合理的参数是需要通过数据分析的结论进行得出，如果由于定义“6个月”长度的要求而发现其他一些手机使用时长虽然短一些，并未与用户是否逾期形成直接必然因素，那么可将该参数放松调整到“3个月”。
记录与统计
风控最终到底是“跑出来”的，所以，整个风控系统对所有不同风控规则的触发需进行有效的记录与统计，以便后期可支持数据分析与风控模型调整的相关工作。
具体的记录与统计内容，主要如下：
触发的具体风控规则
举例说明：通过两种不同的视角进行记录，一是用户与订单层面，记录其所触发的明细规则；二是风控规则层面，记录某条风控规则具体的触发率。例如接了多家三方征信的反欺诈服务，通过比对这几家的触发效果，将反欺诈触发率较高的风控规则可前置执行。
风控规则所要求的“参数”与其参数字段下的具体数值
举例说明：规则定义方向，参数定义标准。其中，包含相符的与不相符都要进行记录，即便此次风控规则并未触发，如果后期发现逾期率较高，则可通过反推此风控规则并结合逾期用户的数据特性，可判断是否需调整此“参数”。
数据源内容
举例说明：某些风控规则是通过二次数据解析与汇总进行的，但原始数据需要进行保存，诸如手机账单的通话明细数据，此部分数据一是可作为风控规则使用，二是未来可用作于催收与贷后管理。
建模
风控体系的简单与复杂，视业务模式的开展而定。如果是固定额度与固定费率式的产品业务定价，则风控体系更多的是规则的集合。但若是有延伸的提额功能模块，与可根据用户前端不同的输入项数据，而输出与之相匹的不同的额度与费率的产品，则此时需要模型化。
风控建模需借助于函数的定义，此外也可以借助评分卡的机制进行补充。而评分卡的模式在另外一方面也作用于系统审核与人工信审，譬如高于X评分的订单申请，系统直接通过；处于X与Y之间的评分，则需人工审核，甚至通过电话联系；而低于Y评分的，则系统直接拒绝。
归结而言，风控的本质是数据，探索数据与数据之间关联关系，根据其演变的规律，为业务所用。消费金融与信贷领域的准入门槛在于风控，越是高额度的产品，对风控的要求越高。整个业务市场，如果按照风控的由简到难展开，则依次可以是：Payday Loan的现金贷→信用卡代偿→消费金融→高额度的信用贷……
#专栏作家#
朱宇迪，人人都是产品经理专栏作家。魔都某公司产品总监，在金融系统搭建、金融社交平台及理财投资产品应用领域均有丰富的积累，完整的前后端实践经验，擅长差异化竞争与全局视野，并对产品规划与落地执行有着独特的见解。
写文章注册登录
?首页
?下载App
?
窗体顶端
?

?
窗体底端
?
×
广告
简述互金帐户设计
?
40岁前的凯撒?关注
?0.1?2018.01.10 21:01*?字数 4233?阅读 536评论 3喜欢 7
这篇本来没有计划写的，但，由于某友的要求且考虑其正在从事这块业务，所以，奋笔疾书，写上一发。
声明: 本人虽然是在支付领域挥洒热(ban)血(zhuan)，但是，互金并不是主业，且不同受众群提供的产品和服务还是有很大差别的，所以，只能从较为宏观的层面谈谈互金账户设计的事儿。
先说一个大概
互金行业涉及的行业有6个大方向：三方支付、P2P、大数据金融(类似花呗，白条等，众筹等)，信息化金融机构，和互联网金融门户。但是，从账户角度来说，个人觉得大同小异，所以，本文拿大家最为熟悉的p2p作为案例。
p2p的分类：
1. 纯线上，线上理财，线上借款；
2. o2o：理财端线上，资产端线下，线下主要负责风控、催款等；
3. 债权转让模式：p2p流行的定期模式
   p2p是互金的一个分支，而贷款对于大家来说是比较了解的，有支付、p2p、花呗、微粒贷、京东白条做的信用贷的产品，还有其他一些东西等等形成的在互金行业的一些特色；
   纯线上的模式来说，企业通用做法是：
   线上获取贷款，线上理财操作；
   对于线上线下结合的方式，从国家对金融监管来说，理财端只能从线上发展；对于资产端，可以从线下进行风控和审批、或者催收；从优质资产考虑和统计数据表明，线上线下结合的模式比纯线上模式坏账率要低很多(我X贷网的朋友分享而知)；
   下面是债券转让模式。这个本人其实不是非常的懂。了解到的是，这一块主要在理财端，以定期和活期为主。最早买p2p以散标的模式，现在已经很少了。目前主要是债权转让的模式做定期和活期，而且以定期为主，活期因为监管被下架。
   从p2p的整个业务链条看，两部分：资金端、资产端。
   资金端。这方面主要是理财为主，以线上为主要方式，合规。资金端主要是理财人以散标、活期、定期等几种方式进行投资。理财人登录p2p平台，选择理财产品，有散标、活期、定期，目标基本以定期为主，散标目前比较少，原因是散标在点对点情况下，借款人的时间太长导致回访过高 。活期，比如各种宝，由于不合规，各平台正在换其他方式。
   定期。按照1，3，6，12个月这种模式比较流行，大家在在各大平台都有接触； 根据你选择的产品进行投标，以合适的身份进行匹配后，在满标后进行放款。
   资产端。本人个人的理解是，这一块比较复杂。
   p2p平台通过门店、电销、线上推广、资产购买等模式发展，经过相应的进件，审批，合格后进行签约，线上的话流程比较简单，线下就比较复杂，主要是按照贷款产品的额度进行区分。资产签约后，需要上标与理财人进行匹配，然后才能放款，后期按还款计划进行还款。
   p2p业务类型
   据本人不完全观察，业务流分为：充值，投资，红包，赎回，放款，提现，还款，代充值，代偿，代扣（还有其他的欢迎补充）
   充值。分为理财充值和借款人充值。对于理财充值，后期购买哪些产品即可理解为是投资了。购买类型是定期、活期还是散标；对于借款人充值，则目的是为了进行还款。
   红包。p2p平台竞争已经是非常激烈了，所以很多平台会做活动；如注册之后就送优惠券、体验金和代金劵等一些营销活动方面的推广， 对于业务活动都会有资金投入的，涉及到后期的业务处理；
   赎回。投资赎回，涉及本金和利息；
   放款。标的满标之后才能向债权人进行放款；对于提现可能会有余额的提现，剩余多少提现金额；
   还款。对于借款人来说，有还款方式和还款业务不同。怎么理解？比如，蚂蚁借呗，是线上还款方式；而有些传统业务比较多的p2p公司，可能会有门店还款、代扣(代收)或者对公的还款方式；
   代垫。这块解释了为什么p2p要接支付公司通道的原因。因为p2p有支付牌照的很少，基本上需要通过支付平台或者银行来走；早期，支付平台一般选择T+1结算，而部分是T＋0，因为费率比较高，原因是，T＋0提现是支付公司代垫，然后在T＋1支付公司自行和银行结算；
   代扣。对借款人银行卡进行定时扣款，比如买房公积金贷款。另外，公积金还款也是以代扣模式进行；
   "凯撒，你侃了半天，还是没有提到账户...”
   “别着急啊朋友，快了"
   凯撒这里再强调一次，为什么要说这么多业务的事情，因为搞清楚了这些，我们聊账户才比较顺当。
   账户？账户！
   是的，聊这一块，起点必然是资金流。资金流涉及的账户如下
   投资人结算户
   投资人债权户
   借款人债务户
   借款人结算户
   我们从一个正常的投资放款流程来看，张三（投资人）向结算户充值、然后进行投资，资金进入债权户（如果，投资失败，返回至投资人结算户）；接下来，平台通过撮合满标后放款到借款人债务户，在债务户进行各种费用的收取后放款到借款人结算户或者银行卡。反之亦然。
   对账务来说，需要关心的只是各个账户对象，资金在各个账户流入流出，即资金转移的过程；至于资金从哪里来的，资金应该属于谁，这些不在账务处理范围内；对于借款人来说，一个还款的过程是：
1. 借款人通过充值或者代扣的方式进行还款到结算户，
2. 结算户根据账单把还款金额冻结到债务户，通过债务户还款到债权人（张三）的债权户。
   假如有复投，债权人（张三）进行复投到其他标的；假如没有复投，就赎回到结算户，债权人（张三）可以选择自己提现或者进行其他标的的投资。
   聊到这里，引出了一个问题，那就是—财务处理和会计处理的差别
   账务处理
   对于账务处理来说，是根据账户的设置进行流水的处理，以收付实现制为基础。很难理解？想想支付宝的账单，是不是清楚很多？然后，根据流入流出的方式更新余额。
   对于会计处理来说，是以科目为主，以权责发生制为基础，资产、负债、所有者权、损益、成本、共同类进行复式记账。
   咱们拿充值为例，这样比较好理解。
   从账户的角度，是以收付实现制为基础的；对于会计处理来说，是以科目为主，以权责发生制为基础；收付实现制法则设定相应的目标账户以资金的流入、流出和余额为标准的，只是解决流入和流出；对于会计科目来说，解决的是为流入这笔钱来自哪里，流出这笔钱要去哪里，要有一个权责确认的过程；
   所以，针对用户充值这个场景，对于账户来说，只是一条资金流入，多少钱、余额多少；对于会计科目来说需要分全面考虑：
1. 对账前，跟支付机构（或银行）进行确认，有一个待清算款；
2. 在 T+1，对帐流水出来后，需要进行对账；（支付公司但凡有提供t+0，对账的事情支付公司T+1找银行清算了）
   3.对账完成后，相当于把待清算转成应收账款；然后，这个充值场景的一笔充值记录在后台对应多笔会计分录；
   会计处理
   这地方要理解一个概念，那就是，从账务处理来讲虚拟户是解决资金归属问题，而不关心资金的存放问题。这里涉及到的有两个账户：实体账户和虚拟账户
   实体账户，即资金存放的账户，在银行，有如下三类：银行存管专户；银行自由资金专户；银行垫资账专户
   虚拟账户，即资金归属；两种：用户虚拟存管账户（投资人账户，借款人账户，合作机构账户，担保机构账户）；平台虚拟存管账户（收入账户，分润账户，代偿账户，代充值账户；派息账户）
   实体账户是干什么的？
   是解决资金存放问题的，与虚拟户成对应关系。从会计处理讲，实体户属于资产，虚拟户属于负债及其他。而实体账户和虚拟户组成，的角度来说，需要跟银行有一个开户的过程，用来解决资金存放的问题（是存放在银行存管户、银行自由资金户还是银行垫资专户，这个要看具体情况而定）；对于虚拟户来说，钱是从投资人、借款人或者居间人一方来的，是属于收入的还是营销的，这个也是要具体情况而定。
   小结一下，对于实体户，只关心资金存放；对于虚拟户（比如说投资户、借款户还有收入户），关心资金归属。举例：在平台银行账户存入一笔钱，是属于投资人还是借款人；从实体户的角度来说是资产，从虚拟户的角度来说是负债（属于平台欠投资人／借款人的钱，对于平台来说是负债）。
   鉴于p2p的特殊性，不止有收入的问题，还会有营销款支出、代偿、代垫、分润等有相关业务，对于没有按时还款进行代偿代垫等这些内容要说估计篇幅太长了，和这个账户设计没有太大关系。
   财务处理和会计处理

图片发自简书App
从四个方面（交易，账务，会计，对账）同一笔交易所涉及到的账务处理、会计处理、对账等事宜。从交易处理、账务处理、会计处理和对账处理，形成一个完整的企业数据流；
我们拿放款为例：
交易处理：放款就是一笔支付；
账务处理：从债权户到债务户，从债务户到结算户然后到结算户的银行卡，同时还涉及到收益户的处理；
那么，为什么有这么多处理步骤? 我们不妨站在平台角度：
1. 需要在放款的时候才确认从债权到债务的处理；
   2.在债务处理的时候，需要把钱放在借款人债务户，并相应把钱划到结算户和收益户（会收取一定的费用）；
3. 针对部分客户有需求是打款到银行卡，所以平台需要记录从债权户到债务户、债务户到结算户、结算户到银行卡的这条流水处理过程，以保证账务流水处理的一致性；
   会计处理：比如贷款，债权户到债务户的确定，会记待发放款项；待发放款项放款，放款金额和合同金额会有差距，所以，放款金额会单独形成待清算目录，假如T+1账单来了，形成清算，对于收益户来说计入收益；
   对账处理：支付流水和确认银行流水对账以后，形成应收账款；然后对于结算来说，形成相应的银行余额进行结算，并形成结算的单据凭证；
   下面我们从财务处理角度去看这个问题：

图片发自简书App
从业务架构上，业务端统一对接支付平台进行现金的收支转等。支付平台在完成支付过程中，同步数据到账务管理和清结算平台。账务管理和清结算在数据处理后，传递到会计处理。这一个过程说起来挺简单的，但是实际由于公司自身发展不均衡，很多公司业务平台先于支付平台建立，这样的话就需要对各条业务线进行梳理，进行标准化设计，对业务系统查缺补漏，统一业务流程和接口方式。
从结构设计上，支付负责进行现金账务管理负责资金的变动，清结算负责对账，进行账实核对，会计处理负责复式记账(啥是复式记账，自行百度吧)，试算平衡及日切等等。
总体流程是：支付订单向账务管理写入账务的流水数据，向清结算写入清洁算的流水数据，并在清结算的过程中进行对账处理，这样从系统设计上来说两边互不干涉。会计处理分别获取账务管理的数据和清洁算的数据，这样分别获得交易的确认和账务的确认，在会计处理这块儿相当于两个合一。
另外，业务的发展速度会快于系统的整体规划速度，这样会导致同样的功能点，同样的业务处理，在不同的系统处理方式不一致。没有形成一个的统一系统的处理。然后从设计的角度上，不仅要考虑系统架构的适用性方面，而且要考虑公司逐步实现的步骤。
附：还款
这里多说一句还款的事儿，因为上图画得比较差
还款涉及到的资金项目有本金、XX费、利息；这些类型还到借款人账户上，这些钱会有几个步骤：从本金还到投资人债权户上，xx费放在收入账户和分润账户，利息放在派息账户；相当于还款部分，异地还款在债务户里面的资金处理是不一样的，流向自然也就不一样了，那么，相应的后台会计处理也就不一样了。（xx费，可以理解为车贷行业）
以上。
小礼物走一走，来简书关注我
赞赏支持
?底稿
? 著作权归作者所有
举报文章
关注40岁前的凯撒
写了 114565 字，被 222 人关注，获得了 151 个喜欢
我是凯撒，是一个从业第三方支付的小咖。对互联网，电商平台，产品，互联网金融等方面略有所见。 说，是为记录，记录即为思考。写，是思考的闭环。这里不敢说有干货，不敢说有洞见，不敢说有真理，有的是一种思考问题的角度。思与辩，没有"形"的局限，有的是"质"的局限。
喜欢
?
7
???更多分享

窗体顶端

登录?后发表评论
窗体底端
3条评论?只看作者
按时间倒序按时间正序

?
40岁前的凯撒?作者
3楼 · 2018.04.19 19:17
想看修正版移步我公众号: 凯撒说
赞??回复

?
柳十七儿
2楼 · 2018.02.24 18:21
我是入行互金产品一年的产品汪一名，楼主的业务流梳理得很好，看完后感觉清晰很多，感谢了
1人赞??回复
40岁前的凯撒：
?@柳十七儿?谢谢支持
2018.02.24 20:31??回复
?添加新评论
?
被以下专题收入，发现更多相似内容

Design2b

推荐阅读更多精彩内容
我的身体为啥别人会羡慕
我是一花甲老者，身体功能正常。身高一米七；四肢无疼痛疾病，走路轻快；戴一百度花镜看书写字皆可，一般不戴眼镜；血压基本正常{90——120）之间；体重一百三、四斤；食欲好，吃啥啥香；粘枕即睡；记忆力稍差；听力无减退；思维敏捷，预测及判断能力强；牙齿无松动、牙没疼过，啃骨头，吃花生都行；嗅觉灵，近距离香臭都分得清；头发自然白；面色红润；上楼不喘；长年很少感冒，感冒后多喝水不吃药或少吃药，一周就好；若不小心碰破皮，包扎一下，几天自癒。身体大致就这样。 对于我这样的身心状态，自我感觉很好，好多人都羡慕我！我为啥有这么好的身体？我归纳总结有如下几个因素： 一、心态平和。天塌事不急不躁，欲望低，看钱...
?风云叟

学了这么多年的英语，一个公式全搞定？！像学母语一样学英语广告

散文 || 一滑倾心
文 / 淡水泉 临近春节，天气愈发的冷，人的食欲也随之莫名地好起来。黄昏时，接到香港曙枫律师的电话：“我和陈维在台江上下杭的民国风情街，你若是方便，开车过来带我们去尝尝当地的特色小吃。”虽说福州有意思的小吃很多，但还是建议他们先随我去试试达道路上人气最旺的“依强牛肉滑”。 达道牛滑的创始人叫林卫民，早年是福州电机厂的磨具工人，业余喜好琢磨厨艺。六十年代末，就跟当厨师的亲兄弟一起合伙开了这家店。后来老人家去世，又交到了儿子林增强和媳妇江雪英手里，但手艺却是分毫不差地传承了下来。 做牛滑，最重要的就是选牛肉。黄牛肉的味道比水牛肉要好，哪里的肉都不如腿肉来得好吃，来得嫩。所以，他们只从闽侯甘蔗...
?淡水泉
还乡过年
据报道，近几日，在亚洲东部进行着一场全球最大规模的人类大迁徙活动。这次迁徙几乎动用了目前所有形式的交通工具，大到汽车、火车、轮船、飞机，小到三轮、摩托、自行车，在浩浩荡荡奋不顾身的庞大队伍面前，任何势力都显得苍白无力难以阻挡。从世界看，各个国家都有为数众多的群体参与其中，纷纷从四面八方向这一地区聚拢；从局部看，这一地带的人群更是蠢蠢欲动，几近失控，有南来北往的，有东西奔走的，这种前赴后继、不计成本、杂乱无章、繁忙穿梭的恢宏景象让各国生物学家都无比困惑，从学术的角度绞尽脑汁也无法解释清楚。 图片发自简书App 其实，这个重大事件的每一名参与者，内心却是无比笃定，目标也是再清楚不过。过大年，...
?水宜
接纳别人的友谊，才能拥有友谊
敏敏是一位正在读初二的女孩，外表文静，说话细声细气的她，最近却遭到了几乎全班女生的孤立，为此，她痛苦万分，想要转学。 “ 很理解你现在的心情，若是我也会很难受的。” 我说道。 泪水顺着她小巧的鼻翼淌了下来，敏敏点了点头，哽咽着说: “嗯，我昨晚都做噩梦了，梦到漆黑的夜晚，我一个人走在路上,路灯一下子灭了，我呼喊着, 却没人理我。” 处于青春期的少男少女非常重视同伴关系，这既是他们情感的重要支撑，也是获取信心的重要途径，因此，人际关系的困扰对少男少女的影响很大。 而敏敏却遭到几乎全班女生的孤立，这对她心灵的打击可见一斑。 “ 那你觉得她们为什么会孤立你呢? ” 我问道。 敏敏不说话，低头看...
?暖暖育儿家
迎雪之想
原创 / 沐心怡然 2019年1月30日这一天，算是今年冬天正式下的第1场雪。 就在这几天，一直唠叨总不下雪，对人的身体健康也好，对农民的庄稼地也好，没有任何好处的时候，雪竟然来了，这可是人们盼望已久的。 自然规律，四季轮回，春花夏荷，秋菊冬雪，这些东西少一样都不行，冬的象征有雪的点缀，才能算上完美。 雪之洁白，晶莹，纯净，高雅，飘飘洒洒，在文人墨客眼中可谓美不胜收，不知是谁起的名字“雪花姑娘”早已成了孩子们印象当中美的象征。 雪的世界，美丽的世界，这是人们赖以生存必不可少的东西，也是多少人在冬季来临时，心心念念的盼望和崇拜的偶像啊！冬季没有雪，是人们心中的失落，更是每一个具有童真童趣人...
?沐心怡然
赵某某被控诈骗百万无罪案辩护概况
穷尽手段打出综合拳进行全面辩护 ——赵某某被控诈骗百万无罪案 承办律师徐宗新简介 承办律师孙立波简介 【案件概况】 《起诉书》指控：2007年9月28日，鲁某向许某某借款人民币68万元，约定借款月利息为3分。后鲁某在2008年因违法犯罪被处理，期...


?杨昆北京靖霖刑辩
《辩护人认为》（第二辑）无罪篇之案例选
穷尽手段打出综合拳进行全面辩护 ——赵某某被控诈骗百万无罪案 承办律师：徐宗新 承办律师：孙立波 【案件概况】 《起诉书》指控：2007年9月28日，鲁某向许某某借款人民币68万元，约定借款月利息为3分。后鲁某在2008年因违法犯罪被处理，期间没有归还本金也未支付利息。...


?杨昆北京靖霖刑辩
银行核心系统概念入门简介
一，银行核心系统是什么? 2011-01-03 csdn 银行核心系统是什么 银行核心系统的英文原意CORE Banking, CORE其实不是“核心”的意思这么简单，它的全称是: Centralized Online Real-time Exchange （集中式在线实时...


?大圣2017
P2P入门概念
P2P：person-to-person（或peer-to-peer）是一种将非常小额度的资金聚集起来借贷给有资金需求人群的一种民间小额借贷模式。 P2P类别 银行系 银行系P2P的优势主要在于：第一，资金雄厚，流动性充足；第二，项目源质地优良，大多来自于银行原有中小型客户...


?大道至简已被使用
??
我的天那


?回到家合适的
爱，不言
文/夏之屿 二郭是班上一个人缘很好的女生 特别是对于我这样不善言谈的人来说，她便是我一直以来的楷模。每天的我，以静默示人，偶尔与同学说话，却也是必要的日常交流或是被逼无奈。我总是认为自己会与世隔绝，似乎周围再怎么吵闹，我也能保持沉默，守住心底的那一份安宁。因此，我没有过多朋...


?夏之屿
夏天的马桑
小城四面环山，平缓绵延的连成了一片，山中树林层叠，很多高大茂密的树木，一年四季都是绿的。夏天阳光强烈，雨水丰富，树林里就结出很多野果来，静静生长，静静落地，也少有人来摘。 公司电视台停车场旁，就有两棵桑树。长了很多年，苍翠挺拔繁密，遮住了大片的天空。记不得每年会有多少附近养...


?璐晓源
你需要知道的Android拍照适配方案
转载自http://blog.coderclock.com/2016/05/22/android/你需要知道的Android拍照适配问题 说起调用系统相机来拍照的功能，大家肯定不陌生，现在所有应用都具备这个功能。例如最基本的，用户拍照上传头像。Android开发的孩纸都知道...


?mark2Li
微信小程序开发flex布局
小程序的布局只要有两种，一种是用flex来做布局，还有就是用相对定位和绝对定位。相对定位和绝对定位这个见得比较多，比起flex麻烦很多，坚决舍弃了，总结一下flex布局的资料，留备查用。如有不足，希望各位道友助攻。 不管是APP开发还是前端开发，最恶心最头痛的就是对各种屏幕...


?WangK_Dev
?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

人人都是产品经理
2.8万文章
9732万总阅读
查看TA的文章>
0
?分享到
?
?
?
谈谈互金风控系统设计?
2018-11-19 09:13
近一年多以来在互金行业负责风控系统，根据自己工作中的经验，写下这篇文章。既是对自己工作的总结，也是给刚入行和准备入行的朋友打个样，希望能有所帮助。

鉴于本文较长，故提供脑图，读者可自行选择感兴趣的部分阅读。

一、为什么要做风控审核系统
记得自己2016年进入互金行业的时候，互金行业的发展形势还是一片大好，各种P2P公司和现金贷公司，宛如雨后春笋一般出现。然而随着时间的推移，大量的公司因为经营不善而倒闭，或清算、或暴雷，P2P行业今年6、7、8月更是发生大规模的雷潮，给社会和行业带来了非常不好的影响。
暴雷的原因千千万万，究起根本原因，大多数是因为对资产端的风险控制不到位而造成的。毕竟，互联网金融，归根结底还是金融，而金融的本质正是风险管理。所以，开发一个能把控资产质量、评估资产风险等级的风控系统就成了一件很有必要的事情。
二、风控系统要达到什么效果
风控系统要达到的效果，我个人的理解是，能保证公司业务的收益在覆盖因为不良资产造成的损失的同时，还能有所盈余。所以在进行风控系统设计时，必须要和业务、信审、大数据、财务等部门充分沟通，确保不会因为风控规则过于严格，而出现进件通过率过低，以致于影响公司收益的情况。
其实，这对风控系统的设计者来说很矛盾，一方面希望自己设计的系统能够规避不良资产的风险，另一方面又不得不降低风控标准来接受一些风险。
三、风控系统进件审核流程1. 进件的分类
之所以没有一上来放一张流程图（平时写PRD经常上来一张流程图），而是先说分类，是想说明一个很重要的事，那就是做风控的PM一定要懂得业务，下文会给出这么说的原因。
（1）根据进件的渠道分类
A、自营
指的是借款人通过本公司的网站、移动端、客户端、H5等渠道进行的借款。
这类进件的风控全程由本公司负责，PM可根据进件的资产类别（信用贷、车贷、房贷等）来设计风控流程。包括需要借款人提供的基础信息和资料，需要引入的第三方征信数据，需要建立的风控模型等。
这类进件的风控规则通常会比较复杂，一方面是为了保证资产的质量，另一方面也能更加全面的收集借款人的数据。
B、第三方
指的是借款人通过第三方机构进行贷款申请，再由第三方机构将进件提供给本公司。
这类进件的风控，有很大比重是对第三方机构的风险管理能力进行审核。在和机构对接前，会有专门负责准入机构审核的同事，上门对机构进行审核。审核的内容包括机构的财务报表、机构的风险隔离能力、机构提供的资产类别和质量、机构的风险管理能力、抽查机构历史进件的真实性及坏账情况等等。
这类进件通常来说本公司风控系统的设计要比对自营资产简单。一方面是因为第三方机构已经对提供的资产进行了审核，另一方面是因为部分借款人的基础信息和资料（资产证明、收入证明、居住证明等）已经由第三方机构收集并提供。
（2）根据资产类别（产品类别）分类
A、信用贷
指的是对借款人的信用进行评估，以此来判断是否提供给借款人一定金额的借款。
因为没有任何抵押物，全凭借款人的信用，所以会对借款人进行大量的信息收集及数据分析，通过较为复杂风控流程来对借款人进行打分（评分卡模型），以此来确定对借款人的授信金额。
收集的信息包括：
?基础信息类：姓名、身份证号码、性别、年龄、工作单位、家庭住址、学历、婚姻、子女情况等；
?资产信息类：车产、房产、社保、公积金、收入等；
?负债信息类：车贷、房贷、信用卡、其他贷款、未还清贷款的笔数和金额等；
?特殊信息类：央行征信报告、芝麻信用积分、手机通讯录、运营商信息、活体检测等；
B、抵押贷
指的是对借款人提供的抵押物进行定价，以此来判断是否提供给借款人一定金额的借款。
因为笔者没有具体做过这方面的业务，所以不在此做介绍。
（3）对于借款人分类
不同类型的借款人，各有各的特点。比如农村人口，很多人是征信白户，没办法通过征信来确定个人信用情况。再加上很多农产品都是靠天吃饭，赶上收成不好，就算借款人有还款意愿，也没有还款能力。所以对农村人口的尽调，更多的倾向于家里的人口、婚姻情况、所从事的农作物的种类等。
比如：公务员，是一群有征信、收入稳定的人，如果能提供工作单位的证明，很多机构都愿意给公务员提供借款。再比如：普通的城市白领，对于他们的审核流程的严格程度要高于公务员或者企业高管这类人群，对他们的授信额度、授信期限等也会低于后者。
总之，只有对各类的进件有充分的了解，才能以此为根据设计出不同的风控流程，满足不同的业务需要。
2. 风控系统流程图
   为了不暴露公司真实的风控系统，所以画了个大致的流程，流程中包含了风控系统的一些必要元素。省略了借款人注册、完善信息、绑定银行卡、开户等前置流程，直接进入风控系统审核流程。设计真实的风控系统时，还需要结合公司的实际情况进行调整。

3. 系统中各部分的作用
   （1）前置系统
   可以是本公司的系统，也可以是第三方机构的系统。主要作用是向风控系统推送进件、接收退回的进件并提供修改借款人信息及资料的窗口。
   （2）准入规则
   风控系统的第一道关卡，作用是通过一些基本的检验规则，来拒绝大量不符合基本要求的进件。目的是降低审核人员的工作量和风控系统的成本。比较常见的准入规则有：年龄判断、地域限制、行业和职业判断、收入判断等。
   （3）反欺诈模型
   A、什么是反欺诈模型
   反欺诈模型是风控系统的标配，我个人认为，没有反欺诈模型的风控系统，不算是真正的风控系统。
   反欺诈模型是一堆风控规则的集合，是将各种规则通过不同的分支、不同的优先级、不同的权重等各种运算方式进行配置。模型中聚集了大量的数据（本公司的、数据商的），可根据不同的业务场景和产品类型（进件类型）进行设计，对于进件的风险判断起到了很重要的辅助作用， 是风控模型的核心。
   B、反欺诈模型数据的分类
   反欺诈模型通常是由几部分组成：
   .本公司收集的借款人黑名单，多为在本公司借款逾期不还或还款状况不好的借款人；
   .本公司从其他网站爬取的数据（法院失信被执行人数据、其他公司的黑名单等）；
   .第三方数据商提供的数据（个人基本信息、历史借贷记录、运营商数据、法院/公安不良记录等）。
   C、反欺诈模型流程图

D、反欺诈模型设计时遵循的原则
绝对风控规则与相对风控规则：
?绝对风控规则：指的是那些命中后结果必须是被拒绝的规则，命中这类规则会终止风控流程，例如之前在本公司借款后不还，命中了本公司黑名单的，或者是有案件在身还没有销案的；
?相对风控规则：指的那些相对于绝对风控规则而言没有那么严重的规则，不会对借款人未来逾期风险产生明确指向的规则，通常命中这种规则风控流程不会马上终止，可采取人工介入审核来判断风险；
成本原则：
?自有规则（自有数据）优先于外部规则（数据商数据）运行；
?无成本或低成本（自有数据或收费较低的数据）的规则优先于高成本的规则运行。
效率原则：消耗高性能的规则需要放在最后面运行，类似于需要从其他网站爬取数据并对数据进行二次加工处理的规则。
便捷原则：
?模型中的规则可根据需要进行开关，非必须的规则可随时进行打开和关闭；
?模型中的规则可根据进件的类型不同进行组合，即每一项反欺诈规则都是可配置的；
?模型中的规则的参数可进行灵活配置。
命中反欺诈规则的处理结果：
?未命中：直接进入下一步风控流程；
?命中绝对风控：风控流程终止，做拒件处理；
?命中相对风控：继续风控流程，然后进入人工审核；
?特殊情况：在反欺诈模型中接入了新的规则或调整了规则的参数等情况，虽然会在做完测试后再去生产环境进行调整，但还是需要在命中这些规则时对进件做标记，然后人工介入审核；
（4）评分模型
A、什么是评分模型
评分模型是根据借款人的历史数据，选取不同维度的数据类型，通过计算而得出的对借款人信用情况打分的模型。不同等级的信用分数代表了借款人信用情况的好坏，以此来分析借款人按时还款的可能性。
B、评分模型和反欺诈模型的区别
评分模型和反欺诈模型的区别在于，反欺诈模型是给出对借款的直接结果（通过/拒绝）并给出命中的规则说明，而评分模型是更加细致的给出了借款人的信用评分。通过信用评评分，可以确定借款人的信用情况，进而不但能确定最终结果是通过还是拒绝，还能给出本次借款的审批额度，对借款人进行循环授信。
C、评分模型的处理结果
?分数大于特定某一分值：可以认为这类的借款人信用情况很好（逾期的概率非常低），进件不需要经过信审人员审批，直接通过；通常这一分值经过计算后会设置的很高，能达到这一份值的借款人占比很小。
?分数在某个区间时：在这一区间的进件，都需要经过信审人员审批。
?分数小于某一特定分值：可以认为这类的借款人信用情况很差（逾期概率非常高），进件不需要经过信审人员审批，直接拒绝。
（5）人工信审
A、信审人员的角色
?普通信审员（初审）：通常负责进件的第一层审核工作，是直面大量进件的人；
?信审组长（复审）：通常负责安排自己这组的信审工作，会对初审通过的进件进行复审；
?信审主管：通常对各组的信审工作进行统筹安排，制定信审政策，对审核结果的争议进行判断；
?复核员：会对审核完成的进件进行抽查，并指出其中审核有问题的进件；
B、信审人员的工作内容
.对命中相对风控规则的或者是新增加的规则的进件进行审核；
.对于处在需要审核的评分区间的进件进行审核；
.对借款人进行电核；
.对借款人的资料进行审核，必要时需要联系借款人提供补充材料。
4. 几个细节问题
   前面说的都是风控系统大框架的流程，其实在系统设计中，还有很多细节问题，下面就拿其中三种说明一下。
   （1）进件开关
   风控系统上线时，需要将上游系统推送的进件拦截住，这时候需要一个进件池。将上游系统推送过来的进件储存在进件池中，待系统上线完成后，再开始向风控系统推件。刚开始推送可少量推送，待在生产环境验收无问题后再放开开关。
   进件池需要能够向风控系统推送不同类型的进件。例如：对某个类型的进件进行了反欺诈模型、审核页面展示等调整，这时候需要单独向风控系统推送这类进件（拦截其他类型的进件），待在生产环境验收无问题后再推送所有类型的。
   （2）模型重启
   风控系统在调用模型时，有小概率会出现因为网络、性能、超时等原因而调用失败，这时为保证流程能够进行下去，需要设置重启机制。确保系统在一定时间内未接到模型的返回时，能够自动或者人工进行重启。
   （3）缺省值设置
   在模型的设置中，需要有对缺省值的设置。例如在模型运行过程中，若某类数据没有返回结果（可能查询失败也可能没有数据），则这时候也需要给出对应的分值或处理结果，这种结果就是对缺省值的返回结果。
   四、总结
   归根结底，风控系统是对数据的运用，是通过各种渠道的数据来对借款人的信用进行评估，进而设计出符合不同类型产品的模型，再用大量的进件去检验模型的效果，不断地完善模型。上述只是基于自己对风控系统的理解，讲了一些基本的设计情况，具体情况一定要结合实际的使用场景进行设计。
   受篇幅限制，很多问题都不能展开来谈，例如审核人员负责的进件分类和权限控制、进件的分单系统规则、反欺诈模型的后台配置设计、评分卡模型是怎么设计的等等，今后如果有时间，会写出来分享给大家。
   作者：打酱油的熊，公众号（打酱油的白熊）
   本文由 @打酱油的熊 原创发布于人人都是产品经理。未经许可，禁止转载。
   题图来自 Unsplash，基于CC0协议。返回搜狐，查看更多
   声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
   阅读 (2260)
   不感兴趣?投诉
   本文相关推荐
   ?金风智慧测风?
   ?金风行业内地位
   ?互金风控论坛
   ?金风科技官网
   ?金风2.0mw风机参数
   ?金风+一带一路
   ?金风可以招聘2018行程
   ?金风园区微电网
   ?金风投资控股有限公司招聘
   广告
   我来说两句
   0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:05?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4620

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 16:7

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

取代滴滴？哈啰顺风车上线不到一个月再遭打击，三大硬伤值得思考
科技蜀黍?·?02-13 22:3516

小米9和荣耀V20很难二选一？听了“修手机”老板的意见，明白了！
小梦的魔法棒?·?02-22 15:20?
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 16:7

德国电信波兰业务CEO：若不让华为参与 波兰5G或将延迟
参考消息?·?今天 00:20134

5G折叠屏手机2月24日发布，华为的底气在哪里？
量子位?·?02-22 18:02136

华为Mate X明日发布：对外折叠屏+5G，网友：实在是买不起！
科技小李?·?昨天 10:42147

华为“脱光外衣给世界看”，英国终于认可：华为5G风险可控
核舟POST?·?02-19 14:161
拥有香港身份,商务往来便利,保留大陆国籍,一人移民全家三代均可移居,福利的待遇与香港公民无差别！
?广告?·?今天 16:7

雷军被打脸，小米9游戏居然抗不过3小时
电商热点观察?·?昨天 17:27?

华为P30系列将于3月26日发布，价格基本确认，网友直呼伤不起！
科技小李?·?02-22 20:59?

滴滴对手来了 哈啰顺风车在全国300余座城市正式上线
随手科技?·?今天 09:19179

华为mate20pro对比苹果XSMAX：差距实在太大
差评数码?·?02-11 16:0023
同样的虫草，不一样的营养，虫草好不好，吃一根就知道了！
?
?
?
?
?广告?·?今天 16:7

滴滴巨亏109亿后，裁员2000人,补偿方案已出，员工争着被裁
互联网架构师?·?02-22 08:19?

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

滴滴亏损109亿不是没理由，司机端抽成30%，依然还补贴113亿！
电子商务实战专家?·?02-13 22:30223

科技标杆荣耀遭遇质量危机？V20屏幕发黄、Magic 2充电口开裂
互联网手机时评?·?昨天 18:54?
?广告?·?今天 16:7

小米MIUI将迎重磅升级：手机使用18个月不卡顿，防系统老化
泡泡网?·?今天 14:05?

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10?

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24171

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11162
2019年新品平板电脑仅598元

?广告?·?今天 16:7

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00417

别急着买小米9，安卓市场大变天，骁龙855＋12GB＋44W
士豆不土?·?今天 09:41?

华为MWC2019直播几点开始？华为MWC2019大会直播的具体时间
手机小师妹?·?02-22 14:12?

华为Mate20：再见了！
科技小李?·?今天 00:10173

海参怎么泡发才是正确的，一招教你快速泡发10几倍！
?广告?·?今天 16:7

苹果跌下神坛，iPhoneXR跌破4500，还买啥小米9
士豆不土?·?今天 09:39?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

特朗普正面回应来了！"不封杀"华为！还将考虑撤销刑事指控！
芯智讯?·?昨天 13:456

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 16:7

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 16:7

2019MWC国产机5G博弈 OPPO小米抢华为风头
蓝鲸TMT?·?今天 13:12?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08262

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43158

荣耀高管质疑小米9超强续航成绩：违反常识，对科学没有敬畏心
数码评价?·?今天 07:25224

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 16:7

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3421
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:2773

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:0390

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26544
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 16:7

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58379

1999元的小米9 SE也用4800万摄像头，雷军的阳谋是什么？
数码评价?·?今天 07:4227

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14?
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 16:7

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26126

小米9将在2月26日正式开售，全网预约量却早已突破百万！
叽歪数码?·?今天 12:42156

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

硬核担当！华为首款5G折叠屏手机配置/售价曝光，惊喜不止这些
泡泡网?·?02-22 13:28

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 16:7

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

工信部曝光华为P30 Lite部分参数
IT之家?·?今天 06:45

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11

中国顺风车顽疾，能否从欧洲找到“解药”？| 欧洲观察
钛媒体APP?·?今天 08:54

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

百度的冰与火
阑夕?·?昨天 23:45

人人车李健：没有盈利的原因是员工没有尽职尽责；巴菲特股东信：伯克希尔Q4净亏损约254...
i黑马?·?今天 08:44

暴风影音CEO：硬件的免费逻辑失效了吗？
智酷科技?·?今天 09:10

FTC：那个有魅力的Facebook陌生人不爱你
MiHomes?·?02-15 10:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

智能媒体：未来变革的5个方向
智酷科技?·?今天 09:11

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

华为P30系列最新渲染图来袭 超强四摄旗舰你心动吗？
手机中国?·?今天 06:05

行业：2019年游戏行业的6个趋势
酷玩儿?·?今天 09:03
已经到底了

广告

热门图集
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
野狼被塑料罐卡住头 高温中挣扎3小时
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
??
?麦田藏北宋钱庄 团伙盗挖4吨古钱币
?化学老师走红 讲解"恋爱中的化学"
?高晓松个站成立 应援图让人不敢认
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7948万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
广告

24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7948万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

写文章注册登录
?首页
?下载App
?
窗体顶端
?

?
窗体底端
?
×
广告
简述互金帐户设计
?
40岁前的凯撒?关注
?0.1?2018.01.10 21:01*?字数 4233?阅读 536评论 3喜欢 7
这篇本来没有计划写的，但，由于某友的要求且考虑其正在从事这块业务，所以，奋笔疾书，写上一发。
声明: 本人虽然是在支付领域挥洒热(ban)血(zhuan)，但是，互金并不是主业，且不同受众群提供的产品和服务还是有很大差别的，所以，只能从较为宏观的层面谈谈互金账户设计的事儿。
先说一个大概
互金行业涉及的行业有6个大方向：三方支付、P2P、大数据金融(类似花呗，白条等，众筹等)，信息化金融机构，和互联网金融门户。但是，从账户角度来说，个人觉得大同小异，所以，本文拿大家最为熟悉的p2p作为案例。
p2p的分类：
1. 纯线上，线上理财，线上借款；
2. o2o：理财端线上，资产端线下，线下主要负责风控、催款等；
3. 债权转让模式：p2p流行的定期模式
   p2p是互金的一个分支，而贷款对于大家来说是比较了解的，有支付、p2p、花呗、微粒贷、京东白条做的信用贷的产品，还有其他一些东西等等形成的在互金行业的一些特色；
   纯线上的模式来说，企业通用做法是：
   线上获取贷款，线上理财操作；
   对于线上线下结合的方式，从国家对金融监管来说，理财端只能从线上发展；对于资产端，可以从线下进行风控和审批、或者催收；从优质资产考虑和统计数据表明，线上线下结合的模式比纯线上模式坏账率要低很多(我X贷网的朋友分享而知)；
   下面是债券转让模式。这个本人其实不是非常的懂。了解到的是，这一块主要在理财端，以定期和活期为主。最早买p2p以散标的模式，现在已经很少了。目前主要是债权转让的模式做定期和活期，而且以定期为主，活期因为监管被下架。
   从p2p的整个业务链条看，两部分：资金端、资产端。
   资金端。这方面主要是理财为主，以线上为主要方式，合规。资金端主要是理财人以散标、活期、定期等几种方式进行投资。理财人登录p2p平台，选择理财产品，有散标、活期、定期，目标基本以定期为主，散标目前比较少，原因是散标在点对点情况下，借款人的时间太长导致回访过高 。活期，比如各种宝，由于不合规，各平台正在换其他方式。
   定期。按照1，3，6，12个月这种模式比较流行，大家在在各大平台都有接触； 根据你选择的产品进行投标，以合适的身份进行匹配后，在满标后进行放款。
   资产端。本人个人的理解是，这一块比较复杂。
   p2p平台通过门店、电销、线上推广、资产购买等模式发展，经过相应的进件，审批，合格后进行签约，线上的话流程比较简单，线下就比较复杂，主要是按照贷款产品的额度进行区分。资产签约后，需要上标与理财人进行匹配，然后才能放款，后期按还款计划进行还款。
   p2p业务类型
   据本人不完全观察，业务流分为：充值，投资，红包，赎回，放款，提现，还款，代充值，代偿，代扣（还有其他的欢迎补充）
   充值。分为理财充值和借款人充值。对于理财充值，后期购买哪些产品即可理解为是投资了。购买类型是定期、活期还是散标；对于借款人充值，则目的是为了进行还款。
   红包。p2p平台竞争已经是非常激烈了，所以很多平台会做活动；如注册之后就送优惠券、体验金和代金劵等一些营销活动方面的推广， 对于业务活动都会有资金投入的，涉及到后期的业务处理；
   赎回。投资赎回，涉及本金和利息；
   放款。标的满标之后才能向债权人进行放款；对于提现可能会有余额的提现，剩余多少提现金额；
   还款。对于借款人来说，有还款方式和还款业务不同。怎么理解？比如，蚂蚁借呗，是线上还款方式；而有些传统业务比较多的p2p公司，可能会有门店还款、代扣(代收)或者对公的还款方式；
   代垫。这块解释了为什么p2p要接支付公司通道的原因。因为p2p有支付牌照的很少，基本上需要通过支付平台或者银行来走；早期，支付平台一般选择T+1结算，而部分是T＋0，因为费率比较高，原因是，T＋0提现是支付公司代垫，然后在T＋1支付公司自行和银行结算；
   代扣。对借款人银行卡进行定时扣款，比如买房公积金贷款。另外，公积金还款也是以代扣模式进行；
   "凯撒，你侃了半天，还是没有提到账户...”
   “别着急啊朋友，快了"
   凯撒这里再强调一次，为什么要说这么多业务的事情，因为搞清楚了这些，我们聊账户才比较顺当。
   账户？账户！
   是的，聊这一块，起点必然是资金流。资金流涉及的账户如下
   投资人结算户
   投资人债权户
   借款人债务户
   借款人结算户
   我们从一个正常的投资放款流程来看，张三（投资人）向结算户充值、然后进行投资，资金进入债权户（如果，投资失败，返回至投资人结算户）；接下来，平台通过撮合满标后放款到借款人债务户，在债务户进行各种费用的收取后放款到借款人结算户或者银行卡。反之亦然。
   对账务来说，需要关心的只是各个账户对象，资金在各个账户流入流出，即资金转移的过程；至于资金从哪里来的，资金应该属于谁，这些不在账务处理范围内；对于借款人来说，一个还款的过程是：
1. 借款人通过充值或者代扣的方式进行还款到结算户，
2. 结算户根据账单把还款金额冻结到债务户，通过债务户还款到债权人（张三）的债权户。
   假如有复投，债权人（张三）进行复投到其他标的；假如没有复投，就赎回到结算户，债权人（张三）可以选择自己提现或者进行其他标的的投资。
   聊到这里，引出了一个问题，那就是—财务处理和会计处理的差别
   账务处理
   对于账务处理来说，是根据账户的设置进行流水的处理，以收付实现制为基础。很难理解？想想支付宝的账单，是不是清楚很多？然后，根据流入流出的方式更新余额。
   对于会计处理来说，是以科目为主，以权责发生制为基础，资产、负债、所有者权、损益、成本、共同类进行复式记账。
   咱们拿充值为例，这样比较好理解。
   从账户的角度，是以收付实现制为基础的；对于会计处理来说，是以科目为主，以权责发生制为基础；收付实现制法则设定相应的目标账户以资金的流入、流出和余额为标准的，只是解决流入和流出；对于会计科目来说，解决的是为流入这笔钱来自哪里，流出这笔钱要去哪里，要有一个权责确认的过程；
   所以，针对用户充值这个场景，对于账户来说，只是一条资金流入，多少钱、余额多少；对于会计科目来说需要分全面考虑：
1. 对账前，跟支付机构（或银行）进行确认，有一个待清算款；
2. 在 T+1，对帐流水出来后，需要进行对账；（支付公司但凡有提供t+0，对账的事情支付公司T+1找银行清算了）
   3.对账完成后，相当于把待清算转成应收账款；然后，这个充值场景的一笔充值记录在后台对应多笔会计分录；
   会计处理
   这地方要理解一个概念，那就是，从账务处理来讲虚拟户是解决资金归属问题，而不关心资金的存放问题。这里涉及到的有两个账户：实体账户和虚拟账户
   实体账户，即资金存放的账户，在银行，有如下三类：银行存管专户；银行自由资金专户；银行垫资账专户
   虚拟账户，即资金归属；两种：用户虚拟存管账户（投资人账户，借款人账户，合作机构账户，担保机构账户）；平台虚拟存管账户（收入账户，分润账户，代偿账户，代充值账户；派息账户）
   实体账户是干什么的？
   是解决资金存放问题的，与虚拟户成对应关系。从会计处理讲，实体户属于资产，虚拟户属于负债及其他。而实体账户和虚拟户组成，的角度来说，需要跟银行有一个开户的过程，用来解决资金存放的问题（是存放在银行存管户、银行自由资金户还是银行垫资专户，这个要看具体情况而定）；对于虚拟户来说，钱是从投资人、借款人或者居间人一方来的，是属于收入的还是营销的，这个也是要具体情况而定。
   小结一下，对于实体户，只关心资金存放；对于虚拟户（比如说投资户、借款户还有收入户），关心资金归属。举例：在平台银行账户存入一笔钱，是属于投资人还是借款人；从实体户的角度来说是资产，从虚拟户的角度来说是负债（属于平台欠投资人／借款人的钱，对于平台来说是负债）。
   鉴于p2p的特殊性，不止有收入的问题，还会有营销款支出、代偿、代垫、分润等有相关业务，对于没有按时还款进行代偿代垫等这些内容要说估计篇幅太长了，和这个账户设计没有太大关系。
   财务处理和会计处理

图片发自简书App
从四个方面（交易，账务，会计，对账）同一笔交易所涉及到的账务处理、会计处理、对账等事宜。从交易处理、账务处理、会计处理和对账处理，形成一个完整的企业数据流；
我们拿放款为例：
交易处理：放款就是一笔支付；
账务处理：从债权户到债务户，从债务户到结算户然后到结算户的银行卡，同时还涉及到收益户的处理；
那么，为什么有这么多处理步骤? 我们不妨站在平台角度：
1. 需要在放款的时候才确认从债权到债务的处理；
   2.在债务处理的时候，需要把钱放在借款人债务户，并相应把钱划到结算户和收益户（会收取一定的费用）；
3. 针对部分客户有需求是打款到银行卡，所以平台需要记录从债权户到债务户、债务户到结算户、结算户到银行卡的这条流水处理过程，以保证账务流水处理的一致性；
   会计处理：比如贷款，债权户到债务户的确定，会记待发放款项；待发放款项放款，放款金额和合同金额会有差距，所以，放款金额会单独形成待清算目录，假如T+1账单来了，形成清算，对于收益户来说计入收益；
   对账处理：支付流水和确认银行流水对账以后，形成应收账款；然后对于结算来说，形成相应的银行余额进行结算，并形成结算的单据凭证；
   下面我们从财务处理角度去看这个问题：

图片发自简书App
从业务架构上，业务端统一对接支付平台进行现金的收支转等。支付平台在完成支付过程中，同步数据到账务管理和清结算平台。账务管理和清结算在数据处理后，传递到会计处理。这一个过程说起来挺简单的，但是实际由于公司自身发展不均衡，很多公司业务平台先于支付平台建立，这样的话就需要对各条业务线进行梳理，进行标准化设计，对业务系统查缺补漏，统一业务流程和接口方式。
从结构设计上，支付负责进行现金账务管理负责资金的变动，清结算负责对账，进行账实核对，会计处理负责复式记账(啥是复式记账，自行百度吧)，试算平衡及日切等等。
总体流程是：支付订单向账务管理写入账务的流水数据，向清结算写入清洁算的流水数据，并在清结算的过程中进行对账处理，这样从系统设计上来说两边互不干涉。会计处理分别获取账务管理的数据和清洁算的数据，这样分别获得交易的确认和账务的确认，在会计处理这块儿相当于两个合一。
另外，业务的发展速度会快于系统的整体规划速度，这样会导致同样的功能点，同样的业务处理，在不同的系统处理方式不一致。没有形成一个的统一系统的处理。然后从设计的角度上，不仅要考虑系统架构的适用性方面，而且要考虑公司逐步实现的步骤。
附：还款
这里多说一句还款的事儿，因为上图画得比较差
还款涉及到的资金项目有本金、XX费、利息；这些类型还到借款人账户上，这些钱会有几个步骤：从本金还到投资人债权户上，xx费放在收入账户和分润账户，利息放在派息账户；相当于还款部分，异地还款在债务户里面的资金处理是不一样的，流向自然也就不一样了，那么，相应的后台会计处理也就不一样了。（xx费，可以理解为车贷行业）
以上。
小礼物走一走，来简书关注我
赞赏支持
?底稿
? 著作权归作者所有
举报文章
关注40岁前的凯撒
写了 114565 字，被 222 人关注，获得了 151 个喜欢
我是凯撒，是一个从业第三方支付的小咖。对互联网，电商平台，产品，互联网金融等方面略有所见。 说，是为记录，记录即为思考。写，是思考的闭环。这里不敢说有干货，不敢说有洞见，不敢说有真理，有的是一种思考问题的角度。思与辩，没有"形"的局限，有的是"质"的局限。
喜欢
?
7
???更多分享

窗体顶端

登录?后发表评论
窗体底端
3条评论?只看作者
按时间倒序按时间正序

?
40岁前的凯撒?作者
3楼 · 2018.04.19 19:17
想看修正版移步我公众号: 凯撒说
赞??回复

?
柳十七儿
2楼 · 2018.02.24 18:21
我是入行互金产品一年的产品汪一名，楼主的业务流梳理得很好，看完后感觉清晰很多，感谢了
1人赞??回复
40岁前的凯撒：
?@柳十七儿?谢谢支持
2018.02.24 20:31??回复
?添加新评论
?
被以下专题收入，发现更多相似内容

Design2b

推荐阅读更多精彩内容
我的身体为啥别人会羡慕
我是一花甲老者，身体功能正常。身高一米七；四肢无疼痛疾病，走路轻快；戴一百度花镜看书写字皆可，一般不戴眼镜；血压基本正常{90——120）之间；体重一百三、四斤；食欲好，吃啥啥香；粘枕即睡；记忆力稍差；听力无减退；思维敏捷，预测及判断能力强；牙齿无松动、牙没疼过，啃骨头，吃花生都行；嗅觉灵，近距离香臭都分得清；头发自然白；面色红润；上楼不喘；长年很少感冒，感冒后多喝水不吃药或少吃药，一周就好；若不小心碰破皮，包扎一下，几天自癒。身体大致就这样。 对于我这样的身心状态，自我感觉很好，好多人都羡慕我！我为啥有这么好的身体？我归纳总结有如下几个因素： 一、心态平和。天塌事不急不躁，欲望低，看钱...
?风云叟

学了这么多年的英语，一个公式全搞定？！像学母语一样学英语广告

散文 || 一滑倾心
文 / 淡水泉 临近春节，天气愈发的冷，人的食欲也随之莫名地好起来。黄昏时，接到香港曙枫律师的电话：“我和陈维在台江上下杭的民国风情街，你若是方便，开车过来带我们去尝尝当地的特色小吃。”虽说福州有意思的小吃很多，但还是建议他们先随我去试试达道路上人气最旺的“依强牛肉滑”。 达道牛滑的创始人叫林卫民，早年是福州电机厂的磨具工人，业余喜好琢磨厨艺。六十年代末，就跟当厨师的亲兄弟一起合伙开了这家店。后来老人家去世，又交到了儿子林增强和媳妇江雪英手里，但手艺却是分毫不差地传承了下来。 做牛滑，最重要的就是选牛肉。黄牛肉的味道比水牛肉要好，哪里的肉都不如腿肉来得好吃，来得嫩。所以，他们只从闽侯甘蔗...
?淡水泉
还乡过年
据报道，近几日，在亚洲东部进行着一场全球最大规模的人类大迁徙活动。这次迁徙几乎动用了目前所有形式的交通工具，大到汽车、火车、轮船、飞机，小到三轮、摩托、自行车，在浩浩荡荡奋不顾身的庞大队伍面前，任何势力都显得苍白无力难以阻挡。从世界看，各个国家都有为数众多的群体参与其中，纷纷从四面八方向这一地区聚拢；从局部看，这一地带的人群更是蠢蠢欲动，几近失控，有南来北往的，有东西奔走的，这种前赴后继、不计成本、杂乱无章、繁忙穿梭的恢宏景象让各国生物学家都无比困惑，从学术的角度绞尽脑汁也无法解释清楚。 图片发自简书App 其实，这个重大事件的每一名参与者，内心却是无比笃定，目标也是再清楚不过。过大年，...
?水宜
接纳别人的友谊，才能拥有友谊
敏敏是一位正在读初二的女孩，外表文静，说话细声细气的她，最近却遭到了几乎全班女生的孤立，为此，她痛苦万分，想要转学。 “ 很理解你现在的心情，若是我也会很难受的。” 我说道。 泪水顺着她小巧的鼻翼淌了下来，敏敏点了点头，哽咽着说: “嗯，我昨晚都做噩梦了，梦到漆黑的夜晚，我一个人走在路上,路灯一下子灭了，我呼喊着, 却没人理我。” 处于青春期的少男少女非常重视同伴关系，这既是他们情感的重要支撑，也是获取信心的重要途径，因此，人际关系的困扰对少男少女的影响很大。 而敏敏却遭到几乎全班女生的孤立，这对她心灵的打击可见一斑。 “ 那你觉得她们为什么会孤立你呢? ” 我问道。 敏敏不说话，低头看...
?暖暖育儿家
迎雪之想
原创 / 沐心怡然 2019年1月30日这一天，算是今年冬天正式下的第1场雪。 就在这几天，一直唠叨总不下雪，对人的身体健康也好，对农民的庄稼地也好，没有任何好处的时候，雪竟然来了，这可是人们盼望已久的。 自然规律，四季轮回，春花夏荷，秋菊冬雪，这些东西少一样都不行，冬的象征有雪的点缀，才能算上完美。 雪之洁白，晶莹，纯净，高雅，飘飘洒洒，在文人墨客眼中可谓美不胜收，不知是谁起的名字“雪花姑娘”早已成了孩子们印象当中美的象征。 雪的世界，美丽的世界，这是人们赖以生存必不可少的东西，也是多少人在冬季来临时，心心念念的盼望和崇拜的偶像啊！冬季没有雪，是人们心中的失落，更是每一个具有童真童趣人...
?沐心怡然
赵某某被控诈骗百万无罪案辩护概况
穷尽手段打出综合拳进行全面辩护 ——赵某某被控诈骗百万无罪案 承办律师徐宗新简介 承办律师孙立波简介 【案件概况】 《起诉书》指控：2007年9月28日，鲁某向许某某借款人民币68万元，约定借款月利息为3分。后鲁某在2008年因违法犯罪被处理，期...


?杨昆北京靖霖刑辩
《辩护人认为》（第二辑）无罪篇之案例选
穷尽手段打出综合拳进行全面辩护 ——赵某某被控诈骗百万无罪案 承办律师：徐宗新 承办律师：孙立波 【案件概况】 《起诉书》指控：2007年9月28日，鲁某向许某某借款人民币68万元，约定借款月利息为3分。后鲁某在2008年因违法犯罪被处理，期间没有归还本金也未支付利息。...


?杨昆北京靖霖刑辩
银行核心系统概念入门简介
一，银行核心系统是什么? 2011-01-03 csdn 银行核心系统是什么 银行核心系统的英文原意CORE Banking, CORE其实不是“核心”的意思这么简单，它的全称是: Centralized Online Real-time Exchange （集中式在线实时...


?大圣2017
P2P入门概念
P2P：person-to-person（或peer-to-peer）是一种将非常小额度的资金聚集起来借贷给有资金需求人群的一种民间小额借贷模式。 P2P类别 银行系 银行系P2P的优势主要在于：第一，资金雄厚，流动性充足；第二，项目源质地优良，大多来自于银行原有中小型客户...


?大道至简已被使用
??
我的天那


?回到家合适的
爱，不言
文/夏之屿 二郭是班上一个人缘很好的女生 特别是对于我这样不善言谈的人来说，她便是我一直以来的楷模。每天的我，以静默示人，偶尔与同学说话，却也是必要的日常交流或是被逼无奈。我总是认为自己会与世隔绝，似乎周围再怎么吵闹，我也能保持沉默，守住心底的那一份安宁。因此，我没有过多朋...


?夏之屿
夏天的马桑
小城四面环山，平缓绵延的连成了一片，山中树林层叠，很多高大茂密的树木，一年四季都是绿的。夏天阳光强烈，雨水丰富，树林里就结出很多野果来，静静生长，静静落地，也少有人来摘。 公司电视台停车场旁，就有两棵桑树。长了很多年，苍翠挺拔繁密，遮住了大片的天空。记不得每年会有多少附近养...


?璐晓源
你需要知道的Android拍照适配方案
转载自http://blog.coderclock.com/2016/05/22/android/你需要知道的Android拍照适配问题 说起调用系统相机来拍照的功能，大家肯定不陌生，现在所有应用都具备这个功能。例如最基本的，用户拍照上传头像。Android开发的孩纸都知道...


?mark2Li
微信小程序开发flex布局
小程序的布局只要有两种，一种是用flex来做布局，还有就是用相对定位和绝对定位。相对定位和绝对定位这个见得比较多，比起flex麻烦很多，坚决舍弃了，总结一下flex布局的资料，留备查用。如有不足，希望各位道友助攻。 不管是APP开发还是前端开发，最恶心最头痛的就是对各种屏幕...


?WangK_Dev

?首页
?
?分类浏览
?
?学习提升
?
?活动讲座
?
?问答
?
?年费会员
?
?书单
?
?百宝箱
投稿?搜索?
APP
?注册 | 登录
聊聊互金公司投资端的会员体系设计

点融设计中心??订阅专栏
点融设计中心DDC
2017-04-10?1.4万?121?17
产品小白专属，10周线上特训，测、练、实战，22位导师全程带班，11项求职服务，保障就业！了解详情
释放双眼，带上耳机，听听看~！
00:00
00:00
知易行难，还是多实践吧！

一、会员体系的目的
为什么要先强调目的，因为不同的目的会有不同的会员权益（激励措施）与之匹配。曾听一些互联网同行抱怨，是老板要做会员体系（抱着人有我也要有的心态），我怎么知道目的是什么？！那么作为一个下属，其实可以想想，既然会员体系是一定要做的（老板说了），那我们可以怎么利用这个会员体系帮助我们达到产品上的目标？
也许你会说，互金公司的投资端做会员体系，目的无非就是促进投资嘛！
这是一句很正确的废话。“促进投资”是个大目标，由此可以分解出很多小目标：
1.促进新注册用户快速转化成投资用户；
2.挖掘用户投资潜力，促进用户追加投资，向较高净值用户转移；
3.提高用户留存，尤其是高净值用户的留存；
4.提高流失用户的回流；
5.……
二、会员体系与积分体系
会员体系与积分体系是2样东西，但我在沟通中发现很多人经常混为一谈。总的来说可以分为几种模式：

三、会员体系设计思路
这是我在实践中总结的一套相对普适的思路，有不同想法欢迎交流。
Step1. 明确会员等级划分依据
既然要分级，自然要明确分级依据是什么；而要明确划分依据是什么，又要先知道会员体系的目标是什么。前面已经列举了各种目标，概括来说主要是：提高投资额、提高留存、流失召回。一般而言，有以下几种划分依据：
?在投金额：根据用户当前贡献值划分等级，但不会考虑历史贡献值，对一些临时撤资的老用户而言可能不公平，也不利于促进流失老用户的回流。
?累计投资额：对老用户总体而言是更优待的划分方式，而且鼓励新用户提高投资额，这样也能迅速冲上高等级。但当投资产品以活期/短期为主时，用户可以通过提高投资频率的方式增加累计投资额（比如同样1万块在1个月内反复投10次，累计投资额就刷到10万，实际对平台的贡献值只有1万），对平台而言是不利的。
?活跃度：如果要促进用户活跃，可以考虑这种划分依据，但是用的不多。衡量活跃度的指标有很多，比如登录频次、论坛发帖数量（不少互金平台都有论坛）、做任务的数量等等，如果想综合考量可以引入“成长值”的概念，定义每项活动获得多少成长值，每个等级分别要达到多少成长值。
最终采用的划分依据可能有多种，这要根据目标和平台特性来定，但有一条原则：要让等级划分看起来简单直接，以便用户能快速了解自己该怎么做才能升级。在一套复杂的会员体系中，用户可能很想升级，却不知道自己该怎么做、做多少，这样就很难起到激励作用了。举个栗子，如果用“累计收益”作为划分依据，虽然累计收益和累计投资额相关，但从用户视角来看却不那么直观。如果平台有多种产品，每种产品的利率都不同，你告诉用户说“你要累计收益达到2000块才能进入下一等级”，用户怎么马上知道自己到底该投哪个产品？该投多少钱？肯定要用上计算器开始捣腾：假如我投产品A，应该投多久、多少钱才能达到2000收益；假如我投产品B，应该投多久、多少钱；假如我同时投A和B，应该各自投多久、多少钱……相信我，用户肯定炸毛了。这种情况下，如果用“累计投资额”来划分，会比“累计收益”要来得简单直接。
Step2. 合理划分等级
什么叫合理？我来说说有哪几条“理”：
1.整个等级体系的用户数符合金字塔分布，避免出现两极分化、梨形分布等情况。这个需要分析现有用户的数据，划分出每个等级的门槛线。不要问我为什么，道理很简单，你自己想。
2.较低等级间跨度不要太大，要让用户觉得努力一下可以升级，有个盼头。
3.等级划分具有长久性，避免隔一段时间后又要重新划分一次。比如说累计投资额，随着平台的经营时间越来越长，必然会有越来越多用户达到较高的累计投资额，导致高等级用户越来越多，这时候又要重新划线，或者在原来的最高等级之上又加几个等级，这样毕竟不是长久之计。所以，要考虑好限制条件，比如最近1年内累计投资额，这样就比较有长久性。
Step3. 制定升级/降级机制
升级机制嘛好理解，无非就是系统什么时候判断用户是否达到等级条件、升级是否需要审核、达到等级条件之后多久升级、什么情况下跳级等等。降级机制又是什么鬼？很多人一听到要降级就不高兴了。有升必然有降，不然一个用户曾经投了100万到平台，之后撤资只剩下1000块，难道平台要一直用100万投资额用户的礼遇去优待这个用户吗？
在降级机制中，需要考虑用户没达到当前等级条件时多久降级，降得太快不好，有时候用户只是临时提现周转，隔不久又会有闲置资金用作投资，太快把用户降下去了用户可能就不爽，转投别的平台。所以需要分析下数据，用户的投资间隔期大概多久，如何分布。另外，降得太狠可能也不好，一个曾经投过100万的用户撤资了，我们一下子把ta打回V0，之后ta可能要重新累积自己的贡献，就像一个新用户一样。此时如果有套规则，比如说这种用户在重新投资时可能门槛更低，或者升级更快，那么在促进流失用户回流时也是比较有利的。当然这个不是必备条件，要根据平台自身情况来考虑，比如在会员等级上没有什么特别措施，但在流失用户召回的运营活动上有针对性的措施。
Step4. 确定会员权益
会员权益看上去五花八门，本质上无非2大类：利益型权益 & 情感型权益。
?利益型权益：一般要花钱砸的，比如派满减券、给用户加息、增加免费提现次数、奖励升级礼包（比如奖励3个月爱奇艺VIP会员）等等。这类权益是会员权益中的核心吸引点，毕竟在互金平台上用户都是首先奔着利益来的。在给各个等级分配权益时要考虑本文开头提到的目标，比如要尽可能地留住高净值用户，那么派投资券时可以把投资额设得较高一些，投资期限设得较长一些。另外，也要考虑成本因素，按成本最大化的原则来核算成本（即假设用户把所有权益都用尽），最终的权益表肯定是在降低成本与提升激励作用之间的平衡点上。
?情感型权益：可以作为补充型权益，比如生日电话问候、节假日送小礼物（比如带公司LOGO的台历）、邀请用户来参加公司年会、组织投资理财沙龙活动、APP界面换肤、点亮头像等等。这类权益可以体现平台对用户的关怀，一定程度上满足用户虚荣心，让原本冷冰冰的投资理财行为变得更有人情味。
四、你以为设计好并上线就结束了？其实还没完
一套会员体系有没有效果，总需要衡量下吧。所以，要制定一套衡量指标，在上线后的一段时间内监测效果。
另外，一套会员体系的影响可能是非常巨大的，为了让结果更加可控，可以尝试在少数用户群中试推行这套体系，一边监测数据一边修改打磨具体规则。不然贸然全面上线，带来的后果可能是不可逆的，那时候再随便修改规则，平台就失去公信力。（有没有让你想到某些名声不好的公司？）
本文只是简单聊聊，在做的过程中才能体会到底有多少坑。知易行难，还是多实践吧！
?
作者： Gene @点融设计中心DDC，微信公众号：「微信ID：DR_DDC」
本文由@点融设计中心 原创发布于人人都是产品经理。未经许可，禁止转载。

互金公司会员体系设计积分体系
给作者打赏，鼓励TA抓紧创作！
?赞赏
?
收藏?|?121赞?|?17

点融设计中心订阅专栏
点融设计中心DDC
37篇作品
?
32.8万总阅读量
评论
窗体顶端
欢迎留言讨论~！
窗体底端
.

.
菜大饭
.
牛逼 学到了！
.
2017/09/01回复
.
您可能感兴趣的文章

每天3块钱，补齐互联网专业知识，提升职场竞争力

新零售知识体系：一致性原理

解构电商、O2O：调节交易的“杠杆”- 价格系统

工作计划避坑指南：科学制定、有效执行

社交不易，前赴后继

数据产品着眼点不同，核心价值也不同
圈子
?产品经理群+加入
?运营交流群+加入
?营销增长群+加入
?文案交流群+加入
?Axure学习群+加入

关注微信公众号

热门文章
?

?
产品经理的三板斧：思维、视角、设计
?
2019-02-20
?
?

?
B端的用户画像，其实和C端的有很大不同
?
2019-02-20
?
?

?
小红书产品分析报告：社交电商的转型之路
?
2019-02-18
?
?

?
千万别把产品做成了功能
?
2019-02-19
?
?

?
产品这五年：从被老周招进360到自己创业
?
2019-02-20
?
大家都在问
【悬赏问答】讲一个你认为正确但大多数人不同意的观点，原因是？
33个回答38人关注
过年回家，一句话介绍你的职业
59个回答61人关注
APP该不该换新年大红图标？
17个回答13人关注
厕所自动冲水的逻辑该是什么？
8个回答4人关注
【悬赏问答】有人提出停止日更“双微一抖”，你怎么看？
29个回答35人关注
【轻松一问】广告语短时间内重复3遍以上的广告，有效吗？
26个回答19人关注
【每日一问】如果你是支付宝产品经理，你会让N多人集齐五福，还是像第一次一样只让一部分人集齐？
32个回答31人关注
关于
人人都是产品经理（woshipm.com）是以产品经理、运营为核心的学习、交流、分享平台，集媒体、培训、招聘、社群为一体，全方位服务产品人和运营人，成立8年举办在线讲座500+期，线下分享会300+场，产品经理大会、运营大会20+场，覆盖北上广深杭成都等15个城市，在行业有较高的影响力和知名度。平台聚集了众多BAT美团京东滴滴360小米网易等知名互联网公司产品总监和运营总监，他们在这里分享知识、招聘人才，与你一起成长。
链接
?加入我们
?投稿须知
?意见反馈
?免责声明
合作伙伴
?
?
?
?
?
?
?
?
?
?
?
APP下载

iPhone & Android
旗下品牌:?起点学院?|?运营派?|?秒聘网?
?2010-2018 - 人人都是产品经理 -?粤ICP备14037330号-1粤公网安备 44030502001309号?版权所有 ? 深圳聚力创想信息科技有限公司
企业内训/课程咨询和合作: 18682011582
其他合作/投诉/意见反馈: 18123776760


?首页
?
?分类浏览
?
?学习提升
?
?活动讲座
?
?问答
?
?年费会员
?
?书单
?
?百宝箱
投稿?搜索?
APP
?注册 | 登录
实例分享：互金平台交易流程设计改版

高广淦订阅专栏
交互设计师，微信公众号：交互视角。
2017-07-02?1万?110?18
零基础学产品，BAT产品总监带，2天线下集训+1年在线课程，全面掌握优秀产品经理必备技能。了解详情
释放双眼，带上耳机，听听看~！
00:00
00:00
互联网理财平台，支付渠道升级，由原来的新浪托管换成富友、宝付支付。这就意味着平台需要对账户资产页面及交易流程进行重新设计。

一、项目背景
互联网理财平台，支付渠道升级，由原来的新浪托管换成富友、宝付支付。这就意味着平台需要对账户资产页面及交易流程进行重新设计。
用户在购买理财产品时，只能通过平台的账户余额进行购买。如果账户余额不足，则需要先通过第三方支付平台进行充值到账户余额，然后再重新购买产品，账户余额支付，输入交易密码后订单申请提交成功。
二、遇到了什么问题
按照产品的需求，设计了第一版的流程及页面，原流程如下：

具体页面流程如下：

上线后发现有部分用户在充值提交成功后误以为投资完成了。
客服也反馈用户有遗漏购买的情况，以为自己购买完成了，没有想到只是做了充值支付，并没有再用账户余额购买产品。
三、我是如何思考的
显然，用户不是专家，他不了解平台账户的复杂的规则。即使弹窗上面已经提示了“账户余额不足，请充值后再投资”，用户也不会花时间去研究你这句话。
那么问题来了，怎么样才能跟用户讲清楚我们的规则。
我想到了以下两点：
1.为了让用户能够完全清楚规则，就采用最笨的方法：
余额不足，不能投资，请先充值。充值成功后，如果用户想购买，主动去产品页面申购，和充值流程完全分开。这样用户会很清楚自己当前处于哪个阶段，在执行什么任务，有什么样的预期，一目了然。
但是，这种方案流程会比较繁琐，会打断用户的申购流程。该如何取舍？
首先，原来的流程引起了用户的误操作，必须得改。但是否有必要改成稍微复杂一点的流程呢？这就要看在购买产品时需要充值的用户大概占多大的比例。毕竟如果数量很少的话，采用这种方案也是可以的，虽然繁琐，但是不会出错，用户也觉得清晰、安全。
我们查看了一下用户使用账户余额购买的数量和在购买过程中需要充值支付的数量，结果显示，有62%的用户都是在购买产品过程中去选择充值的。看来还得想想其他的方案。
2.有没有什么方法能够像用户解释清楚我们的规则呢？
这样就可以沿用原来的流程，不需要使用最笨的方法了。为什么我们需要如此努力地去向用户解释流程和规则？一旦开始绞尽脑汁思考这个问题时，其实就说明了你的规则太复杂了。如果一个流程需要千方百计去向用户解释清楚，那么这就不是一个体验好的流程。
四、我是如何解决的
方案一：以下是上文提到的第一种思考方案，直接弹窗提示后让用户自己去充值入口进行充值。

那么，有没有更加简单的流程？
梳理一下交易流程的整个后台逻辑：

用户充值完成后数据返回给后台，并在前端做最新展示，用户再次发起申购时，后台进行扣款。从中可以看出，用户充值后去购买产品，其实只是后台针对订单进行扣款，没有涉及到富友系统的交互。
因此可以在用户申购时，完成充值后，等资金到达账户余额时自动扣款并购买成功，这样用户在前台就可以省掉资金到账后的重新购买操作。用户具体操作流程如下：

页面流程就可以设计如下：

显然这种方案会让用户在前端的操作减少了很多，不会再有遗漏购买的情况。
五、页面交互细节：
1.投资页面输入金额交互细节

为确保用户能够输入有效投资金额，键盘输入规则如下：
?首位输入小数点，输入框显示为“0.”，删除时同时删除“0.”
?首位输入0，继续输入非0数字时，不显示0，直接显示该数字；
?首位输入“00”时，输入框显示“0”，继续输入非0数字时，直接显示该数
?首位输入0，继续输入0时不显示，始终只显示一个0
?小数点后只可输入两位小数，继续输入无反应
?不可输入两个小数点，第二次输入小数点时没反应
当用户输入金额有误时，分不同情况进行报错：
a.【超过限额】输入过程中，未失去焦点时实时判断

b.【低于起投金额】用户点击投资按后报错

这种情况不需要在用户输入时就进行报错，否则用户从刚开始输入第一个数字时，就会被高亮提示你错了，直到输入到第四位数字。
2.结果页面反馈设计
金融产品设计应当重视用户的安全感，尤其是在用户的资金处于在途处理中的状态，要明确反馈用户资金的当前所处状态，并有效管理好用户的预期。否则，很容易让用户担心自己的资金去哪里了？什么时候到账？是不是哪里出问题了？我的资金还安全吗？
使用账户余额购买产品和购买时充值支付的结果页面反馈

a.账户余额直接购买产品，可以即时显示是否申购成功，此时用户比较关系的是产品什么时候开始计息及什么时候到期，到期后资金汇款到哪里。
b.而在购买时充值支付，系统需要等资金充值到账户才能进行成功扣款，因此不能实时显示购买成功，只能显示申请已提交，用户比较关心什么时候可以投资成功，如果觉得自己银行卡资金被扣但是投资还在确认中不是很放心，可以直接拨打下方的客服电话。
充值或取现等资金在途页面设计：

申请取现后，资金不是立刻从账户余额到达用户银行卡，需要一个工作日的时间，因此在页面设计上，一定要说清楚申请已提交成功，并且写清楚资金当前处于哪一个状态，还剩下哪些步骤以及预计完成的时间。为防止用户有疑问，最好在结果页面上提供客服的联系方式。
以上是整理的一部分流程，关于实名认证及绑卡等一系列流程改版，会持续整理中。
谢谢:)
?
作者：细水，交互设计师； ?微信公众号：交互视角
本文由 @细水 原创发布于人人都是产品经理。未经许可，禁止转载。

互金平台交易流程产品改版
给作者打赏，鼓励TA抓紧创作！
?赞赏
6人打赏






?
收藏?|?110赞?|?18

高广淦订阅专栏
交互设计师，微信公众号：交互视角。
6篇作品
?
6.4万总阅读量
评论
窗体顶端
欢迎留言讨论~！
窗体底端
.

.
dnaught
.
充值完成直接给个弹窗，提示是否购买之前填写的金额，一键搞定
.
2017/07/09回复
.
.

.
366go
.
订单写的1000 结果就充值了1块怎么办。
.
2017/07/05回复
.
.

.
高广淦作者回复366
.
下了订单跳到第三方支付平台，金额不可修改
.
2017/07/05回复
.
.

.
一車君认证？
.
如果用户余额不足，为什么不使用银行卡直接代扣呢？ 楼主现在的平台接入存管了吗？ 我们现在在对接流程，我们存管前是使用余额不足使用银行代扣，现在改为充值后才能投资 用户会很习惯的认为我充值了就等于申购了。所以这快的我一直在思考
.
2017/07/05回复
.
.

.
高广淦作者回复一車君
.
以前用的是新浪托管，一年前就不用了
.
2017/07/05回复
.
.

.
吹泡泡
.
我的看法是投资一定还是需要用户自行操作比较好，如果充值后用户不想现在投资了怎么办？投资不应该是系统来代替操作。
.
2017/07/03回复
.
.

.
高广淦作者回复吹泡泡
.
你好，现在的方案用户在操作的时候，并不会觉得是充值，只是想买一个产品，现场做了支付而已。充值后再购买那是后台的逻辑，而用户就像淘宝上买个东西，你提了一个订单，然后在新的页面输相关密码确认后就支付了。
.
2017/07/04回复
.
.

.
项目记录互联网金融小透明产品一枚
.
比较大胆的尝试，有过类似的想法由于是担心 1，充值前投资金额只是一个意向，将充值所有金额用于投资而不经过确认，用户是否会反感。2，投资意向达成以及产品实际剩余可投可能会带来投资失败，产品流标等风险所以选择了认为较为稳妥的做法，就是充值成功自动跳回确认投资页面。让用户再输入交易密码进行确认。。。。
.
作者是多肉理财的么，用过就觉得页面风格以及一些细节的交互真是不错！
.
2017/07/03回复
.
.

.
高广淦作者回复项目记录
.
一看就是同样做互金的，哈哈
.
2017/07/04回复
.
.

.
zpmok
.
非常赞同：让用户知道交易总共分几步，奖金处在哪步，增强了用户体验，减少了运维、运营部门的电话数量。
.
2017/07/03回复
.
.

.
卡卡怕苦
.
学习了，辛苦辛苦
.
2017/07/03回复
.
.

.
tientse产品顾问
.
辛苦楼主，文章很棒，学习了。学习过程中有个问题需要向你请教，既然有大部分用户充完值后，误以为是已经做好了投资（确实这样也很方便）。那么为什么选择另外一套流程，而否定掉了这样充值带投资的流程呢？
.
2017/07/03回复
.
.

.
高广淦作者回复tientse
.
你好，其实从前端页面流程上来看，改进后的方案其实就是原方案中的第1，4，6张页面，就是顺着用户的操作路径来的，比当初的原方案还要简洁；不过你说的很有道理，当时为什么没有大胆地将错就错，而是想方设法教育用户懂得产品的规则呢？做互联网金融设计，跟资金相关的不容有错，有一种沉重的谨慎感……
.
2017/07/03回复
.
.

.
tientse回复高广淦
.
棒棒的 逻辑无懈可击
.
2017/07/07回复
.
.

.
constantine一直奔向梦想的小小PM
.
还有一点我很好奇：在键盘输入数字部分你们有个业务规则是不接受小于1000的金额，又做低于一元的录入处理，这完全没必要，因为即使录入了合法值也无法走通下面的流程，还不如直接不接受首位为零时直接录入小数点
.
2017/07/03回复
.
.

.
constantine一直奔向梦想的小小PM
.
交互本人不专业，抱着学习的态度。后台业务逻辑的流程图画的实在有些欠思考，余额不足跳去充值再跳回去本来就是个分支而已，居然画到主干流程了
.
2017/07/03回复
.
.

.
高广淦作者回复constantine
.
交互第一次画后台业务逻辑图，谢谢你的评论。余额充足画到主干流程，余额不足的那一大坨感觉无处安放。另外我还在想，案例中百分之六十多的用户都不是用充足的余额支付的，到底哪个是主流程捏？
.
2017/07/03回复
.
.

.
constantine回复高广淦
.
余额不足在后台逻辑里就是下单的一个前置判断，一个导致反向的if分支，这个分支应该指向一个充值子流程，所以不能因为出现频率高就判断这个流程是主流程。流程图里充值成功后重新指向余额是否充足的判断就行了，没必要再画一个。
.
2017/07/06回复
.
您可能感兴趣的文章

社交不易，前赴后继

每天3块钱，补齐互联网专业知识，提升职场竞争力

解构电商、O2O：调节交易的“杠杆”- 价格系统

工作计划避坑指南：科学制定、有效执行

数据产品着眼点不同，核心价值也不同

新零售知识体系：一致性原理
圈子
?产品经理群+加入
?运营交流群+加入
?营销增长群+加入
?文案交流群+加入
?Axure学习群+加入

关注微信公众号

热门文章
?

?
产品经理的三板斧：思维、视角、设计
?
2019-02-20
?
?

?
B端的用户画像，其实和C端的有很大不同
?
2019-02-20
?
?

?
小红书产品分析报告：社交电商的转型之路
?
2019-02-18
?
?

?
千万别把产品做成了功能
?
2019-02-19
?
?

?
产品这五年：从被老周招进360到自己创业
?
2019-02-20
?
大家都在问
过年回家，一句话介绍你的职业
59个回答61人关注
微信是否有义务开放快捷登录？
10个回答5人关注
【悬赏问答】有人提出停止日更“双微一抖”，你怎么看？
29个回答35人关注
如果美团做社交，会怎样？
4个回答6人关注
是否能从产品的角度分析，年味越来越淡的原因？
17个回答21人关注
【每日一问】支付宝沾福卡的商业目的是？
27个回答45人关注
【每日一问】微博也推了2018年度社交盘点，但没见有人晒这是为啥？
8个回答7人关注
关于
人人都是产品经理（woshipm.com）是以产品经理、运营为核心的学习、交流、分享平台，集媒体、培训、招聘、社群为一体，全方位服务产品人和运营人，成立8年举办在线讲座500+期，线下分享会300+场，产品经理大会、运营大会20+场，覆盖北上广深杭成都等15个城市，在行业有较高的影响力和知名度。平台聚集了众多BAT美团京东滴滴360小米网易等知名互联网公司产品总监和运营总监，他们在这里分享知识、招聘人才，与你一起成长。
链接
?加入我们
?投稿须知
?意见反馈
?免责声明
合作伙伴
?
?
?
?
?
?
?
?
?
?
?
APP下载

iPhone & Android
旗下品牌:?起点学院?|?运营派?|?秒聘网?
?2010-2018 - 人人都是产品经理 -?粤ICP备14037330号-1粤公网安备 44030502001309号?版权所有 ? 深圳聚力创想信息科技有限公司
企业内训/课程咨询和合作: 18682011582
其他合作/投诉/意见反馈: 18123776760

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

凤凰牌老熊
168文章
11万总阅读
查看TA的文章>
0
?分享到
?
?
?
20180812-互金系统的标签平台设计?
2018-08-22 07:15设计/支付
一、标签平台
网贷业务的资产端在有业务进件时，都需要对放款申请进行审核，审核的过程中会需要在数据中查询或计算出申请用户的多种数据（身份、银行卡、手机号、贷还款记录、工作单位等）信息。
当风控审核的查询或计算需要经常进行时，用规范的SQL脚本的方式进行，这种SQL脚本可以称之为标签，每次查询或计算只需添加相应的用户参数信息即可。标签就是sql脚本，例如：
{ "channelId": "xxx", "mkey": "user_id", "mvalue": "287ba4dd7ebac1f18002bf2354444b76", "params": { "al_client_name": "芦xxx", "al_tel_no": "13xxxxx" }, "tagName": "tb_if_name_in_deliveraddress_180d" } 二、标签的运行
?标签可以运行在不同的数据库：mysql和mongo、eshbase等。同时，风控需要用到大量爬虫数据，爬虫数据又是非结构化的，业务库的数据是结构化的，标签平台能够支持这两种数据，甚至可以是查询结构化的标签结果作为非结构化标签的入参。
?标签平台能够支持多种不同的业务线做风控取数或计算。
?对于要求秒级返回结果的标签在实时同步场景下实现，对于返回时间要求不高的可以在异步场景下实现。为了应对高并发，大量爬虫数据的计算也可以放在异步场景下实现。
下图为标签平台的业务逻辑图：

分享内容不多，更多精华在QA部分。
Q&A
Q:flink的作用只是数据获取，有些牵强吧？
A:异步场景中flink用作计算，标签的计算和取数可以走业务库的从库。
Q1:Flink用作实时计算吧？
A1:对于资金端业务如果有查询或取数需求，也可以使用标签，计算是实时的，整个业务交互流程分为同步和异步，同步：业务库的需求；异步：爬虫的需求。
Q2:你们数据存储用了这么多的东西主要是考虑在哪方面，HBase TiDB ES。
A2:因为涉及的业务线很多，涉及的数据源比较多，tidb存结构化数据，eshbase存非结构化数据，而且都是接入从库数据。
Q3:HBase不也存非结构化的么？
A3:是的。es是同步主库的数据，是否丢失取决于主库，标签平台的主要作用是可以同时满足多种网贷业务的取数和计算需求，同步和异步的共同使用，为了应对高并发场景。同时在同步场景下，程序为了避免宕机，本身也有熔断保护机制，即在一个时间段内有超时设置，程序还有标签全生命周期监控，即从标签的上线到下线都有完善的监控。For 用户数据的使用者; Who 需要提取用户特征加工用户标签，The 标签产品 is a 标签加工和管理工具，That快速加工标签并方便快捷的管理标签 Unlike 分析师写SQL，开发人员开发上线的传统方式，Our product 加工速度快，准确性高，管理方便，目前的痛点：受主库影响大，如果有更好的建议，欢迎大家积极提出来。
Q:你们TiDB数据在什么量级？
A:这样做加大了程序的维护成本，但能避免互相影响。
Q:如果es中存的数据能否丢失？hbase的数据是否和es一样？
A:tidb的数据量在tb级别，不到pb；hbase的数据和es一样。
Q:能不能看看你说的标签是什么样子的，给个demo。
A:依赖于标签的关系和结果，还可以建立起用户画像。
Q:能举两个不同标签的例子吗？
A:①不仅仅可以用在风控审核场景下；②资金端业务线有取数需求也可以用③实时同步场景是秒级返回，异步场景对时间要求不高，根据不同的需求把标签分为异步和同步。
Q:我有三个问题请教，非常感谢峰兄解答：第一、mongo将数据同步到kafka，如果在同步的过程中发生数据丢失，怎么做补偿！第二、用es的场景是查询吗？是否有大量的聚合统计，如果有的话，服务器有多少个cpu，内存是多大的！第三、为什么要从主库中同步数据，不会影响主库的业务吗？
A:1、同步过程中如果发生了数据丢失，通过监控能够发现，会进行重新同步。如果在重新同步的过程中，有标签正好用到了丢失的数据，会有进行补数或者等待同步完成；2、目前程序部署在云上，同步用了8个实例，异步用了10个实例，这和业务量有很大关系；3、主库用来存储和共享数据，从库用来满足业务需求。
Q:问个问题，为什么数据存储选用ES？是因为存在检索，或预计数据量较小吗？
A:es也可以有一定量的数据。
Q1:那大概数据量级是多少呢？
A1:es如果做聚合统计，对cpu和内存要求很高，多个机房以及部分数据在云上，目前是TB级别。
Q2:TB级别的数据，你们是怎么存储的？
A2:涉及的数据源很多，分别存在不同的数据库，有mysql、tidb、mongo等。
Q3:你们TB级别的数据是什么数据？网带的资产数据还是借款还款数据？
A3:tidb可以搞很大。不过tb级别的数据需要的资源确实不少，流水，日志，记录细一点，TB很正常，所以要用es当仓库用，资源消耗就极大。
Q:标签写成sql,风控人员能维护吗?这个标签系统，有多少人参与？
A:标签平台几个人就可以，写标签需要业务线来完成。
Q:标签翻译到对应的存储过程，能举个例子吗？
A:风控业务很多sql业务逻辑都是相同的，可以合并的。
Q:风控平台用sql有点简单吧，没有用到机器学习领域?风控对网贷来说最核心的了？
A:网贷的风控基本是看运气的，说是核心，其实不是核心，还是看拿钱的能力吧，不管是融资，才是资产证券化。
Q1:资产证券化？
A1:就是卖资产出去，或者说卖负债出去么，风控和自身承受能力，和市场目标都很大关系的。
了解更多互金风控
本文档来自支付产品技术交流群的聊天记录整理，由志愿者整理并发布到本网站。如需要及时收到来自支付产品技术交流群的最新消息，请扫码关注“凤凰牌老熊”的微信公众号。新建的支付产品技术群还有不少空位， 本群面向支付行业的有经验（2年以上）的产品经理、软件工程师、架构师等，提供交流平台。如想加入本群，请在本文评论中留言（不公开），说明所在的公司、负责的工作、入群分享的主题和时间。返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (82)
不感兴趣?投诉
本文相关推荐
?化学品安全标签编写规定?
?药品说明书和标签管理规定
?云标签考试答案
?rfid电子标签
?个人标签与职业有关怎么写
?a标签去掉下划线
?淘宝新品标签怎么弄
?tidb+临时表
?tidb需要ssd
?tidb性能测试
?runingman20180812
?标签体系应用场景
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4620
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 16:28

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

华为“脱光外衣给世界看”，英国终于认可：华为5G风险可控
核舟POST?·?02-19 14:161

德国电信波兰业务CEO：若不让华为参与 波兰5G或将延迟
参考消息?·?今天 00:20134

取代滴滴？哈啰顺风车上线不到一个月再遭打击，三大硬伤值得思考
科技蜀黍?·?02-13 22:3516
拥有香港身份,商务往来便利,保留大陆国籍,一人移民全家三代均可移居,福利的待遇与香港公民无差别！
?广告?·?今天 16:28

小米MIUI将迎重磅升级：手机使用18个月不卡顿，防系统老化
泡泡网?·?今天 14:05?

小米9和荣耀V20很难二选一？听了“修手机”老板的意见，明白了！
小梦的魔法棒?·?02-22 15:20?

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

华为mate20pro对比苹果XSMAX：差距实在太大
差评数码?·?02-11 16:0023
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 16:28

华为Mate X明日发布：对外折叠屏+5G，网友：实在是买不起！
科技小李?·?昨天 10:42147

滴滴亏损109亿不是没理由，司机端抽成30%，依然还补贴113亿！
电子商务实战专家?·?02-13 22:30223

滴滴巨亏109亿后，裁员2000人,补偿方案已出，员工争着被裁
互联网架构师?·?02-22 08:19?

滴滴对手来了 哈啰顺风车在全国300余座城市正式上线
随手科技?·?今天 09:19179

好书集结令 中国古典名著100部 趁现在抢藏！
?广告?·?今天 16:28

科技标杆荣耀遭遇质量危机？V20屏幕发黄、Magic 2充电口开裂
互联网手机时评?·?昨天 18:54?

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10?

华为P30系列将于3月26日发布，价格基本确认，网友直呼伤不起！
科技小李?·?02-22 20:59?

5G折叠屏手机2月24日发布，华为的底气在哪里？
量子位?·?02-22 18:02136
?广告?·?今天 16:28

雷军被打脸，小米9游戏居然抗不过3小时
电商热点观察?·?昨天 17:27?

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00417

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24171

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11165
2019年新品平板电脑仅598元

?广告?·?今天 16:28

别急着买小米9，安卓市场大变天，骁龙855＋12GB＋44W
士豆不土?·?今天 09:41?

重磅报告 | 未来数字化发展的9大趋势
阿里研究院?·?02-20 17:05?

华为Mate20：再见了！
科技小李?·?今天 00:10173

这样病态的网红，不要也罢！
经济日报?·?今天 15:04?

惊呆！原来去眼袋那么容易，在家也能轻松去眼袋！
?广告?·?今天 16:28

特朗普正面回应来了！"不封杀"华为！还将考虑撤销刑事指控！
芯智讯?·?昨天 13:456

华为MWC2019直播几点开始？华为MWC2019大会直播的具体时间
手机小师妹?·?02-22 14:12?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

苹果跌下神坛，iPhoneXR跌破4500，还买啥小米9
士豆不土?·?今天 09:39?
源产地直销，没有任何中间商，低于市场价一半，品质更佳！
?
?
?
?
?广告?·?今天 16:28

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:05?

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34?

2019MWC国产机5G博弈 OPPO小米抢华为风头
蓝鲸TMT?·?今天 13:12?

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43159

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 16:28

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3421

海参怎么泡发才是正确的，一招教你快速泡发10几倍！
?广告?·?今天 16:28

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08273

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26126

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

荣耀高管质疑小米9超强续航成绩：违反常识，对科学没有敬畏心
数码评价?·?今天 07:25224
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 16:28

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03102

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26561

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58379
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 16:28

“阿里系”与“腾讯系”的较量
创业家?·?今天 13:15?

1999元的小米9 SE也用4800万摄像头，雷军的阳谋是什么？
数码评价?·?今天 07:4227

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57

小米9将在2月26日正式开售，全网预约量却早已突破百万！
叽歪数码?·?今天 12:42
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 16:28

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

硬核担当！华为首款5G折叠屏手机配置/售价曝光，惊喜不止这些
泡泡网?·?02-22 13:28

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

工信部曝光华为P30 Lite部分参数
IT之家?·?今天 06:45

浮夸营销无法解决续航问题，小米9续航遭质疑
蓝鲸TMT?·?昨天 16:15
腋下异味令你不敢走向人群？别怕，其实这样做就可以了
?广告?·?今天 16:28

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 16:28

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

中国顺风车顽疾，能否从欧洲找到“解药”？| 欧洲观察
钛媒体APP?·?今天 08:54

人人车李健：没有盈利的原因是员工没有尽职尽责；巴菲特股东信：伯克希尔Q4净亏损约254...
i黑马?·?今天 08:44

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

百度的冰与火
阑夕?·?昨天 23:45

暴风影音CEO：硬件的免费逻辑失效了吗？
智酷科技?·?今天 09:10

FTC：那个有魅力的Facebook陌生人不爱你
MiHomes?·?02-15 10:36

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31
已经到底了

广告

热门图集
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
野狼被塑料罐卡住头 高温中挣扎3小时
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
??
?麦田藏北宋钱庄 团伙盗挖4吨古钱币
?化学老师走红 讲解"恋爱中的化学"
?高晓松个站成立 应援图让人不敢认
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7950万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
?返回
?首页
?用户
?反馈

?首页
?博客
?学院
?下载
?图文课
?论坛
?APP
?问答
?商城
?VIP会员
?活动
?招聘
?ITeye
?GitChat
?
?

?
?写博客
?赚零钱
?消息
?登录注册
转
互金平台数据透析：用这3个模型就够了
2017年11月13日 00:00:00?人人都是产品经理V?阅读数：244

作者：绰号甄嬛的男人
全文共 3233 字 3 图，阅读需要 7 分钟

———— / BEGIN / ————

由于运营部门是互金平台公司里需要对业绩对KPI负责的部门，这决定了运营人员需要时时刻刻观察数据，从数据出发找到公司运营的异常情况。

若上天保佑大吉大利，业务数据增长符合预期，那很棒今晚可以吃鸡；若多灾多难，业务数据下滑严重出现异常，也不必慌张；学会利用和使用数据，通过数据多维度的对比分析，找出数据波动的潜在因素，并思考对应的运营策略并迅速做出调整，保证公司业务回归正常——所谓兵来将挡水来土掩。

市面上互金产品的运营端工作主要分为两种，一种是资金端（即出借人Or投资人）的获取，另一种是资产端（即借款人）的获取。

前者典型例子为证券炒股类、银行理财类、P2P类的互金产品；后者典型代表为现金贷类、借款类的互金产品。

本文的研究对象是前者，通过三种常见的数据分析模型，阐述资金端获取的互金产品的数据分析角度，希望对大家有益。

模型一
AARRR模型，针对整个产品层面

从整个产品日常运营层面做分析，笔者套用现在市面上比较流行的AARRR运营模型。这个模型几乎可以套用所有的互联网产品，大家也可以尝试着在自己的垂直领域去套用分析。

获取用户（Acquisition）

关键数据指标：注册用户数、投资用户数、人均投资金额；

分析角度：需对比不同渠道的注册量与注册质量，注册量看注册用户数，注册质量看投资用户数与人均投资金额（即转化率）。

提高活跃度（Activation）

关键数据指标：浏览量（PV）、访客数（UV）、IP数、APP日活跃用户、APP日启动次数；

分析角度：不同于社交类或资讯类产品，互金类产品不是非常看重活跃度这个指标。因为从最理想的情况上分析，用户投资后，是不需要再点开APP进行任何操作，接着就是坐等本金和利息回款即可，这也是用户对投资产品信任和放心的一种体现。

那什么时候活跃度这个指标值得运营者去重点关注呢？

两种情况，重大利好或重大利空的消息发布。重大利好如平台融资、力度空前的营销活动等，重大利空如各种负面新闻曝光等，这个时候运营者需要去关注这个活跃度的波动，并要分析波动是否在预期范围里。

获取收入（Revenue）

关键数据指标：投资用户数、交易额、平均投资期限、满标时长；

分析角度：收入数据在电商平台里对应为营业额，在互金平台里则对应为投资数据。

一个平台的“吸金”能力可以从投资用户数和交易额这两线指标里直观看出，另外还有两个辅助指标，一个是投资期限，一个是满标时长。

借用马化腾爸爸说的一句话，“金融拼得不是谁跑得快，而是拼谁跑得长。”所以投资期限越长，代表用户信任平台，愿意长期限进行投资，也代表了平台的经营状况越好；而满标时长越短，说明资产供不应求，平台获取投资资金相对容易，这也代表了平台的经营状况良好。

提高留存率（Retention）

关键数据指标：充值金额、提现金额、充提率、回款金额、回款用户数、留存金额、资金留存率、资金复投率、留存用户数、留存用户比例、流失金额、流失用户数、资金净流入/流出

分析角度：做好留存是互金平台的重中之重，这里面牵涉的数据指标有很多，给人眼花缭乱的感觉，但核心只要关注两个数据，资金留存率和资金复投率，因为这两项其实是结合了回款、提现、充值、投资而综合计算出来的。

短期看，留存率和复投率会随着短期的营销活动而产生剧烈波动；长期看，留存率和复投率会随着平台的征信、利率、产品体验等各方面的提升而稳步提高，反之亦然。

自传播（Refer）

关键数据指标：邀请用户数、邀请用户投资额、红包分享次数、活动分享次数

分析角度：做好自传播能帮助平台节省很多渠道费用和推广费用，把这部分费用让利给邀请人用户，邀请功能几乎也是很多互金平台的必备功能之一，除此以外，一些大型活动和功能也具有分享传播的价值。笔者见过最狠的是平安银行，手机App里几乎所有落地页面都具备分享功能，无时无刻都在提醒用户进行分享传播。数据层面关注对应的分享数据及转化数据即可，比较简单。

模型二
占比模型，针对某项功能层面

除了产品日常运营需要做数据分析，互金类产品上线了新版本，更新了如VIP体系、积分体系、任务体系、自动投标、智能投顾等新功能，这个时候运营也需要对特定功能进行数据跟踪与分析，了解用户对新功能的反馈。

有些运营喜欢对用户进行回访调研去了解用户的接受度，但笔者认为只有数据是最客观最真实的，能切实解决用户需求的功能，一定能在数据层面有好的体现。

下面介绍两种判别方法：

1. 新功能是否受欢迎？

衡量指标：活跃比例。

即：使用新功能的活跃用户数/同期活跃用户数。



2. 用户是否会重复使用？

衡量指标：重复使用比例。

即：第N天的继续使用新功能的用户数/第一天使用新功能的用户数。



（以上部分内容引用于人人都是产品经理专栏作家@艺林小宇 专栏文章）

模型三
漏斗模型，针对运营活动层面

活动是运营人员的日常工作，如果把一个活动比作一个项目，一个再复杂的项目都可以通过WBS：工作分解结构（Work Breakdown Structure）进行拆解。

同理，一个再复杂的活动也可以拆分成多个步骤去分析，这里常用的分析方法就是进行漏斗模型分析，分析从潜在用户到最终用户这个过程中用户数量的变化趋势，从而寻找到最佳的优化空间。

比如，下面的例子是分析从用户进入某个活动页面到最终产生投资行为的变化趋势。



最后，我们从这个漏斗中去分析，每个环节的转化率有没有达到预期。如果没有，就要反思活动流程中还有哪些可以优化的环节，比如文案是否足够吸引、步骤是否足够精简、体验是否足够流畅。

数据会说谎

数据会说谎这种说法相信大家都听过，其实数据本身是不会说谎的，是收集、分析数据的方法会说谎。

数据分析过程中，如果结合其它维度再次做分析，有时候是会得出完全不一样的结论。

举个例子：

一个用户运营团队要做用户喜爱度调研，于是给所有每天使用他们产品的用户致电访问；最后调研结果显示：他们的产品用户喜爱度接近100%，他们信心满满，觉得产品太完美了。

可是，不喜欢谁会天天使用你们的产品？

（这个例子类似“幸存者偏差”陷阱）

互金产品里一样也会出现数据说谎情况。

举个典型的例子：

A渠道投资转化率为60%，B渠道投资转化率为40%，从以上数据分析，A渠道的用户质量明显比B好。

可是，如果结合不同的维度，结论有可能是B渠道的用户质量是比A渠道的更好。

比如结合金额留存率这个维度，A渠道用户的金额留存率是10%，B渠道用户的金额留存率是50%。

这说明A渠道用户的“羊毛”属性明显更重，用户都是投完一笔拿完首投奖励就走，相比B渠道的用户能在首投后留下来继续投资，所以B渠道用户的整体质量是更高的。

这种情况下，我们就得到了和之前截然相反的结论了。

因此，产品运营人员做数据分析时，一定要尽可能把各种干扰因素考虑进去。

一个错误的数据分析结论比不做任何分析都还要遭，毕竟掉进坑里后，还要花费力气跑出来，这里面的时间成本、机会成本实在太高。

结语

在互联网这个信息洪流中，不少人幻想着能抓住一些一夜爆红的秘籍，各种含金量不高的营销类、学习类账号（人人都是产品经理当然除外）也喜欢分享以下类型文章，如《如何制作刷爆朋友圈的某某H5》、《四个方法教你打造爆款》、《写出10万+文案的七个细节》等等。很多互联网运营者热衷于学习研究上述各种“看得见”的道和术，但对许多“看不见”的体系内容缺乏足够的关注。

数据运营分析，就是“看不见”内容中的重中之重。

看数据、找原因、想对策，基本上就是一个运营人员每天的日常工作。除了“想对策”这步，需要结合运营人员对业务、对用户、对产品的熟知和了解（通常也是由运营总监做出决策）。

其余两步，懂得“看数据、找原因”，就是一个合格运营人员的必备技能，而且这项技能越娴熟，越懂得用数据指导运营工作，运营人员的阶位就越高。

最后，希望大家都能成为运营大神。

———— / END / ————

本文由 @绰号甄嬛的男人 原创发布于人人都是产品经理。未经许可，禁止转载

点击“阅读原文”下载APP
城东25岁美女手机做这个，一年存款吓呆父母！徽彩印刷 · 鹓鶵

窗体顶端

窗体底端

深度解析｜互金用户增长模型背后，最底层的逻辑框架
阅读数 6680

————/BEGIN/————一、当我们在讨论用户行为时，我们在说什么1.1从基础出发，回归初始定义很多日常脱口而出的词，其实我们并没有思考过它真实的含义。大多数争论和错误决策的起点，也在于定义的不清...博文来自： 人人都是产品经理

移动端的角度浅谈数据分析报告
阅读数 240

麦肯锡给大数据定义：“一种规模大到在获取、存储、管理、分析方面大大超出了传统数据库软件工具能力范围的数据集合，具有海量的数据规模、快速的数据流转、多样的数据类型和价值密度低四大特征。“大数据特征可总结...博文来自： des0810的博客

做好公司各部门数据报表支撑的几个简单思维
阅读数 1387

越来越多的数据，越来越多的需求，越来越多的不满意如今，大数据和数据分析的概念相当普及，从基层到管理层，从IT到业务，都深知“数据化管理”、“数据决策”的重要性。越多重视，压力也就越多，导致信息中心和数...博文来自： hualalalalali的博客
年轻人有福了：昨日刚上线,平均3.2秒进一个玩家,开服2分钟爆服热门推荐

不止从0到1｜从日活10万到日活1000万，该如何优化产品？
阅读数 1118

作者：WinsonL全文共2786字7图，阅读需要6分钟————/BEGIN/————今天要分享的是从「日活十万的应用打造成为日活千万级产品」的优化框架，后面再结合案例详细说明。很多时候我们并没有机会...博文来自： 人人都是产品经理

竞品分析全览
阅读数 5733

前篇：前期准备1.竞品选择1.1竞品分级竞品分级是以我们自身的产品为中心，?.重要竞品，远高于我们的产品；?.核心竞品，高于并且非常有竞争力的产品；?.一般竞品，在我们之下或者还不如我的产品。竞品分级...博文来自： 北雨南萍

什么是互联网产品运营
阅读数 344

周鸿祎曾经说&quot;好的互联网产品是运营出来的&quot;，那到底什么是互联网产品运营呢？本文主要是结合日常工作积累和互联网中可查阅的资料进行归纳梳理。一、互联网产品运营的定义互联网产品运营（In...博文来自： 斑鸠的博客

互金平台如何利用大数据做用户留存？
阅读数 1042

提起互联网金融，人们当下的态度可谓又爱又恨，因为口口相传的“致富”和“跑路”都不绝于耳。在问题平台的数量（3795）已经快达到正常平台数量（2114）两倍之多、且盈利平台尚不足百分之一的现状下，撑到今...博文来自： 修行2017

(新东方)背单词，记住这200个词根词缀就够了(我自用)
阅读数 1617

帮助记忆前缀:a.b.c.d.e–&amp;amp;amp;amp;gt;2.3.2.3.5kfn各一个–&amp;amp;amp;amp;gt;外键i有6个--&amp;amp;amp;amp;gt...博文来自： 北京小辉的博客
陈小春哭诉：城东土豪怒砸2亿请他代言这款0充值正版传奇！真经典！贪玩游戏 · 顶新

互金平台如何利用大数据做用户留存? - 修行2017 - CSDN博客
10-24
互金平台数据透析:用这3个模型就够了 11-13 134...- 人人都是产品经理 如何计算用户生命周期天数? ...


...3大新兴互金黑科技,做稀缺型互金产品经理 - 人人都是产品经理 ...
1-16
谢谢。人人都是产品经理 ,但不是人人都可以成为产品...互金平台数据透析:用这3个模型就够了 11-13 211...


给我一个微笑就够了
阅读数 693

给我一个微笑就够了不要给我太多情意让我拿什么还你感情的债是最重的呵我无法报答又怎能忘记给我一个微笑就够了如薄酒一杯，像柔风一缕这就是一篇最动人的宣言呵仿佛春天温馨又飘逸?默默的情怀总有些这样的时候正是...博文来自： sky3785的专栏

互金发展和模式
阅读数 541

竹外桃花三两枝，春江水暖鸭先知三月四号杭州温度居然28度，直接蹦到夏天了，把春天给略过去了，老天爷有没有问过我们的感受啊~~~~PS：上一篇文章《备付金知识知多少》结尾处原来是“请大牛拜读”，现在已经...博文来自： HIP的博客
关注

silentwolfyh

366篇文章
排名:2000+
关注

CSDN官方博客

588篇文章
排名:17
关注

黑夜路人

855篇文章
排名:94
关注

foruok

549篇文章
排名:68

互金运营底层逻辑
阅读数 399

本文希望通过这套框架的介绍，帮助产品经理和运营经理搞明白如下问题：手头负责的产品，最需要配套哪些运营功能为什么同样的产品，不同的公司会有不同的运营策略不同的公司，同样的产品，同样的运营策略，为什么会带...博文来自： jiemo_99的博客

mysql---学习MySQL优化原理，这一篇就够了！
阅读数 798

http://dbaplus.cn/news-155-1531-1.html?utm_source=tuicool&utm_medium=referral博文来自： 黄星的专栏

(收藏）万字总结：学习MySQL优化原理，这一篇就够了！
阅读数 98

http://dbaplus.cn/news-155-1531-1.html博文来自： jackyrongvip的专栏
城东25岁美女手机做这个，一年存款吓呆父母！徽彩印刷 · 鹓鶵

...模型背后,最底层的逻辑框架 - 人人都是产品经理 - CSDN博客...
2-12
对互金运营来说,必须深入到本公司产品的体系中,了解...用户行为是串起用户和平台两端的其他3项数据的关键...


从事互金行业的那些日子 - site008的博客 - CSDN博客
11-20
????? 掐指一算在某互金公司呆了一年零两个月(哈哈,终于离职了...互金平台数据透析:用这3个模型就够了 - 人人都是产品经理 11-13 151 作...


网络小贷用户评分卡风控模型设计
07-11
互金平台、银行、小贷公司用户风险量化评分模型！互金平台、银行、小贷公司用户风险量化评分模型！
下载


数据库原理，看这一篇就足够
阅读数 277

1.绝对大神作品，讨论数据库原理。值得耐心看完…数据库原理全面分析2.什么是数据库索引?数据库索引3.什么是数据库视图？数据库视图4.什么是数据库执行计划？数据库执行计划......博文来自： Stony_Confident的博客

从事互金行业的那些日子
阅读数 812

前言?????掐指一算在某互金公司呆了一年零两个月（哈哈，终于离职了，小小庆祝下），在这段时间算是尝尽了人间的酸甜苦辣，五味杂陈。去年阴差阳错就进入互金行业了，感觉水深不可测。外行开热闹，内行看门道?...博文来自： site008的博客

互金技术的门槛和挑战
阅读数 111

加入互金这个领域已经2年多了，作为一名从传统互联网加入互金的技术人，除了自己需要角色和行业认知的转变外，还要帮助团队同样完成升级。所以，我今天要来说说互金技术人常见的一些......博文来自： 架构栈

MYSQL的基本操作与演示（MYSQL这一篇文章就够了）
阅读数 223

????常用的关系型数据库语言有三种：SQL、Mysql、Oracle。这三种数据库语言基本操作是很相近的，目前大公司的主流使用的Mysql，所以本文将对MySql语言的基本操作进行演示与分析说明。?...博文来自： TigerChen
城东25岁美女手机做这个，一年存款吓呆父母！徽彩印刷 · 鹓鶵

Python 3 入门，看这篇就够了
阅读数 560

简介?Python是一种高层次的结合了解释性、编译性、互动性和面向对象的脚本语言。Python由GuidovanRossum于1989年底在荷兰国家数学和计算机科学研究所发明，第一个公开发行版发行于1...博文来自： HelloWorld搬运工

git常用命令这几个就够了
阅读数 61

git常用命令常用基本命令代码冲突了怎么办分支怎么使用常用基本命令以下12个命令基本上可以解决开发中遇到的绝大部分问题1.gitclone代码地址2.gitadd代码路径;将修改添加到暂存区3.git...博文来自： jianglong_he的博客

关于点击率模型，你知道这三点就够
阅读数 1170

关于点击率模型，你知道这三点就够说到广告，或者运营，关注的最多的就是点击率了。我们经常能听说某某科学家通过建立更好的点击率预测模型，为公司带来上亿的增量收入。点击率这么简单直接的统计量，为什么要用复杂...博文来自： WhyNot

互金平台灰度发布的三段式探索与实践
阅读数 1118

http://dbaplus.cn/news-72-1441-1.html作者介绍小亚，互联网金融公司应用运维主管，参与运维工作九年，涉及领域包含航空、金融、广告等。近两年主要负责金融业务运维的线上业...博文来自： guolong1983811的专栏

Makefile 经典教程（看完这篇就够了，不信你拉拉进度条）
阅读数 1129

支持原创：http://blog.csdn.net/haoel/article/details/2886makefile很重要什么是makefile？或许很多Winodws的程序员都不知道这个东西，因...博文来自： 一航jason
陈小春哭诉：城东土豪怒砸2亿请他代言这款0充值正版传奇！真经典！贪玩游戏 · 顶新

Dubbo在互金行业的应用 - qswm_18301240090的博客 - CSDN博客
12-24
来自: 人人都是产品经理 互金行业的应用 12-03 20 金融反欺诈 https:/...互金平台数据透析:用这3个模型就够了 11-13 182 作者:绰号甄嬛的男人全文...


互金行业的应用 - OYY_90的博客 - CSDN博客
12-3
前言????? 掐指一算在某互金公司呆了一年零两个月(哈哈,终于离职...互金平台数据透析:用这3个模型就够了 - 人人都是产品经理 11-13 161 ...


HTML基础，这一篇就够了
阅读数 390

1.html骨架标注的html骨架博文来自： Sloven

关于数据分析那些事，看这一篇就够了
阅读数 193

本文转自：数据分析与开发目录?1什么是数据分析；2数据分析职业介绍；3数据分析生涯规划；4数据分析基本素质；?一：那到底什么是数据分析呢？?数据分析是基于商业目的，有目的的进行收集、整理、加工和分析数...博文来自： lixiaoxiong的专栏

万字总结：学习MySQL优化原理，这一篇就够了！
12-29
实用文档，万字总结：学习MySQL优化原理，这一篇就够了！
下载


为什么互金平台资金存管了，就安全了？
阅读数 144

最近多家互金平台接连“爆雷”，引起投资人恐慌性情绪蔓延，监管层和互金协会接连发出合规信号，合规内容中经常提到“资金存管”。今天咱们就聊聊，什么是资金存管？资金存管了就安全吗？那什么是资金存管呢？投资人...博文来自： 王猛的博客

从前端菜鸟到大神，看这一篇就够了
阅读数 2855

结合个人经历总结的前端入门方法，总结从零基础到具备前端基本技能的道路、学习方法、资料。由于能力有限，不能保证面面俱到，只是作为入门参考，面向初学者，让初学者少走弯路。互联网的快速发展和激烈竞争，用户体...博文来自： 無形的畫筆
最美网红同款婚纱照，本地人都选这家婚纱摄影！美人纪摄影 · 顶新

关于HTTP协议，一篇就够了
阅读数 2386

转载：http://www.jianshu.com/p/80e25cb1d81aHTTP简介HTTP协议是HyperTextTransferProtocol（超文本传输协议）的缩写,是用于从万维网（W...博文来自： u012361288的博客

我的100个愿望
阅读数 345

1.和LP学会跳华尔兹2.和LP在草地上骑马3.博文来自： mujian0000的专栏

这样读书就够了
12-01
这样读书就够了，拆书帮来源、理论、实践，学习拆书理论
下载


关于线程池，你看这一篇就够了
阅读数 81

本文主要从为什么要用线程池、线程池的参数、线程池中任务有三种排队策略、线程池的拒绝规则、线程池大小设置规则几个方面来介绍线程池。...博文来自： qq_29606255的博客

[转]词根词缀记单词3-主讲victor老师
阅读数 29

(三)名词后缀一、?表示学术、行业的名词后缀1.-ery??fishery渔业??cookery烹饪法?surgery外科?medicine内科?2.-ese??Chinese汉语??Japanese...博文来自： Xgeeeeek的专栏
最美网红同款婚纱照，本地人都选这家婚纱摄影！美人纪摄影 · 顶新

Dubbo在互金行业的应用 - maoreyou的博客 - CSDN博客
1-24
互金平台数据透析:用这3个模型就够了 11-13 阅读...来自: 人人都是产品经理 深度解析|互金用户增长模...


互金平台灰度发布的三段式探索与实践 - guolong1983811..._CSDN博客
12-17
互金平台灰度发布的三段式探索与实践2017年12月03日...分布式缓存数据结构存在差异及不兼容的情况,就不能...来自: 人人都是产品经理 持续集成与灰度发布 06...


互金平台借贷数据
09-19
来自互联网金融平台的，用户借贷数据，已经经过脱敏，可用于简单的，风控评分卡建模
下载


AI在蚂蚁金服产品线中的大规模应用
阅读数 1149

近日，蚂蚁金服副总裁兼首席数据科学家漆远博士发表了主题为《金融智能的发展与应用》的演讲。漆远表示，蚂蚁金服今年的两个关键词，一个是“开放”，一个是“AI（人工智能）”。在此次演讲中，漆远从风控系统、智...博文来自： 巫山云的专栏

计算机视觉与深度学习，看这本书就够了
阅读数 1462

开始机器学习知识的学习，差不多已经有一年的时间。这期间看了很多教材和书籍，有些深入进行了学习，有些书（比如深度学习领域著名的西瓜书）则看不下去。机器学习其实也有许多方向，比如强化学习、计算机视觉、自然...博文来自： 云水木石

了解HTTP协议，这一篇就够了
阅读数 459

1、HTTP协议简介1.1、HTTP协议是超文本传输协议的简称，工作于应用层，用于从服务器传输超文本到本地浏览器。HTTP协议本身是一种无状态的，也没法自己传输数据，底层的数据传输协议是TCP协议。H...博文来自： 知行合一 止于行善

CSDN日报20170303——《百亿互金平台救火故事》
阅读数 1

一直以来总是想以什么方式去记录下自己在互金行业的这段经历，趁着自己还记得清楚，还能找到一些资料原型，一方面可以分享出来供大家参考，但是更重要就是多年以后我可以根据这些文章回忆起来自己的那段激情岁月。想...博文来自： CSDN 官方博客

Linux 常用指令 ，看这一篇就够了—— 摘自《Linux Probe》
阅读数 1

系统常用控制命令man：查看命令的帮助信息，如manls可以查看ls指令的使用说明。 echo：在终端输出字符串以及变量的值，如echomypath:$PATH将会以‘mypath:’开头，后接系统环...博文来自： 分花拂柳的博客

要认识嵌入式Linux，看这一篇就够了
阅读数 502

要认识嵌入式Linux，看这一篇就够了博文来自： Zzzz_linux的博客

Spring入门看这一篇就够了
阅读数 347

前言前面已经学习了Struts2和Hibernate框架了。接下来学习的是Spring框架…本博文主要是引入Spring框架…Spring介绍Spring诞生：创建Spring的目的就是用来替代更加重...博文来自： 3y

想要学Git，这一篇就够了
阅读数 546

此片文章较长但是非常的详细！如果你觉得长文章枯燥，小编找来一套很好的git视频教程公众号回复“git”获取！一：Git是什么？Git是目前世界上最先进的分布式版本控制系统。目前很多公司都在使用它......博文来自： 互扯程序的博客

学习 JSP ！这一篇就够了！一.简介二.JSP注释 三.JSP指令 四.JSP内置对象 五.JSP动作标签 六.BeanUtils 七.EL表达式
阅读数 58

一.简介JSP语言：它是在servlet发展起来的，更加方便，它是HTML，java代码，JSP自己的东西所组成的，英文缩写是javaserverpages。在jsp文件中，我们可以在java代码之间...博文来自： 逆水行舟，不进则退

凡普金科以互金 “头马”入选互联网企业百强的启示:创..._CSDN博客
2-6
博文 来自: 人人都是产品经理 互金平台如何利用大数据做用户留存? 07-27 ...互金平台数据透析:用这3个模型就够了 11-13 阅读数 226 作者:绰号甄嬛的...


读《这样读书就够了》有感
阅读数 460

信管1142??????曾国营?????201411671201?????这本书讲述的是成人学习以及拆书阅读，它提倡的是片段阅读而不是全部阅读。跟大学生的学习有相似之处，他们把学习看作是一种负担，而且...博文来自： Q1399151473的专栏

[转]Redis2.8从入门到精通文档
阅读数 3944

版本：V3.12014-3-36(@江南白衣版权所有，转载请保留出处)，针对Redis2.8版。1.Overview1.1资料?，最好的入门小册子，可以先于一切文档之前看，免费。作者Antirez的博...博文来自： heiyeluren的blog（黑夜路人的开源世界）

vue开发看这篇文章就够了
阅读数 961

SegmentFault首页问答头条专栏讲堂发现搜索立即登录免费注册在SegmentFault，学习技能、解决问题每个月，我们帮助1000万的开发者解决各种各样的技术问题。并助力他们在技术能力、职业生...博文来自： lengyu6220的博客

对于c语言程序与设计的理解
阅读数 285

对于计算机科学与技术这个学科来说，c和c++还有java都是其重要的语言基础，在大一刚开始两个多月对于c的学习，其中神奇之处深深的吸引了我，独特的编译方式引起了我的好奇心，也激起我想要征服这个学科的信...博文来自： xuzhifeng1106的博客

Python互联网金融之用户增长的数据逻辑
阅读数 149

怎样看待和应用我们互联网金融中的数据？怎样进行数据分析？互联网金融数据分析的三个层面：(1)指标层面建立指标体系，观察指标涨跌的情况(2)行业框架不同的行业对于各个指标的权重不同复投率留存率转化率金融...博文来自： jacky_zhuyuanlu的博客

MySQL优化原理——掘金官方
阅读数 117

声明原文：https://www.jianshu.com/p/7fc148a2aa31?utm_campaign=maleskine&amp;amp;utm_content=note&amp;amp;...博文来自： 坚持写啵

学习1368个单词 - 有关物和人的名词
阅读数 614

最近闲来无事、想提升自己一下。先来张图镇一下本篇文章主要记录一些分类的单词，用于之后的查阅，单词来自《1368个单词就够了》-王了平，有时间的朋友可以去看看。学习英语的好处就不多说的，可以看看下面的文...博文来自： sjxt's blog

搭建图片服务器《二》-linux安装nginx
阅读数 2万+

nginx是个好东西，Nginx (engine x) 是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambl...博文来自： maoyuanming0806的博客

YOLOv2训练自己的数据集（VOC格式）
阅读数 3万+

最近在用yolo来做视频中的人员检测，选择YOLO是从速度考虑，在训练数据集的过程中碰到很多坑，并且现在yolo又到了v2的版本，在网络和命令中都有区别...博文来自： ch_liu23的博客

高斯混合模型（GMM）及其EM算法的理解
阅读数 8万+

一个例子高斯混合模型（Gaussian Mixed Model）指的是多个高斯分布函数的线性组合，理论上GMM可以拟合出任意类型的分布，通常用于解决同一集合下的数据包含多个不同的分布的情况（或者是同一...博文来自： 小平子的专栏

OpenCL性能优化实例研究系列2：避免Local Memory Bank Conflicts的两个简单方法
阅读数 2262

转自：http://hi.baidu.com/fsword73/item/51df1fafe6083e268919d39e 作者: ?fsword73 Bank Conflicts 是存储...博文来自： lucky_greenegg的专栏

linux上安装Docker(非常简单的安装方法)
阅读数 13万+

最近比较有空，大四出来实习几个月了，作为实习狗的我，被叫去研究Docker了，汗汗！ Docker的三大核心概念：镜像、容器、仓库 镜像：类似虚拟机的镜像、用俗话说就是安装文件。 容器：类似一个轻量...博文来自： 我走小路的博客

jquery/js实现一个网页同时调用多个倒计时(最新的)
阅读数 19万+

jquery/js实现一个网页同时调用多个倒计时(最新的) 最近需要网页添加多个倒计时. 查阅网络,基本上都是千遍一律的不好用. 自己按需写了个.希望对大家有用. 有用请赞一个哦! //js ...博文来自： websites

keras实现常用深度学习模型LeNet，AlexNet，ZFNet，VGGNet，GoogleNet，Resnet
阅读数 6034

LeNet #coding=utf-8 from keras.models import Sequential from keras.layers import Dense,Flatten from...博文来自： wmy199216的博客

centos 查看命令源码
阅读数 2万+

# yum install yum-utils 设置源: [base-src] name=CentOS-5.4 - Base src - baseurl=http://vault.ce...博文来自： linux/unix

强连通分量及缩点tarjan算法解析
阅读数 32万+

强连通分量： 简言之 就是找环（每条边只走一次，两两可达） 孤立的一个点也是一个连通分量 ? 使用tarjan算法 在嵌套的多个环中优先得到最大环( 最小环就是每个孤立点） ? 定义： int Ti...博文来自： 九野的博客

MATLAB中注释一段程序
阅读数 1万+

在MATLAB中，可以注释一段程序。 使用“%{”和“%}”。 例如 %{ 。。。 %} 即可。 经典方法是用 if 0，但缺点是不够直观，注释掉的内容仍然保持代码的颜色。现在可以用 ...博文来自： 知识小屋

VMware虚拟机配置文件(.vmx)损坏修复
阅读数 4万+

前言： 对于VMware虚拟机配置文件(.vmx)损坏 大家发生问题的原因可能跟我不一样，但是解决方法应该是一样的. 但是本方法仅适用.vmx文件损坏而其他文件完好无损的情况。 ...博文来自： shuideyidi的专栏

C# 基于SharpPcap的局域网数据包捕获 之二 监听代码
阅读数 4201

1.配置好sharpPcap引用和安装好winPcap后，添加引用 using PacketDotNet; using SharpPcap; using SharpPcap.AirPcap; usi...博文来自： wuma0q1an的博客

ArcGIS VS QGIS——两者之间的27点比较上篇（译）
阅读数 9972

本文是笔者刚刚接触QGIS相关博客资源时找到的一篇文章，全文比较长，因此分成两篇发布。就内容而言不代表笔者观点，留待后续一一验证。QGIS和ArcGIS的比较你也许伴随着ArcGIS或者QGIS而成长...博文来自： 番茄园

DirectX修复工具增强版
阅读数 182万+

最后更新：2018-12-20 DirectX修复工具最新版：DirectX Repair V3.8 增强版??NEW! 版本号：V3.8.0.11638 大小: 107MB/7z格式压缩，18...博文来自： VBcom的专栏
颜色模型?损失函数模型?算法模型?随机森林stacking模型?泰坦尼克号随机森林模型构建
3个数字最大值 c#?c++指针输入3个整数?c#怎么保留3个小数点?c#怎么输入3个值?c#软件用长时间就会卡炼数成金python教程?python在线教育平台

人人都是产品经理V
关注
原创
81
粉丝
303
喜欢
179
评论
975
等级：
?

访问：
?
41万+
积分：
?
5712
排名：
?
7294
勋章：
最新文章
?从4P理论说起，luckin coffee 火爆背后的可能原因
?为什么产品0经验和产品1年经验薪资相差一倍多？
?车载系统中，交互设计的「三秒原则」
?有一个很棒的想法，如何向老板证明你是对的
?与其一个人闷头苦学，不如让老司机指条明路！
归档
?2018年5月34篇
?2018年4月130篇
?2018年3月111篇
?2018年2月69篇
?2018年1月66篇
?2017年12月103篇
?2017年11月111篇
?2017年10月5篇
展开
热门文章
?后台经验分享：如何做权限管理系统设计？
阅读数?43488
?
?我在阿里的第322天，这是我的review
阅读数?17248
?
?深度：一套系统从无到有的设计
阅读数?12580
?
?月薪18k+的产品经理，都是这样玩Axure的！
阅读数?10897
?
?关于抖音，这应该是全网最深度的分析
阅读数?10400
?
最新评论
?成为运营，最重要的能力到底是什么？
wjf1997：好文 值得一看
?
?深度解析｜互金用户增长模型背后，最...
weixin_34073858：好文好文
?
?还在因为不懂技术被嘲？试试用10天...
weixin_44582739：怎么购买怎么学习？
?
?后台经验分享：如何做权限管理系统设...
weixin_37778679：问下如果一个人多个角色 登录进去页面显示那个角色的权限呢
?
?后台经验分享：如何做权限管理系统设...
weixin_37778679：求分享源码407819228@qq.com
?

微信客服

QQ客服
kefu@csdn.netQQ客服
客服论坛400-660-0108
工作时间 8:30-22:00
关于我们招聘广告服务?网站地图
百度提供站内搜索?京ICP证19004658号
?1999-2019 北京创新乐知网络技术有限公司
经营性网站备案信息网络110报警服务
北京互联网违法和不良信息举报中心
中国互联网举报中心
Python实战训练
转型AI人工智能指南
数据库沙龙
21 天入门机器学习
登录
注册
?
0
?
?
5
?
?
?
?

?
?
?



?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>财经>正文

凤凰牌老熊
168文章
11万总阅读
查看TA的文章>
0
?分享到
?
?
?
20170919-互金（借贷）账户设计?
2017-10-19 06:59银行/贷款/P2P
一、主题分享：互金（借贷）账户设计
我从05年开始接触软件行业，曾经在用友工作多年，到现在一直从事信息化系统方面，干过服务、产品经理、咨询，今年正好加入一家P2P行业，任财务支付产品经理，负责账户、支付、清结算、会计处理等方面的工作；另，本文是参考同行业内做法，与笔者所在公司业务无相关性。
1. 互金行业及p2p概述
   图一：互金行业及p2p概述

互金行业主要分为六个大方向三方支付、P2P、大数据金融也就是类似花呗，白条等，众筹等。这次主要介绍p2p借贷分为：
.
纯线上的，入线上理财，线上借款；
.
.
o2o线上线下结合，就是理财端线上，资产端线下，线下主要负责风控、催款等；
.
.
债权转让模式，就是现在p2p流行的定期模式，具体可百度。
.
p2p行业属于互金的一个分支，贷款对于大家来说比较了解的，有支付、p2p、阿里、微信、京东白条做的信用贷的产品，众筹模式和其他一些东西等等形成的在互金行业的一些特色；
?
对于纯线上的模式来讲，企业通用做法是：从线上获取贷款，在线上进行操作理财；很多企业最早都是采用这种模式。
?
?
对于线上线下结合的方式，从国家对金融监管来说，理财端只能从线上发展；对于资产端，可以从线下进行风控和审批、或者催收；从优质资产考虑和统计数据表明，线上线下结合的模式比纯线上模式坏账率要低很多；
?
?
债券转让模式主要是在理财端，我们现在以定期和活期为主。最早买p2p以散标的模式，现在这种模式已经很少了。目前主要是债权转让的模式做定期和活期，而且以定期为主，活期因为监管要求已经下架。
?
图二：p2p行业涉及的业务

从p2p的整个业务链条来说有资金端、资产端两个部分：
?
从资金端来讲，主要是理财人为主，以线上为主要方式，符合法规。资金端主要是理财人以散标、活期、定期等几种方式进行投资。理财人登录p2p平台，选择理财产品，有散标、活期、定期，目标基本以定期为主，散标目前比较少，原因是散标在点对点情况下，借款人的时间太长导致回访过高 。活期，比如各种宝，由于不合规，各平台正在换其他方式。定期，1/3/6/12个月这种模式比较流行，大家在在各大平台都有接触； 根据你选择的产品进行投标，以合适的身份进行匹配后，在满标后进行放款。
?
?
相对来说，资产端就比较复杂一些，平台通过门店展业、电销、线上推广、资产购买等模式发展，经过相应的进件，审批，合格后进行签约，线上的话流程比较简单，线下就比较复杂，主要是按照贷款产品的额度进行区分。资产签约后上标与理财人进行匹配就可以放款了。后期按还款计划进行还款。
?
2. p2p业务类型
   图三：p2p业务类型(典型)

对于p2p有些典型的业务类型，对于前台来看一个动作，比如说充值。对于后台来说有很多种情况需要业务处理。
.
对于以充值来说，有理财人充值和借款人充值。对于理财人充值，后期购买哪些产品就是投资，购买类型就是定期、活期还是散标；对于借款人充值，则目的是为了进行还款。
.
.
对于红包来说，现在p2p平台竞争也比较激烈，所以很多p2p平台会做一些活动；比如大家进去之后，注册之后就送优惠券、体验金和代金劵等一些营销活动方面的推广， 对于业务活动都会有资金投入的，涉及到后期的业务处理；
.
.
对于赎回的话，投资的赎回，会涉及本金和利息；
.
.
对于放款，对于我们平台来说，标的满标之后才能向债权人进行放款；
.
.
对于提现可能会有余额的提现，剩余多少提现金额；
.
.
对于还款的话，对于借款人来说会有还款方式和还款业务不同，像蚂蚁借呗，是采用线上还款方式；对于一些传统业务比较多的p2p公司，可能会有门店还款、代扣(代收)或者对公的还款方式；
.
.
对于代偿来说，大部分的平台，都是一些代偿的行为。
.
.
对于提现代垫，做p2p的公司有支付牌照的很少，基本上需要通过支付平台或者银行来走；在支付平台一般选择T1结算，选择T0费率比较高，且T0提现需要代垫，然后在T1在进行结算；
.
.
对于代扣，就是对借款人银行卡进行定时扣款，比如买房公积金贷款，公积金还款的话就是以代扣模式走的；
.
3. 功能设计总图
   图四：功能设计总图

从业务架构上，业务端统一对接支付平台进行现金的收支转等信息，支付平台在完成支付过程中，同步数据到账务管理和清结算平台。账务管理和清结算在数据处理后，传递到会计处理。这一个过程说起来比较简单，但是实际由于企业发展不均衡，很多公司业务平台先于支付平台建立，这样的话就需要对各条业务线进行梳理，进行标准化设计，对业务系统查缺补漏，统一业务流程和接口方式。
从业务结构设计上来讲，支付负责进行现金账务管理负责资金的变动，清结算负责对账，进行账实核对，会计处理负责复式记账，试算平衡及日切等。总体流程是，支付订单向账务管理写入账务的流水数据，向清洁算写入清洁算的流水数据，并在清洁算的过程中进行对账处理，这样从系统设计上来说两边互不干涉。会计处理分别获取账务管理的数据和清洁算的数据，这样分别获得交易的确认和账务的确认，在会计处理这块儿相当于两个合一。
对于这个模式，看起来比较简单。但是由于互联网发展速度比较快，对于互联网企业来说一般都是先有业务，再有管理；业务的发展速度会快于系统的整体规划速度，这样会导致同样的功能点，同样的业务处理，在不同的系统处理方式不一致。没有形成一个的统一系统的处理。然后从设计的角度上，不仅要考虑系统架构的适用性方面，而且要考虑公司逐步实现的步骤；
4. 会计处理功能设计
   图五：会计处理功能设计

账务处理内容就不讲了，对大家大同小异。对于会计处理这块，对很多公司来讲如果只为了满足报税需求的话可以做的比较简单，不用考虑区分账簿的事情。但是对于p2p行业来说，国内本来就要求出两套表，而且这个行业在国内上市和国外上市要求不同，则报表也不同。所以设置影响的字段，根据交易设置模板，可根据不同账簿设置不同模板，也可以使用管理账簿+erp软件结合的模式；
对于大多数互金行业，只需要考虑国内审计或国内报表。但是对于p2p行业，对于行业监管责任要求，需要监管资金报表和平台收益的报表；对于需要国内和国外上市，需要准备国内上市报表和国外上市的报表，这都是不一样；
对于系统设计来说，同样业务处理过程，入账因素根据不同的会计准则进行设置（中国或美国的，还有国内和国外的）。不同的影响因素形成不同的模版，不同的模版生成不同的账簿凭证，不同的账簿凭证生成不同的账簿报表。这样可以满足我们不同业务对象的要求；
对于这点来说，处于整体设计的考虑，像sap，oracle、用友和金蝶这些软件都有多账簿模式，我们采用自己内部的管理账簿加上erp里面实行的对外账簿，形成管理账簿+erp的外部账簿相结合模式，即管理账簿+erp的软件结合模式，从成本和软件应用性来说，实现度比较高.
5. 账务处理和会计处理的区别
   图六：账务处理与会计处理的区别

对于账务处理来说他只是根据账户的设置进行流水的处理，以收付实现制为基础，就像支付宝的账单一样。根据流入流出的方式更新余额。
对于会计处理来说他是以科目为主，以权责发生制为基础，资产、负债、所有者权、损益、成本、共同类进行复式记账。如图中以充值为例。
账务的处理跟会计分录有什么区别。从账户的角度，是以收付实现制为基础的；对于会计处理来说他是以科目为主，以权责发生制为基础；收付实现制法则设定相应的目标账户以资金的流入、流出和余额为标准的，只是解决流入和流出；对于会计科目来说，他解决为流入这笔钱来自哪里，流出这笔钱要去哪里，要有一个权责确认的过程；
对于图六来说，针对用户充值这个场景：对于账户来说，只是一条资金流入，多少钱、余额多少；对于会计科目来说需要分全面考虑，
.
考虑对账前，因为跟银行或者支付机构进行确认，需要有一个待清算款项；
.
.
在T+1，银行和支付机构对帐流水出来后，需要进行对账；
.
.
对账完成后，相当于把待清算转成应收账款。这个充值场景的一笔充值记录在后台对应多笔会计分录；
.
6. 账户
   图七：账户（以厦门银行存管账户为例）

这地方要理解一个概念，从账务处理来讲虚拟户是解决资金归属问题，而不关心资金的存放问题。实体户是解决资金存放问题，跟虚拟户是对应关系。从会计处理讲，实体户属于资产，虚拟户属于负债及其他。
对于实体户和虚拟户组成，从平台的角度来说，需要跟银行有一个开户的过程，用来解决资金存放的问题（存放在银行存管户、银行自由资金户还是银行垫资专户）；对于虚拟户来说，钱是从投资人、借款人或居间人那一方来的，是属于收入的还是营销的。
对于实体户，只关心资金存放；对于虚拟户（比如说投资户、借款户还有收入户），关心资金归属。举例：在平台银行账户存入一笔钱，是属于投资人还是借款人；从实体户的角度来说是资产，从虚拟户的角度来说是负债（属于平台欠投资人／借款人的钱，对于平台来说是负债）。
由于p2p平台的特殊性，不止有收入的问题，还会有营销款支出、代偿、代垫、分润、当中值，分润有相关业务，对于没有按时还款进行代偿代垫等这些内容就不在这里展开了；
7. p2p业务的基本资金流
   图八：p2p业务的基本资金流

从p2p业务的资金流来讲，涉及到投资人结算户、投资人债权户、借款人债务户、借款人结算户。从正常的一个投资放款流程来说，投资人向结算户充值、然后进行投资，资金进入债权户（假如投资不成功会返回至投资人结算户），平台通过撮合满标后放款到借款人债务户，在债务户进行各种费用的收取后放款到借款人结算户或者银行卡。反之亦然。
对于账务处理来说，只是关心各个账户对象，资金在各个账户流入流出，只是资金转移的过程；对于资金从哪里来的，资金应该属于谁不在账务处理；
对于图八从右至左来看是一个借款人还款的过程：借款人通过充值或者代扣的方式进行还款到结算户，通过结算户根据账单把还款金额冻结到债务户，通过债务户还款到债权人（投资人）的债权户，假如有复投，债权人（投资人）进行复投到其他标的；假如没有复投，就赎回到结算户，债权人（投资人）可以选择自己提现或者进行其他标的的投资。
8. 科目设置
   图九：科目设置

科目对于会计处理至关重要，我简单列举了目前业务所需要的科目，比如资产类的银行存管就有专管户和自有资金户，应收账款根据我们现在支付通道清算。委托贷款核算债务，负债类包括理财人和借款人的放款和还款，利息是贷款利息，损益中有收益户作为收入，共同类有待清算。
?
银行存款 从科目的角度来说，这些资金从哪里来，存到哪里去；存的资金在哪里：我们在银行有资金专管户（银行存管户）、自有资金户；
?
?
资金在资金专管户（银行存管户），平台是不能动此部分资金，平台只能发出信息（使资金在投资人和借款人之间的互转）；
?
?
专门自有资金户，在平台上通过撮合的标的形成的收益，会通过存管银行转到平台自有资金户；
?
?
对于应收账款，我们支付情况的收款；从业务处理上，属于理财人委托贷款给借款人(债务人)，相当于有一个委托贷款科目进行核算债务；
?
?
对于负债类，对于p2p来说应该是理财人和借款人；
?
理财人的存入款和借款人的存入款不一样，可能理财人投资本金和投资收益，还有借款人投入的存入款和待发放款项；其实这块儿在有些企业，会把存入款合在一起；对于我们平台，为了保证理财人和借款人分离，我们设了两个；利息单独处理，损益类有收益户，还有共同类的待清算；
9. 账务处理和会计处理
   图十：账务处理与会计处理

这张图从四个方面同一笔交易所涉及到的账务处理、会计处理、对账等事宜。从交易处理、账务处理、会计处理和对账处理，形成一个完整的企业数据流；
以放款为例：
?
对于交易处理：放款就是一笔支付；
?
?
对于账务处理：从债权户到债务户，从债务户到结算户然后到结算户的银行卡，同时还涉及到收益户的处理；为什么有这么多处理步骤，站在平台角度：
?
?
1. 需要在放款的时候才确认从债权到债务的处理；
   ?
   ?
   2.在债务处理的时候，需要把钱放在借款人债务户，并相应把钱划到结算户和收益户（会收取一定费用）；
   ?
   ?
3. 针对部分客户有需求是打款到银行卡，所以平台需要记录从债权户到债务户、债务户到结算户、结算户到银行卡的这条流水处理过程，以保证账务流水处理的一致性；
   ?
   ?
   对于会计处理：从账务里面看到几笔处理（黑色箭头部分），每个账务处理后，会计处理的凭证是怎样的。比如贷款，债权户到债务户的确定，会记待发放款项；待发放款项放款，放款金额和合同金额会有差距，所以放款金额会单独形成待清算目录，假如T+1账单来了，形成清算，对于收益户来说计入收益；
   ?
   ?
   对于对账处理：支付流水和确认银行流水对账以后，形成应收账款；然后对于结算来说，形成相应的银行余额进行结算，并形成结算的单据凭证；
   ?
   账务处理在相应的账户处理举例：
   1.账户处理-充值
   图十一：账务处理-充值

首先分业务类型、根据业务类型选择资金项目，根据资金项目来进行充值，可以充值到投资人或借款人下面；
2. 账务处理-放款
   图十二：账务处理-放款

简化的放款账务处理：放款的情况下资金项目涉及到合同额和服务费两个项目，对于合同额投资人来说是流出，对于借款人来说是流入；借款人流入其实就是债务户的流入，然后形成一个流出；对于合同额（放款额）来说，相当于提现；对于服务费相当于收入账户和分润账户；
3.账务处理-还款
图十二：账务处理-还款

还款的账务处理（棕色部分）：停车费还款涉及到的资金项目有本金、停车费、利息；这些类型还到借款人账户上，这些钱会有几个步骤：从本金还到投资人债权户上，停车费放在收入账户和分润账户，利息放在派息账户；相当于还款部分，异地还款在债务户里面的资金处理是不一样的，流向也是不一样的，相应的后台会计处理也是不一样的；
由于时间比较紧张，大概简单的把内容给大家介绍了一下。由于这个行业业务比较多，我举例子也只能举一些简单的，如果有兴趣的我们可以详细交流；
二、主题Q&A
Q1：还款里说的停车费项目 没太理解
A：我只是举个例子，在车抵贷里，我们会一些服务费收取，停车费也是一个名目，还有好多其他费，我就不列举了。所以你会接到很多电话来让你借款的。
Q2：你们那边对于支付调用第三方通道，丢单有哪些措施出来吗？能最大限度减少，丢单
A1：这个你问住我了，我们现在对接了4，5个支付平台，目前采取的是如果超过一定时间没有结果，直接调对方查询接口的情况，而且支付平台都是t+1，所以有我们在对账的时候也会进行对于我方成功，对方失败，对方失败，我方成功这种进行交易流水处理；
A2：就你了解到的方案，除了这2种，不知道还有更好的没？
A1：你们调单多么？
A2：我们是想做一个聚合支付，通道很多，现在就想最少丢单
A1：我们目前很少。所以还真没有考虑这方面太多。因为有很大一部分存管后，我们和银行对，当天做回盘文件。
Q3：如下问题截图红线框出来的，应收账款是资产，余额方向在借方；我理解支付对账，是支付清算对账；支付清算 、 支付结算后怎么贷两次应收账款？
A1：感谢，第五个拷贝过去的时候没有改，我改一下（修改后的为图十：账务处理与会计处理），但是要是从公司整体业务来讲也没有错，因为你看到我标注余额了么，结算是平余额的，改成这样就比较怪，不过逻辑是顺的
A2：应收账款， 属于资产， 那他的余额方向应该在 借方；支付清算的时候， 贷了一下， 那就是减少
A1：这笔交易就相当于提现
A2：结算的时候， 又 借了 一下， 拿就是增加
A1：放款是提现
A2：噢，对的
A1：因为结算是按余额结算
A2：最后那个，银行存款，现金库存 更好些
A1：现金有专门含义的
A2：嗯嗯，我们这个叫那个1001
A1：一级分录1001 1002，二级分录100201 100202

Q4：如下问题截图中红线框出来的这步不记分录吗？
A1：不计入，因为我们会计分录没有单设债务户；债务户对我们来说就是冻结的概念

Q5：你这虚拟账户系统，有总账概念？账户不平是通过人工调账？
A1：为什么这么说？能详细描述一下
Q6：感觉你们这没有 出借账户 、 借款账户 余额的概念？
A1：你们怎么定义这三个名词的呀
A2：金融办定义的，出借人, 借款人；P2P 是不叫投资人，叫 出借人
A1：是的，我们还有叫理财人，意思其实一样
A2：大家都理解就行，尽量向监管靠齐
Q7：貌似现在P2P要做资金托管了
A1：我这是以托管为范本的呀，要是非托管，我就不会做的这么复杂了
Q8：那个图是 线下定向委托， 线上融资；定向委托融资是陆金所发明的
A1：我没写，这个东西不好写把；我默认都是线下开发资产，线上进行匹配；现在这个都是合法的

苹果用户扫描小程序打赏，谢谢
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (492)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?汇率
?虚拟货币
?贸易战
?映客
?苹果
?蚂蚁金服
?微商
?双十一
?第三方支付
?债券通
?前海人寿
?可燃冰

时寒冰：又到了无法忍受去杠杆之痛的时候！
功夫财经?·?02-22 11:3071

内蒙矿难背后的兴业矿业：赤峰首富与中植系卷入
大摩财经?·?今天 13:15102

石家庄“问题别墅”有蹊跷 丽豪地产背后的老大曝光
运营商财经网?·?02-19 11:45490

澳大利亚终于感觉到痛了！铁矿石之后，中国已经禁止进口澳煤炭！
金十数据?·?02-21 15:18117
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 16:31

加拿大终于承认，没有华为将落后于他国！多国改口下美国计谋落空
金十数据?·?02-15 11:211

马云同学聚会开路虎，任正非请同学吃饭，开的车却是十多万的标致
担扑?·?02-18 16:41133

中国发现超巨型油田！石油底气终于足了，连中东都非常羡慕！
乐趣逗?·?02-18 21:2861

捷克态度又反转！华为终于忍无可忍，或将采取法律行动反击？
金十数据?·?02-11 17:48116
雇佣兵入赘豪门遭妻子冷眼亮出身份后另妻子唯命是从！！
?
?
?
?
?广告?·?今天 16:31

又一“股神”副省长栽了！内幕交易狂赚3.6亿，一审获刑20年，还被罚了3
炙手可热搜?·?昨天 10:16?

刘强东：永远不会开除任何一个兄弟！啪啪打脸...
优势智业营销策划?·?02-22 16:53402

安徽富豪留下烂摊子开溜：欠债37亿，巨亏25亿，套现15亿走人
朱邦凌?·?02-20 17:291817

京东裁员10%副总裁高管：“辞退100名员工，不如辞掉一个平庸的管理者”
慧恩人力?·?02-20 15:26?
拥有香港身份,商务往来便利,保留大陆国籍,一人移民全家三代均可移居,福利的待遇与香港公民无差别！
?广告?·?今天 16:31

我国唯一宣布破产的5A景区，负债竟达8亿多
中华摄影报?·?昨天 23:1594

外资疯狂涌入中国，他们看上了什么
肖磊看市?·?02-22 11:30?

中国即将迎来人口大迁徙，“抢人大战”进入升级版！
北京山东同乡沙龙?·?昨天 19:38?

任正非：华为员工2018年平均年薪110万，留不住人
奇葩office?·?02-17 20:41169

这些股票跌至黄金底 放心大胆买入 加微信领取这类股票
?广告?·?今天 16:31

黄金周评：刺激！金价暴涨暴跌坐足“过山车” 超级周重磅来袭
FX168财经?·?今天 14:11?

网商银行何以大幅缩减大额存单发行 存款可能是关键
四维环球金融智库?·?今天 13:44?

慈溪知名企业卓力集团董事长去世，享年53岁！上个月工商登记已变更...
深度慈溪?·?02-22 18:321

谁杀死了“味精大王”：河南明星企业坠落，莲花味精预亏3亿
有道热点?·?今天 00:16787
?广告?·?今天 16:31

公摊面积取消后房价上涨还是下跌？央视给了意想不到的答案
光宇吐楼市?·?今天 12:04?

5千年前是埃及人主食，根茎如巨型人参，如今成越冬高价滋补品
中华摄影报?·?今天 13:12?

一个快被中国制造搞死的“世纪大骗局”
大猫财经?·?02-21 08:111308

费列罗年营业额超815亿元，百威英博购鸡尾酒品牌，汇源首度回应高管离职传闻，法国奶粉...
小食代?·?02-22 19:09?
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 16:31

稳步上涨？房价走势越来越清晰了，2019年……
合肥房地产交易网?·?今天 11:33?

又一家中国500强企业陷债务危机！53亿债难偿付，互保是祸首？
朱邦凌?·?今天 07:3956

马云王健林1亿赌期将至，万达再卖37家百货门店，开启甩货转型
三言财经?·?今天 14:12?

奖金8000万，年收入近八位数，如今她却身陷囹圄
华商韬略官方账号?·?昨天 14:42337

好书集结令 中国古典名著100部 趁现在抢藏！
?广告?·?今天 16:31

任正非：改写欧美商业规则的中国老板
港股解码?·?昨天 10:001006

我国楼市终于要告别公摊面积？不止是影响房价那么简单！
杠杆游戏?·?昨天 23:40246

王亚光：A股还将深跌，创业板可能也并不例外
王亚光?·?今天 14:49?

郭台铭：每个员工每天都得吃蛋，企业建立检验室把关食品安全
奇葩office?·?昨天 16:12?
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 16:31

60多万人被骗700多亿！380多网贷平台被封，100多老板高管失联，内幕触目惊心！
安徽共青团官方?·?今天 12:00?

巴菲特手握1120亿美元现金，“希望大规模收购，无奈太贵了”
每日经济新闻?·?今天 00:11181

一不小心又要扮救世主？国际贸易濒临冻结，全世界都在等着中国的刺激政策
智谷趋势?·?今天 09:122

胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成"校友"
投资家?·?今天 15:51103

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 16:31

国内一年产值330亿，最初入侵全国泛滥各地，如今火遍大街小巷
中华摄影报?·?今天 12:53?

踩雷卡夫亨氏，减持苹果，巴菲特为何仍是无法超越的投资大师？
郭施亮的博客?·?今天 14:46?

这只独角兽新年后被近百家机构调研
证券数据宝?·?今天 12:19?

【重磅财经前瞻】2月PMI数据公布在即 机构称警惕A股调整风险
中新经纬?·?今天 14:58?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 16:31

各地“抢人大战”正酣，他们为什么选择“重返北上广”？
中新经纬?·?今天 08:121860
月薪万元招不到人企业别只顾着喊冤
北京青年报?·?今天 05:011239

展锋：下周最值得关注的板块和个股！（2.23）
展锋?·?昨天 18:281

寿命长达60年，能上树下水无所不能，如今却活不过10年
中华摄影报?·?今天 12:56?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 16:31

全球“降税潮”！日欧互相抵消，特朗普没想到，澳大利亚对华……
第一白银网?·?今天 00:0411

这货浑身都是刺，树叶清香却是极品野菜，二月最嫩不吃可惜了
中华摄影报?·?今天 13:01?

复购率直逼毒品？电子烟成2019年第一个资本风口
环球老虎财经?·?今天 12:19?

四连涨！油价又要变！
合肥在线?·?今天 12:231
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 16:31

事关亿万手机用户！中国5G再出大招领跑全球 华为任正非重磅喊话！
巨丰财经?·?今天 07:37101

巴菲特2018年15大重仓股：苹果位居第一，通用汽车、比亚迪跌出榜单
华尔街见闻?·?昨天 23:3638
著名投资人林园：炒股从不用杠杆，未来医药股能出世界级公司
经济日报?·?今天 10:12

凤栖阁：气质美女-夜色下的大眼睛美眉！
光影旅法师?·?今天 09:16
源产地直销，没有任何中间商，低于市场价一半，品质更佳！
?
?
?
?
?广告?·?今天 16:31

一周要闻回顾 与 下周财经前瞻
格隆汇?·?今天 12:30

凤栖阁：气质美女-办公室里阳光可爱的女白领！
光影旅法师?·?今天 09:34

亏损扩大的爱奇艺，为何股价反涨？
钛媒体APP?·?昨天 20:37

孙宏斌之子上台，女首富杨惠妍掀地产二代上位潮，王思聪唱反调
有道热点?·?今天 00:24
12寸平板电脑598元特惠抢购

?广告?·?今天 16:31

继裁员后 滴滴将在2月25日起减少员工各项福利
投资家?·?昨天 22:34
九成银行一年定存利率上浮超30%
中国经济网?·?昨天 08:32

佛山一学生58同城找兼职 遇上“钓鱼”公司被骗3000元
金睿?·?今天 11:13
中国人寿管理层揭开业绩升降谜团 未来将优化资产配置体系
人民网?·?今天 07:26

海参怎么泡发才是正确的，一招教你快速泡发10几倍！
?广告?·?今天 16:31

股神巴菲特股东信出炉：去年净赚40亿美元，靠什么跑赢大盘
澎湃新闻?·?昨天 22:40

剖析爱奇艺，虎牙，B站股价发展动态
创业家?·?今天 13:16
股神巴菲特最新市场判断：今年会继续增持股票，扩大海外投资
澎湃新闻?·?今天 08:20

牛味浓！关注7只低位优质股
益盟好股?·?今天 14:01

惊呆！原来去眼袋那么容易，在家也能轻松去眼袋！
?广告?·?今天 16:31
508亿吸并白药控股 云南白药重组“三易其稿”
中国经济网?·?今天 08:16

操盘论市：先行指标暴涨之后，这些板块将迎来大机会！
益盟好股?·?今天 13:36

美股上演一场超级逼空大戏：净空仓已经降至十二年低位
华尔街见闻?·?今天 11:36

新加坡三大银行去年盈利大幅增长
经济日报?·?今天 14:02

北上资金生猛！连买18天，开年流入速度激增1.6倍，连续7周买入这些股
证券数据宝?·?今天 12:16

凤栖阁：气质美女-雪肤玉肌的美少女！
光影旅法师?·?今天 09:10

孙宏斌的神级家教：长子金融才子预备接班，少子叱咤全美网坛
金融街侦探?·?昨天 15:14

流感疫苗一针难求背后的双轨难题
经济观察报?·?昨天 17:22
评估租金482万元成交价1800万元 从一处国有资产拍卖增值看我省国有资...
东北网?·?今天 07:09

凤栖阁：清纯美女-明眸皓齿的长发姑娘！
光影旅法师?·?今天 09:22

胡玮炜卸任摩拜CEO后：花69万上这所大学，比马云湖畔大学贵40万
商悟社?·?今天 11:50
全省贷款余额首次突破四万亿元
中安在线（安徽新闻）?·?今天 05:16

巴菲特最新股东信披露重点持仓股，我们能学到什么？
新京报?·?今天 12:30

上海炒股养家，写给踏空的人！
黄生说金融?·?今天 09:37

起底银漫矿业：今年近5亿业绩承诺 被上市公司视为主力
新京报?·?昨天 23:54

巴菲特股东信十大看点：踩中商誉减值天雷，仍未公布接班人
澎湃新闻?·?今天 08:11
已经到底了

广告

热门图集
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
野狼被塑料罐卡住头 高温中挣扎3小时
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
??
?麦田藏北宋钱庄 团伙盗挖4吨古钱币
?化学老师走红 讲解"恋爱中的化学"
?高晓松个站成立 应援图让人不敢认
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
A股最奇葩敲诈案：被勒索2099个比特币
1.2亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
1.1亿?阅读
3
史上最低价保险股中国人保今申购：半年仅此一次！有望100%...
1.1亿?阅读

社科院：三四线城市房价不再涨了！有钱也买不到房逻辑是否...
1.1亿?阅读

一文带你了解中美贸易战来龙去脉
1.1亿?阅读
广告
搜狐号推荐

券商中国
致力于提供最及时的财经资讯，最专业的解读分析，覆盖宏观经济、金融机构、A...

和讯网
中国财经网络领袖和中产阶级网络家园,创立于1996年,是中国最早而且最大的财...

搜狐财经快讯
搜狐财经出品，第一时间发布有价值的财经讯息。

朱邦凌
财经专栏作家，腾讯研究院特约研究员

第一白银网
第一白银网为白银投资者提供及时全面的财经资讯和知识。
广告

?联系我们
广告

24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1.2亿?阅读
2
财政部发文规范金融企业对地方政府和国有企业投融资行为（...
1.1亿?阅读
3
史上最低价保险股中国人保今申购：半年仅此一次！有望100%...
1.1亿?阅读

社科院：三四线城市房价不再涨了！有钱也买不到房逻辑是否...
1.1亿?阅读

一文带你了解中美贸易战来龙去脉
1.1亿?阅读
?返回
?首页
?用户
?反馈
?

Sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>财经>正文

凤凰牌老熊
168文章
11万总阅读
查看TA的文章>
0
?分享到
?
?
?
20170919-互金（借贷）账户设计?
2017-10-19 06:59银行/贷款/P2P
一、主题分享：互金（借贷）账户设计
我从05年开始接触软件行业，曾经在用友工作多年，到现在一直从事信息化系统方面，干过服务、产品经理、咨询，今年正好加入一家P2P行业，任财务支付产品经理，负责账户、支付、清结算、会计处理等方面的工作；另，本文是参考同行业内做法，与笔者所在公司业务无相关性。
1. 互金行业及p2p概述
   图一：互金行业及p2p概述

互金行业主要分为六个大方向三方支付、P2P、大数据金融也就是类似花呗，白条等，众筹等。这次主要介绍p2p借贷分为：
.
纯线上的，入线上理财，线上借款；
.
.
o2o线上线下结合，就是理财端线上，资产端线下，线下主要负责风控、催款等；
.
.
债权转让模式，就是现在p2p流行的定期模式，具体可百度。
.
p2p行业属于互金的一个分支，贷款对于大家来说比较了解的，有支付、p2p、阿里、微信、京东白条做的信用贷的产品，众筹模式和其他一些东西等等形成的在互金行业的一些特色；
?
对于纯线上的模式来讲，企业通用做法是：从线上获取贷款，在线上进行操作理财；很多企业最早都是采用这种模式。
?
?
对于线上线下结合的方式，从国家对金融监管来说，理财端只能从线上发展；对于资产端，可以从线下进行风控和审批、或者催收；从优质资产考虑和统计数据表明，线上线下结合的模式比纯线上模式坏账率要低很多；
?
?
债券转让模式主要是在理财端，我们现在以定期和活期为主。最早买p2p以散标的模式，现在这种模式已经很少了。目前主要是债权转让的模式做定期和活期，而且以定期为主，活期因为监管要求已经下架。
?
图二：p2p行业涉及的业务

从p2p的整个业务链条来说有资金端、资产端两个部分：
?
从资金端来讲，主要是理财人为主，以线上为主要方式，符合法规。资金端主要是理财人以散标、活期、定期等几种方式进行投资。理财人登录p2p平台，选择理财产品，有散标、活期、定期，目标基本以定期为主，散标目前比较少，原因是散标在点对点情况下，借款人的时间太长导致回访过高 。活期，比如各种宝，由于不合规，各平台正在换其他方式。定期，1/3/6/12个月这种模式比较流行，大家在在各大平台都有接触； 根据你选择的产品进行投标，以合适的身份进行匹配后，在满标后进行放款。
?
?
相对来说，资产端就比较复杂一些，平台通过门店展业、电销、线上推广、资产购买等模式发展，经过相应的进件，审批，合格后进行签约，线上的话流程比较简单，线下就比较复杂，主要是按照贷款产品的额度进行区分。资产签约后上标与理财人进行匹配就可以放款了。后期按还款计划进行还款。
?
2. p2p业务类型
   图三：p2p业务类型(典型)

对于p2p有些典型的业务类型，对于前台来看一个动作，比如说充值。对于后台来说有很多种情况需要业务处理。
.
对于以充值来说，有理财人充值和借款人充值。对于理财人充值，后期购买哪些产品就是投资，购买类型就是定期、活期还是散标；对于借款人充值，则目的是为了进行还款。
.
.
对于红包来说，现在p2p平台竞争也比较激烈，所以很多p2p平台会做一些活动；比如大家进去之后，注册之后就送优惠券、体验金和代金劵等一些营销活动方面的推广， 对于业务活动都会有资金投入的，涉及到后期的业务处理；
.
.
对于赎回的话，投资的赎回，会涉及本金和利息；
.
.
对于放款，对于我们平台来说，标的满标之后才能向债权人进行放款；
.
.
对于提现可能会有余额的提现，剩余多少提现金额；
.
.
对于还款的话，对于借款人来说会有还款方式和还款业务不同，像蚂蚁借呗，是采用线上还款方式；对于一些传统业务比较多的p2p公司，可能会有门店还款、代扣(代收)或者对公的还款方式；
.
.
对于代偿来说，大部分的平台，都是一些代偿的行为。
.
.
对于提现代垫，做p2p的公司有支付牌照的很少，基本上需要通过支付平台或者银行来走；在支付平台一般选择T1结算，选择T0费率比较高，且T0提现需要代垫，然后在T1在进行结算；
.
.
对于代扣，就是对借款人银行卡进行定时扣款，比如买房公积金贷款，公积金还款的话就是以代扣模式走的；
.
3. 功能设计总图
   图四：功能设计总图

从业务架构上，业务端统一对接支付平台进行现金的收支转等信息，支付平台在完成支付过程中，同步数据到账务管理和清结算平台。账务管理和清结算在数据处理后，传递到会计处理。这一个过程说起来比较简单，但是实际由于企业发展不均衡，很多公司业务平台先于支付平台建立，这样的话就需要对各条业务线进行梳理，进行标准化设计，对业务系统查缺补漏，统一业务流程和接口方式。
从业务结构设计上来讲，支付负责进行现金账务管理负责资金的变动，清结算负责对账，进行账实核对，会计处理负责复式记账，试算平衡及日切等。总体流程是，支付订单向账务管理写入账务的流水数据，向清洁算写入清洁算的流水数据，并在清洁算的过程中进行对账处理，这样从系统设计上来说两边互不干涉。会计处理分别获取账务管理的数据和清洁算的数据，这样分别获得交易的确认和账务的确认，在会计处理这块儿相当于两个合一。
对于这个模式，看起来比较简单。但是由于互联网发展速度比较快，对于互联网企业来说一般都是先有业务，再有管理；业务的发展速度会快于系统的整体规划速度，这样会导致同样的功能点，同样的业务处理，在不同的系统处理方式不一致。没有形成一个的统一系统的处理。然后从设计的角度上，不仅要考虑系统架构的适用性方面，而且要考虑公司逐步实现的步骤；
4. 会计处理功能设计
   图五：会计处理功能设计

账务处理内容就不讲了，对大家大同小异。对于会计处理这块，对很多公司来讲如果只为了满足报税需求的话可以做的比较简单，不用考虑区分账簿的事情。但是对于p2p行业来说，国内本来就要求出两套表，而且这个行业在国内上市和国外上市要求不同，则报表也不同。所以设置影响的字段，根据交易设置模板，可根据不同账簿设置不同模板，也可以使用管理账簿+erp软件结合的模式；
对于大多数互金行业，只需要考虑国内审计或国内报表。但是对于p2p行业，对于行业监管责任要求，需要监管资金报表和平台收益的报表；对于需要国内和国外上市，需要准备国内上市报表和国外上市的报表，这都是不一样；
对于系统设计来说，同样业务处理过程，入账因素根据不同的会计准则进行设置（中国或美国的，还有国内和国外的）。不同的影响因素形成不同的模版，不同的模版生成不同的账簿凭证，不同的账簿凭证生成不同的账簿报表。这样可以满足我们不同业务对象的要求；
对于这点来说，处于整体设计的考虑，像sap，oracle、用友和金蝶这些软件都有多账簿模式，我们采用自己内部的管理账簿加上erp里面实行的对外账簿，形成管理账簿+erp的外部账簿相结合模式，即管理账簿+erp的软件结合模式，从成本和软件应用性来说，实现度比较高.
5. 账务处理和会计处理的区别
   图六：账务处理与会计处理的区别

对于账务处理来说他只是根据账户的设置进行流水的处理，以收付实现制为基础，就像支付宝的账单一样。根据流入流出的方式更新余额。
对于会计处理来说他是以科目为主，以权责发生制为基础，资产、负债、所有者权、损益、成本、共同类进行复式记账。如图中以充值为例。
账务的处理跟会计分录有什么区别。从账户的角度，是以收付实现制为基础的；对于会计处理来说他是以科目为主，以权责发生制为基础；收付实现制法则设定相应的目标账户以资金的流入、流出和余额为标准的，只是解决流入和流出；对于会计科目来说，他解决为流入这笔钱来自哪里，流出这笔钱要去哪里，要有一个权责确认的过程；
对于图六来说，针对用户充值这个场景：对于账户来说，只是一条资金流入，多少钱、余额多少；对于会计科目来说需要分全面考虑，
.
考虑对账前，因为跟银行或者支付机构进行确认，需要有一个待清算款项；
.
.
在T+1，银行和支付机构对帐流水出来后，需要进行对账；
.
.
对账完成后，相当于把待清算转成应收账款。这个充值场景的一笔充值记录在后台对应多笔会计分录；
.
6. 账户
   图七：账户（以厦门银行存管账户为例）

这地方要理解一个概念，从账务处理来讲虚拟户是解决资金归属问题，而不关心资金的存放问题。实体户是解决资金存放问题，跟虚拟户是对应关系。从会计处理讲，实体户属于资产，虚拟户属于负债及其他。
对于实体户和虚拟户组成，从平台的角度来说，需要跟银行有一个开户的过程，用来解决资金存放的问题（存放在银行存管户、银行自由资金户还是银行垫资专户）；对于虚拟户来说，钱是从投资人、借款人或居间人那一方来的，是属于收入的还是营销的。
对于实体户，只关心资金存放；对于虚拟户（比如说投资户、借款户还有收入户），关心资金归属。举例：在平台银行账户存入一笔钱，是属于投资人还是借款人；从实体户的角度来说是资产，从虚拟户的角度来说是负债（属于平台欠投资人／借款人的钱，对于平台来说是负债）。
由于p2p平台的特殊性，不止有收入的问题，还会有营销款支出、代偿、代垫、分润、当中值，分润有相关业务，对于没有按时还款进行代偿代垫等这些内容就不在这里展开了；
7. p2p业务的基本资金流
   图八：p2p业务的基本资金流

从p2p业务的资金流来讲，涉及到投资人结算户、投资人债权户、借款人债务户、借款人结算户。从正常的一个投资放款流程来说，投资人向结算户充值、然后进行投资，资金进入债权户（假如投资不成功会返回至投资人结算户），平台通过撮合满标后放款到借款人债务户，在债务户进行各种费用的收取后放款到借款人结算户或者银行卡。反之亦然。
对于账务处理来说，只是关心各个账户对象，资金在各个账户流入流出，只是资金转移的过程；对于资金从哪里来的，资金应该属于谁不在账务处理；
对于图八从右至左来看是一个借款人还款的过程：借款人通过充值或者代扣的方式进行还款到结算户，通过结算户根据账单把还款金额冻结到债务户，通过债务户还款到债权人（投资人）的债权户，假如有复投，债权人（投资人）进行复投到其他标的；假如没有复投，就赎回到结算户，债权人（投资人）可以选择自己提现或者进行其他标的的投资。
8. 科目设置
   图九：科目设置

科目对于会计处理至关重要，我简单列举了目前业务所需要的科目，比如资产类的银行存管就有专管户和自有资金户，应收账款根据我们现在支付通道清算。委托贷款核算债务，负债类包括理财人和借款人的放款和还款，利息是贷款利息，损益中有收益户作为收入，共同类有待清算。
?
银行存款 从科目的角度来说，这些资金从哪里来，存到哪里去；存的资金在哪里：我们在银行有资金专管户（银行存管户）、自有资金户；
?
?
资金在资金专管户（银行存管户），平台是不能动此部分资金，平台只能发出信息（使资金在投资人和借款人之间的互转）；
?
?
专门自有资金户，在平台上通过撮合的标的形成的收益，会通过存管银行转到平台自有资金户；
?
?
对于应收账款，我们支付情况的收款；从业务处理上，属于理财人委托贷款给借款人(债务人)，相当于有一个委托贷款科目进行核算债务；
?
?
对于负债类，对于p2p来说应该是理财人和借款人；
?
理财人的存入款和借款人的存入款不一样，可能理财人投资本金和投资收益，还有借款人投入的存入款和待发放款项；其实这块儿在有些企业，会把存入款合在一起；对于我们平台，为了保证理财人和借款人分离，我们设了两个；利息单独处理，损益类有收益户，还有共同类的待清算；
9. 账务处理和会计处理
   图十：账务处理与会计处理

这张图从四个方面同一笔交易所涉及到的账务处理、会计处理、对账等事宜。从交易处理、账务处理、会计处理和对账处理，形成一个完整的企业数据流；
以放款为例：
?
对于交易处理：放款就是一笔支付；
?
?
对于账务处理：从债权户到债务户，从债务户到结算户然后到结算户的银行卡，同时还涉及到收益户的处理；为什么有这么多处理步骤，站在平台角度：
?
?
1. 需要在放款的时候才确认从债权到债务的处理；
   ?
   ?
   2.在债务处理的时候，需要把钱放在借款人债务户，并相应把钱划到结算户和收益户（会收取一定费用）；
   ?
   ?
3. 针对部分客户有需求是打款到银行卡，所以平台需要记录从债权户到债务户、债务户到结算户、结算户到银行卡的这条流水处理过程，以保证账务流水处理的一致性；
   ?
   ?
   对于会计处理：从账务里面看到几笔处理（黑色箭头部分），每个账务处理后，会计处理的凭证是怎样的。比如贷款，债权户到债务户的确定，会记待发放款项；待发放款项放款，放款金额和合同金额会有差距，所以放款金额会单独形成待清算目录，假如T+1账单来了，形成清算，对于收益户来说计入收益；
   ?
   ?
   对于对账处理：支付流水和确认银行流水对账以后，形成应收账款；然后对于结算来说，形成相应的银行余额进行结算，并形成结算的单据凭证；
   ?
   账务处理在相应的账户处理举例：
   1.账户处理-充值
   图十一：账务处理-充值

首先分业务类型、根据业务类型选择资金项目，根据资金项目来进行充值，可以充值到投资人或借款人下面；
2. 账务处理-放款
   图十二：账务处理-放款

简化的放款账务处理：放款的情况下资金项目涉及到合同额和服务费两个项目，对于合同额投资人来说是流出，对于借款人来说是流入；借款人流入其实就是债务户的流入，然后形成一个流出；对于合同额（放款额）来说，相当于提现；对于服务费相当于收入账户和分润账户；
3.账务处理-还款
图十二：账务处理-还款

还款的账务处理（棕色部分）：停车费还款涉及到的资金项目有本金、停车费、利息；这些类型还到借款人账户上，这些钱会有几个步骤：从本金还到投资人债权户上，停车费放在收入账户和分润账户，利息放在派息账户；相当于还款部分，异地还款在债务户里面的资金处理是不一样的，流向也是不一样的，相应的后台会计处理也是不一样的；
由于时间比较紧张，大概简单的把内容给大家介绍了一下。由于这个行业业务比较多，我举例子也只能举一些简单的，如果有兴趣的我们可以详细交流；
二、主题Q&A
Q1：还款里说的停车费项目 没太理解
A：我只是举个例子，在车抵贷里，我们会一些服务费收取，停车费也是一个名目，还有好多其他费，我就不列举了。所以你会接到很多电话来让你借款的。
Q2：你们那边对于支付调用第三方通道，丢单有哪些措施出来吗？能最大限度减少，丢单
A1：这个你问住我了，我们现在对接了4，5个支付平台，目前采取的是如果超过一定时间没有结果，直接调对方查询接口的情况，而且支付平台都是t+1，所以有我们在对账的时候也会进行对于我方成功，对方失败，对方失败，我方成功这种进行交易流水处理；
A2：就你了解到的方案，除了这2种，不知道还有更好的没？
A1：你们调单多么？
A2：我们是想做一个聚合支付，通道很多，现在就想最少丢单
A1：我们目前很少。所以还真没有考虑这方面太多。因为有很大一部分存管后，我们和银行对，当天做回盘文件。
Q3：如下问题截图红线框出来的，应收账款是资产，余额方向在借方；我理解支付对账，是支付清算对账；支付清算 、 支付结算后怎么贷两次应收账款？
A1：感谢，第五个拷贝过去的时候没有改，我改一下（修改后的为图十：账务处理与会计处理），但是要是从公司整体业务来讲也没有错，因为你看到我标注余额了么，结算是平余额的，改成这样就比较怪，不过逻辑是顺的
A2：应收账款， 属于资产， 那他的余额方向应该在 借方；支付清算的时候， 贷了一下， 那就是减少
A1：这笔交易就相当于提现
A2：结算的时候， 又 借了 一下， 拿就是增加
A1：放款是提现
A2：噢，对的
A1：因为结算是按余额结算
A2：最后那个，银行存款，现金库存 更好些
A1：现金有专门含义的
A2：嗯嗯，我们这个叫那个1001
A1：一级分录1001 1002，二级分录100201 100202

Q4：如下问题截图中红线框出来的这步不记分录吗？
A1：不计入，因为我们会计分录没有单设债务户；债务户对我们来说就是冻结的概念

Q5：你这虚拟账户系统，有总账概念？账户不平是通过人工调账？
A1：为什么这么说？能详细描述一下
Q6：感觉你们这没有 出借账户 、 借款账户 余额的概念？
A1：你们怎么定义这三个名词的呀
A2：金融办定义的，出借人, 借款人；P2P 是不叫投资人，叫 出借人
A1：是的，我们还有叫理财人，意思其实一样
A2：大家都理解就行，尽量向监管靠齐
Q7：貌似现在P2P要做资金托管了
A1：我这是以托管为范本的呀，要是非托管，我就不会做的这么复杂了
Q8：那个图是 线下定向委托， 线上融资；定向委托融资是陆金所发明的
A1：我没写，这个东西不好写把；我默认都是线下开发资产，线上进行匹配；现在这个都是合法的

苹果用户扫描小程序打赏，谢谢
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (492)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?汇率
?虚拟货币
?贸易战
?映客
?苹果
?蚂蚁金服
?微商
?双十一
?第三方支付
?债券通
?前海人寿
?可燃冰

时寒冰：又到了无法忍受去杠杆之痛的时候！
功夫财经?·?02-22 11:3071

内蒙矿难背后的兴业矿业：赤峰首富与中植系卷入
大摩财经?·?今天 13:15102

石家庄“问题别墅”有蹊跷 丽豪地产背后的老大曝光
运营商财经网?·?02-19 11:45490

澳大利亚终于感觉到痛了！铁矿石之后，中国已经禁止进口澳煤炭！
金十数据?·?02-21 15:18117
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 16:31

加拿大终于承认，没有华为将落后于他国！多国改口下美国计谋落空
金十数据?·?02-15 11:211

马云同学聚会开路虎，任正非请同学吃饭，开的车却是十多万的标致
担扑?·?02-18 16:41133

中国发现超巨型油田！石油底气终于足了，连中东都非常羡慕！
乐趣逗?·?02-18 21:2861

捷克态度又反转！华为终于忍无可忍，或将采取法律行动反击？
金十数据?·?02-11 17:48116
雇佣兵入赘豪门遭妻子冷眼亮出身份后另妻子唯命是从！！
?
?
?
?
?广告?·?今天 16:31

又一“股神”副省长栽了！内幕交易狂赚3.6亿，一审获刑20年，还被罚了3
炙手可热搜?·?昨天 10:16?

刘强东：永远不会开除任何一个兄弟！啪啪打脸...
优势智业营销策划?·?02-22 16:53402

安徽富豪留下烂摊子开溜：欠债37亿，巨亏25亿，套现15亿走人
朱邦凌?·?02-20 17:291817

京东裁员10%副总裁高管：“辞退100名员工，不如辞掉一个平庸的管理者”
慧恩人力?·?02-20 15:26?
拥有香港身份,商务往来便利,保留大陆国籍,一人移民全家三代均可移居,福利的待遇与香港公民无差别！
?广告?·?今天 16:31

我国唯一宣布破产的5A景区，负债竟达8亿多
中华摄影报?·?昨天 23:1594

外资疯狂涌入中国，他们看上了什么
肖磊看市?·?02-22 11:30?

中国即将迎来人口大迁徙，“抢人大战”进入升级版！
北京山东同乡沙龙?·?昨天 19:38?

任正非：华为员工2018年平均年薪110万，留不住人
奇葩office?·?02-17 20:41169

这些股票跌至黄金底 放心大胆买入 加微信领取这类股票
?广告?·?今天 16:31

黄金周评：刺激！金价暴涨暴跌坐足“过山车” 超级周重磅来袭
FX168财经?·?今天 14:11?

网商银行何以大幅缩减大额存单发行 存款可能是关键
四维环球金融智库?·?今天 13:44?

慈溪知名企业卓力集团董事长去世，享年53岁！上个月工商登记已变更...
深度慈溪?·?02-22 18:321

谁杀死了“味精大王”：河南明星企业坠落，莲花味精预亏3亿
有道热点?·?今天 00:16787
?广告?·?今天 16:31

公摊面积取消后房价上涨还是下跌？央视给了意想不到的答案
光宇吐楼市?·?今天 12:04?

5千年前是埃及人主食，根茎如巨型人参，如今成越冬高价滋补品
中华摄影报?·?今天 13:12?

一个快被中国制造搞死的“世纪大骗局”
大猫财经?·?02-21 08:111308

费列罗年营业额超815亿元，百威英博购鸡尾酒品牌，汇源首度回应高管离职传闻，法国奶粉...
小食代?·?02-22 19:09?
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 16:31

稳步上涨？房价走势越来越清晰了，2019年……
合肥房地产交易网?·?今天 11:33?

又一家中国500强企业陷债务危机！53亿债难偿付，互保是祸首？
朱邦凌?·?今天 07:3956

马云王健林1亿赌期将至，万达再卖37家百货门店，开启甩货转型
三言财经?·?今天 14:12?

奖金8000万，年收入近八位数，如今她却身陷囹圄
华商韬略官方账号?·?昨天 14:42337

好书集结令 中国古典名著100部 趁现在抢藏！
?广告?·?今天 16:31

任正非：改写欧美商业规则的中国老板
港股解码?·?昨天 10:001006

我国楼市终于要告别公摊面积？不止是影响房价那么简单！
杠杆游戏?·?昨天 23:40246

王亚光：A股还将深跌，创业板可能也并不例外
王亚光?·?今天 14:49?

郭台铭：每个员工每天都得吃蛋，企业建立检验室把关食品安全
奇葩office?·?昨天 16:12?
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 16:31

60多万人被骗700多亿！380多网贷平台被封，100多老板高管失联，内幕触目惊心！
安徽共青团官方?·?今天 12:00?

巴菲特手握1120亿美元现金，“希望大规模收购，无奈太贵了”
每日经济新闻?·?今天 00:11181

一不小心又要扮救世主？国际贸易濒临冻结，全世界都在等着中国的刺激政策
智谷趋势?·?今天 09:122

胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成"校友"
投资家?·?今天 15:51103

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 16:31

国内一年产值330亿，最初入侵全国泛滥各地，如今火遍大街小巷
中华摄影报?·?今天 12:53?

踩雷卡夫亨氏，减持苹果，巴菲特为何仍是无法超越的投资大师？
郭施亮的博客?·?今天 14:46?

这只独角兽新年后被近百家机构调研
证券数据宝?·?今天 12:19?

【重磅财经前瞻】2月PMI数据公布在即 机构称警惕A股调整风险
中新经纬?·?今天 14:58?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 16:31

各地“抢人大战”正酣，他们为什么选择“重返北上广”？
中新经纬?·?今天 08:121860
月薪万元招不到人企业别只顾着喊冤
北京青年报?·?今天 05:011239

展锋：下周最值得关注的板块和个股！（2.23）
展锋?·?昨天 18:281

寿命长达60年，能上树下水无所不能，如今却活不过10年
中华摄影报?·?今天 12:56?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 16:31

全球“降税潮”！日欧互相抵消，特朗普没想到，澳大利亚对华……
第一白银网?·?今天 00:0411

这货浑身都是刺，树叶清香却是极品野菜，二月最嫩不吃可惜了
中华摄影报?·?今天 13:01?

复购率直逼毒品？电子烟成2019年第一个资本风口
环球老虎财经?·?今天 12:19?

四连涨！油价又要变！
合肥在线?·?今天 12:231
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 16:31

事关亿万手机用户！中国5G再出大招领跑全球 华为任正非重磅喊话！
巨丰财经?·?今天 07:37101

巴菲特2018年15大重仓股：苹果位居第一，通用汽车、比亚迪跌出榜单
华尔街见闻?·?昨天 23:3638
著名投资人林园：炒股从不用杠杆，未来医药股能出世界级公司
经济日报?·?今天 10:12

凤栖阁：气质美女-夜色下的大眼睛美眉！
光影旅法师?·?今天 09:16
源产地直销，没有任何中间商，低于市场价一半，品质更佳！
?
?
?
?
?广告?·?今天 16:31

一周要闻回顾 与 下周财经前瞻
格隆汇?·?今天 12:30

凤栖阁：气质美女-办公室里阳光可爱的女白领！
光影旅法师?·?今天 09:34

亏损扩大的爱奇艺，为何股价反涨？
钛媒体APP?·?昨天 20:37

孙宏斌之子上台，女首富杨惠妍掀地产二代上位潮，王思聪唱反调
有道热点?·?今天 00:24
12寸平板电脑598元特惠抢购

?广告?·?今天 16:31

继裁员后 滴滴将在2月25日起减少员工各项福利
投资家?·?昨天 22:34
九成银行一年定存利率上浮超30%
中国经济网?·?昨天 08:32

佛山一学生58同城找兼职 遇上“钓鱼”公司被骗3000元
金睿?·?今天 11:13
中国人寿管理层揭开业绩升降谜团 未来将优化资产配置体系
人民网?·?今天 07:26

海参怎么泡发才是正确的，一招教你快速泡发10几倍！
?广告?·?今天 16:31

股神巴菲特股东信出炉：去年净赚40亿美元，靠什么跑赢大盘
澎湃新闻?·?昨天 22:40

剖析爱奇艺，虎牙，B站股价发展动态
创业家?·?今天 13:16
股神巴菲特最新市场判断：今年会继续增持股票，扩大海外投资
澎湃新闻?·?今天 08:20

牛味浓！关注7只低位优质股
益盟好股?·?今天 14:01

惊呆！原来去眼袋那么容易，在家也能轻松去眼袋！
?广告?·?今天 16:31
508亿吸并白药控股 云南白药重组“三易其稿”
中国经济网?·?今天 08:16

操盘论市：先行指标暴涨之后，这些板块将迎来大机会！
益盟好股?·?今天 13:36

美股上演一场超级逼空大戏：净空仓已经降至十二年低位
华尔街见闻?·?今天 11:36

新加坡三大银行去年盈利大幅增长
经济日报?·?今天 14:02

北上资金生猛！连买18天，开年流入速度激增1.6倍，连续7周买入这些股
证券数据宝?·?今天 12:16

凤栖阁：气质美女-雪肤玉肌的美少女！
光影旅法师?·?今天 09:10

孙宏斌的神级家教：长子金融才子预备接班，少子叱咤全美网坛
金融街侦探?·?昨天 15:14

流感疫苗一针难求背后的双轨难题
经济观察报?·?昨天 17:22
评估租金482万元成交价1800万元 从一处国有资产拍卖增值看我省国有资...
东北网?·?今天 07:09

凤栖阁：清纯美女-明眸皓齿的长发姑娘！
光影旅法师?·?今天 09:22

胡玮炜卸任摩拜CEO后：花69万上这所大学，比马云湖畔大学贵40万
商悟社?·?今天 11:50
全省贷款余额首次突破四万亿元
中安在线（安徽新闻）?·?今天 05:16

巴菲特最新股东信披露重点持仓股，我们能学到什么？
新京报?·?今天 12:30

上海炒股养家，写给踏空的人！
黄生说金融?·?今天 09:37

起底银漫矿业：今年近5亿业绩承诺 被上市公司视为主力
新京报?·?昨天 23:54

巴菲特股东信十大看点：踩中商誉减值天雷，仍未公布接班人
澎湃新闻?·?今天 08:11
已经到底了

广告

热门图集
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
野狼被塑料罐卡住头 高温中挣扎3小时
"老佛爷"葬礼举行 安娜·温图尔等送行
沙特王储游八达岭长城 合影"好汉碑"
??
?麦田藏北宋钱庄 团伙盗挖4吨古钱币
?化学老师走红 讲解"恋爱中的化学"
?高晓松个站成立 应援图让人不敢认
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
A股最奇葩敲诈案：被勒索2099个比特币
1.2亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
1.1亿?阅读
3
史上最低价保险股中国人保今申购：半年仅此一次！有望100%...
1.1亿?阅读

社科院：三四线城市房价不再涨了！有钱也买不到房逻辑是否...
1.1亿?阅读

一文带你了解中美贸易战来龙去脉
1.1亿?阅读
广告
搜狐号推荐

券商中国
致力于提供最及时的财经资讯，最专业的解读分析，覆盖宏观经济、金融机构、A...

和讯网
中国财经网络领袖和中产阶级网络家园,创立于1996年,是中国最早而且最大的财...

搜狐财经快讯
搜狐财经出品，第一时间发布有价值的财经讯息。

朱邦凌
财经专栏作家，腾讯研究院特约研究员

第一白银网
第一白银网为白银投资者提供及时全面的财经资讯和知识。
广告

?联系我们
广告

24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1.2亿?阅读
2
财政部发文规范金融企业对地方政府和国有企业投融资行为（...
1.1亿?阅读
3
史上最低价保险股中国人保今申购：半年仅此一次！有望100%...
1.1亿?阅读

社科院：三四线城市房价不再涨了！有钱也买不到房逻辑是否...
1.1亿?阅读

一文带你了解中美贸易战来龙去脉
1.1亿?阅读
?返回
?首页
?用户
?反馈
?



?忘记密码?免费注册

窗体顶端
全部

快捷导航学习中心
窗体底端
?门户
?培训
?专才计划
?特训营
?课程
?专业
?云实验室
?团购
?API
?企业服务
?猎头
?论坛
?大数据
?商业智能
?专家团
?关于我们
炼数成金?门户?量化投资?金融风控?查看内容
互金风控系统0-1完整搭建方法论
2018-5-24 10:31|?发布者:?炼数成金_小数|?查看:?21796|?评论: 0|来自: 钊哥用户增长
摘要: 在金融服务二八规律的大背景下，很多低端、无稳定收入的群体无法享受银行提供的金融服务，这类群体据估算约有四亿人之多，这个数十万亿市场级别的需求缺口如何来被满足呢--小额贷款作为新型的金融服务产品应运而生， ...
基础?测试?大数据?金融?量化投资
“为什么有人擅长在快速发展的时代掘金？他们只是有玩转风险控制的能力而已。”

什么是风控系统？
在金融服务二八规律的大背景下，很多低端、无稳定收入的群体无法享受银行提供的金融服务，这类群体据估算约有四亿人之多，这个数十万亿市场级别的需求缺口如何来被满足呢--小额贷款作为新型的金融服务产品应运而生，被众多公司争相追捧，据统计高峰时期全国约有五千家现金贷公司（中国传销最多的时候才有一万家）。小额信贷业务具有单笔金额小、单笔利润低、利润率高、审批速度快的特点，所以这项业务运转的前提是必须有一个能够基于用户的申请信息进行快速的系统自动化审批（人工审批太慢还、成本高）的系统，这样风控系统在这样一个风口领域就变成了最最核心的竞争力。

如何建设风控系统？
建设风控系统的思路跟所有互联网+的项目一样：将传统行业（信贷审批）中的经验和方法论应用于系统，让计算机自动计算原来需要人去判断的规则，所以第一个步骤就是抽象出传统人工审批的方法论，人工审批的方法论分为以下几个环节：准入政策（做的客户在法律范围内）、反欺诈（防止客户骗钱）、信用评估（对于好用户能借给他多少钱），基于这样一套业务逻辑，系统需要在这几个层面上进行搭建：数据层、规则层、配置层、策略层。



数据层：大数据风控的基础在于数据，这一层相当于大数据风控系统的基础设施，就像是盖楼时需要的钢筋水泥，全面、高质量的数据可以帮助我们准确地进行风险把控，大数据风控所用到的数据包罗万象，比如以下几个方面：

基础信息数据，最基本的用户四要素信息（姓名、身份证、银行卡、手机号），除此之外可以搜集用户学历、收入、家庭地址等基本信息，当然要求用户填写信息会影响用户体验，需要平衡这些信息的必要性和用户体验之间的关系。

用户的征信数据，这里的征信数据包括该用户是否在其他平台有过多头借贷行为，在非银机构是否有过逾期行为、有没有上过征信系统的黑名单等等。
运营商数据，通过运营商数据可以判断用户的设备是否有异常，比如入网时长、入网状态、每月消费情况、通话记录、短信情况等。
用户行为数据，包括用户的搜索记录、购买记录、社交数据等，通过这些数据可以判断识别该用户是一个什么样的人、有多强的消费能力、社会关系如何等等。

规则层：这一层是系统重点的核心功能，帮助我们最终输出拒绝这个申请或是借多少钱，这里的规则包括准入规则、反欺诈规则、信用评分规则等。
政策准入规则基于以下几个方面进行设定：

政策需要：18岁以下的人不能放贷、大学生不能放贷等
催收需要：青海、西藏等少数民族催收也催不回来的地方就不要放贷了
系统测试需要：白名单规则，只放进来某些特定人群（适用于初步搭建的系统，后续有单独的测试模块就不用在这里做了）。

反欺诈规则主要目的是识别用户是否有骗贷风险，有多大的骗贷风险，所以规则制定的时候可以通过基于用户画像维度：目的在于通过打标签的方法识别不同的用户群体的风险程度，之所以对不同群体的用户进行不同的反欺诈规则而不是对所有用户都应用最全面的反欺诈规则，原因在于两点：一是使用越多的规则就会调用更多维度的数据，会增加用户的征信成本，二是使用过多的数据会增加集群计算的负担，用户的审批时长就会增加，所以对用户使用适当的规则判断就需要对用户进行分类，打标签，从而达到用最小的资源、最短的审批时长且尽可能全面地识别出用户的欺诈风险的目的，用户画像的标签可以按照用户还款行为、用户申请轨迹、用户基本信息等方面进行建设，给用户打上以下的标签，例如：

用户还款情况：已借还5次、借一次未还等
用户风险等级：（黑名单、灰名单、白名单）
用户欺诈风险等级（基于用户行为）：用户行为异常、用户行为正常。

对于不同类型或组合类型的用户可以应用不同的规则包进行风险识别，比如首次申请的用户我们要判断他的基本信息是否造假、注册手机是否是自己常用的、平时消费水平如何等等很全面的信息，整体审批下来可能需要5-10分钟；但对于已经成功还款10次的用户，我们可能只需要判断一下该用户近期有没有被加入到征信系统的黑名单中就直接放款了，让用户享受秒批的快感（整个审批流程只需要5-10秒）。对于小额信贷产品来说，因为用户申请的金额很小，但是企业需要承担获客成本、支付成本、征信成本、集群成本、人力成本等众多成本项，所以新用户（只贷款一次）基本是无法给企业贡献利润的，小额信贷业务的利润主要来自复贷用户，在这个前提下复贷用户的产品体验就很重要了，谁能给用户提供快速顺畅的体验，用户就会去哪家借款，所以平衡好复贷用户的风险和产品体验是小额信贷业务能否盈利的关键。

配置层：这一层的功能主要服务于风控规则的快速迭代和系统的个性化配置，这一层的主要功能对于处于不同发展阶段的企业不尽相同，这里只介绍一些基本的配置功能：
规则管理：规则管理模块的功能包括配置不同规则包所包含规则的内容，比如面向特别优质的用户，我们希望提升一下风险识别的全面性，那就需要在优质用户规则包中增加除了黑名单之外的功能，这里的规则包配置就可以快速灵活地配置完成增加规则的操作，由于业务发展波谲云诡，欺诈手段变幻莫测，及时应对各种外界状况变得至关重要。

规则开关：由于各个单条规则需要调用的数据源不同，如果某条规则需要调用第三方数据源，而与第三方的对接可能由于各种情况出现异常或者成本变化，我们就需要灵活地调整在线的规则，为了保证自动化审批的顺畅，出现异常的规则要迅速下线，而面对识别出的潜在团伙欺诈要迅速上线审批严格的规则（如调整规则阈值，将非银机构多头借贷次数从20次调为0次）。

风控服务开关：风控系统的根本作用在于对于放款用户的风险把控，对于刚刚启动业务的公司来说，最担心的是团伙欺诈，在基础设施还不完善的时点，直接将审批闸口断掉是防范欺诈，降低损失的最后一招，所以这个开关可以让用户处于队列等待状态，既不完全拒掉（有可能错杀好人），也不通过放款，待系统准备好完善的防范规则再开启开关。

策略层：这一层主要是对不同类型的用户进行授信政策的分配，比如对于新用户分配500元、10天的授信，对于1个月内复贷10次的用户分配800元，20天的授信，对于3个月内复贷10次的用户分配1000元、30天的授信。在设计授信政策的时候需要考虑好影响因素，比如复贷时间周期、次数、金额、还款逾期情况等等，这样做的目的在于防范好深度欺诈用户和优待平台忠诚用户。

除了以上的基层系统服务，还需要其他的工具型产品来帮助我们更好地优化系统策略，比如AB测试工具、数据分析系统等等。

结语：
总而言之，大数据风控系统的设计目的本质上是基于数据的力量，防范用户欺诈，灵活多变地采取不同的应对策略，道高一尺魔高一丈，甄别出有欺诈风险的用户，为真正有需求的用户提供高体验的金融服务。篇幅有限，欢迎各位后续进一步一起交流。

作者简介：
一线互联网公司运营从业者、用户增长深度玩家，致力于短时间为产品带来爆发时增长及深度留存、崇尚“不以变现为目标的增长都是废话”。

欢迎加入本站公开兴趣群
量化投资群
兴趣范围包括：量化投资，算法交易，金融建模，统计套利等等
QQ群 697033743
如果大家不明白什么是量化投资，在百度谷歌搜索一下“西蒙斯”就知道了，最近这哥们火极了！这套东西在国外的金融机构已经大量使用，随着中国金融市场规模日益扩大和趋于成熟，这套玩法最终肯定也能在国内转起来，我们一起学习切磋，寻求项目机会做一下，提升自己在这方面的技能，将来一起发财

鲜花
握手
雷人
路过
鸡蛋
分享到新浪微博收藏分享邀请
上一篇：BAT、网易、京东等如何做大数据风控的？
最新评论
窗体顶端

评论
窗体底端
热门频道
?大数据
?商业智能
?量化投资
?科学探索
?创业

即将开课
???MySQL性能优化最佳实践（第八期）
???机器学习（第26期）
???Python自然语言分析（第13期）
???金融市场基础（第11期）
???安全渗透测试工具之Burp Suite使用精讲（第一期）
???Spark企业级大数据项目实战（第七期）
???从零入门金融业信贷风控算法（第四期）
???【免费公开课】企业级Hadoop大数据平台实践（第18期）
???Oracle DBA从小白到入职实战应用（第十期）
???Python金融投资分析实践（第十期）
???左飞的机器学习十八般算法武艺详解（第八期）
???金融的人工智能革命（第八期）
???深度学习框架Tensorflow学习与应用（第九期）
???python3接口自动化测试开发实战（第四期）
???【免费公开课】R七种武器之金融数据分析quantmod（第42期）
???Python数据分析（第17期）
???深入浅出Spring（第九期）
???知识图谱实战（第六期）
???系统运维之基础服务进阶实战（第三期）
???突击pyspark：数据挖掘的力量倍增器（第七期）
???【分享海报9元购】数据科学家养成：从零入门机器学习（第三期）
???精准安防场景理解及语义分割（第二期）
???Node.js项目实战：从编写代码到服务器部署（第七期）
???Python机器学习Kaggle案例实战（第十期）
???Oracle DB Performance Tuning（DSI系列Ⅳ)（第二期）
???开源计算机视觉库OpenCV从入门到应用（第十期）
???深度学习框架Keras学习与应用（第八期）
???Python全栈学习——Python自动化测试（第二期）
???Python3入门到精通实战特训（第五期）
???计算机视觉：从入门到精通，极限剖析图像识别学习算法（第二期）
???股票投资高手武器系列之缠论系统（第四期）
???JAVA极客特训（第五期）
???【百万年薪系列】视觉的盛宴：深度玩转人脸识别（第五期）
???【免费公开课】数据库设计（第28期）
???黄美灵的Spark ML机器学习实战（第五期）
???Oracle SQL Tuning（DSI系列Ⅲ）（第三期）
???OpenAI强化学习实战（第四期）
???实战Java高并发程序设计（第16期）
???Python金融业数据化运营实战（第三期）
???【免费公开课】Julia快速数据分析（第八期）

热门文章

关于我们	新手指南	企业合作	联系我们		
公众号	小程序

关于我们	教育模式	企业会员	电话：4008-010-006
讲师招募	选课流程	内训合作	邮箱：kefu@dataguru.cn
校园大使	学费返还	媒体合作	客服QQ:
版权声明	奖学金激励	代理合作	售后QQ:
关于我们手机版友情链接站点统计文本模式小游戏
版权所有 广州市皓岚信息技术有限公司 合作伙伴 中山大学海量数据与云计算研究中心

粤公网安备 44011302000975号
?
粤ICP备08028958号

CopyRight 2011-2018 dataguru.cn All Right Reserved.
从零入门金融业信贷风控算法...安全渗透测试工具之Burp Sui...Oracle DBA从小白到入职实战...Spark企业级大数据项目实战...Python金融投资分析实践（第...金融市场基础（第11期）左飞的机器学习十八般算法武...Python自然语言分析（第13期...


限时秒杀活动！充值700送500人工智能前沿人才培养计划郭一军“新DBA”精英计划APIguru对接人工智能新纪元葛一鸣JAVA实战精英培养计划
客服微信
?首页
?博客
?学院
?下载
?图文课
?论坛
?APP
?问答
?商城
?VIP会员
?活动
?招聘
?ITeye
?GitChat
?
?

?
?写博客
?赚零钱
?消息
?登录注册
转
深度解析｜互金用户增长模型背后，最底层的逻辑框架
2018年02月08日 00:00:00?人人都是产品经理V?阅读数：6684


———— / BEGIN / ————

一、当我们在讨论用户行为时，我们在说什么

1.1 从基础出发，回归初始定义

很多日常脱口而出的词，其实我们并没有思考过它真实的含义。大多数争论和错误决策的起点，也在于定义的不清晰和不一致。

互金运营是离钱最近的一项工作，清晰的用户行为定义便显得尤为重要了。

1.1.1 用户行为

用户行为由最简单的五个元素构成：时间（when）、地点（where）、人物（who）、交互（how）、交互的内容（what）。

对用户行为进行分析，要将其定义为各种事件。

比如用户搜索是一个事件，在什么时间、什么平台上、哪一个ID、做了搜索、搜索的内容是什么。

这是一个完整的事件，也是对用户行为的一个定义。

有了这样的事件以后，就可以把用户行为连起来观察。

1.1.2 用户行为分析

用户行为分析，是指在获得网站访问量基本数据的情况下，对有关数据进行统计、分析，从中发现用户访问网站的规律，并将这些规律与网络营销策略等相结合，从而发现目前网络营销活动中可能存在的问题，并为进一步修正或重新制定网络营销策略提供依据。

具体而言，用户行为分析是基于用户在互联网产品上的行为，以及行为背后的人发生的时间频次等维度，深度还原用户使用场景并且指导业务增长。

一个完整、多维、精确的用户画像=用户行为数据+用户属性数据


1.3 消费者行为

消费者行为在狭义上讲：仅仅指消费者的购买行为以及对消费资料的实际消费。

在广义上讲：消费者为索取，使用，处置消费物品所采取的各种行动以及先于且决定这些行动的决策过程，甚至是包括消费收入的取得等一系列复杂的过程。

消费者行为是动态的，既涉及了感知、认知、行为以及环境因素的互动作用，也涉及了交易的过程。

1.1.3 消费者行为模型（AISAS）：



消费者行为模型

随着互联网的兴起和发展，针对消费者进行研究的模型已经从最初的AIDMA模式（Attention 注意、Interest 兴趣、Desire 欲望、Memory 记忆、Action 行动），演化到了到后来的AISAS模式：

?
Attention——引起注意
?
?
Interest——引起兴趣
?
?
Search——进行搜索
?
?
Action——购买行动
?
?
Share——发起分享
?

1.2 基于基础定义的分析框架搭建

在线性方向上，从“注意”到“分享”的核心路径上存在着多个关键节点，而由于“说服心理学滑梯”效应的作用（下文将说明），导致从起始节点到最终节点的过程中，用户会因为各种原因出现流失，从而形成用户转化漏斗。

对互金运营来说，需要结合公司当前目标和自身KPI，抓住转化漏斗的关键触点，据此设计相应的运营策略。

对用户行为进行分析，要将其定义为各种事件，而将时间（when）、地点（where）、人物（who）、交互（how）、交互的内容（what）聚合在一起，便构成了一个完整的用户任务。

从任务的层次来看，从核心到外围，可以分为三档：核心任务、扩展任务、外延任务。

对互金运营来说，必须深入到本公司产品的体系中，了解用户操作的关键路径和主线流程，根据用户任务的重要程度，设计运营活动，这样能够最大程度上避免运营和产品惨烈撕X的情况出现。

在往下看之前，你可以停下来想一想：

对于投资用户来说，TA的核心任务、扩展任务、外延任务分别是什么？

由于不同用户在转化漏斗的阶段各有不同，其在本平台所处的生命周期发展阶段也就有了群体差异。

引入期、成长期、成熟期、休眠期、流失期，针对不同发展阶段的用户，运营策略的差别往往十分巨大。

到这里，我们已经初步搭建起了用户增长策略的基本框架：

1.
根据转化漏斗梳理操作流程，进而识别关键触点进行优化
2.
3.
根据任务层次梳理最小闭环，进而分层次、分阶段设计运营策略
4.
5.
根据用户生命周期进行用户分层，进而针对不同生命周期的用户实施差异化的运营手段
6.

二、18字诀：为什么要分析用户行为

2.1 做画像

完整的互金用户画像=用户属性数据+用户行为数据+交易数据+风险收益数据

互联网公司擅长前2块，但往往偏重于一般的互联网用户分析，缺乏对金融和投资的理解；金融机构强于后2块，一般认为用户行为数据只是过程性信息而不屑收集，可能一款APP已经推出很多年都没有做过基本的埋点或转化率分析。

在整个用户画像的体系中，用户行为是串起用户和平台两端的其他3项数据的关键要素，值得深入探究和完善。

2.2 知偏好

通过对用户访问页面的类型、访问路径的深度，可以帮助识别用户对某些投资品种或运营活动的偏好程度，进而针对此类用户推送更多此类产品上架的信息，或是与相关产品有关的优惠券（加息券/抵扣券/满减券等）。

平台再大一点，可以据此完善“千人千面”的前端架构设计。

此前GrowingIO、诸葛IO等用户行为分析机构，已经推出了此类产品，虽然在精度上还有待进一步加强，但毕竟是一个有益的尝试。

从实际使用的反馈情况来看，偏好分析在投资理财类APP上的分析效果，会好于在借贷类产品上的应用。

2.3 控营收

从用户导入到用户流失，全链路跟进转化率和留存率提升。

根据公式：

用户生命周期价值（LTV）=（某个客户每个月的投资频次*客单价*毛利率）*（1/月流失率）

由此可知，在客单价和毛利率水平不变的情况下，我们可以着手的点有2个：

1.
提升投资频次：持续做好用户转化节点的运营策略优化，让用户在“注册-实名-绑卡-交易-复投”的转化过程中，有充分的动力持续向下一步跃迁，实现交易笔数和交易金额的提升，最终提升平台用户生命周期价值。
2.
3.
降低流失率：通过释放出各种任务引导持续提升等级，进而做好用户的忠诚度提升；通过刺激活跃和召回策略提升用户留存，最终降低平台用户流失率。
4.

2.4 做策略

做运营策略，并不是简单地抄一抄竞品、落实老板要求那么简单。或者换个角度说，如何更好地抄到竞品的精髓、把老板的要求落到可规划/可执行/可汇报的程度，都有赖于对用户行为数据的收集和分析。

离开用户行为谈运营，无异于耍流氓。

2.5 搞复盘

根据用户行为数据复盘版本升级和运营活动的效果，并据此进行调整和优化。无论活动的目标是提升日活、提升GMV还是单品交易量，最终都要落实到用户在转化漏斗节点或用户任务上。

对于活动效果的检视，简单地看无非是“达成”或“未达成”，而对用户行为数据的分析，却能回答为什么、好在哪/不好在哪儿、下次如何和才能做得更好。

2.6 作比较

基于转化漏斗的各种转化率、基于海盗指标的拉新-促活-留存分析、基于用户任务体系的注册-投资-提现数据分析等，都能够帮助我们搭建一套对本平台指标体系搭建和竞品比较分析的框架，对于运营指标制订、资源申请和效果检视有显著的帮助。

三、如何搭建基于用户行为的增长体系

基于用户行为的增长体系建设，可分为前置条件、执行策略、通道搭建和落地配套原则4部分。

下文将分别展开。

3.1 前置条件：用户数据准备

如上文所述，完整的互金用户画像体系，由如下这4部分数据构成：属性数据、行为数据、交易数据、风险收益数据。



互联网金融数据分析体系

?
属性数据：用户作为自然人和社会人的最基本数据，也是其他三类数据的基础
?
?
行为数据：串起用户和平台两端的其他各项数据的关键要素，一切运营策略的落脚点。以用户行为数据为基础，结合平台的标签体系，还可以得到衍生的用户转化数据和用户行为偏好数据，在此不详细展开
?
?
交易数据：计算平台营收、ROI、LTV等经营指标的基础，也是用户价值的判断的重要标准
?
?
风险收益数据：用户的投资属性数据,既是差异化运营的依据,也是平台落实风控合规要求的体现
?

属性数据举例：



行为数据举例：



基于以上数据,结合频率、时间维度、用户数等指标，就能得到更多指标数据。

比如：

?
时间周期(月)+投资次数=月活(MAU)
?
?
最后一次回款日期+回款后最近一次投资日期=用户流失
?
?
时间区间内投资金额/时间区间内投资用户数=人均投资金额
?

如果将用户投资行为，与最近一次交易时间、交易频率、单位时间内交易金额相结合（根据RFM模型），在计算和分析后对于用户价值判断、召回策略制定等方面将能够提供有力支撑。

?
R(Recency)：用户投资的时间间隔
?
?
F(Frequency)：用户在单位时间内投资的次数
?
?
M (Monetary)：用户在时间内投资的金额
?

交易数据举例：



风险收益数据举例：



有关风险收益数据，稍微展开说一下：

对于大多数互金平台来说，产品的展示和推荐，首先还是基于营销的目的来做，不太考虑用户自身的风险承受力情况。

甚至有些时候，在用户完成风险测评后，还会诱导用户购买超出自身风险承受力的产品，于是你就会看到下面这种画风：



XX金融在用户完成风险测评后给出的投资建议
（图片来自公众号@智能投顾联盟）

按照这两年监管发展的方向，“把合适的产品卖给合适的投资者”的适当性原则落地，将逐渐从持牌金融机构向互联网金融公司逐步扩散。

基于用户风险承受力和收益目标来进行产品和运营策略设计，一方面能够提高合规水平和平台安全边际，另一方面，也是对用户投资需求和投资能力的更进一步把握。



用户风险承受力与产品风险等级的匹配关系
基于用户风险承受力（5档分级）



用户风险承受力与用户投资目标的关系
基于用户风险承受力（3档分级）

2016年蚂蚁金服公布的《蚂蚁聚宝大众投资人大数据分析》中，透露出来的5项内容，分别都能对应到上文提到的四大类数据中：



注：

?
在实际搭建数据指标体系的过程中，指标会拆解得更加细化，这里不是写PRD，就不针对这四类数据对应的报表字段详细展开了
?
?
此处的“交易数据”，主要只用户发生投资行为后的持仓数据；而用户的首投、复投相关的时间、金额、产品数量等投资行为数据，包含在“行为数据”的类目下
?

3.2 用户增长模型搭建

基于用户行为的增长策略，依赖于三个基础模型的建立，它们分别是：转化漏斗模型、生命周期模型和任务分层模型。

其中：

?
转化漏斗模型是在纵向上，对用户转化的节点进行分析；以此为基础，根据用户在不同转化节点的分布情况，对将用户在平台上所属的生命周期进行定义和划分
?
?
任务分层模型是在横向上，对用户在平台上的各种行为进行拆解和分组，按照“核心任务-扩展任务-外延任务”的体系进行划分，以此为基础引导用户在不同层级的任务中迁移和成长
?

最终，通过对用户转化率的持续优化、用户任务完成行为的持续引导，进而实现对平台各生命周期用户的差异化运营和服务，最终实现平台用户快速和持续的增长。

模型Ⅰ-用户转化漏斗模型

关于转化漏斗模型，在此前的文章中已经有过比较详细的描述，在此就不再展开。



转化漏斗模型（理财端）

基于以上模型，对于理财端用户的转化关键节点和对应的重要指标就可以比较轻松地掌握了。但在实际的应用中，这只是达到了60分的及格线而已。

那么，该如何用更高阶的手段来使用转化漏斗模型呢？以下是2个可以参考的方向：

1. 用户分支路径转化漏斗（以传播/邀请为例）



转化漏斗模型-分支路径转化

以转化漏斗模型的“传播”这个节点为核心，可以拆解出从“老用户看到界面邀请提示”到“新用户接受邀请并完成注册开户”，其间至少有7个转化节点。

拆解到这个颗粒度，运营更多的工作开始浮现出来：



最终从结果来看，精细化的漏斗划分，一方面能帮助运营提升效率和投入产出比，另一方面，也有利于在活动过程中快速地定位和解决问题。活动结束后进行复盘时，做得好不好、下一次怎么才能做得更好，得出的结论才会更加靠谱。

2. 方向二：平行转化漏斗



转化漏斗模型-平行转化

* 注：在上图中，对用户来说，投资、内容、每日加息、传播等业务，都被定义为“平行业务”。

如果按照不同的颗粒度、不同的业务条线来分拆，一个APP内其实可以拆解很多平行的转化漏斗。

对运营来说，单纯为了拆而拆是没有意义的，我们需要根据当前运营重点和部门KPI梳理出需要重点关注的几个平行漏斗（同一时期内数量一般不超过3-4个，多了你也顾不过来）。

一般来说，大概的方向有这么几个：

?
抓用户主线转化流程：注册/绑卡/普通投资/定投
?
?
抓用户活跃转化：推送/内容/每日加息/签到/老用户复投
?
?
抓用户拉新转化：邀请好友/新用户首投
?

对同一时期内进入平台的用户，可以通过同期群分析等方式，分析这些用户在进入平台后的一段时间内（如果是公募基金，按照最短的申赎时间来看, 可以设定为一周），在各主要平行业务的使用情况和转化情况，并进一步了解用户在各业务上重合的程度。

基于以上分析，通过页面引导、活动激励等方式，结合平台的用户成长体系，促成用户在各平行业务之间的跃迁。

下面以与“投资”相关的几条平行业务进行举例说明：




示例：陆金所

以陆金所的印章体系为例，通过对用户成长路径的设计，引导用户在不同的业务之间跃迁，持续进行各类产品的交易、参加平台各类活动，最终提升用户的活跃度和留存率。

模型Ⅱ-用户生命周期模型

用户生命周期通常分为五个阶段，分别为：引入期、成长期、成熟期、休眠期、流失期。

通过各个时期特征的提炼，可将这五个时间分为三个运营区间：

?
获客区——引入期，通常说的“拉客”，主要运营手段为拉新，主要考核指标为留存率；
?
?
升值区——成长期+成熟期，通常说的“接客”，主要运营主段为激活，主要考核指标为增长率和转化率；
?
?
留存区——休眠期+流失期，通常说的“留客”，主要运营手段为留存，主要考核指标为为留存率和召回率。
?



用户生命周期模型

新手首先碰到的问题，往往是不知道按照什么标准来划分生命周期节点。其实在实际操作的过程中，你并不需要真的做出一个用户生命周期分布图，然后据此操作。

实际上，用户处于周期的哪个阶段，是由其行为决定的。

所以，运营的抓手，也是落在用户的行为上。

比如，你发现近期平台上产品的申购金额几乎没有什么增长，甚至还有所下降。于是，你找BI同学拉数据，发现近1个月平台上已注册&未交易用户占比有上升的趋势，而且用户复投率也有所下降。

结合上文的用户转化漏斗模型，你可以得出初步结论：

?
注册用户的交易转化率偏低，一方面可以内部排查，看看在系统层面，交易流程是否有问题；另一方面，可以通过短信/PUSH/站内信/APP首页弹窗等方式，给用户推送新手大礼包（新手红包+体验金+高收益新手标），引导用户完成首投转化。在此，实际上就是针对这一批引入期用户进行了交易转化率提升的操作。
?
?
用户复投率下降，原因可能比较复杂和多样，可以多观察几天，并跟历史基线数据做比较。有时很可能正是用户还没到发薪日没钱投资，或是前一阵做过大促，大批用户买了期限较长的产品尚未回款，所以没有新的资金进行复投。
?

当用户处于不同发展阶段时，用户价值会产生相应的变化，因此，也需要针对不同阶段来设计对应的运营目标和策略。

相关内容已经在此前的文章中有过较为详细的描述，在此不再展开。



模型Ⅲ-用户任务分层模型



互金用户任务分层体系（理财端）

对于理财端的用户来说，在一个平台上所有的行为，都可以放到“核心任务-扩展任务-外延任务”的框架中进行考核和分析，这就是道是无在本部分要介绍的“用户任务分层模型”。

仔细观察后，你会发现一个很有意思的现象：

?
“模型Ⅰ-用户转化漏斗模型”其实是以平台为中心的用户转化视角
?
?
而“模型Ⅲ-用户任务分层模型”则是以用户为中心的需求满足视角。
?

两个模型有同样的转化节点，但模型Ⅰ是扁平的，而模型Ⅲ却是带权重的。

1. 任务分层结构：



* 注：把“成为平台投资者”放在扩展任务区域的原因——对用户来说，“成为平台投资者”这个任务，其实是“赚钱”任务的前置条件，确实很重要，但并不是用户首先关心的问题，所以就把该任务的权重将至扩展任务。

2. 用户任务分层模型中的市场机会：

?
核心任务：提供亿级用户规模的机会。满足互金核心任务需求的，从前是金融体系的银行、券商、保险和基金等金融机构，后来是推出了余额宝的蚂蚁金服。你会发现这一类公司做的就是面向海量用户提供“存钱-赚钱-取钱”的基础服务，它们在的用户运营上谈不上有多大特色，但选对了时间和任务模式，成功的概率最高。这类公司应对洗牌风险的能力为“强”
?

?
扩展任务：提供千万级用户规模的机会。满足扩展任务需求的，往往在效率上有表达提升。它包括两类公司：一类是腾讯、京东这样的互联网巨头，从成为平台用户的扩展任务切入（即俗称的“用户导入”），本质上做的是流量生意；另一类是平安、玖富、拍拍贷这样的互金玩家，模式有：①平安陆金所：通过强大的金融产品整合和供应能力做好“投资-复投”任务②玖富/悟空理财和拍拍贷：抓住P2P的时间窗口，做好“获得收益-增加收益”任务，以及简化和降低准入门槛，做好“成为平台投资者”任务这类公司应对洗牌风险的能力为“中”
?

?
外延任务：提供百万级用户规模的机会。以满足外延任务需求为特色的，多数是互联网系的头部互金公司。它们在核心任务上找不到突破点，于是立足扩展任务，发力外延任务，在获客手段、运营手段、补贴力度、差异化资产获取和包装上都做得最为有声有色。这类公司应对洗牌风险的能力为“弱”
?

* PS：做外延业务如果用力过猛，走上邪路，极致就是传销和庞氏骗局了。不少人痴迷所谓的用户裂变方法，如果脱离了用户的核心任务，那就肯定不是健康的用户增长模式——既无法带来合法的收入，规模增长也无法持续。

3. 任务分层关系：

?
核心任务：用户首先关心的是赚钱，赚钱的主线流程是“投入本金（入金）→获得收益（增值）→获利了结（出金）”。平台是否安全、平台收益是否有吸引力、要用钱时是否能够及时取出、主线操作流程是否方便，这是用户在核心任务区域最关心的几个问题，它们直接决定了“扩展任务”和“外延任务”是否存在
?

?
扩展任务：扩展任务中，“复投”、“增加收益”、“提前获利了结”这3个一级任务，分别对应核心任务中“投入本金”、“获得收益”、“获利了结”这3个二级任务，前者是后者的进一步扩展和优化
?

?
外延任务：外延任务附属于核心任务和扩展任务，当运营活动主要落在外延任务区域时，需求基本在运营经理层面就可以搞定了。如果运营活动落到扩展任务或核心任务区域，往往就需要产品经理比较深度的配合了。尤其是落到核心任务区域的运营活动（体验金、加收益等），往往要横向统筹多个部门，最容易踩到坑里去的往往也是这类活动。
?

4. 任务分层角色统筹：

?
核心任务是产品经理主要关心的领域，平时说的APP核心功能设计、用户体验设计基本都落在这个区域
?

?
外延任务往往是运营经理发力的着眼点，各种拉新、促活、留存的运营活动，都落在这个区域
?
?
扩展任务区域则是产品和运营的交界地带，对产品经理来说，扩展任务是用户体验持续优化的方向，对运营经理来说，扩展任务中的各项子任务，都是运营活动很好的载体
?

如果你仔细观察就会发现：一个高阶的产品经理或运营经理，常常是能够按照“核心任务→扩展任务→外延任务”的方向来思考，同时又能够充分立足各自业务目标和KPI，进而设计方案并安排优先级的人。

反过来看，有时运营同学向产品同学提出一个运营需求时，会很诧异：“咦，为什么产品同学当场炸毛了？”其实，如果你了解用户任务分层模型就会知道，这次你提的这个需求，大概率是让产品同学感觉用户的核心任务流程受到干扰了。

基于对用户任务分层的洞察，运营对产品中各种功能的权重才能有更合理的把握，与产品和开发沟通时，才能有共同的讨论基础。

下面以京东金融APP的“任务中心”为例，对相关任务进行拆解和分析：



京东金融任务体系拆解

通过上图可以看出：

?
互联网金融的最关键的点是交易，所以叠加在核心任务和扩展任务上的运营激励往往比较大
?
?
邀请好友使用京东金融APP，能够间接带来交易量的提升，所以给予了中等程度的激励
?
?
每日玩金币游戏，由于是一个单纯的促进用户活跃的活动，与核心任务距离比较远，对于用户核心需求的满足程度也较低，所以给予了比较弱的运营激励
?

不过需要注意的是：不同类型的公司，在处于不同发展阶段时，业务目标会有不同的侧重点；所以在运营活动方案和配套激励措施的设计上，会有各自个性化的地方，不能直接套用模型，还需要具体问题具体分析。

3.3 用户成长路径建设



互金用户成长框架

对于互金业产品来说，用户的转化和成长是在两个层面上实现的：

?
金融层面：用户投资金额、投资产品复杂度的提升，背后代表的是用户风险承受力和收益目标的提升
?
?
互联网层面：用户在平台内成熟度的提升，它表现为在基于主线转化漏斗的成长体系上，持续不断地向漏斗的下一个环节迁移和成长
?

从金融层面看，用户在财务生命周期中所处的家庭发展阶段，是影响用户在金融层面成长的背景性因素；同时，用户风险承受力、收益目标、收入水平、投资经验等都是影响用户在金融层面成长的关键性因素。

不过，由于财务生命周期涉及到大量个性化的线下数据，而且与投资、保障和资产配置的关联度太高，在本文中就不再详述。

从互联网层面看，用户在平台上发展生命周期所处的节点，是影响用户在互联网层面成长的背景性因素；同时，用户在主线转化漏斗所处的节点、活跃情况、留存情况等都是影响用户在互联网层面成长的关键性因素。

总体来看，用户的成长过程是在金融和互联网这两个层面上交织进行的，最终都体现为用户在平台上各种各样的投资行为。

成长模式Ⅰ-用户在金融层面的成长


理财端用户投资成长体系

此前，蚂蚁财富（原“蚂蚁聚宝”）曾经对理财用户做了一个很形象的分层，从最初级的银行存款（幼儿园），到最高级的资产配置（六年级）分为7个进阶。

按照这个标准来看，会发现大多数基金公司的现状是给一年级的小朋友，上三年级、四年级的课；国内一众做智能投顾的公司，在给幼儿园的小朋友，上六年级的课——这些情况，其实都是忽略了互金用户的分层以及用户成长的过程，体现到用户数和管理费收入上，回报的效果自然不会太好。

对互金平台来说，需要根据自身产品资源、用户分层，结合相应的运营策略，帮助和引导用户实现成长和进步。

这一点上，我一直觉得京东金融的“小白基金”做得不错（没看到交易数据，欢迎京东的童鞋补充^_^）：



京东金融-小白基金

用户点击进入“小白基金”，从左到右一次可以看到“天天赚”、“月月赚”、“高手专区”,分别对应货币型基金、债券型基金和混合型/股票型基金（原先还有基于短期理财基金的“周周赚”），帮助用户勾勒出“一年级（货基）→二年级（债基）→四年级（混合型基金）”的成长路径，用户还可以通过学习基金产品知识，获得从3%到4%不等的收益奖励。

对小白用户来说，货基和债基在能够承担的风险范围之内，又能够够获得额外的收益补贴，自然会有动力参与到投资和成长的过程中来。

其实对于多数理财类的APP来说，如果做好如下2点，这篇文章也就算没白看了：

1.
划分用户成长进阶，提供有梯度的产品和服务
2.
3.
首先服务好低年级“小朋友”，在用户体验和运营策略上做出倾斜，辅以投资者引导和教育
4.

成长模式Ⅱ-用户在互联网层面的成长



理财端用户交易行为成长体系

从理财端用户交易行为成长体系的构成来看，主要包括如下几个要素：

?
垂直方向上，基于用户转化漏斗模型，设定转化路径和转化目标，从“完成注册”到“完成新的投资”都包括在内
?
?
水平方向上，在转化漏斗的主要节点上，促成用户从上一个节点向下一个节点转化和成长，从“已下载未注册”到“汇款后N天未投&账户内无余额”，都有各自的转化目标
?
?
在配套条件上，针对相应生命周期内用户的特点，设定好“触发转化条件（如下载后的M天内）–触发转化方法（如首页蒙层）–触发转化激励（如阶梯现金券）”这整套运营手段，以保证用户转化和成长目标的落地
?

重点强调：在促成用户“完成首投”、沉默/流失用户“完成新的投资” 的转化节点上，可以适当引入人工电话回访的方式，主体内容是“平台信心建设+未转化原因询问和解答+优惠激励”。

只要成本可控，人工的方式会让用户感觉比较有温度，转化效果一般也还不错。

下方，是陆金所针对“N天未投资&账户内有余额”的用户，推出的“1月回归礼”活动，主要目的是通过下发投资券短信的方式，促成休眠用户“完成新的投资”。



陆X所-1月回归礼

通过上图可以看出：

?
用户触达的第一步就存在风险，下发的短信可能被用户手机上的安全软件禁用，导致用户看不到这条消息。相对比较保险的做法，可以采用“短信+邮件/推送/电话”的方式，确保用户肯定可以看到
?

?
短信文案的表述容易让人误以为是诈骗短信，用户明明什么都没做，为什么就凭空“获得抽奖资格”？
?

?
在可以做到针对休眠用户精准发送触达短信的基础上，最好的方式是确保所有收到短信的用户都能中奖，否则会比较影响用户感受。这一类活动的指导思想，应该是【确定能得到，不确定得到多少】：确定得到，能够确保用户有参与的动力；不确定得到多少，能够提供用户“赌一把”的乐趣。不过这也是大公司的苦恼，包括很多银行在内，由于用户规模大，为了控制营销成本，不得不祭出“数量有限、先到先得”这个法宝
?

?
在适用的产品上，尽量不要太限制。用户之所以会进入休眠状态，肯定存在某种原因的，所以给这些用户的激励一定要更诱人，最好能给到无门槛的全场通用券，或至少放到明星产品或是一些新上架产品上
?

简言之，用户在互联网层面的转化和成长，其实也是一个比较复杂的过程，它既包括用户在主线流程上的转化，也包括用户在支线流程的转化。

在转化的每一个节点上，一定要考虑清楚用户的利益点和风险点/困难点在哪里，并提前做好产品和运营手段上的准备，最终促成用户的持续转化和成长。

本部分的最后，再上一个案例——桔子理财新手任务、成长任务。

正如上文所说，用户的成长过程，是在金融和互联网这两个层面上交织进行的，两者相互依赖、相互促进。



桔子理财新手任务成长任务拆解

通过上图可以看出：

?
从互联网层面的成长来看，桔子理财新手任务是在重点引导用户完成“渠道导入→注册→首投→传播”的主线流程转化。完成这样一个深度的操作过程后，用户对平台肯定是比较了解和信任的了（投入金钱&投入人脉关系），这样用户离开平台的成本就变得更高了
?
?
从金融层面的成长来看，周周升属于短期高收益产品（7天后可赎回，年化最高8.39%），爱定存的期限从1个月（年化收益率5.5%）到12个月（年化收益率8.29%）不等，而且用户为了追求高收益，往往会倾向于投资期限较长的产品。
?

买入定期产品后，只有VIP用户有提前赎回特权，普通用户无法提前赎回（成为VIP用户需要在平台上的投资金额达到一定规模），这样也进一步提升了用户在平台上的留存率：

从激励的倾向性上看，可以看出桔子理财和京东金融具有比较明显的不同。

在上例“京东金融任务体系拆解”中，对于“邀请好友使用京东金融APP”给予的是50个金币的中等程度激励，而在桔子理财这里，是给予400个桔子的最高强度激励。

京东金融由于背靠京东商城，用户体量大，业务复杂度高，所以重在引导用户在各业务体系内的转化和活跃；桔子理财属于创业型平台，用户渗透率相对较低，所以重在扩大用户规模，更多地圈进用户后，再谋求转化

我们平时在做竞品研究和运营手段借鉴时，这样的背景性因素往往会被忽视，而直接照搬别人方法的结果，往往就是“七分看运气，三分看财力”，这种情况应该尽量避免。

综上，在不断完成任务、获得成长的过程中，用户获得了更多的权益和心理满足，平台也获得了用户的活跃和忠诚，在这里可以看到，一个好的运营策略设计，能够让用户和平台都获得双赢的。

而用户成长体系的搭建，又穿插着“利益”、“荣誉”、“情感”、“安全”的种种套路，对人性弱点的窥探，在这里体现的淋漓尽致。

3.4 落地配套原则

在充分把握用户行为的基础上，为了最大限度地发挥用户增长模型的效能，我们还需要有配套的指导原则和措施：

1. 一切从实际出发。

任何方法或模型，都要基于公司的行业属性和当前发展阶段来使用，这是一条基本原则。

彼之美味,吾之砒霜，尤其不能简单粗暴地照搬友商的方法。

最典型的例子，是上文提到的京东金融和桔子理财对老拉新的激励程度差异，体现的正是这条原则。

2. 使用PCDA来验证和拓展模型的有效性。

通过计划阶段（Plan）- 执行阶段（Do）-检查阶段（Check)-行动阶段（Action）的不断循环，结合运营目标和数据复盘，配合做好ABtesting，形成适合本平台的有效运营手段体系。

3. 指标拆解和运营活动设计的精细化。

明确自己的关键目标，然后通过MECE（Mutually Exclusive Collectively Exhaustive，相互独立，完全穷尽）的方式，不断进行目标的分解；最后，拆到最小的颗粒度上，据此设计运营方案。

比如上文提到的“用户分支路径转化漏斗（以传播/邀请为例）”，道是无强调“在老用户界面显化利己因素，在被邀请用户界面显化利他因素，最终将传播/邀请的转化率最大化”。

在下方的拿铁智投活动页中就体现得很完整：对老用户，凸显的是“每位好友送您50元”；对新用户，凸显的是“最高加送鼓励金5%”。



拿铁智投-老拉新案例

4. 小米加步枪有时候比长枪大炮更有效。

这句话完整地说，应该是“（今天你拿在手里的）小米加步枪，有时候比（未来某一天可能拥有的）长枪大炮更有效”。

如果平台成立时间不长，数据体系也不完备，划不出完整的用户生命周期，这时候又想快速提升交易转化率，就可以直接找数据同学，拉一下近一个月“已开户未交易”、“已首投未复投”的用户数据，给新用户发一批新手大礼包短信推送并跟进电话、给首投用户发一批（高收益新手标+定向现金券），直接看效果。草莽阶段，百废待兴，这时候简单粗暴比按部就班更有效。

最后，记得算清楚ROI——行业低潮期，钱还是得用在刀刃上。

四、底层框架和指导思想

行为至此，全篇也将接近尾声了。

我整理了基于用户行为的增长逻辑背后，那一整套底层的思考框架。因为埃隆·马斯克（Elon Musk）的缘故，这两年“第一性原理”很火，我也尝试从互金用户最底层的需求和行为模式出发，将全套的逻辑做一下简要的推演，参见下图：



基于用户行为增长逻辑的底层框架

4.1 用户底层需求

用户参与金融业务最底层的需求，直接目标是获得收益，而最终是为了消费。

按照《金融学》的表述：

金融学的一个基本信条是：金融体系的终极功能在于满足人们的消费偏好，包括诸如食物、衣服和住所等全部基本生活必需品。

换成大白话，就是：赚钱是为了更好地花钱。

在这一点上，阿里、京东这样的平台，算是比较完美地实现了用户的“投资-消费”闭环。

用户获得收益的过程，就是将投入资金到理财平台，在达成收益目标后，转出资金的过程。用户在任何理财平台的操作，最终都可以被抽象到“投入资金→获得收益→转出资金”这一行为体系中。

4.2 经济学三公理

在目前所有的学科当中，经济学是解释用户需求和行为最合理的框架与工具。

而根据张五常先生的观点，经济科学最终可以归纳为三个最基本的公理：需求定律、成本概念和竞争含义。

这三点，其实也是一切运营策略的起点。

需求定律

核心思想是“价格对供求的作用是确定性的”，在这里，“价格”可以是是理财平台给出的金融产品收益率，也可以是互联网的用户体验度、运营提供的补贴和激励。

用户的需求会被导向哪一家平台、到了某一个平台后是留还是走，都受到平台提供的“价格”影响。

成本

对用户来说，从下载APP到投资、分享，整个转化漏斗的每一个节点上，无论是选择YES还是NO，都意味着成本的付出。

在互金运营中，需要重点考虑的是这四类成本：沉没成本、机会成本、边际成本和会计成本，它们是用户作出行为决策的基础。

实际上，很多平台的运营策略，就是通过不断增加用户的沉没成本(金钱、时间和情感)，持续增加用户心理账户的支出，让用户因为离开的成本太高而留下来。

竞争

根据百度百科的定义，竞争( competition)是个体或群体间力图胜过或压倒对方的心理需要和行为活动。

即每个参与者不惜牺牲他人利益，最大限度地获得个人利益的行为，目的在于追求富有吸引力的目标，竞争是个人或群体的各方力求胜过对方的对抗性行为。

同一个运营活动（比如请好友帮助砍价、邀请好友获返利、给宝宝投票等），如果引入排名机制，往往会较大幅度地提升用户参与意愿和持续参与的时间。

说服心理学滑梯模型：



说服心理学滑梯

根据说服心理学理论，对用户的说服和行为的促成，需要考虑如下四个要素：

?
首先是重力，这代表用户做一件事的初始动机。对互金用户来说，就是通过投资赚取收益
?

?
角度，它是运营从用户身上挖掘出来的动机和需求，依托于重力而存在。比如用户的初始动机是投资赚钱，运营通过设计各种活动的方式，设计出“邀请好友可以加收益”、“学习理财知识送红包”等活动，培养用户邀请好友加入平台的动机和学习理财知识的动机
?

?
推动，是运营为用户提供的激励，目的是为了引导用户完成特定的行为，促成用户的持续转化和成长
?

?
摩擦，是用户在平台上完成特定行为的阻力：有时是客观层面的，比如APP不稳定，或是绑卡成功率低，或平台产品收益率水平偏低；有时是主观层面的，比如平台的UI主色调是绿色（XX投资最初几个版本就是这样），让投资用户心里觉得不太舒适，或是平台名字起得拗口等等，原因不一而足
?

在说服心理学滑梯模型中，代表用户初始动机的“重力”与经济学三公理的“需求”存在着对应关系，代表用户完成特定行为阻力的“摩擦”，与经济学三公理的“成本”也是相对应的，它们是经济学公理在运营策略上的体现。

福格行为模型(BJ Fogg’s behavior model)：



福格行为模型

福格行为模型(BJ Fogg’s behavior model)认为，要促成用户某个行为发生，需要同时具备以下三个要素：

?
动机，根据百度百科的定义，动机是由一种目标或对象所引导、激发和维持的个体活动的内在心理过程或内部动力，是人类大部分行为的基础。在组织行为学中，动机主要是指激发人的行为的心理过程。通过激发和鼓励，使人们产生一种内在驱动力，使之朝着所期望的目标前进的过程。在这里可以很清晰的看到，用户的动机是行为发生的内驱力，是一种用户自主性较高的心理机制，而且往往要通过“激发和鼓励”才发生作用。在互金业务里，用户最底层的动机就是获得收益，而各平台努力的方向，是让用户来到自己的平台投资，持续留存，并带入更多的用户过来投资
?

?
能力，是用户完成某种特定操作的的素质，或者说完成某种行为的水平高低。在互金业务中，用户的行为能力一般体现为是否拥有一台手机、是否有几秒钟的操作时间或是否有一定的投资资金，门槛非常低
?

?
触发器，在这里指的是运营为用户提供的激励，用以促成用户完成某种行为
?

在福格行为模型中，“动机”与说服心理学滑梯模型的“重力”（初始动机）和“角度”（从用户身上挖掘出来的动机）存在对应关系，“能力” 与“摩擦”（用户在平台上完成特定行为的阻力）对应，“触发器”与“推动”（运营为用户提供的激励）相对应——这意味着说服心理学滑梯的每一个要素，最终都体现为福格行为模型中相应的操作要点。

而福格行为模型，又是一切运营策略的基础框架。

以上文陆X所的1月回归礼为例，我们来看一下福格行为模型的实际应用：

?
动机：用户的初始动机是通过投资赚取收益，运营挖掘出来的动机，是赚取平台提供的额外补贴奖励
?
?
能力：用户只需拥有一台智能手机即可，几乎所有的互联网用户都能满足这一条件
?
?
触发器：在这里陆X所运营为用户提供的激励是获得抽奖机会，用户有机会得到从5元到50元不等的投资券
?

当用户按照运营设定的路径完成特定的行为后，用户的转化和成长之路，又向前迈出了新的一步。

全文关键要点归纳如下：

1.
互联网金融数据分析体系的搭建和不断完善，是增长模型持续发挥作用的基础
2.
3.
用户转化模型的使用方法和配套数据指标，在本系列上一篇文章中已经有过介绍。在此基础上，还有更为进阶和精细化的玩法：用户分支路径转化漏斗、平行转化漏斗
4.
5.
用户生命周期模型，重点并不在于多么精确地划分周期节点，而是根据周期内相应用户的行为特征和数据，提供对应的运营策略，从头到尾做好“拉客-接客-留客”的工作
6.
7.
?用户任务分层模型，能够帮助大家梳理互金业务的用户任务体系：核心任务→扩展任务→外延任务。高阶的产品和运营，往往更加认同“核心任务＞扩展任务＞外延任务”的重要性设定，并以此为基础来进行产品设计或运营活动设计，同时，这也是各方顺利沟通的基本前提
8.
9.
在用户的转化和成长路径建设上，可以从金融和互联网两个层面切入。它们分别受到用户的财务生命周期和在平台生命周期影响，各有特点，又相互交织
10.

最后，本篇通过打通互金用户的底层需求、经济学三个公理、说服心理学滑梯模型和福格行为模型，挖掘出各种互金用户增长模型背后最底层的逻辑框架。

———— / END / ————


点击“阅读原文”下载APP
新服刚开，绝版坐骑免费送，战力狂飙9999+！桃花源记二 · 顶新

窗体顶端

窗体底端
?
西瓜粑粑：?好文好文(4周前#1楼)
?

数据分析和用户增长的思维导图
阅读数 6433

数据分析，用户增长，是否感觉无从下手？本文介绍一种思维模式，避免只见树木，不见森林。...博文来自： 老屈长谈

深度学习在用户画像标签模型中的应用
阅读数 7778

最近一段时间都在学习深度学习，想着在用户画像标签模型中看能不能用上，终于，用了一个多月的时间，结合实际的场景和数据，搭建了一套“孕妇标签”的深度学习模型。这篇文章重点介绍了在用户画像标签模型中运用深度...博文来自： chaishen10000的专栏

Django 2.0 项目实战: 扩展Django自带User模型，实现用户注册与登录
阅读数 4399

用户的注册与登陆是一个网站应该具有的基本功能。网上很多Django关于实现用户注册与登录的教程都是用Django1.X写的，比较老了，所以小编我觉得有必要亲自动手用Django2.0重写用户注册与登陆...博文来自： 大江狗

常见用户行为分析模型解析
阅读数 1275

具体参见-神策数据行为分析常用名词维度维度描述的是一个事物身上所具备的特征或属性指标指标，即具体的数值。比如访客、页面浏览量、停留时长都属于常见的指标展示和点击展示，指页面上元素的曝光次数。点击，指页...博文来自： Alien_lily的博客

如何定义用户模型（persona）
阅读数 2

一、什么是用户模型？Persona（[p?:'s?un?]）：(Persona是用户模型的的简称)是虚构出的一个用户用来代表一个用户群。一个persona可以比任何一个真实的个体都更有代表性。一个代表...博文来自： sagacity789的专栏

用户模型
阅读数 353

1.数据迁移在Laravel中，我们使用数据库迁移来管理数据库表结构，迁移就像是数据库中的版本控制，它让团队成员之间能够轻松地修改跟共享应用程序的数据库结构，而不用担心并行更新数据结构而造成冲突问题。...博文来自： qq_20567419的博客

用户生命周期模型
阅读数 3481

本文转载自：https://blog.csdn.net/l18930738887/article/details/50818878一、为什么要定义用户生命周期？用户生命周期是为了定位每个用户在哪个阶段...博文来自： memory专栏

建立用户模型
阅读数 3190

最近我们也在实践基于行为数据快速、低成本构建用户画像的方法，欢迎各位共同探讨：用户模型（Persona）是AlanCooper在《AboutFace：交互设计精髓》2一书中提到的研究用户的系统化方法。...博文来自： 心系旭阳
禁止偷窥！这望远镜可望10公里，微光夜视可拍照！优诺 · 顶新

互金平台数据透析:用这3个模型就够了 - 人人都是产品经..._CSDN博客
11-23
由于运营部门是互金平台公司里需要对业绩对KPI负责的...深度解析|互金用户增长模型背后,最底层的逻辑框架 - ...


互金运营底层逻辑?- jiemo_99的博客 - CSDN博客
10-28
深度解析|互金用户增长模型背后,最底层的逻辑框架 ...来自: 人人都是产品经理 详解第三方支付之无卡支付...


用户兴趣模型分类以及推荐系统技术调研
阅读数 1

用户兴趣模型分类根据用户之前在相关网站的行为数据记录分析出用户的兴趣和偏好，然后根据不同用户兴趣和偏好不同为其推荐不同的内容，这种新的信息获取方式被称为个性化推荐技术。个性化新闻推荐系统中常用的几种用...博文来自： baoyan2015的博客

拼多多是如何做用户增长的？
阅读数 978

作者：Bruce全文共4921字14图，阅读需要11分钟————/BEGIN/————从2017年以来，线上流量增长天花板到来的言论不断地出现在各大媒......博文来自： 人人都是产品经理
关注

AI科技大本营

1619篇文章
排名:200
关注

bladestone

491篇文章
排名:504
关注

GitChat的博客

1593篇文章
排名:1000+
关注

arvik

112篇文章
排名:8000+

用户运营的核心本质是什么？分级、分类、分阶段
阅读数 242

————/BEGIN/————长久以来，人们对于用户运营这个岗位有诸多的看法和误解，甚至有过些许争论。比如：有的人认为：促进产品的用户增长、留存、活跃，都是用户运......博文来自： 人人都是产品经理

AARRR增长黑客模型
阅读数 359

第一个A是获取客户的意思.第二个A是激活客户,第一个R是提高客户留存.第二个R是增加客户销售转化,第三个R是客户口碑传播从一到四就是一个漏斗......博文来自： 武西亮的博客

BAT缩招，AI跻身2019年最赚钱职业榜首！（附薪酬表）
阅读数 3

临近年底，互联网正在经历寒冬，不少公司出现了裁员新闻，也有很多人纷纷转型、跳槽。那么，2019年IT领域内，什么样的工作比较好？最近美国薪酬统计网站PayScale发布了一份报告，给出了答案。他们盘点...博文来自： CSDN学院
禁止偷窥！这望远镜可望10公里，微光夜视可拍照！优诺 · 顶新

暴涨背后的逻辑:数字货币的投资分析框架?- GitChat - CSDN博客
10-31


互金平台如何利用大数据做用户留存? - 修行2017 - CSDN博客
10-24
- 人人都是产品经理 如何计算用户生命周期天数? 深度解析|互金用户增长模型背后,最底层的逻辑框架 ... ...


互联网金融风控模型
阅读数 1

一、市场调研目前市面主流的风控模型1、互联网金融前10名排行榜(数据截止日期2017-09-12)互联网金融公司排名分别是蚂蚁金服、陆金所、京东金融、苏宁金融、百度金融、腾讯理财通、宜信、钱大掌柜、万...博文来自： Change the World by Program

金融领域数据模型实例
阅读数 4041

通用金融行业主题域模型通用金融行业概念模型主题域模型的设计原则：1是对商业模式的抽象2以商业模式中关注的对象为划分依据3内容完整且相对稳定4每个主题域下一般都有一个与之同名的主实体，围绕该主实体展开各...博文来自： xi4m00的博客

互金运营底层逻辑
阅读数 399

本文希望通过这套框架的介绍，帮助产品经理和运营经理搞明白如下问题：手头负责的产品，最需要配套哪些运营功能为什么同样的产品，不同的公司会有不同的运营策略不同的公司，同样的产品，同样的运营策略，为什么会带...博文来自： jiemo_99的博客

百亿互金平台技术栈大起底
阅读数 5099

技术栈(technologystack)就是一个公司的透视镜，从某些程度上可以展示出公司的技术实力。从技术桟也可以看出整个平台的技术要素，平台大小规模等，今天来给大家分享我司的技术全家桶。总览回到主题...博文来自： 纯洁的微笑

金融结算系统的基础业务之账户体系结构分析
阅读数 3877

金融系统的基础是结算，结算的核心是账户，账户体系是最基础的也是最重要的部分，而众多的业务也都是围绕账户展开的，要了解现在众多的金融系统（包括互联网金融）就绕不开账户体系。一、先看一下结算系统的几个抽象...博文来自： 重剑无锋，大巧不工。。。
中老年如何正确刷牙，该用哪种牙膏，告别牙松动？众易 · 顶新

如何构建 FinTech 科学反欺诈体系|架构师实践日
阅读数 533

微众圈?>?微信资讯?>?科技?>文章如何构建FinTech科学反欺诈体系|架构师实践日摘自公众号：七牛云发布时间：2017-4-1121:28:33FinTech，即Finance+Technolo...博文来自： starzhou的专栏

下一代的全能广告系统架构【腾讯创新日】
阅读数 286

下一代的全能广告系统架构【腾讯创新日】唐溪柳发表于2017.7.54150浏览0讨论?引言：6.14日“腾讯创新日：科技年技术盛宴”代表腾讯各个事业群技术实力的四级专家、腾讯微创新2016年度创意获奖...博文来自： 专注，坚持

5个步骤完成一个专业的用户调研过程
阅读数 627

@可乐橙_ColaChan：多数小团队都没有专门的用户研究人员，常由产品与设计师来进行调研。本文中，作者简要描述了一次专业的用户调研的经过。设计决策需要同时满足商业与用户需求，但了解真实用户需求也非常...博文来自： dlfeicui的博客

用户研究
阅读数 161

个人对用户研究的学习一、用户研究的定义：?用户研究让我们了解到人们的生活，工作习惯，从而提供更多信息，激发我们的灵感，针对人们的真实需求，隐性需求提供更有效的解决方案。?二、用户研究方向：1、新产品用...博文来自： weixin_42638802的博客

一亿用户增长背后的架构秘密 之 腾讯微信技术架构
阅读数 1931

微信——腾讯战略级产品，创造移动互联网增速记录，10个月5000万手机用户，433天之内完成用户数从零到一亿的增长过程，千万级用户同时在线，摇一摇每天次数过亿...??在技术架构上，微信是如何做到的？...博文来自： shao.bing的专栏
中老年如何正确刷牙，该用哪种牙膏，告别牙松动？众易 · 顶新

数据分析繁华的背后,都隐藏着怎样的哀伤 - openfea的博..._CSDN博客
11-3


预测性客户分析之客户生命周期(Part 1) - 数据猿 - CSDN博客
11-9
预测性客户分析使用客户数据去构建模型,这些模型帮助预测未来的行为,帮助企业转化...深度解析|互金用户增长模型背后,最底层的逻辑框架 - 人人都是产品经理(产品经理...


一亿用户增长背后的架构秘密
阅读数 976

转载：http://sd.csdn.net/a/20120515/2805581.html微信——腾讯战略级产品，创造移动互联网增速记录，10个月5000万手机用户，433天之内完成用户数从零到一亿的...博文来自： zhangxinrun的专栏

网络小贷用户评分卡风控模型设计
07-11
互金平台、银行、小贷公司用户风险量化评分模型！互金平台、银行、小贷公司用户风险量化评分模型！
下载


增长黑客_电子书.epub
09-30
运营人才必读书籍，适合产品运营、互联网运营，讲述用户增长的背后逻辑和策划思路
下载


解析深度神经网络背后的数学原理！
阅读数 533

作者|PiotrSkalski译者|巧克力编辑|Jane出品|AI科技大本营【导读】为了更好地理解神经网络的运作，今天只为大家解读神经网络背后的数学原理......博文来自： AI科技大本营

用户模型视图-用户例图
阅读数 1276

http://housen1987.iteye.com/blog/1319309编写系统的用例图有助于在初始开发阶段构建系统的业务需求。用例模型描述的就是外部参与者所理解的系统功能。用例模型用于需求分...博文来自： zhuwenchao90的专栏
贝特重工-2017商品混凝土拌合站价格-18264673643!热门推荐 · 顶新

设计师思维模型之用户模型
阅读数 999

如何作出一个正确的设计方向？如何作出一个正确的设计方向？给父母、朋友、恋人准备礼物时，我们通常会准备不一样的符合对象需求的惊喜。我们往往会站在对方的生活场景中去思考我们的礼物是否合适，进行最终选择。可...博文来自： heye13的专栏

预测性客户分析之客户生命周期（Part 1）
阅读数 805

【数据猿导读】企业的成功与获取客户、培育客户、让客户满意、解决客户的问题、进而从客户那里获取更多收入的能力直接相关。但是企业想要做到这一点，需要能够识别他们的潜在客户作者|TalikingData官网...博文来自： 数据猿

如何计算用户生命周期天数？
阅读数 3952

作者：Kitty全文共2991字3图，阅读需要7分钟此文写在去年了，当时是给老板的一个汇报，针对用户的生命周期长度一直有争议，查阅了网站上一些达人的分享和自己的一些经验理解后，有以下内容，欢迎各位探讨...博文来自： 人人都是产品经理

第三方支付架构设计之—帐户体系
阅读数 9

第三方支付架构设计之—帐户体系一，?????什么是第三方支付？????什么是第三方支付？相信很多人对这个名字很熟悉，不管是从各种媒体等都经常听到，可以说是耳熟能熟。但，如果非得给这个名词总结出一个概念...博文来自： tenfyguo的技术专栏

用户画像建模（一）
阅读数 6944

用户基本属性表根据用户所填写的属性标签和推算出来的标签。用于了解用户的人口属性的基本情况和按不同属性维度统计。作用：按人口属性营销、比如营销80后，对金牛座的优惠，生日营销。主要数据来源：用户表、用户...博文来自： Running_Tiger的博客
甄子丹电脑前大汗淋漓，爽到停不下来，手都累坏了贪玩游戏 · 顶新

联想的非连续性——增长的逻辑(混沌2018年度大课笔记2)..._CSDN博客
11-8
人是连续性思维,而企业是市场的产物,市场的增长需要...深度解析|互金用户增长模型背后,最底层的逻辑框架- ...


从事互金行业的那些日子 - site008的博客 - CSDN博客
11-20
????? 掐指一算在某互金公司呆了一年零两个月(哈哈,终于离职了...深度解析|互金用户增长模型背后,最底层的逻辑框架 - 人人都是产品经理 02-08...


抖音是如何通过AARRR模型实现用户增长的
阅读数 874

产品定位：抖音于2016年9月26日上线，是一款专注于新生代的音乐创意短视频社区，其以拍摄＋音乐＝短视频的形态展示创作内容，是一款音乐UGC类的产品，品牌形象鲜明。　　抖音的用户画像：以19-34...博文来自： qq_43044147的博客

LogisticRegression?逻辑斯蒂回归 matlab 可运行
05-30
LogisticRegression 逻辑斯蒂回归 matlab 可运行 内含测试数据
下载


互金平台借贷数据
09-19
来自互联网金融平台的，用户借贷数据，已经经过脱敏，可用于简单的，风控评分卡建模
下载


用量子物理学原理解释为什么振金可以吸收能量（论发散思维的重要性)
阅读数 253

写了很多年技术文章，现在也来做做科普，另外，也让大家体验下思维的真正力量。知识并不重要，重要的是驾驭知识的能力以及天马行空的想象力！希望广大读者不要将本文当成一篇普通的科普文章，而当做进入思维殿堂的入...博文来自： 李宁的极客世界bgJBm&nku$q$

PHP框架深度解析
11-16
PHP框架深度解析 PHP框架深度解析 PHP框架深度解析
下载


生命周期模型
阅读数 358

典型的生命周期模型有：?1.瀑布模型（WaterfallModel）?2.渐增模型/演化/迭代模型（IncrementalModel）?3.原型模型（PrototypeModel）?4.螺旋模型（Sp...博文来自： 一万个兵的专栏

5种项目生命周期模型（个人笔记）
阅读数 3

1.项目生命周期定义参考网站：http://wiki.mbalib.com/wiki/%E9%A1%B9%E7%9B%AE%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F2.一...博文

移动用户生命周期模型(中国移动).pdf
08-29
移动用户生命周期模型(中国移动).pdf
下载


用户生命周期
阅读数 347

一、需求用户是软件的活动主体，软件行为也是用户主导来完成，所以创建、修改、删除一个用户信息，并进行登录、操作、退出等操作，是开发一个重要发起点。通过用户生命周期的整个过程分析，也能很好的理解和设计其他...博文来自： 我是传奇

项目生命周期模型
阅读数 1074

http://mp.weixin.qq.com/s/rzo40Q5ndhJKf11QfsJstg一个阶段划分不清、工作目标任务不明确的项目，过程不可能是规范的。因此，为了实现项目过程规范化，我们首要的...博文来自： wuxiaobingandbob的专栏

打造一款安全的互金产品时,需要考虑什么 - pmcaff2008..._CSDN博客
11-18
从小的方面说,包含用户个人账户的资金安全和操作安全...深度解析|互金用户增长模型背后,最底层的逻辑框架 - ...


互金技术的门槛和挑战
阅读数 112

加入互金这个领域已经2年多了，作为一名从传统互联网加入互金的技术人，除了自己需要角色和行业认知的转变外，还要帮助团队同样完成升级。所以，我今天要来说说互金技术人常见的一些......博文来自： 架构栈

打造一款安全的互金产品时，需要考虑什么
阅读数 269

1安全的意义与内涵在金融三性风险、收益和流动性中，风险性始终要放在首位考虑。对于互联网金融产品，可以没有炫酷的交互，可以没有各种时尚前卫的设计风格，但一定要具备安全性。作为一个互金产品，要时刻意识到钱...博文来自： pmcaff2008的博客

回顾·大数据平台的模型思维与用户增长实践
阅读数 76

本文根据快看漫画屈世超老师在DataFunTalk数据主题技术沙龙活动“大数据从底层处理到数据驱动业务”中分享的《大数据平台的模型思维与用户增长实践》编辑整理而成，在未改变原意的基础上稍做修改。今天分...博文来自： DataFun_Hoh的博客

spring源码深度解析---Spring的整体架构和环境搭建
阅读数 236

spring源码深度解析—Spring的整体架构和环境搭建1.概述Spring是一个开放源代码的设计层面框架，他解决的是业务逻辑层和其他各层的松耦合问题，因此它将面向接口的编程思想贯穿整个系统应用。S...博文来自： 渔潭的博客

中国人自己的RPC—— 蚂蚁金服RPC框架结构分析
阅读数 1395

蚂蚁金服RPC框架结构分析蚂蚁金服近期开源了研发多年的SOFA一篮子框架，其中就有一个非常核心的RPC框架，它叫SOFA-BOLT。小编今天花了近一天的时间仔细阅读研究它的源码，阅读过程中遇到了不少问...博文来自： shellquery的博客

软件性能生命周期模型
阅读数 612

软件需求模型V模型性能需求分析-概要设计-详细设计-编码-单元性能测试-集成性能测试-系统性能测试性能需求分析：首先需要根据系统的业务特点制定明确的性能需求，为系统设计和性能测试提供依据概要设计：针对...博文来自： Tongdingsidong的博客

软件生命周期的内容以及生命周期模型比较
阅读数 3434

问：什么是软件生命周期模型？试比较瀑布模型，快速原型模型，增量模型和螺旋模型的优缺点，说明每种模型的适用范围。答：软件的生命周期由软件定义，软件开发，运行维护（软件维护）3个时期组成，每个时期又进一步...博文

搭建图片服务器《二》-linux安装nginx
阅读数 2万+

nginx是个好东西，Nginx (engine x) 是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambl...博文来自： maoyuanming0806的博客

YOLOv2训练自己的数据集（VOC格式）
阅读数 3万+

最近在用yolo来做视频中的人员检测，选择YOLO是从速度考虑，在训练数据集的过程中碰到很多坑，并且现在yolo又到了v2的版本，在网络和命令中都有区别...博文来自： ch_liu23的博客

高斯混合模型（GMM）及其EM算法的理解
阅读数 8万+

一个例子高斯混合模型（Gaussian Mixed Model）指的是多个高斯分布函数的线性组合，理论上GMM可以拟合出任意类型的分布，通常用于解决同一集合下的数据包含多个不同的分布的情况（或者是同一...博文来自： 小平子的专栏

OpenCL性能优化实例研究系列2：避免Local Memory Bank Conflicts的两个简单方法
阅读数 2262

转自：http://hi.baidu.com/fsword73/item/51df1fafe6083e268919d39e 作者: ?fsword73 Bank Conflicts 是存储...博文来自： lucky_greenegg的专栏

linux上安装Docker(非常简单的安装方法)
阅读数 13万+

最近比较有空，大四出来实习几个月了，作为实习狗的我，被叫去研究Docker了，汗汗！ Docker的三大核心概念：镜像、容器、仓库 镜像：类似虚拟机的镜像、用俗话说就是安装文件。 容器：类似一个轻量...博文来自： 我走小路的博客

jquery/js实现一个网页同时调用多个倒计时(最新的)
阅读数 19万+

jquery/js实现一个网页同时调用多个倒计时(最新的) 最近需要网页添加多个倒计时. 查阅网络,基本上都是千遍一律的不好用. 自己按需写了个.希望对大家有用. 有用请赞一个哦! //js ...博文来自： websites

keras实现常用深度学习模型LeNet，AlexNet，ZFNet，VGGNet，GoogleNet，Resnet
阅读数 6034

LeNet #coding=utf-8 from keras.models import Sequential from keras.layers import Dense,Flatten from...博文来自： wmy199216的博客

centos 查看命令源码
阅读数 2万+

# yum install yum-utils 设置源: [base-src] name=CentOS-5.4 - Base src - baseurl=http://vault.ce...博文来自： linux/unix

强连通分量及缩点tarjan算法解析
阅读数 32万+

强连通分量： 简言之 就是找环（每条边只走一次，两两可达） 孤立的一个点也是一个连通分量 ? 使用tarjan算法 在嵌套的多个环中优先得到最大环( 最小环就是每个孤立点） ? 定义： int Ti...博文来自： 九野的博客

MATLAB中注释一段程序
阅读数 1万+

在MATLAB中，可以注释一段程序。 使用“%{”和“%}”。 例如 %{ 。。。 %} 即可。 经典方法是用 if 0，但缺点是不够直观，注释掉的内容仍然保持代码的颜色。现在可以用 ...博文来自： 知识小屋

VMware虚拟机配置文件(.vmx)损坏修复
阅读数 4万+

前言： 对于VMware虚拟机配置文件(.vmx)损坏 大家发生问题的原因可能跟我不一样，但是解决方法应该是一样的. 但是本方法仅适用.vmx文件损坏而其他文件完好无损的情况。 ...博文来自： shuideyidi的专栏

C# 基于SharpPcap的局域网数据包捕获 之二 监听代码
阅读数 4201

1.配置好sharpPcap引用和安装好winPcap后，添加引用 using PacketDotNet; using SharpPcap; using SharpPcap.AirPcap; usi...博文来自： wuma0q1an的博客

ArcGIS VS QGIS——两者之间的27点比较上篇（译）
阅读数 9972

本文是笔者刚刚接触QGIS相关博客资源时找到的一篇文章，全文比较长，因此分成两篇发布。就内容而言不代表笔者观点，留待后续一一验证。QGIS和ArcGIS的比较你也许伴随着ArcGIS或者QGIS而成长...博文来自： 番茄园

DirectX修复工具增强版
阅读数 182万+

最后更新：2018-12-20 DirectX修复工具最新版：DirectX Repair V3.8 增强版??NEW! 版本号：V3.8.0.11638 大小: 107MB/7z格式压缩，18...博文来自： VBcom的专栏
逻辑回归模型?不可变深度理解?颜色模型?损失函数模型?算法模型
c#用户注册登录模型?c++加载深度模型 opencv?c++ 模型框架?android驱动框架深度开发?android jni互掉炼数成金python教程?人工智能中的深度结构学习

人人都是产品经理V
关注
原创
81
粉丝
303
喜欢
179
评论
975
等级：
?

访问：
?
41万+
积分：
?
5713
排名：
?
7294
勋章：
最新文章
?从4P理论说起，luckin coffee 火爆背后的可能原因
?为什么产品0经验和产品1年经验薪资相差一倍多？
?车载系统中，交互设计的「三秒原则」
?有一个很棒的想法，如何向老板证明你是对的
?与其一个人闷头苦学，不如让老司机指条明路！
归档
?2018年5月34篇
?2018年4月130篇
?2018年3月111篇
?2018年2月69篇
?2018年1月66篇
?2017年12月103篇
?2017年11月111篇
?2017年10月5篇
展开
热门文章
?后台经验分享：如何做权限管理系统设计？
阅读数?43488
?
?我在阿里的第322天，这是我的review
阅读数?17248
?
?深度：一套系统从无到有的设计
阅读数?12580
?
?月薪18k+的产品经理，都是这样玩Axure的！
阅读数?10897
?
?关于抖音，这应该是全网最深度的分析
阅读数?10400
?
最新评论
?成为运营，最重要的能力到底是什么？
wjf1997：好文 值得一看
?
?深度解析｜互金用户增长模型背后，最...
weixin_34073858：好文好文
?
?还在因为不懂技术被嘲？试试用10天...
weixin_44582739：怎么购买怎么学习？
?
?后台经验分享：如何做权限管理系统设...
weixin_37778679：问下如果一个人多个角色 登录进去页面显示那个角色的权限呢
?
?后台经验分享：如何做权限管理系统设...
weixin_37778679：求分享源码407819228@qq.com
?

微信客服

QQ客服
kefu@csdn.netQQ客服
客服论坛400-660-0108
工作时间 8:30-22:00
关于我们招聘广告服务?网站地图
百度提供站内搜索?京ICP证19004658号
?1999-2019 北京创新乐知网络技术有限公司
经营性网站备案信息网络110报警服务
北京互联网违法和不良信息举报中心
中国互联网举报中心
Python实战训练
转型AI人工智能指南
数据库沙龙
21 天入门机器学习
登录
注册
?
3
?
?
21
?
?
?
?

?
?
?



?首页
?博客
?学院
?下载
?图文课
?论坛
?APP
?问答
?商城
?VIP会员
?活动
?招聘
?ITeye
?GitChat
?
?

?
?写博客
?赚零钱
?消息
?登录注册
原
互金技术的门槛和挑战
2018年04月26日 00:00:00?东升Forest?阅读数：113
?版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/xiedongsheng/article/details/80102522

加入互金这个领域已经2年多了，作为一名从传统互联网加入互金的技术人，除了自己需要角色和行业认知的转变外，还要帮助团队同样完成升级。所以，我今天要来说说互金技术人常见的一些问题。

互金的技术“好像”缺乏挑战性

? ? ? ? 过去这2年，我和之前一样，定期会和团队里的每个人做沟通，了解大家对现在工作内容的反馈，收集到以下一些内容：

后端同学: 日活月活并不大，高并发CAP距离有点远; 每天都是在撸业务逻辑
前端同学: 页面大同小异，活动页面有些多,? 缺少酷炫，中规中矩
测试同学: 每次发布几十个功能点，功能测试的工作量大，性能测试自动化测试迟迟不能推动

技术同学的共同感受：

1. 追求技术优化的效果，还不如让业务更新决策? ??
2. 花了那么多时间学习金融业务，感觉换一个行业就没用了

那么互金的技术有“门槛”或者“挑战”吗？我的回答是：当然有

比如，一个几千PV的机构管理系统没有挑战?技术挑战 != PV或者流量的大小

子系统: 渠道、收单、审批流等。子系统之间如何解耦，不同类型小微企业的收单如何高可用。
不同业务部门的权限管控、各类业务或者财务报表同步/异步导出。
系统扩展性设计，小微企业的类型和考核科目千千万万，怎么保证能快速复制和更新。

金融领域的技术挑战，在于快速和稳定的解决各种场景化问题。
现在各类成熟的三方工具和系统有很多，挑战在于如何选择和合理使用，技术团队的指标就是解决问题，单纯炫技是不成熟的表现。

技术的价值，在与不断提升业务。
努力提升我们的技术效率和生产力，我们今年上半年，前端同学要优化框架，打造组件库；后端要优化配置文件和代码重构；质量团队要全面接口自动化运作；运维团队要将虚拟化道路走好，本地k8s环境搭建完毕等等。

技术人都要有行业的敬畏心

我们技术人都要在一个行业有更加深入理解，不要轻易换行业，一个普通人没在一个行业做10年8年的，是很难有真正的沉淀。我鼓励大家尝试新事物，选择更有生命力的机会和行业，但不是无脑追热。

技术工程师招聘，如果候选人都不能清晰讲明白自己所做的业务细节，无论他技术能力如何，在我眼里，他都是不合格的。

抛开行业和业务谈技术，都是无法走长远的。

描二维码或手动搜索微信公众号【架构栈】： ForestNotes
欢迎转载，带上以下二维码即可
? ? ? ? ? ? ? ? ? ? ?
城东都在买这款德国全自动扫地机器人！仅售348元优诺 · 顶新

窗体顶端

窗体底端

美团点评前端技术体系的思考与实践》知乎 live 文字稿
阅读数 630

为什么要讲这个题目前端圈是一个被技术圈的人称为娱乐圈的领域，很多做后端的、算法什么的，会经常来调侃前端圈，知乎上甚至有个问题问「前端架构是什么，前端有架构可谈吗？」，甚至前端圈自己也有很多人在自嘲。但...博文来自： itheima_Wujie的博客

同样的工作、同样的做需求，为什么他们能进阿里？
阅读数 174

引言古人云：“活到老，学到老。”互联网算是最辛苦的行业之一，“加班”对工程师来说已是“家常便饭”，同时互联网技术又日新月异，很多工程师都疲于应付，叫苦不堪。以至于长期以来流传一个很广的误解：35岁是程...博文来自： Java高级架构的博客

互联网时代产品研发的思考
阅读数 743

传统软件企业向互联网企业的转型2005年我提出将公司CRM产品向SaaS化发展的战略时，很多人都认为那是一个巨大的冒险，而如今已经没有人再质疑传统软件向SaaS化发展的趋势。很多决心向互联网产品转型的...博文来自： 砯崖的博客
禁止偷窥！这望远镜可望10公里，微光夜视可拍照！优诺 · 顶新

iOS工程师如何在工作中提升自己?
阅读数 578

古人云：“活到老，学到老。”互联网算是最辛苦的行业之一，“加班”对工程师来说已是“家常便饭”，同时互联网技术又日新月异，很多工程师都疲于应付，叫苦不堪。以至于长期以来流传一个很广的误解：35岁是程序员...博文来自： ping20的博客

架构师素养及从小菜进阶架构师(2)
阅读数 197

支付宝架构师：讲述从工程师到架构师的成长之路-http://blog.csdn.net/Gupaoxueyuan/article/details/79089101支付宝架构师：从工程师到架构师的成长之...博文来自： ShareUs的专栏

互金平台数据透析：用这3个模型就够了
阅读数 244

作者：绰号甄嬛的男人全文共3233字3图，阅读需要7分钟————/BEGIN/————由于运营部门是互金平台公司里需要对业绩对KPI负责的部门，这决定了运营人员需要时时刻刻观察数据，从数据出发找到公司...博文来自： 人人都是产品经理

从事互金行业的那些日子
阅读数 813

前言?????掐指一算在某互金公司呆了一年零两个月（哈哈，终于离职了，小小庆祝下），在这段时间算是尝尽了人间的酸甜苦辣，五味杂陈。去年阴差阳错就进入互金行业了，感觉水深不可测。外行开热闹，内行看门道?...博文来自： site008的博客

早起打卡平分挑战金 ，鸟不叫早起挑战
阅读数 505

摘要：古人云：一日之计在于晨。而有趣的一个现象也是，Twitter创始人、移动支付公司Square首席执行官JackDorse坚持每天5:30起床;AuroraFashions首席执行官MikeShe...博文来自： ziyang880的博客
禁止偷窥！这望远镜可望10公里，微光夜视可拍照！优诺 · 顶新

百亿互金平台技术栈大起底 - Yan_Programer 的专栏 - CSDN博客
10-25
技术栈(technology stack)就是一个公司的透视镜,从某些程度上可以展示出公司的...互金技术的门槛和挑战 04-26 40 ... 来自: 架构栈 作为互金产品经理,...


从事互金行业的那些日子 - site008的博客 - CSDN博客
11-20
????? 掐指一算在某互金公司呆了一年零两个月(哈哈,终于离职了...互金技术的门槛和挑战 - 架构栈 04-26 46 ... 来自: 架构栈 下载 ...


从蚂蚁金服一窥人工智能在金融领域的机遇与挑战
阅读数 580

从蚂蚁金服一窥人工智能在金融领域的机遇与挑战CCAI?蚂蚁金服?人工智能?金融?中国人工智能大会阅读2469?编者按：由中国人工智能学会、阿里巴巴以及蚂蚁金服联合主办，CSDN、中国科学院自动化研究所...博文来自： starzhou的专栏

互金运营底层逻辑
阅读数 399

本文希望通过这套框架的介绍，帮助产品经理和运营经理搞明白如下问题：手头负责的产品，最需要配套哪些运营功能为什么同样的产品，不同的公司会有不同的运营策略不同的公司，同样的产品，同样的运营策略，为什么会带...博文来自： jiemo_99的博客
关注

CSDN官方博客

588篇文章
排名:17
关注

AI科技大本营

1619篇文章
排名:200
关注

人人都是产品经理V

629篇文章
排名:7000+
关注

site008

95篇文章
排名:千里之外

深度解析｜互金用户增长模型背后，最底层的逻辑框架
阅读数 6684

————/BEGIN/————一、当我们在讨论用户行为时，我们在说什么1.1从基础出发，回归初始定义很多日常脱口而出的词，其实我们并没有思考过它真实的含义。大多数争论和错误决策的起点，也在于定义的不清...博文来自： 人人都是产品经理

互金平台如何利用大数据做用户留存？
阅读数 1042

提起互联网金融，人们当下的态度可谓又爱又恨，因为口口相传的“致富”和“跑路”都不绝于耳。在问题平台的数量（3795）已经快达到正常平台数量（2114）两倍之多、且盈利平台尚不足百分之一的现状下，撑到今...博文来自： 修行2017

打造一款安全的互金产品时，需要考虑什么
阅读数 269

1安全的意义与内涵在金融三性风险、收益和流动性中，风险性始终要放在首位考虑。对于互联网金融产品，可以没有炫酷的交互，可以没有各种时尚前卫的设计风格，但一定要具备安全性。作为一个互金产品，要时刻意识到钱...博文来自： pmcaff2008的博客
中老年如何正确刷牙，该用哪种牙膏，告别牙松动？众易 · 顶新

互金平台灰度发布的三段式探索与实践 - guolong1983811..._CSDN博客
12-17
通过之前的平滑发布和小范围验证的摸索,开始进行灰度发布实践之路。?灰度...互金技术的门槛和挑战 04-26 64 ... 来自: 架构栈 互金发展和模式 ...


7天吃透这3大新兴互金黑科技,做稀缺型互金产品经理 - ..._CSDN博客
1-16
互金技术的门槛和挑战 04-26 91 ... 来自: 架构栈 互金运营底层逻辑 03-08 366 本文希望通过...


互金发展和模式
阅读数 541

竹外桃花三两枝，春江水暖鸭先知三月四号杭州温度居然28度，直接蹦到夏天了，把春天给略过去了，老天爷有没有问过我们的感受啊~~~~PS：上一篇文章《备付金知识知多少》结尾处原来是“请大牛拜读”，现在已经...博文来自： HIP的博客

信数金服决策引擎分享（二）：灰度发布-冠军/挑战者试验的另一个应用
阅读数 1473

之前，我们谈到冠军/挑战者试验是如何在同一个决策点上比较多个实现策略。这次，我想谈谈该技术的另一种应用。使用同一种架构，同一种思路，在生产环境中测试和更新决策逻辑。这不是为了评估策略的业务表现，而是为...博文来自： 数智物语

7天吃透这3大新兴互金黑科技，做稀缺型互金产品经理
阅读数 228

对于互联网金融产品来说，安全是第一要义。如何才能实现在保证资金、账号安全的前提下，让用户合规合法又方便快捷地完成线上金融交易所需的全部流程呢？这在过去或许是个难题，但随着新兴生物识别、电子签章、移动支...博文来自： 人人都是产品经理

为什么很多人会觉得IT门槛低？
阅读数 814

“阅读文本大概需要3分钟。”技术的进步会让入门变得越来越容易，这是客观规律。但事情还有另一面，那就是人们正在用计算机技术解决越来越复杂，规模越来越大的问题，很多问题要解决，难度很大。所以门槛在降低，但...博文来自： zhugeaming2018的博客

【盘点】金融科技走向风口，细数互金领域估值最高的十家企业
阅读数 1367

近几年，互联网金融平台层出不穷，不仅传统金融行业第一时间进入互联网金融，很多非金融出身的知名企业也开始涉足互联网金融业务。但是，互联网金融平台讲究的是“剩者为王”，并非起步越早就越有机会占据一席之地。...博文来自： 数据猿
中老年如何正确刷牙，该用哪种牙膏，告别牙松动？众易 · 顶新

为什么互金平台资金存管了，就安全了？
阅读数 144

最近多家互金平台接连“爆雷”，引起投资人恐慌性情绪蔓延，监管层和互金协会接连发出合规信号，合规内容中经常提到“资金存管”。今天咱们就聊聊，什么是资金存管？资金存管了就安全吗？那什么是资金存管呢？投资人...博文来自： 王猛的博客

信数金服决策引擎分享（一）：来聊聊冠军/挑战者试验，一个数字游戏
阅读数 2147

自动化决策与冠军/挑战者试验????自动化决策最有价值之处在于可以迅速的根据业务变化改变底层的决策逻辑。这些业务变化可能来自于监管的调整、竞争压力或单纯的商业机会。决策的修改需要有测试同步跟进——毕竟...博文来自： 数智物语

互联网金融风控体系
02-26
金融风险分类与概述 互联网金融风险特点 互金风控体系的建设 互金行业风控的展望
下载


（转）上交所朱立：联盟区块链最大的技术挑战将是隐私保护
阅读数 992

近日，由中国金融科技50人论坛（CFT50）与证券信息技术研究发展中心（上海）举办的“区块链里的密码学技术”闭门研讨会议，在上海证券大厦举行。上交所技术有限责任公司架构师朱立代表主办方致辞并进行了主题...博文来自： Julia & Rust & Python

为什么大公司要设置这么高的门槛？
阅读数 120

点击上方“Java后端技术”，选择“置顶或者星标”每天带你看高清大图哦！作者：hsm_computer来源：www.cnblogs.com/JavaArchitect注：......博文来自： Java后端技术
甄子丹电脑前大汗淋漓，爽到停不下来，手都累坏了贪玩游戏 · 顶新

Dubbo在互金行业的应用 - qswm_18301240090的博客 - CSDN博客
12-24
老师在上海Dubbo沙龙的演讲稿进行整理,意在为大家展示最真实、最一手的沙龙技术...互金技术的门槛和挑战 04-26 75 ... 来自: 架构栈 互金平台数据透析:...


互金公司AI落地场景介绍 - sparkapi的博客 - CSDN博客
11-4
前言????? 掐指一算在某互金公司呆了一年零两个月(哈哈,终于离职...互金技术的门槛和挑战 04-26 43 ... 来自: 架构栈 2018年,这100家A...


大数据挑战与NoSQL数据库技术?pdf 全
05-16
大数据挑战与NoSQL数据库技术 pdf 全 大数据挑战与NoSQL数据库技术 pdf 全
下载


IIoT的技术与挑战（PPT全文）
阅读数 561

自物联网兴起，在各个行业引起影响，当然也包括工业制造。刚刚暂告一段落的“中美贸易战”，排除桌面上明显贸易差，很多人坚持认为，美国核心对抗的是中国“2025”战略，其实也是中国的IIoT（工业物联网战略...博文来自： weixin_42480782的博客

一名优秀的程序员，总结的20条金句良言，真正的生存指南
阅读数 3595

新手程序员入坑20条生存指南，首先，欢迎来到程序员的世界。在这个世界上，不是有很多人想创造软件并解决问题。你是一名hacker，属于那些愿意做一些有挑战性的事情的人。?“当你不创造东西时，你只会根据自...博文来自： zwjweb的博客

深度学习入行门槛太低，不开心！
阅读数 1265

安妮问耕编译整理量子位出品|公众号QbitAI进入门槛太低正在毁掉深度学习的名声！这么一篇标题“忧心忡忡”的讨论帖，毫无意外的在reddit上炸了。为什么发起这么一个讨论？先看看原po主是怎么说的。很...博文来自： 量子位

室内定位面临的挑战_凯利讯
阅读数 253

测量位置已经成为户外导航系统的一个引人注目的成功，并且在室内有一个强烈的重复。能够找到一个人在一个建筑内可以帮助许多不同的方式，从找到一个塔楼中的合适的办公室，定位一个必要的部门，甚至一个特定的产...博文来自： 财经小二的博客
城东超温馨的装修，才花了几万，多亏看了这份装修底价！装修家家优保 · 顶新

人工智能，现在门槛这么低了吗？
阅读数 1788

阅读文本大概需要3分钟。这两天大家又被AlphaGo刷屏了，让我们见识到了人工智能的发展之迅速，毫无疑问，未来一定会全面进入到人工智能的时代，很多人已经蠢蠢欲动，提前拥抱新时代了，之前很多读也者问我，...博文来自： AndroidDeveloper

互金协会披露27项指标 其中强制性披露指标23项
阅读数 269

互金协会披露27项指标其中强制性披露指标23项博文来自： petermsh的专栏

互金PM基础知识_ 作为P2P PM，你应该知道的
12-07
基本概念、资金操作相关、融资端风控、信息安全、债权转让、我对互金产品设计的一点思考
下载


Dubbo在互金行业的应用
阅读数 80

本文章是根据潘志伟老师在上海Dubbo沙龙的演讲稿进行整理，意在为大家展示最真实、最一手的沙龙技术干货。1、作者介绍潘志伟(微信号panzw008)，现任上海融之家首席架构师，十余年互联网架构经验，精...博文来自： qswm_18301240090的博客

作为互金产品经理，至少要具备哪些基本素质？
阅读数 538

作者：7姐全文共字，阅读需要分钟————/BEGIN/————优秀的产品经理很多很多，有的擅长数据分析，有的擅长用户体验等等。但是在互联网金融领域，无论是沙龙分享上，还是优秀的APP打造者，优秀突出的...博文来自： 人人都是产品经理
贝特重工-2017商品混凝土拌合站价格-18264673643!热门推荐 · 顶新

互金风控业务+技术初体验 - zhibo112的专栏 - CSDN博客
11-19
刚换新工作2个月,新工作团队主要是大数据和风控为主,日常工作是对爬虫、风控...互金技术的门槛和挑战 - 架构栈 04-26 46 ... 来自: 架构栈 百亿互...


我们要对互金平台少点恐惧,多点信心 - weixin_34187862..._CSDN博客
2-14
互金技术的门槛和挑战 04-26 阅读数 100 加入互金这个领域已经2年多了,作为...所以,我今天要来说说互金技术人常见的一些... 博文 来自: 架构栈 从事互...


互穿网络聚合物
09-05
互穿网络金典书籍
下载


【转】工业物联网技术（IIoT）的技术与挑战（PPT全文）
阅读数 511

自物联网兴起，在各个行业引起影响，当然也包括工业制造。刚刚暂告一段落的“中美贸易战”，排除桌面上明显贸易差，很多人坚持认为，美国核心对抗的是中国“2025”战略，其实也是中国的IIoT（工业物联网战略...博文来自： FreeBird

CSDN日报20170303——《百亿互金平台救火故事》
阅读数 1

一直以来总是想以什么方式去记录下自己在互金行业的这段经历，趁着自己还记得清楚，还能找到一些资料原型，一方面可以分享出来供大家参考，但是更重要就是多年以后我可以根据这些文章回忆起来自己的那段激情岁月。想...博文来自： CSDN 官方博客

深度学习入行，现在门槛这么低了吗？
阅读数 1562

一篇标题“忧心忡忡”的讨论帖，毫无意外的在reddit上炸了。原po主表示：进入门槛太低正在毁掉深度学习的名声！很长一段时间以来，我注意到很多自称深度学习专家、大咖的人，其实名不副实。这些人没有机器/...博文来自： 七月在线实验室

《大数据挑战与NoSQL数据库技术》
阅读数 23

???麦肯锡称：“数据，已经渗透到当今每一个行业和业务职能领域，成为重要的生产因素。人们对于海量数据的挖掘和运用，预示着新一波生产率增长和消费者盈余浪潮的到来。”随着互联网的高速发展，云时代的来临，越...博文来自： zhang__qiang的专栏

互金平台灰度发布的三段式探索与实践
阅读数 1118

http://dbaplus.cn/news-72-1441-1.html作者介绍小亚，互联网金融公司应用运维主管，参与运维工作九年，涉及领域包含航空、金融、广告等。近两年主要负责金融业务运维的线上业...博文来自： guolong1983811的专栏

阳振坤：关系数据库的挑战与机遇
阅读数 855

详细解读和小伙伴们一起来吐槽博文来自： 拟声的主扬在江湖

搜索引擎的技术门槛
阅读数 26

国内著名搜索引擎公司百度（http://www.baidu.com）总裁李彦宏说：搜索引擎不是人人都能做的领域，进入的门槛比较高。搜索引擎的门槛到底有多高？搜索引擎的门槛主要是技术门槛，包括网页数据的...博文来自： 坚持拼搏自信

专访阿里数据库备份专家 教你pick最有效的备份系统
阅读数 54

摘要：?数据库备份是个老生常谈的话题，看似很简单，但在实际操作过程中，运维人员往往会遇到这样或那样的坑。那么，如今的数据库备份有哪些挑战？如何构建有效备份系统？有什么解决办法？数据库备份是个老生常谈的...博文来自： xstardust的博客

互金平台借贷数据
09-19
来自互联网金融平台的，用户借贷数据，已经经过脱敏，可用于简单的，风控评分卡建模
下载


互金整治——现场检查取证 - weixin_33910434的博客 - CSDN博客
2-15
互金技术的门槛和挑战 04-26 阅读数 102 加入互金这个领域已经2年多了,作为...所以,我今天要来说说互金技术人常见的一些... 博文 来自: 架构栈 深度解析...


“人工智能技术驱动下的机遇与挑战”技术分享会圆满成功！
阅读数 326

2018年1月31日下午，在中科院计算所一层礼堂举行“大数据和人工智能技术驱动下的机遇与挑战”的技术分享会。本次会议邀请了培训中心副校长谢新华老师，以及张云泉、彭晓辉、赵屹博士等中科院计算所在大数据、...博文来自： 中科院计算所培训中心

用量子物理学原理解释为什么振金可以吸收能量（论发散思维的重要性)
阅读数 253

写了很多年技术文章，现在也来做做科普，另外，也让大家体验下思维的真正力量。知识并不重要，重要的是驾驭知识的能力以及天马行空的想象力！希望广大读者不要将本文当成一篇普通的科普文章，而当做进入思维殿堂的入...博文来自： 李宁的极客世界bgJBm&nku$q$

自动人脸识别技术【挑战性问题】
阅读数 1626

FROM：http://b2museum.cdstm.cn/identification/rlsb-1.htm自动人脸识别技术??在2008年，人脸识别技术首次亮相奥运会，为保障北京奥运会及残奥会的开...博文来自： hermito的专栏

秒杀系统的技术挑战、应对策略以及架构设计总结一二！
阅读数 777

参考书籍|《大型网站技术架构》|?李智慧整理|公众号|?Justin谈开发一、什么是秒杀？秒杀是电商常见的一种营销手段：将少量的商品，以极低的价格，在特定的时间点开始出售，网站通过这种营销手段，制造某...博文来自： Java后端技术

震惊！机器人竟然面临这十大挑战
阅读数 511

机器人科学杂志对机器人领域面临的挑战进行了一次调查，受邀的专家小组随后筛选了答案，提出了10个可能在未来5-10年取得重大突破的最大挑战。该专家组是由伦敦帝国学院汉姆林机器人外科中心主任杨广忠率领的。...博文来自： AMOVLAB(阿木实验室)

很多人都说学编程门槛低，真的是这样吗？
阅读数 733

思路清奇，一针见血其实我想说去了华为帮领导做ppt的也不少#手动滑稽为啥我十几年前没遇到这位大哥呢,不至于现在才当5k月薪的码农...哎这里我插上一句，门槛降低，也就导致龙鱼混杂更严重，本来要系统学习...博文来自： qq_41807409的博客

《大数据挑战与NoSQL数据库技术》读后感
阅读数 14

从1970年IBM的埃德加·弗兰克·科德发表“大型共享数据库的关系模型”论文至今，关系数据库发展已有40年有余，已经发展到了高度成熟的阶段，而且是经住了时间考验的。但是近几年来，随着数据大爆发时代的来...博文来自： 清晨之风专栏

搭建图片服务器《二》-linux安装nginx
阅读数 2万+

nginx是个好东西，Nginx (engine x) 是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP服务器。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambl...博文来自： maoyuanming0806的博客

YOLOv2训练自己的数据集（VOC格式）
阅读数 3万+

最近在用yolo来做视频中的人员检测，选择YOLO是从速度考虑，在训练数据集的过程中碰到很多坑，并且现在yolo又到了v2的版本，在网络和命令中都有区别...博文来自： ch_liu23的博客

高斯混合模型（GMM）及其EM算法的理解
阅读数 8万+

一个例子高斯混合模型（Gaussian Mixed Model）指的是多个高斯分布函数的线性组合，理论上GMM可以拟合出任意类型的分布，通常用于解决同一集合下的数据包含多个不同的分布的情况（或者是同一...博文来自： 小平子的专栏

OpenCL性能优化实例研究系列2：避免Local Memory Bank Conflicts的两个简单方法
阅读数 2262

转自：http://hi.baidu.com/fsword73/item/51df1fafe6083e268919d39e 作者: ?fsword73 Bank Conflicts 是存储...博文来自： lucky_greenegg的专栏

linux上安装Docker(非常简单的安装方法)
阅读数 13万+

最近比较有空，大四出来实习几个月了，作为实习狗的我，被叫去研究Docker了，汗汗！ Docker的三大核心概念：镜像、容器、仓库 镜像：类似虚拟机的镜像、用俗话说就是安装文件。 容器：类似一个轻量...博文来自： 我走小路的博客

jquery/js实现一个网页同时调用多个倒计时(最新的)
阅读数 19万+

jquery/js实现一个网页同时调用多个倒计时(最新的) 最近需要网页添加多个倒计时. 查阅网络,基本上都是千遍一律的不好用. 自己按需写了个.希望对大家有用. 有用请赞一个哦! //js ...博文来自： websites

keras实现常用深度学习模型LeNet，AlexNet，ZFNet，VGGNet，GoogleNet，Resnet
阅读数 6034

LeNet #coding=utf-8 from keras.models import Sequential from keras.layers import Dense,Flatten from...博文来自： wmy199216的博客

centos 查看命令源码
阅读数 2万+

# yum install yum-utils 设置源: [base-src] name=CentOS-5.4 - Base src - baseurl=http://vault.ce...博文来自： linux/unix

强连通分量及缩点tarjan算法解析
阅读数 32万+

强连通分量： 简言之 就是找环（每条边只走一次，两两可达） 孤立的一个点也是一个连通分量 ? 使用tarjan算法 在嵌套的多个环中优先得到最大环( 最小环就是每个孤立点） ? 定义： int Ti...博文来自： 九野的博客

MATLAB中注释一段程序
阅读数 1万+

在MATLAB中，可以注释一段程序。 使用“%{”和“%}”。 例如 %{ 。。。 %} 即可。 经典方法是用 if 0，但缺点是不够直观，注释掉的内容仍然保持代码的颜色。现在可以用 ...博文来自： 知识小屋

VMware虚拟机配置文件(.vmx)损坏修复
阅读数 4万+

前言： 对于VMware虚拟机配置文件(.vmx)损坏 大家发生问题的原因可能跟我不一样，但是解决方法应该是一样的. 但是本方法仅适用.vmx文件损坏而其他文件完好无损的情况。 ...博文来自： shuideyidi的专栏

C# 基于SharpPcap的局域网数据包捕获 之二 监听代码
阅读数 4201

1.配置好sharpPcap引用和安装好winPcap后，添加引用 using PacketDotNet; using SharpPcap; using SharpPcap.AirPcap; usi...博文来自： wuma0q1an的博客

ArcGIS VS QGIS——两者之间的27点比较上篇（译）
阅读数 9972

本文是笔者刚刚接触QGIS相关博客资源时找到的一篇文章，全文比较长，因此分成两篇发布。就内容而言不代表笔者观点，留待后续一一验证。QGIS和ArcGIS的比较你也许伴随着ArcGIS或者QGIS而成长...博文来自： 番茄园

DirectX修复工具增强版
阅读数 182万+

最后更新：2018-12-20 DirectX修复工具最新版：DirectX Repair V3.8 增强版??NEW! 版本号：V3.8.0.11638 大小: 107MB/7z格式压缩，18...博文来自： VBcom的专栏
体感技术?帧内编码技术?体感技术视频教程?体感技术学习?体感技术课程
android jni互掉?android开发获取手机的金纬度?c++技术 微信公众号?c++中文分词技术?c# rsa签名技术人工智能带来的挑战班会?人工智能学习门槛

东升Forest
关注
原创
42
粉丝
11
喜欢
12
评论
22
等级：
?

访问：
?
2万+
积分：
?
432
排名：
?
14万+
勋章：
最新文章
?学会表达就是核心竞争力
?ToB产品的架构版本维护
?讲讲小朋友培养数学思维的玩具
?根据我的个人经历说说小朋友的数学教育
?回顾一下今年的朋友圈
归档
?2019年2月1篇
?2019年1月3篇
?2018年12月2篇
?2018年7月3篇
?2018年6月2篇
?2018年5月6篇
?2018年4月7篇
?2018年3月6篇
?2018年2月6篇
?2018年1月3篇
?2017年12月6篇
?2017年11月5篇
?2017年10月4篇
?2017年9月3篇
展开
热门文章
?简单说说SQL中Join的使用
阅读数?4714
?
?简单说两句微服务拆分
阅读数?3279
?
?如何做团队复盘
阅读数?2436
?
?谈谈搭建堡垒机的几条原则
阅读数?1704
?
?说说招聘工程师
阅读数?1025
?
最新评论
?说说最近面试招聘的感受
QH_JAVA：贵公司做的不错，作为一个被招聘者看着很欣慰！
?
?说说招聘工程师
bushanyantanzhe：一场面试是否成功，取决于面试官是否能把面试者的能力引导出来，当然，更重要的还是看面试者个人的技术修...
?




微信客服

QQ客服
kefu@csdn.netQQ客服
客服论坛400-660-0108
工作时间 8:30-22:00
关于我们招聘广告服务?网站地图
百度提供站内搜索?京ICP证19004658号
?1999-2019 北京创新乐知网络技术有限公司
经营性网站备案信息网络110报警服务
北京互联网违法和不良信息举报中心
中国互联网举报中心
Python实战训练
转型AI人工智能指南
数据库沙龙
21 天入门机器学习
登录
注册
?
0
?
?
?
?
?

?
?
?



?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
支付路由的设计与实践?
2018-06-11 17:25设计/支付/操作系统

前言
用户在一些P2P公司进行充值投资经常会收到手机短信提示输入手机验证码完成支付。细心的用户往往会发现，在不同的时间，不同的金额进行充值投资时，往往收到的短信验证码会略有不同。
这些前缀可能是“宝付支付”，“连连支付”，“易宝支付”等等。其实这背后是有一个支付路由在替用户选择一个最合适的支付通路完成支付。本文旨在揭示与阐述支付系统背后的路由设计与实践。
支付路由存在的意义
如前言所展示的替用户选择一个合适的充值渠道只是支付路由的冰山一角。
事实上，一个健壮，设计良好的支付路由存在的意义包括但不限于：
A. 降低公司的支付成本：不同支付通道有着不尽一致的支付成本，支付路由旨在尽可能择出一个对于公司而言节省成本的方案。
B. 保证支付成功率：对于投资用户而言，支付成功率是用户体验的重要组成部分。良好的支付成功率可以使用户投资顺畅，对于借款用户而言，支付成功率是投资用户的投资收益，以及借款按时计划还款的重要组成部分。
C. 支持个性化的支付定制：例如对于渠道灰度切换，特定银行特定渠道优先，或是渠道每日限额控制，A/B 测试，脚本定制。这些个性化的渠道方案定制策略都希望可以在路由系统中被考虑和实施。
D. 计算支付整体方案的能力：不仅仅计算单一的支付通道，而是拥有计算一个完成支付方案的能力。
E. 闭环控制：设计良好的支付路由系统应该有闭环控制的能力，能够根据外界环境的变化（比如渠道/银行维护，断路）而对于相同的输入参数给出不同的输出结果。从而降低公司整体的运营成本。
支付路由设计需要考量的因素
对于一个支付路由而言，设计时需要考量的因素有哪些呢？
本章会从系统的输入与输出入手，阐述支付路由中需要考量的业务因素，继而推出路由算法以及背后的整体流程方案。
A. 系统的输入与输出
对于任何一个系统设计而言，首先需要明确系统的边界在哪里。支付路由可以简化为公式：y=f(x).其中y =支付方案，x =支付请求。
支付请求：支付请求包括需要执行的支付金额，使用的银行卡，以及对应的产品。举例：(张三，银行卡A, 充值, 2000元)。 这是一个典型的投资者行为。张三在有一张绑定的银行卡A, 希望投资充值2000元。复杂一点的, (李四，银行卡A, 银行卡B, 代扣，7000元)。对应的业务可能是李四是借款人，登记了银行卡A和银行卡B，期望这次还他的贷款7000元。
支付方案：支付方案包括支付金额，使用的银行卡，渠道。对应支付请求中的例子。可能是：(张三， 银行卡A, 2000元，连连支付)。于是张三手机上收到连连支付发送给他的短信验证码。对应第二个例子复杂一点, 结果是: [(李四，银行卡A, 3000元， 宝付支付), (李四，银行B, 2000元，网易支付), (李四，银行卡B, 2000元，网易支付)]。表示这里会执行三次代扣，分别是通过宝付在银行卡A扣款3000元，通过网易在银行卡B分别扣款2000元。
B. 路由业务：
我们将具体的业务因素定义为两大类：过滤性因素以及选择性因素。
过滤性因素指在一个支付方案在这个因素不被满足时，则整个系统就不会采纳这个支付方案，选择性因素指在多个支付方案可以在这个因素上进行比较，从而很大因素上影响支付方案结果的产生。
典型的过滤性因素包括但不限于以下几类：
?渠道/银行维护：渠道和银行并不是总是在 7*24小时内保持有效。大部分时候渠道/银行会提前知会公司有关维护信息。
? 渠道银行限额：不同渠道银行在不同的支付产品下会有不同的限额设置，限额包括单笔限额，单日限额，单月限额。
? 渠道银行交易频率限制：对于特定的渠道, 单卡的每日交易次数也是有所限制。
? 渠道用户绑卡情况限制：某些支付产品，渠道是需要先绑卡后使用，对于绑卡失败的用户，该渠道并不能被使用。
? 可用渠道配置限制：系统管理员可以根据公司签署的渠道和产品，在系统中配置相应产品对应的多种渠道。对于不在配置列表的方案，则不应予以采纳。
? 白名单/黑名单限制：支付请求可以对应相应的白名单和黑名单请求，表示在指定的渠道/指定以外的渠道内进行选择。
典型的选择性因素包括但不限于以下几类：
? 渠道费率：对于不同的渠道，相同的支付请求往往会对应不同的支付费率。费率比较是支付路由的核心比较之一。
? 渠道成功率：不同的渠道由于其技术,运营水平的差异，往往对应不同的支付成功率。成功率比较也是支付路由的核心比较之一。
C.路由算法：
路由系统是否可以支持费率优先，或者成功率优先，或是其他更复杂的算法呢？在本章B中的选择性因素只能给出对于一个具体的维度上，多个方案的排名优劣。但是并没有回答这个排名优劣如何作用于一个最终的决策。本文给出两个经典的常用算法：
锦标赛赛决出优胜者的方式是，通过一轮又一轮的比赛，在每一轮的比赛中，失败者淘汰，优胜者晋级直至最终冠军的产生。
举例: 一个锦标赛的路由算法配置：[费率优先，渠道成功率优先]. 表示这次比赛，所有的候选方案都先进行费率优先的比较，而后进行成功率优先的比较。
在A中张三投资2000元有三个方案参与了比赛，分别是S1: （张三， 银行卡A, 2000元，连连支付），S2: （张三， 银行卡A, 2000元，宝付支付），S3（张三， 银行卡A, 2000元，易宝支付）。 S1费率0.5元，S2费率0.5元，S3费率0.8元。则第一轮在费率上的比赛 S3出局，继续S1和S2的成功率比赛。S1成功率99.1%, S2成功率99.9%。则优胜者为S2. 最终张三收到连连支付发送的短信验证码.?锦标赛算法本质上这是一个偏序比较的算法。
循环赛决出优胜者的方式是：所有候选者都参与每一轮的比赛，根据排名座次分别取得一定的积分。最终所有候选人根据总积分决定优胜者。
举例：一个循环赛的配置是：费率排名第一的得3.5分，第二得2分，第三得1分。成功率第一得4分，第二得2分，第三得1分。在这种设置下，假设S1在费率得1分，成功率得4分。总得分5分。而S2在费率得2分，在成功率得2分。总得分4分。则最终S1胜出。说明虽然S1费率最差，但是成功率的领先让其在路由中被择出。而如果S2在费率中排名第一，则S2的成绩从4分变为5.5分。则S2胜出了。说明在巨大的费率优势下，整个路由系统判定S2虽然成功率低一点但是也值得一试。循环赛算法本质上是一个权重比较的算法。
所有参与排序的方案在各个选择性因素上都可以得到一个通用的排名以及各个不同的比较结果参数。比如在费率的比较上，各个候选方案可以得到排名以及相对应的费率。在成功率的比较上，
也可以得到相应的排名和预测成功率数值。以下是公式定义与推导：
计费率优先算法为f1:

计成功率优先算法为f2:

则任何路由算法可以定义并且实现为f3:
D.系统流程
为了支持A中李四的例子，整个支付路由系统被设计成可重复迭代计算的流程。 以下设计为例：

当一个输入进入到路由系统时。对于此输入我们分配了若干的候选方案。经过金额结算器（Amount Decision Maker）计算出每个候选方案的支付金额。
而后经过过滤器（Filter Decision Maker）会根据渠道银行限额，渠道银行维护，黑名单，白名单等可配置的各种过滤性因素（见本章B的讨论）排除掉一些不合适的方案。
之后进入选择过滤器（Decision Comparator Maker）. 选择过滤器由两部分组成，一部分是业务的选择性因素(见本章B的讨论)，一部分是路由算法(见本章C的讨论)。
最终选出一个合适的候选方案。最终进入中断结算器（Terminal Decision Maker）。 中断结算器的作用是根据输入参数，和计算出的候选者（解）决定是否还需要迭代计算。
对于本章A中张三的例子，中断决算器判定不需要再迭代计算了。所以第一个候选方案就是最终方案（单解）。
而对于本章A中李四的例子，中断结算器在前两次的计算中判定还需要迭代出新的方案。所以最终可以看到完整的支付方案是包括三个解的解集（复解）。
E.系统扩展
根据高内聚，低耦合的软件设计原则，由本章D的设计图可知，无论是对于过滤性因素，还是选择性因素或者是路由算法。整个系统是可以被实现为可配置化的路由决策系统。在关键的组件上，还可以实现DSL用户自定义编程，从而系统可以拥有线上灵活更改路由的能力。下图即为一个路由策略的配置参数：

对于二次开发而言，开发人员也只需要根据业务增加新的过滤性因素，或者编写新的路由算法/脚本（或引入规则引擎）。线上人员只需要通过配置就可以引入这些新的功能。
整个支付系统还可以考虑针对不同渠道的返回或者自定义的计算方式决定打开/关闭某些渠道，或者动态调整渠道银行限额。从而使得路由系统拥有闭环控制的能力。
结语
支付路由作为支付系统的“大脑”，并不是简单的if-else的堆砌。
希望本文可以抛砖引玉，欢迎同行一起讨论更多的类似解决方案。
12返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (601)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:524
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 19:36

小米9配置很强，卖5千也便宜，网友：荣耀V20，正式再见
差评数码?·?02-19 14:03?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124
2019年新品平板电脑仅598元

?广告?·?今天 19:36

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 19:36

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

华为“脱光外衣给世界看”，英国终于认可：华为5G风险可控
核舟POST?·?02-19 14:161

华为mate20pro对比苹果XSMAX：差距实在太大
差评数码?·?02-11 16:0023
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 19:36

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11176

华为Mate20：再见了！
科技小李?·?今天 00:10173
?广告?·?今天 19:36

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24172

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 19:36

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:05?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?
欧盟正式启动“欧洲联盟人工智能”(AI4EU)项目，项目预算达2000万欧元
中国国防科技信息中心?·?今天 17:28?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 19:36

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

谁在购买微博、微信流量？
张书乐?·?今天 16:49?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 19:36

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:0768

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08314

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03132

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

三星S10：回来了！
火科技?·?今天 16:30154

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26626

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14?

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08?

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39?

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:361

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00145

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

浮夸营销无法解决续航问题，小米9续航遭质疑
蓝鲸TMT?·?昨天 16:15
法国国防部授出第一批“人机组合”(MMT)计划研究合同
中国国防科技信息中心?·?今天 17:28

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

人人车李健：没有盈利的原因是员工没有尽职尽责；巴菲特股东信：伯克希尔Q4净亏损约254...
i黑马?·?今天 08:44

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11

百度的冰与火
阑夕?·?昨天 23:45

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00
以蒸汽为动力的航天器或许可以实现“永久”探测
中国国防科技信息中心?·?今天 17:28

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23

报告:到2021年，iPhone、iPad和Mac将运行相同的应用程序
MiHomes?·?02-21 22:16

2019MWC五大看点：“数字星球”时代到来，5G只是开始
第一财经?·?今天 16:45

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7963万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
?返回
?首页
?用户
?反馈

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
Java内存模型的核心问题就是如何解决一致性问题?
2018-10-17 17:24计算机/操作系统

不知道你有没有听过Java内存模型(Java Memory Model)？如果没听过，那Java多线程编程你肯定不陌生吧。你去随便找一本讲Java多线程编程的书籍，你就会发现，基本上都会讲到Java内存模型。到底什么是Java内存模型呢？它跟多线程又有什么关系呢？
要了解这块知识，最权威的材料莫过于JSR-133(JMM规范)了。不要被JSR-133这个奇怪的单词吓到了。实际上看懂JSR-133并不难，我也是几乎不费力气的就看懂了。但是，尽管JSR-133每个章节每个概念都不难看懂，但是，要真正理解JMM还是不容易的，不信？那你可以拿下面这几个问题自测一下，看是否都能会答上来呢？
1）为什么叫Java“内存”模型？JSR-133讲的内容跟”内存“有什么关系？
2）为什么Java内存模型总是跟多线程放到一块讲？
3）处理器可见性和重排序跟Java内存模型有什么关系？
4）JMM为什么要讲volatile, synchronized, final?
透彻的无盲点的理解JMM是需要非常广和深的计算机理论知识的，涉及到计算机体系结构，操作系统，编译原理，JVM虚拟机规范等，我能力有限也不想假装大牛，所以为了能顺畅的阐述JMM的来龙去脉，对于有些概念进行了假设，猜想，默认，细节简化，做到“不求甚解”只是为了能很短的篇幅内完整的阐述清楚JMM的来龙去脉，并且能让你看懂。不过，尽管有些细节的忽略，但并不影响文章的正确性。
JMM解决的核心问题是什么？
我先概括性的给出四个结论，如果你看不懂，也没关系，我接下来会针对每一点展开分析。
1）多线程情况下，一致性问题是如何产生的？
硬件内存模型导致的，其中包括CPU缓存和指令重排序。
2）多线程环境下，有哪些一致性问题？
CPU缓存导致的：缓存与内存数据的一致性问题；
指令重排序导致的：指令真正被执行顺序与程序书写的顺序的一致性问题；
3）上述一致性问题带来哪些编程上的问题？
多线程下并发的执行存在race condition的代码，上述的不一致性问题会导致代码执行结果的不确定性(随机性)。
4）Java如何来解决上述所讲的一致性问题？
通过一些方法来禁止CPU缓存和禁止指令重排序
什么是硬件内存模型？
不同体系结构的内存模型是可能有差别的，我们拿其中一种常见的并且简化一下来讲解。处理器为了保证高效的运行，提高CPU指令执行的效率，引入了两个优化：CPU缓存和指令重排序。
1）CPU缓存：导致数据的不一致性
CPU引入缓存的目的主要是解决内存读写速度和CPU处理速度的差别，使CPU对数据的读写不需要等待较慢的内存。
在只有一个CPU的情况下，使用缓存是没有任何问题的。但在多CPU的情况下，每个CPU都会有一个独立的缓存，但共享内存。这就有问题了。因为每次CPU写操作，都会先将数据写到缓存，然后再择机刷到内存。同样，CPU读操作，也是先从缓存中读取，不命中再从内存捞。
我们知道缓存会有数据一致性问题（不懂自己查查），CPU缓存也不例外，一个CPU写的数据可能不会被另个CPU立刻读到，这就是我们经常提到的可见性问题。
2）指令重排序：导致指令执行顺序的不一致性
对于一组指令序列，比如A,B,C,D,E...(每个英文代表一条指令)，指令的顺序有可能并非是最终执行的顺序，CPU为了提高执行效率(比如，提高缓存的命中率)，可能会在执行的时候，只要保证存在数据依赖的两条指令，执行先后顺序不变(即偏序有序)，就可以肆无忌惮的对指令序列重排序。
对于单CPU的情况下，这样的指令重排序并没有什么问题，CPU承诺最终执行的结果跟没有重排序的执行结果是一样子的，不然它也不敢这么肆无忌惮的瞎搞。但是对于多CPU的情况下，CPU就不做任何承诺了，一个CPU看到的数据更新操作可能跟其预期的(未指令重排序执行的)是不一致的了。
不过，上述两种CPU优化策略（缓存和指令重排序）大部分情况下都不会出问题，只有当两个CPU并行执行存在数据操作冲突的指令(其中有一个写操作)的时候，才会存在问题。不过，CPU是否听之任之问题的存在呢？当然不是。
有些处理器直接就在硬件层面上禁止重排序和缓存，所以就不存在上面说的问题。但大部分CPU并不想为此牺牲效率，所以默认将问题丢给了上层代码，但提供了一些基本的指令来支持禁止缓存和指令重排。
JMM与硬件内存模型有什么关系？
在CPU看来，任何高级语言编写的代码最终也都是要编译成一组操作数据的指令序列，CPU最终执行的就是这样一组指令序列。因为并不是所有的处理器都会妥妥的解决好缓存和指令重排带来的问题，像JAVA这样的跨平台语言，就需要在语言层面解决编译之后的指令的在不同处理器上可能存在的缓存和指令重排序问题。
那如何来解决呢？所以JMM规范就顺理成章的诞生了。那又为什么叫Java内存模型呢？那是因为JMM解决的是我们刚刚讲到的硬件内存模型存在的问题，所以起名叫做Java内存模型。
JMM跟多线程的又有什么关系？
为什么每次提到JMM都要跟多线程联系在一起呢？因为单线程下，程序被分派给一个CPU执行。而硬件内存模型里面的缓存和指令重排序的问题也只是在多个CPU并行执行并存在冲突的数据操作的时候才会有问题。
也就是说在Java不涉及多线程运行代码的情况下，也就不存在多CPU并行执行代码，也就不存在上面说的种种问题。所以Java内存模型讲的内容的前提都是在多线程并发执行race condition代码的时候产生的。
硬件内存模型带来哪些编程问题？
我们举两个例子说明一下，硬件内存模型中缓存和指令重排序对Java多线程编程的影响。
首先来看下下面的代码：
public class Server {
private boolean stoped = false;
void run() {
// ....
While (!stoped) {
// ....
}
// ....
}
void stop() {
stoped = true;
}
}
一个线程执行run()，当需要停止Server的时候，另一个线程执行stop()，将stoped设置成true。
从代码角度看，貌似没有什么问题，但是将代码翻译成机器指令之后，就会发现stoped值会因为CPU缓存，存在一致性问题。
当一个CPU执行stoped=true指令时 ，会先写入CPU缓存，具体刷新到内存的时间不确定，另一个执行run()指令序列的CPU，有可能之前已经缓存了stoped值在CPU缓存中，另一个CPU即便将stoped设置为了true，此CPU可能也迟迟读不到最新值。
从Java代码的层面来看，就会出现一种奇怪的现象，明明stoped已经设置为true了，server仍然一直运行。
我们再来看下面这段代码：
public class ReorderExample {
int val = 0;
boolean flag = false;
public void fun1() {
val = 1; // A
flag = true; // B
}
public void fun2() {
if (flag) { // C
int ret = val + val; // D
// ...
}
}
}
看上面这段代码，我们预期的ret值应该是2，因为只有flag=true的时候才会执行ret=val+val，而flag设置为true之前val会被设置为1。但实际上，在多线程并发执行fun1和fun2的情况下，会出现ret=0的情况，这就是操作重排序导致的结果，我们来分析一下。
在fun1()中，A, B操作没有依赖关系，如果发生指令重排序，B先于A执行，flag会先被true，然后val还没有被设置为1，这个时候C通过，D计算结果便成了0。
这样子，在多线程下，代码的执行结果就不确定了。
JMM如何解决多线程面临的问题？
问题很明显是因为硬件的内存模型导致的，我们要解决这个问题，可以有几个途径：
1）硬件层面解决
处理器层面上就禁止缓存和指令重排序，对于Java这种跨平台的语言来说，显然是不行的。
2）JVM默认实现
上面有问题的代码，在编译成指令时就事先通过处理器提供的 指令，将其编译成一组多CPU下执行安全的指令序列。这个显然是不合适的，因为我们事先并不知道程序是否是在多线程下执行，过度的严格的限制会导致代码执行的效率。
3）程序员控制
通过提供一些语法关键词，有程序员发现负责代码在多线程并发竞态下的问题，通过这些关键词来控制，做到多线程下执行结果并非不确定。
JMM讲到了三个关键词，volatile, synchronized, final，其中：
a) final本身是指常量类型，但在构造函数中使用final会重排序问题，所以重新定义了final对重排序的规则语义。
b) synchronized本身的虽然并未对解决重排序问题，但通过互斥访问共享变量，做到临界区代码串行执行，并且synchronized语义本身定义了每次进入和退出都要同步CPU缓存，所以CPU缓存的数据一致性问题不存在，并且指令重排序也并不影响指令执行的确定性。
c) volatile这个关键词就是纯粹为了解决可见性，重排序等问题产生的。volatile修饰的数据的读写读写操作会让CPU缓存主动跟主存同步，来保证一致性，另外通过禁止某些指令重排序，可以完美解决指令重排序导致的问题。
对于volatile, synchronized, final的详细介绍，请看JSR-133.返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (958)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:524
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 19:45

小米9配置很强，卖5千也便宜，网友：荣耀V20，正式再见
差评数码?·?02-19 14:03?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 19:45

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621
2019年新品平板电脑仅598元

?广告?·?今天 19:45

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

华为“脱光外衣给世界看”，英国终于认可：华为5G风险可控
核舟POST?·?02-19 14:161

华为mate20pro对比苹果XSMAX：差距实在太大
差评数码?·?02-11 16:0023
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 19:45

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

华为Mate20：再见了！
科技小李?·?今天 00:10173

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11177
?广告?·?今天 19:45

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24172

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 19:45

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:05?
欧盟正式启动“欧洲联盟人工智能”(AI4EU)项目，项目预算达2000万欧元
中国国防科技信息中心?·?今天 17:28?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 19:45

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 19:45

三星S10：回来了！
火科技?·?今天 16:30154

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08322

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03136

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:0770

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26627

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55136

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14?

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08?

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39?

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00145

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:361

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

浮夸营销无法解决续航问题，小米9续航遭质疑
蓝鲸TMT?·?昨天 16:15

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

人人车李健：没有盈利的原因是员工没有尽职尽责；巴菲特股东信：伯克希尔Q4净亏损约254...
i黑马?·?今天 08:44

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17
法国国防部授出第一批“人机组合”(MMT)计划研究合同
中国国防科技信息中心?·?今天 17:28

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

百度的冰与火
阑夕?·?昨天 23:45

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23
以蒸汽为动力的航天器或许可以实现“永久”探测
中国国防科技信息中心?·?今天 17:28

报告:到2021年，iPhone、iPad和Mac将运行相同的应用程序
MiHomes?·?02-21 22:16

2019MWC五大看点：“数字星球”时代到来，5G只是开始
第一财经?·?今天 16:45

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7963万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
广告

24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7963万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
高并发高性能系统设计实践?
2018-09-29 17:25设计/开发/技术

随着近些年互联网的发展，高并发高性能技术已经非常成熟。移动互联网、电商等聚集了大量的人气，业务的发展，并发用户的猛增，也将原本简单的应用推动到了必须解决性能的问题上，伴随着技术一步一步的升级，系统已不再是每逢促销就宕机，而是轻松应对每次高并发。得益于分而治之、扩容、降级、熔断等一系列方法的应用。
我曾有幸经历了电商系统业务从几十亿到几百亿规模的过程，系统从单体应用过度到服务化，应用经过了各种拆分、服务化、治理。单个服务达到每日几十亿次调用。
在我进入互联网领域之前，一直想知道互联网的那些高并发是不是使用了更高级更贵的软硬件，比如Oracle RAC、Weblogic、小型机等。后来才发现这完全相反，大部分使用得更多的是免费、开源、轻量级的软件，比如Mysql、Tomcat、Nginx、Redis、zookeeper、CentOS等等，服务器虚拟Docker化，架构设计上更多考虑水平扩展性，10台服务器支撑不住，是否能支持部署100台、1000台或者更多服务器扩容，只要能通过增加服务器解决的都不是问题。这些都体现在深挖更底层技术特性，将最简单技术用到极致。
高并发高性能系统是逐步演变、逐步迭代优化而来的，不是一开始就设计出来的，但是系统各个阶段的设计水平影响到后期迭代、重构、优化的难度及速度。本文将会大致介绍一个成熟的高并发系统经历过的阶段及各个环节的高并发的实际技术架构及解决方案。
系统要求

对于一个系统设计上需要考虑很多方面。
可用性是最基本保障，比如要达到99.999%的可用，1年不能超过5分钟宕机，这一点还是比较难达到的，宕机一次，全年KPI就被扣没了，这也是用来衡量系统的可用性的关键指标；
容灾性比较容易忽略，应用容灾、数据容灾、网络设备基础设施容灾、IDC机房容灾，这要考虑如何能从灾难中快速恢复，满足RTO、RPO的指标，这也是可用性的一重要项；
安全性就更重要了，一般公司都有技术安全部门把关，但应用开发人员同样需要具备安全的基本知识，可能安全问题出现在某一个对外接口权限控制上，这些还是需要对涉及安全相关的模块重点Code Review及安全渗透测试；
伸缩性、扩展性，在系统刚开始建立的时候，业务量一般都不大，不需要设计得那么高并发，但是需要有所准备，在系统规划的时候就要考虑到，比如将来业务量增长了之后，我们只需要改造某一个或几个模块就能达到扩展性，或者增加硬件资源纵向或横向增加伸缩性；
高并发，在系统设计阶段需要考虑，比如一开始设计的时候就考虑未来业务增长几十上百倍，将来系统一定会拆分，那么设计的时候在应用代码内部模块化做好，模块之间松耦合，未来并发量高或需要更多团队维护的时候，就很轻松拆应用。当然我们不要过度设计，把一个简单的系统设计得很复杂，每天访问量都不过万，就要达到亿级流量的容量能力，这样只会让维护性变差。
项目初期阶段

一般项目初期开发人数在十几个左右，这个时候通常都是建立一套应用，所有的业务模块都放在一起，核心开发人员也需要对整个系统业务及代码比较了解。好的架构在这个时候就需要设计出模块化，系统内部代码相互尽量保持独立，从控制层到service，到dao层。可以将各模块分配到各开发人员维护，并定期交换模块开发。这样的单系统好处维护方便，包括开发、打包测试、上线等。这样的单系统也可以按照Web控制层、Service服务层简单分应用，这是目前中小项目用的比较多的方式；当项目规模到50人以上的时候，维护性及效率将会降低。
项目中期阶段

上图是电商系统的基础模块。当业务量上升，需求大量增加，这个时候技术团队人员也会随着大量增加，因为系统变复杂了，需要更多人参与开发，同时还要处理线上问题等。当人员从原来的十几个开发，增加到近百人的时候，系统需要快速进行拆分，每个小Team负责一个模块。这时候如果系统前期设计及保持得比较好，拆分是很容易的一件事。比如用户中心的模块，用户表属于基础表，大部分模块都会使用到，如果各模块需要使用用户信息，都是从独立模块service接口获取信息，那拆分会很简单，如果所有查询地方都自己去Join这些表，拆分将会是很漫长的过程，且伴随各个Team的协调、配合、沟通才能完成这件事。所以通常建议Join表控制在3-5张表以内，超过的话需要考虑是否未做好模块化了。
项目成熟阶段

上图是电商系统经过长期的发展逐步形成的模块，这时期系统变得非常复杂，当然开发人员也是比较多，可能一个大部门就只负责其中几个模块。这时期的系统处于高度模块化、服务化，当需要实现一个新的业务模式的时候，比如增加一个拼团网站或App或频道页，只需要各个Team配合，相关的功能拼凑即可完成（当然也需要一些定制开发），不再需要独立设计库存、订单等模块，更多的精力放在前台页面相关业务功能实现上，高度复用及固定团队做熟悉的事情，这样大大增加了系统可用性、安全性等。
上图中大致分为前台（用户直接操作的相关功能）、中台（后端服务层）、后台（运营或商家使用的相关功能），中台是整个系统中抽离出来的共享服务层，各个业务模块系统基本都会使用到。
服务层子系统实现

前面聊到的系统发展到成熟阶段，这时候前台用户流量很高，各个子系统并发量都很大，这里解决高并发的最常规手段就是分而治之，每个子系统需要设计考虑容量、TPS。
如上面图中的价格子系统。“价格业务后台”将各种类型的价格写入数据库，在该系统中业务较为复杂，比如基准价、促销价、团购价、闪购价、拼团价、会员阶梯价等等，这些价格都是由运营人员设置操作的，因此并发量很小，在该系统实现复杂的业务逻辑校验不是什么问题，最后将校验后的价格写入专用的数据库，核心的表一般就在5-10张左右。
“Price Service”的内部业务逻辑较为简单，只做一些与前台调用相关的逻辑，前台不同的业务类型、平台、渠道等调用该服务，可以获取到相应的价格，该服务基本上对DB是只读操作，如果流量过大，可以扩展更多的备库，流量再大一些就拆库，对该服务来说，做到百亿级别的日调用量不是什么难事，只要堆机器就好（当然系统结构上还要考虑缓存、DB、网络等）。通常按照每天12小时计算出每秒需要的支撑并发量，再乘以3-5倍作为峰值的并发量。这里单台Tomcat服务器能达到的TPS越高，所需要的机器数量就会少很多。系统的性能优化是持续不断的过程。
前台子系统实现

上图是前台的相关设计，前台是直接与页面用户能操作的相关功能，通常也是细分了模块，比如商品详情页功能可以是独立的一个子系统，页面加载的内容细分很多次请求，对于后端业务服务层来说，相关数据调用了其他service提供的接口。
要高并发，必须对调用的接口有高的要求，通常单次调用需要做到5-10ms，不超过20ms。对于调用的Timout时间也是控制在100ms以内或更低，也就是如果调用接口响应超过一定时间，直接调用失败以页面报错等方式快速处理，通常页面部分功能未加载出来，然后再次刷新就能看到，就是这个原因。当某个非关键路径的应用宕机，不影响整体网站的主流程功能。这里要做到高并发，有时候是需要牺牲一些用户体验的（在能接受的范围）。
DB分库分表实现

前面提到了子系统的高并发，这些系统都需要读写数据库。通常DB的操作中90%以上都是读的操作，也就是写的操作压力并没有那么大。
考虑性能的时候，可以读写分离，写的操作在主库（对于特殊的一些时延很敏感的读操作放主库），读的操作在备库，这样减少了主库压力，备库压力大的时候可以再增加几个备库解决。
当主库压力很大的时候，可以考虑将表按照业务模块划分拆分成几个主库，比如用户库、产品库、订单库等。如果这样拆分还不能满足，则可以拆分表，按照时间维度拆分表，近期数据查询频率更高。对热点数据或近期数据表可以考虑继续拆分，比如订单表，可以按照用户维度拆分到6个库，如果压力再增加，则拆分到12个库，按照1拆2的方式，成倍增加数据库主库，可以很好解决主库扩展，提升并发性能的问题。
表的拆分，通常会引入更多复杂性和局限性，比如按用户拆分表后，需要按商家维度查询该商家下所有用户的订单就比较麻烦。通常用户自己查看订单的并发量要远远高于商家查询订单的并发量。所以商家查询可以低效率一点、或者再同步一份数据到单个库供商家查询。
服务化事务考虑

服务拆分后，原本容易控制的事务变成了分布式系统事务。整个系统要保证高并发，需要有一定的容忍度，跨服务的事务通常都是事后补偿机制，如果调用较多的子系统，可以类似DB的机制，先写日志，调用成功后更新日志，然后定时任务检查日志中调用情况，然后再次发起调用进行补偿，直到各个子系统都调用成功或回滚成功，如果1h、3h、6h阶梯调用3次还不能补偿，可能就需要技术人工介入处理（当然这样的数据不多，可能是程序Bug引起）。
高并发中一般不使用分布式事务、二阶段提交事务等，本地事务一般也不使用表锁、行锁等悲观锁，乐观锁是很不错的选择，如果出现并发抢占资源，则让后来者更新快速失败，如果冲突较多，则需要检查程序逻辑了。
一次操作调用太多的子系统，还需要将同步调用和异步调用区分开，异步调用不占用时间，将调用是否成功放在后续流程操作中检查，这样也能大大缩短一次调用的处理时间，提高并发性能。
高可用性泳道隔离

在考虑可用性上，避免将鸡蛋都放在一个篮子里，对于一些独立的业务，可以采用泳道隔离的方式，如果出现高并发流量导致应用宕机，应该将故障控制在一定的范围内，其他业务不受到影响，比如未事先报备评估，业务人员将某商品以极低的价格在外部推广，这时候就可能出现流量陡增，系统被压垮，如果泳道隔离了，只会影响部分业务。对于业务系统后端调用的基础服务子系统也应该分组，也就是同一个子系统的机器被划分组提供给不同业务线使用。
高可用优雅降级

一次连续的用户操作路径会有很多的系统支撑，各种业务都混在一起，当大促的时候，流量数倍增加，这时候某些页面可能支撑不了，因此需要整理业务流程，定义关键路径。当出现系统不能支撑的时候，快速降级，断开一些不重要的业务，保障大部分功能正常使用。比如大促时，商品详情页上的收藏数量展示、精准化推荐等用户并不关注。大促有什么商品，价格和促销方式是怎样的，及能下单和支付成功，且能看到订单，这是用户操作及关心的主功能，其他功能降级，基本不影响用户体验。
在实际中，经常有很多S0（订单单量急速下降，甚至跌到0订单/每分钟）的事故是因为一些未被关注的应用，大促前也未充分评估，流量高的时候，这些应用就宕机，结果影响整体网站访问。
整个网站子系统非常多，千丝万缕，理清主流程，服务治理还是需要一个过程的，但又必须要做好。
流量应对

大促临近的时候，通常是根据性能压测指标增加机器，机器不够用就从一些不重要的系统拆借机器，或者临时租用云服务器，组成混合云模式（流量分发的时候要考虑云机器加入集群中的访问时延）；除了增加机器，还有一些化解流量的策略。
业务场景分步操作，比如抢红包，就将抢的操作分开了，先让用户打开红包，再点击抢的按钮，第一步打开的操作查询红包余额并不准确，当第二步点击的时候才出现准确的结果，红包已抢完或抢中。这样分开的设计对用户体验降低较少，但对系统并发量处理呈指数级下降。
缓存很重要，CDN的图片分布式缓存可以降低对IDC服务器访问量，以及squid缓存静态页面，memcached、Redis缓存业务数据及热点数据，还有JVM本地缓存等。
秒杀抢购场景使用排队策略，用户页面轮询排队结果，后端服务可以毫无压力的处理。对于库存有限的抢购，可以只放入一定量的请求，其他请求全部挡回去（这些请求进来也不会抢成功），这样对后端也就没有并发压力了。
多IDC分流，建立多IDC分布于重点区域或省份，这样可以分流，同时也能提升用户访问速度
限流的策略通常作为灾备方案，当出现系统不能支撑的时候，拒绝一些服务请求，比如Tomcat设置为600最大线程（需要压测评估该系统能接受的TPS）作为保护，避免宕机。还有一些从网络设备上的限流策略，拒绝一部分访问，避免出现整个系统宕机的严重事故。
监控

所有性能、并发量指标等等都离不开监控。从域名解析到各IDC机房、网络设备层、负载均衡、应用服务器、JVM、磁盘、服务接口响应耗时、缓存、DB等等，要优化性能，这些监控指标都要能清晰的看到才便于分析优化（当然及时报警快速定位问题是监控最重要的）；一次用户访问经过很多过程，需要从前到后逐个排查分析，找到瓶颈并优化。
THE END
网站的高并发性能需要逐步重构优化、不断调整架构设计，各个节点模块的优化也都有大致标准的业界通用做法，限于时间和篇幅，本文仅大致描述了一些实践中的方案。
作者加入点融前，曾在某知名电商公司工作多年，负责过一些架构设计及团队管理，以上内容是在实际工作中总结的一些经验，仅作为一些设计的参考，有不当之处欢迎指出及交流，感谢您阅读到这里！返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (756)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

iOS 12.1.4 真实体验后，到底值不值得升级？
iTools?·?02-19 08:20?

搞笑GIF：这个简单，趁树不注意的时候就可以了
呼吸的鱼?·?02-20 14:55?

任正非怒斥女儿孟晚舟团队：还过什么年！
MBA领袖商学堂?·?02-08 22:019

廉政风云结局什么意思？张家辉怎么没有死？其实这部挺烧脑的！
懂你的资源君?·?02-14 14:57?
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 19:50

面试官：100元掉马桶里，你捡还是不捡？男子回答机智，被录取
升学故事?·?02-21 09:59?

在4个“时辰”降生的孩子，说明会很有福气，你家孩子中几个？
馨蔓育儿?·?02-18 15:40?
网易不易
北京商报?·?02-22 00:55?

国际贸易服务供应商宏桥高科赴美上市，正在研发区块链服务
资本邦?·?02-21 14:02?
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 19:50

想自己呆着的时候总被搭讪怎么办？这波防骚扰神器推荐给你！
冷笑话?·?02-21 20:19?
网易去年营收671亿元：游戏吸金超400亿 电商增速放缓
每日经济新闻?·?02-21 23:11?

35岁还不结婚的生活，是什么样的？
界面新闻?·?02-19 09:422515
偿付能力逼近红线 两寿险公司被迫精准展业
证券时报?·?02-22 00:46?
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 19:50
深圳市民办理法定代表人变更等业务跑多趟民政局无果，官方回应
南方都市报?·?02-21 18:124
联想扭亏为盈 难掩移动业务短板
北京商报?·?02-22 00:5537

移动业务5年终于扭亏为盈，联想手机还能讲什么新故事？
第一财经?·?02-21 12:2556

嗨起来比谁都能疯，正经起来自己都怕的星座
摘星工厂星吧?·?02-21 08:20?
2019年新品平板电脑仅598元

?广告?·?今天 19:50
美海军发布无人海上自主架构信息征询书
中国国防科技信息中心?·?02-22 00:14?

这三个星座放弃这段感情的原因是这样的
新鲜的星座知识?·?02-22 00:12?

暧昧成性！最容易和前任复合的4个星座，爱上他们要注意！
趣撩星座?·?02-21 14:36?

水瓶座的爱不是逼出来的，而是需要用爱来唤醒
新鲜的星座知识?·?02-22 00:55?
?广告?·?今天 19:50

变脸比变天还快，这些星座说翻脸就翻脸！
星座概念AFN?·?02-21 10:21?

一生气，狠话张口就来的4个星座
生肖星座运势命理玄学?·?02-21 00:39?

爱情的秘诀，学会了就会天长地久！
新鲜的星座知识?·?02-22 00:12?

当这三大星座想恋人的时候是这样做的！
新鲜的星座知识?·?02-22 01:11?
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 19:50

双鱼座：人家不是林妹妹啦
澎湃新闻?·?02-21 09:38?

看起来洒脱，可其实很容易悲伤的3个星座
小新星座说?·?02-21 19:55?

30年大厨公开炒肉秘方：不管什么肉，用“它”腌制，鲜嫩又多汁！
伊谷情感?·?02-21 09:5811

14岁上中科大，18岁去麻省理工，天才少年放弃留美回到祖国！
树梁晨曦教育?·?02-21 06:363
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 19:50
中船澄西获两型3艘自卸船订单
中国国防科技信息中心?·?02-22 00:14?

我火箭军迎来百辆电子干扰车：靠它可随时屏蔽美军无人机全部信号
突击?·?02-20 18:02?
俄新一代高精度地基无线电导航系统可提高舰船战斗力
中国国防科技信息中心?·?02-21 01:11?

蔚来柴油车加电遭质疑 李斌内部信回应称被黑
车威?·?02-20 08:31?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 19:50

财务老将出任总裁，佳源国际将迎“财技大展”时刻？
中新经纬?·?02-22 00:04?

这款SUV颜值高，搭载1.5GDIT+7DCT动力组合，换挡仅需0.2秒
大理京涛哈弗?·?02-21 11:05?

S-400导弹将登上隐形护卫舰！能同时兼容近中远三款防空导弹
兵鉴堂?·?02-21 16:57?

俄媒：俄研发“章鱼”高精度导航系统 精度优于美国GPS
参考消息?·?02-21 20:59?
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 19:50

滴滴确认将关停国内外卖业务，郑州城市外卖员抗议
聊点研习社?·?02-21 17:221

女孩第一次来月经，若没早于这个数，偷乐吧，可能会对发育有好处
艺杉育儿?·?02-20 19:21?

炒青菜千万别直接放盐了，少了这一步，不管怎么做青菜都会黑乎乎
感情经典语录?·?02-20 12:401

预调剂 | 2019年上海海事大学硕士研究生预调剂系统于3月1日开放
中国MBA教育网记者团?·?02-21 17:00?

支付宝收费后，你会更加欲罢不能
薛洪言?·?02-22 01:04164

炖猪蹄时，第一步切记不要焯水，多加这“1步”，软烂又入味！
沛沛情感?·?02-21 10:105

让蜡烛代替所有灯是什么歌 抖音有可能的夜晚完整歌词
斗玩网?·?02-13 15:08?

iOS12.1.4正式版使用体验：苹果建议所有用户进行更新！
叽歪数码?·?02-13 09:07?

收入降两成，联想移动业务却实现收购MOTO后首次盈利
新京报?·?02-21 22:15264

铭时代圈经济app骗局吗？进来看看就清楚
磐银点金?·?02-12 07:592

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:361

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08322

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59

FTC：那个有魅力的Facebook陌生人不爱你
MiHomes?·?02-15 10:36

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

百度的冰与火
阑夕?·?昨天 23:45

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

报告:到2021年，iPhone、iPad和Mac将运行相同的应用程序
MiHomes?·?02-21 22:16

行业：2019年游戏行业的6个趋势
酷玩儿?·?今天 09:03

智能媒体：未来变革的5个方向
智酷科技?·?今天 09:11

中国顺风车顽疾，能否从欧洲找到“解药”？| 欧洲观察
钛媒体APP?·?今天 08:54

三星正式发布Galaxy Fold 折叠屏手机是未来趋势吗？
唠氪?·?今天 11:44

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

暴风影音CEO：硬件的免费逻辑失效了吗？
智酷科技?·?今天 09:10

OPPO副总裁沈义人：会第一批推5G商用手机 巴展前临时拿掉可折叠方案
搜狐科技视界?·?今天 16:58

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

Google的Android Things将聚焦于智能扬声器和智能显示器
MiHomes?·?02-13 10:42

这样病态的网红，不要也罢！
经济日报?·?今天 15:04
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7964万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7964万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
MySQL性能优化?
2018-09-17 17:25公司/设计/客户端

三个方面
数据库主要可以从三个方面进行优化，一是数据库的配置；二是优化表结构；三是优化sql。
数据库的配置
首先是数据库基础配置，如服务名、端口号及连接方式的配置，这些对数据库性能没有影响；其次是数据库常用配置，如连接池，缓冲区等配置，这些配置可以提高数据库的性能；
MySQL的配置主要是在my开头的配置文件里，首先是连接池的配置，一是配置最大连接数 max_connections，增加该值可以增加mysqld 要求的文件描述符的数量。在并发量比较大的情况下，可以适量增大该值。但不能盲目提高设值，因为如果连接数越多，介于MySQL会为每个连接提供连接缓冲区，就会开销越多的内存，所以要适当调整该值。二是配置暂存的连接数 back_log，如果MySQL的连接数据达到max_connections时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源，如果短时间内有非常多的连接请求可以适当增大该值。三是配置连接关闭时间 interactive_timeout和wait_timeout，一个是交互式连接前等待活动的秒数，一个是非交互式连接前等待活动的秒数，这个主要取决于客户端，默认8小时，如果在这段时间内客户端没有操作，连接会被断开，此时会报错。
其次是缓冲区的配置，一是指定缓冲区key_buffer_size的大小，它决定索引处理的速度，尤其是索引读的速度。通过检查状态值Key_read_requests和Key_reads，可以知道key_buffer_size设置是否合理。比例key_reads / key_read_requests应该尽可能的低，至少是1:100，1:1000更好（上述状态值可以使用SHOW STATUS LIKE ‘key_read%’获得）。二是使用查询缓冲query_cache_size，MySQL将查询结果存放在缓冲区中，今后对于同样的SELECT语句（区分大小写），将直接从缓冲区中读取结果。通过检查状态值Qcache_*，可以知道query_cache_size设置是否合理（上述状态值可以使用SHOW STATUS LIKE ‘Qcache%’获得）。如果Qcache_lowmem_prunes的值非常大，则表明经常出现缓冲不够的情况，如果Qcache_hits的值也非常大，则表明查询缓冲使用非常频繁，此时需要增加缓冲大小；如果Qcache_hits的值不大，则表明你的查询重复率很低，这种情况下使用查询缓冲反而会影响效率，那么可以考虑不用查询缓冲。此外，在SELECT语句中加入SQL_NO_CACHE可以明确表示不使用查询缓冲。除此之外还有每个连接的缓冲区配置，如record_buffer_size、read_rnd_buffer_size、sort_buffer_size、join_buffer_size等的配置。
关于数据表结构的设计与优化，首先数据库是依赖于我们的应用程序，数据库表的设计与优化首先要确认我们设计的应用程序是什么类型的。事务处理型：这种类型的应用程序，你的最终用户更关注数据的增查改删（CRUD，Creating/Reading/Updating/Deleting）。这种类型也叫 “OLTP” 。分析型：这种类型的应用程序，你的最终用户更关注数据分析、报表、趋势预测等等功能。这一类的数据库的 “插入” 和 “更新” 操作相对来说是比较少的。它们主要的目的是更加快速地查询、分析数据。这种类型也叫 “OLAP” 。对于OLTP，数据表的优化首先保证数据表的数据的量级，如维持在百万级以下，超过一定量级进行归档，或者按年或者月进行备份归档，始终保证数据表的量级不要太高，从而达到快速查询更新的目的；其次是最小冗余原则，除了主键以外的字段不会出现在多张表之中，保证更新同一字段，只需更新一张表；最后是索引的使用，索引太多，会影响插入更新的速度，索引太少，会使某些查询很慢，索引的使用要遵循最小化原则，首先建立索引的字段不应该是大的char或者blob、clob这样的字段，其次是使用组合索引，覆盖经常查询的条件。对于OLAP，因为不需要频繁的更新或者实施的更新，主要关注查询和分析的效率，此时的最小化原则是用更少的表进行查询和分析，利用适当的冗余，减少不必要的连表查询，提高查询和分析的效率。
关于sql的优化，分为两部分，一是sql的分析，二是根据分析结果对sql进行优化。首先通过explain MySQL为例，如下是使用explain的结果：

1、id：这是SELECT的查询序列号
2、select_type：select_type就是select的类型，可以有以下几种：
SIMPLE：简单SELECT(不使用UNION或子查询等)
PRIMARY：最外面的SELECT
UNION：UNION中的第二个或后面的SELECT语句
DEPENDENT UNION：UNION中的第二个或后面的SELECT语句，取决于外面的查询
UNION RESULT：UNION的结果。
SUBQUERY：子查询中的第一个SELECT
DEPENDENT SUBQUERY：子查询中的第一个SELECT，取决于外面的查询
DERIVED：导出表的SELECT(FROM子句的子查询)
3、table：显示这一行的数据是关于哪张表的
4、partitions：这一列只有在EXPLAIN PARTITIONS 语法中才有值
5、type：这列最重要，显示了连接使用了哪种类别,有无使用索引，是使用Explain命令分析性能瓶颈的关键项之一。
结果值从好到坏依次是：
system > const > eq_ref > ref > fulltext > ref_or_null > index_merge > unique_subquery > index_subquery > range > index > ALL
一般来说，得保证查询至少达到range级别，最好能达到ref，否则就可能会出现性能问题。
6、possible_keys：列指出MySQL能使用哪个索引在该表中找到行
7、key：显示MySQL实际决定使用的键（索引）。如果没有选择索引，键是NULL
8、key_len：显示MySQL决定使用的键长度。如果键是NULL，则长度为NULL。使用的索引的长度。在不损失精确性的情况下，长度越短越好
9、ref：显示使用哪个列或常数与key一起从表中选择行。
10、rows：显示MySQL认为它执行查询时必须检查的行数。
11、filtered：指返回结果的行占需要读到的行(rows列的值)的百分比。
12、Extra：包含MySQL解决查询的详细信息，有10多种，常用的如下：
distinct：在select部分使用了distinc关键字
no tables used：不带from字句的查询或者From dual查询。
使用not in()形式子查询或not exists运算符的连接查询，这种叫做反连接。即，一般连接查询是先查询内表，再查询外表，反连接就是先查询外表，再查询内表。
using filesort：排序时无法使用到索引时，就会出现这个。常见于order by和group by语句中。
using index：查询时不需要回表查询，直接通过索引就可以获取查询的数据。
using_union：表示使用or连接各个使用索引的条件时，该信息表示从处理结果获取并集
using intersect：表示使用and的各个索引的条件时，该信息表示是从处理结果获取交集
using sort_union和using sort_intersection：与前面两个对应的类似，只是他们是出现在用and和or查询信息量大时，先查询主键，然后进行排序合并后，才能读取记录并返回。
using where：表示存储引擎返回的记录并不是所有的都满足查询条件，需要在server层进行过滤。查询条件中分为限制条件和检查条件，5.6之前，存储引擎只能根据限制条件扫描数据并返回，然后server层根据检查条件进行过滤再返回真正符合查询的数据。5.6.x之后支持ICP特性，可以把检查条件也下推到存储引擎层，不符合检查条件和限制条件的数据，直接不读取，这样就大大减少了存储引擎扫描的记录数量。extra列显示using index condition
using temporary：表示使用了临时表存储中间结果。临时表可以是内存临时表和磁盘临时表，执行计划中看不出来，需要查看status变量，used_tmp_table，used_tmp_disk_table才能看出来。
firstmatch(tb_name)：5.6.x开始引入的优化子查询的新特性之一，常见于where字句含有in()类型的子查询。如果内表的数据量比较大，就可能出现这个
loosescan(m..n)：5.6.x之后引入的优化子查询的新特性之一，在in()类型的子查询中，子查询返回的可能有重复记录时，就可能出现这个
filtered：使用explain extended时会出现这个列，5.7之后的版本默认就有这个字段，不需要使用explain extended了。这个字段表示存储引擎返回的数据在server层过滤后，剩下多少满足查询的记录数量的比例，注意是百分比，不是具体记录数。
根据分析的结果，我们可以看到扫描的总数据量、查询结果占比、是否使用索引等，优化的方向，是减少扫描的数据量，增大查询结果占比，尽量使用索引。因此，查询应遵循最简单原则，首先是减少联表查询、子查询，减少排序、统计、分页的查询的使用，简单查询更易优化，效率更高。大部分应用，仍然需要分页、排序和统计的查询，首先是分页查询的优化，当对较大数据量进行分页时，数据库自带的分页功能效率并不是太高，如MySQL的limit和oracle的rownum，这时候通过连续递增的一个字段（加索引）实现分页功能，如利用自增主键或者时间戳，利用上次查询的值进行查询，避免数据库通过计数分页；其次是排序的优化，除了使用索引，减少排序的字段，尽量和分页同时使用，避免对全量数据进行排序；最后是统计数据，对少量数据统计（个人用户）并不会有什么影响，但制作报表（公司、企业数据统计），则会有一定的压力，除了通过技术手段优化，也要将这类统计放到业务抵峰期进行统计，减少系统压力，因为这类统计的时效性不是很高，可以通过从库进行统计，减少主库压力。返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (405)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:1

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:1

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408
2019年新品平板电脑仅598元

?广告?·?今天 20:1

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 20:1

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?
?广告?·?今天 20:1

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

华为Mate20：再见了！
科技小李?·?今天 00:10173

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 20:1

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11179

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24172

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 20:1

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:1

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:1

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08326

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03143

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

三星S10：回来了！
火科技?·?今天 16:30154

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26631

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:1
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

传承经典&更强性能，韩国老牌发烧厂商COWON正式推出PLENUE D2
永远的永?·?昨天 22:08
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

百度的冰与火
阑夕?·?昨天 23:45

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7964万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7964万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
基于工作流的平台管理系统设计?
2018-09-12 17:25设计/Snap/开发

对于互联网金融平台来说,重要的业务尤其是涉及资金业务相关操作时都有必要有相关的审批流程.同时在流程的流转过程中需要和各个业务系统进行交互,完成真正的业务处理, 并记录这个过程中所有人的操作以及每一步操作时所涉及数据快照,以便于内外部审计和问题的追溯.
◆?下面为两个典型的业务流程?◆
(注: 为了说明方便, 已经简化和修改相关步骤, 和点融实际操作不一致)

一.?借款人银行卡信息修改
该流程发起原因主要是由于借款人银行卡变更原因需要修改. 流程关键步骤为:
? 用户联系客户服务人员,提交申请, 包括借款信息, 手持身份证照片, 银行卡信息等
? 申请提交系统后, 由风控进行审核
? 运营部门进行修改操
二. 提前还款流程
发起流程的主要原因是用户希望按照合同进行提前还款. 流程关键步骤为:
? 借款人联系客服人员, 提交申请
? 运营生成提前还款说明书, 其包括详细金额数据
? 借款人确认, 通过客服服务人员上传签字照片
? 运营代扣还款金额, 结清借款
? 生成还款结清证明
在平台的实际运营中, 有各种各样的业务需要处理, 包括借款人, 出借人, 资金等等, 同时还涉及到各个不同的业务部门, 而且流程的流转操作人员和部门也随着公司业务的发展而不同的调整. 设计一个基础的流程框架和实现基础代码, 形成简洁的开发模式是该系统的关键. 因此整个系统的设计涉及到以下主要几个方面:
? 选择合适的工作流引擎
对于一个类似涉及到审批以及执行具体业务的系统, 基于简单的状态控制的设计, 或者自行开发类工作流引擎轮子的做法都是不合适. 所以一个开源并且被广泛使用的工作流引擎是一个正确而且必须的选择. Activiti 工作流引擎由于其轻量级, 易用性等优点目前在业界被广泛使用. 其工作流的状态机和外部系统的连接只需要通过一个ID进行关联即可, 即activiti的business key. (如下图)

?设计通用的底层数据来支持不同的业务
由于这样一个运营管理系统涉及到各种不同的业务数据. 如借款人信息相关涉及借款ID, 银行卡信息等; 如出借人信息则涉及用户ID, 电话号码等; 而对于资金相关如提前还款则涉及到提前还款日期, 还款金额等. 所以一套支撑不同具体业务的流程数据表结构也是非常重要.
? 基础框架代码的设计
一个好的设计不是一步到位的设计, 而是一个循序渐进的过程以及不断重构的过程. 但是非常重要的一点就是在一开始能够根据当前的需求以及所能预见的需求进行设计, 并且在这个基础框架代码上开发要更加便利和简洁.
◆?以下对第二、三点进行展开?◆

数据库设计
如上所说, 这样的一个数据设计必须能够满足:
1. 能够满足不同的业务域的需求, 如出借, 借款, 资金相关的具体业务数据
2. 能够记录每一步的操作审批或业务执行结果, 同时记录相关的数据快照
   所以, 基于具体的业务进行数据表的设计是不合适的, 且无法扩展. 常见的设计为基于Key-Value的设计, 而key则是各个不同业务系统涉及到的metadata. 如USER_ID(用户ID), LOAN_ID(借款ID)等等. 设计概述如下:

一个Request代表某一个人发起的请求, Snapshot代表这个流程的每一步操作. Property则分别为Request的Snapshot的具体的数据, 当其REQUEST_ID非空SNAPSHOT_ID为空时表示其为REQUEST的属性(SNAPSHOT同理), 即用户发起请求所带入的数据. 如: 用户信息修改: PROPERTY则包括NAME(KEY)为USER_ID(用户唯一ID), ATTACHMENT(用户手持身份证照片), EMAIL(修改项)等相应的值. 而对于SNAPSHOT, 则记录对应审核以及操作的信息, 其对应的PROPERTY则保存了对某个数据修改前后的值.
基础框架代码设计
初始的场景和需求包括:
1. 一些通用的activiti流程, 如一步操作即创建后只需要一步完成操作, 两步流程 – 创建后一步审核一步操作等, 不同的业务会使用相同的流程.
2. 在activiti流程相同的情况下, 不同的业务的步骤其处理人/组则不同
3. 不同业务流程的实际代码开发应该简洁, 和工作流引擎解耦, 即实际的开 发人员 在不了解工作流引擎具体工作原理的情况下可以进行迅速的开发, 并 只需要关注具体 的业务需求
   为了解决#1的问题, 则需要定义出流程--步骤—业务(请求类型)—处理人/组 的配置 关系, 并在流程流转时自动设置, 而不是在流程描述文件 (bpmn)里 指定
   为了解决 #2 的问题, 则需要用服务进行封装, 抽象出一些接口以及基类的实 现, 并 应用一些常见的设计模式(工厂模式)和java的特性(反射).
   下图为基本的架构设计

基于这样的框架完成基础代码后, 最终对于一个实现具体业务的开发人员来说, 其实 现一个业务流程代码主要包括:
1. 实现一个创建Request的页面, 用于录入业务数据
2. 实现一个Request详细页面, 用于展示详情, 包括操作历史, 和业务操作按钮
3. 实现该业务涉及的具体步骤的操作processor类(如审批或和其他系统对接, 完成实际的业务),
4. 将流程涉及的processor和对应的业务类型, 流程名, 流程步骤进行注册绑定
   演进过程
   正如上面曾说到, 对于一个系统设计, 不可能一步到位, 在最初时要抓住最需要解决的问题, 比如在这个系统开始阶段, 最核心的设计包括:
   ? 数据库设计 和RequestService对底层数据操作的封装
   ? WorkflowService对工作流引擎的封装
   ?可配置化的根据业务类型(Request Type) 和配置(process_cfg)在运行时动态设置流程相应的处理人/组
   持续的重构包括:
   ?将各种处理类(业务处理类, 流程处理人/组分配处理类, 通知处理类) 通过RegisterService的统一注册管理, 并且支持应用对于特定的流程实现特定的处理类来替代默认的处理类
   ?RequestQuery支持统一的查询入口对业务流程数据进行查询
   ? 根据业务需要提供ASync的processor处理基类, 因为实际应用中发现, 一些业务的处理(如批量)需要一段时间的执行才能完成, 而异步处理基类则完成基础实现, 并由相应子类去实现虚函数即可.
   公共化工作流模块:
   ? 最近, 另外一个项目其应用到的场景和这个系统有类似之处, 其独立于该业务管理平台. 在这种情况下, 将该工作流相关的模块进行公共化, 以JAR包的形式提供, 使得另外一个系统的开发能够短期内达到同样的效果
   借鉴Activiti的源代码
   在设计和实现该系统时会有
   这样或者那样的疑惑或者斗争,
   哪一种实现更好?
   别人的系统是如何实现的?
   这里举几个例子
   Property表里是否需要需要用不同的字段(LONG_VALUE, TEXT_VALUE, DOUBLE_VALUE等)存不同类型的值;还是直接都存成字符串,?在代码中再根据需要转成Long, Double等?当然两种实现都是可行的, 并且各有优缺点,?并且个人觉得存在不同的字段上优点更大一些(主要体现在查询效率),?但是如何更加的让自己信服? 在看activiti的文档时发现外部的业务数据以Map的方式存在activiti的数据库中, 那么activiti的设计者一样会碰到同样的问题. 通过查看源代码以及其数据库设计,?发现其将数据存入不同的字段.?但是在我的设计中,?我并没有完全照搬Activiti的处理方式, 比如:?我没有为布尔类型加单独的字段,?而是以0或者1的方式存入LONG_VALUE里。
   Activiti中提供便捷的查询类, 如: ProcessInstanceQuery, TaskQuery. 其同时支持按照Process和Task相应的属性数据进行查询, 和Request/Snapshot以及property有很大的相似之处, 借鉴并根据实际情况实现自己的RequestQuery类, 支持各类复杂查询, 如: 按照指定的property的name和value查询, 支持or的查询等。
   Activiti的数据库版本的自动升级. 当我们升级activiti的版本时, 其实我们只需要更新JAR的版本号, 而不用关心起底层数据库是否需要升级, activiti在其表中会记录数据库scheme的版本号, 启动时会自动判断并根据需要自动更新数据库. 这也是非常值得借鉴的地方, 尤其是当这个模块被多个系统所使用时。
   返回搜狐，查看更多
   声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
   阅读 (425)
   不感兴趣?投诉
   广告
   我来说两句
   0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

三星S10：回来了！
火科技?·?今天 16:30154

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:6

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150
2019年新品平板电脑仅598元

?广告?·?今天 20:6

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:6

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 20:6

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?
?广告?·?今天 20:6

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11179

华为Mate20：再见了！
科技小李?·?今天 00:10173

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24172

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 20:6

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 20:6

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:6

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08327

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:6

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03143

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:6

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26632

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39?

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14?

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08?

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00145

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:361

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12
以蒸汽为动力的航天器或许可以实现“永久”探测
中国国防科技信息中心?·?今天 17:28

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

百度的冰与火
阑夕?·?昨天 23:45

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

2019MWC五大看点：“数字星球”时代到来，5G只是开始
第一财经?·?今天 16:45

暴风影音CEO：硬件的免费逻辑失效了吗？
智酷科技?·?今天 09:10

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

传承经典&更强性能，韩国老牌发烧厂商COWON正式推出PLENUE D2
永远的永?·?昨天 22:08
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7965万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7965万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
基于工作流的平台管理系统设计?
2018-09-12 17:25设计/Snap/开发

对于互联网金融平台来说,重要的业务尤其是涉及资金业务相关操作时都有必要有相关的审批流程.同时在流程的流转过程中需要和各个业务系统进行交互,完成真正的业务处理, 并记录这个过程中所有人的操作以及每一步操作时所涉及数据快照,以便于内外部审计和问题的追溯.
◆?下面为两个典型的业务流程?◆
(注: 为了说明方便, 已经简化和修改相关步骤, 和点融实际操作不一致)

一.?借款人银行卡信息修改
该流程发起原因主要是由于借款人银行卡变更原因需要修改. 流程关键步骤为:
? 用户联系客户服务人员,提交申请, 包括借款信息, 手持身份证照片, 银行卡信息等
? 申请提交系统后, 由风控进行审核
? 运营部门进行修改操
二. 提前还款流程
发起流程的主要原因是用户希望按照合同进行提前还款. 流程关键步骤为:
? 借款人联系客服人员, 提交申请
? 运营生成提前还款说明书, 其包括详细金额数据
? 借款人确认, 通过客服服务人员上传签字照片
? 运营代扣还款金额, 结清借款
? 生成还款结清证明
在平台的实际运营中, 有各种各样的业务需要处理, 包括借款人, 出借人, 资金等等, 同时还涉及到各个不同的业务部门, 而且流程的流转操作人员和部门也随着公司业务的发展而不同的调整. 设计一个基础的流程框架和实现基础代码, 形成简洁的开发模式是该系统的关键. 因此整个系统的设计涉及到以下主要几个方面:
? 选择合适的工作流引擎
对于一个类似涉及到审批以及执行具体业务的系统, 基于简单的状态控制的设计, 或者自行开发类工作流引擎轮子的做法都是不合适. 所以一个开源并且被广泛使用的工作流引擎是一个正确而且必须的选择. Activiti 工作流引擎由于其轻量级, 易用性等优点目前在业界被广泛使用. 其工作流的状态机和外部系统的连接只需要通过一个ID进行关联即可, 即activiti的business key. (如下图)

?设计通用的底层数据来支持不同的业务
由于这样一个运营管理系统涉及到各种不同的业务数据. 如借款人信息相关涉及借款ID, 银行卡信息等; 如出借人信息则涉及用户ID, 电话号码等; 而对于资金相关如提前还款则涉及到提前还款日期, 还款金额等. 所以一套支撑不同具体业务的流程数据表结构也是非常重要.
? 基础框架代码的设计
一个好的设计不是一步到位的设计, 而是一个循序渐进的过程以及不断重构的过程. 但是非常重要的一点就是在一开始能够根据当前的需求以及所能预见的需求进行设计, 并且在这个基础框架代码上开发要更加便利和简洁.
◆?以下对第二、三点进行展开?◆

数据库设计
如上所说, 这样的一个数据设计必须能够满足:
1. 能够满足不同的业务域的需求, 如出借, 借款, 资金相关的具体业务数据
2. 能够记录每一步的操作审批或业务执行结果, 同时记录相关的数据快照
   所以, 基于具体的业务进行数据表的设计是不合适的, 且无法扩展. 常见的设计为基于Key-Value的设计, 而key则是各个不同业务系统涉及到的metadata. 如USER_ID(用户ID), LOAN_ID(借款ID)等等. 设计概述如下:

一个Request代表某一个人发起的请求, Snapshot代表这个流程的每一步操作. Property则分别为Request的Snapshot的具体的数据, 当其REQUEST_ID非空SNAPSHOT_ID为空时表示其为REQUEST的属性(SNAPSHOT同理), 即用户发起请求所带入的数据. 如: 用户信息修改: PROPERTY则包括NAME(KEY)为USER_ID(用户唯一ID), ATTACHMENT(用户手持身份证照片), EMAIL(修改项)等相应的值. 而对于SNAPSHOT, 则记录对应审核以及操作的信息, 其对应的PROPERTY则保存了对某个数据修改前后的值.
基础框架代码设计
初始的场景和需求包括:
1. 一些通用的activiti流程, 如一步操作即创建后只需要一步完成操作, 两步流程 – 创建后一步审核一步操作等, 不同的业务会使用相同的流程.
2. 在activiti流程相同的情况下, 不同的业务的步骤其处理人/组则不同
3. 不同业务流程的实际代码开发应该简洁, 和工作流引擎解耦, 即实际的开 发人员 在不了解工作流引擎具体工作原理的情况下可以进行迅速的开发, 并 只需要关注具体 的业务需求
   为了解决#1的问题, 则需要定义出流程--步骤—业务(请求类型)—处理人/组 的配置 关系, 并在流程流转时自动设置, 而不是在流程描述文件 (bpmn)里 指定
   为了解决 #2 的问题, 则需要用服务进行封装, 抽象出一些接口以及基类的实 现, 并 应用一些常见的设计模式(工厂模式)和java的特性(反射).
   下图为基本的架构设计

基于这样的框架完成基础代码后, 最终对于一个实现具体业务的开发人员来说, 其实 现一个业务流程代码主要包括:
1. 实现一个创建Request的页面, 用于录入业务数据
2. 实现一个Request详细页面, 用于展示详情, 包括操作历史, 和业务操作按钮
3. 实现该业务涉及的具体步骤的操作processor类(如审批或和其他系统对接, 完成实际的业务),
4. 将流程涉及的processor和对应的业务类型, 流程名, 流程步骤进行注册绑定
   演进过程
   正如上面曾说到, 对于一个系统设计, 不可能一步到位, 在最初时要抓住最需要解决的问题, 比如在这个系统开始阶段, 最核心的设计包括:
   ? 数据库设计 和RequestService对底层数据操作的封装
   ? WorkflowService对工作流引擎的封装
   ?可配置化的根据业务类型(Request Type) 和配置(process_cfg)在运行时动态设置流程相应的处理人/组
   持续的重构包括:
   ?将各种处理类(业务处理类, 流程处理人/组分配处理类, 通知处理类) 通过RegisterService的统一注册管理, 并且支持应用对于特定的流程实现特定的处理类来替代默认的处理类
   ?RequestQuery支持统一的查询入口对业务流程数据进行查询
   ? 根据业务需要提供ASync的processor处理基类, 因为实际应用中发现, 一些业务的处理(如批量)需要一段时间的执行才能完成, 而异步处理基类则完成基础实现, 并由相应子类去实现虚函数即可.
   公共化工作流模块:
   ? 最近, 另外一个项目其应用到的场景和这个系统有类似之处, 其独立于该业务管理平台. 在这种情况下, 将该工作流相关的模块进行公共化, 以JAR包的形式提供, 使得另外一个系统的开发能够短期内达到同样的效果
   借鉴Activiti的源代码
   在设计和实现该系统时会有
   这样或者那样的疑惑或者斗争,
   哪一种实现更好?
   别人的系统是如何实现的?
   这里举几个例子
   Property表里是否需要需要用不同的字段(LONG_VALUE, TEXT_VALUE, DOUBLE_VALUE等)存不同类型的值;还是直接都存成字符串,?在代码中再根据需要转成Long, Double等?当然两种实现都是可行的, 并且各有优缺点,?并且个人觉得存在不同的字段上优点更大一些(主要体现在查询效率),?但是如何更加的让自己信服? 在看activiti的文档时发现外部的业务数据以Map的方式存在activiti的数据库中, 那么activiti的设计者一样会碰到同样的问题. 通过查看源代码以及其数据库设计,?发现其将数据存入不同的字段.?但是在我的设计中,?我并没有完全照搬Activiti的处理方式, 比如:?我没有为布尔类型加单独的字段,?而是以0或者1的方式存入LONG_VALUE里。
   Activiti中提供便捷的查询类, 如: ProcessInstanceQuery, TaskQuery. 其同时支持按照Process和Task相应的属性数据进行查询, 和Request/Snapshot以及property有很大的相似之处, 借鉴并根据实际情况实现自己的RequestQuery类, 支持各类复杂查询, 如: 按照指定的property的name和value查询, 支持or的查询等。
   Activiti的数据库版本的自动升级. 当我们升级activiti的版本时, 其实我们只需要更新JAR的版本号, 而不用关心起底层数据库是否需要升级, activiti在其表中会记录数据库scheme的版本号, 启动时会自动判断并根据需要自动更新数据库. 这也是非常值得借鉴的地方, 尤其是当这个模块被多个系统所使用时。
   返回搜狐，查看更多
   声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
   阅读 (425)
   不感兴趣?投诉
   广告
   我来说两句
   0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

三星S10：回来了！
火科技?·?今天 16:30154

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:6

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150
2019年新品平板电脑仅598元

?广告?·?今天 20:6

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?
美女总裁的窝囊废未婚夫，竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:6

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 20:6

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?
?广告?·?今天 20:6

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11179

华为Mate20：再见了！
科技小李?·?今天 00:10173

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24172

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 20:6

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?
【每天1杯，不到1元】上班族、熬夜人群，每天1杯提神
?
?
?
?
?广告?·?今天 20:6

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:6

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08327

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:6

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03143

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:6

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26632

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39?

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14?

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08?

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00145

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:361

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12
以蒸汽为动力的航天器或许可以实现“永久”探测
中国国防科技信息中心?·?今天 17:28

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

百度的冰与火
阑夕?·?昨天 23:45

胡泳：互联网时代的5个悖论
智酷科技?·?今天 09:11

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

徐小平：五年来我的投资哲学
智酷科技?·?今天 09:11

紫光展锐将发布其首款5G芯片
观察者网?·?昨天 21:23

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

2019MWC五大看点：“数字星球”时代到来，5G只是开始
第一财经?·?今天 16:45

暴风影音CEO：硬件的免费逻辑失效了吗？
智酷科技?·?今天 09:10

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

传承经典&更强性能，韩国老牌发烧厂商COWON正式推出PLENUE D2
永远的永?·?昨天 22:08
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7965万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7965万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
自建规则引擎在促销系统中的应用?
2018-07-19 17:19操作系统

需求或目标
目标：提供一组数据，以及基于这组数据编写的任意规则条件，快速得出结果。

主要包含几个部分：
1 任意数据模型；
2 基于数据模型构造的任意规则；
3 根据传入数据运行规则、得到正确的行为或结果；
数据和规则的抽象及举例
数据的抽象
数据可以抽象为两类：一类是基础数据，一类是具有时间特性的流式数据，第一类数据可以直接应用于表达式中，而第二类数据需要在其基础之上做reduce规约操作得到规约结果数据。
下面以DR lender用户为例详细说明这两类数据：
类别1：基础数据
针对lender用户来说，基础数据包含id、姓名、手机号、等级、注册渠道、注册时间、是否绑卡、是否实名、绑卡时间、实名时间、风险偏好、投资金额、投资团等单值数据。
类别2：行为数据
针对lender用户来说，行为数据包含用户的投资、退团、注册、实名、邀请的人的投资记录等。这类数据的特征是具备时间特性，可以在其之上：(1)应用时间窗口(最近x天/y次，当前自然日/周/月等)限制; (2)进一步用规则条件筛选数据; (3)最后做count/sum/average等reduce规约型计算得出“规约结果”。
以用户的投资行为记录为例，规约结果如：
A. 最近10天的平均投资额；
B. 投资大于1w的总次数；
C. 最近30天投资大于2w的总次数；
D. 最近10次投资大于2w的总次数；
E. 当前自然月的首投大于1w；
F. 首次投资发生在注册后20天内；
以用户邀请的人的投资记录为例，规约结果为：
A. 所有单笔大于5w、且在[A,B,C]团范围内的邀请投资的总和；
B. 所有邀请的注册时间满20天的人的投资的总和；
C. 从指定活动注册进来的、完成首投大于1w的人数；
规则的抽象
前面已经介绍了“基础数据”和“行为数据的规约结果”，基于这两类数据可以构造表达式，诸如%、+、-、*、/、甚至java库中数学运算Math，commons包的DateUtils等任意第三方库都可用于构造表达式，比较操作符诸如>、>=、<、<=、contains、not contains、start with、end with、between等。左右表达式结合比较操作符构成一个原子的规则条件：

在“基础数据”上构建的原子规则条件如：
A. ${用户等级}等于x级；
B. ${注册时间}在<begin, end>之间；
C. ${是否完成实名绑卡}等于true；
D. ${实名绑卡时间}发生在${注册时间}后30天内；
E. ${投资额}大于x元；
F. ${投资团范围}在(a,b,c,d)内；
G. ${用户手机号}以181开头；
H.“当前投资金额”大于“风险评级”的10倍；
在“行为数据的规约结果”上构建的原子规则条件如：
A. ${最近10天平均投资额}大于1w。
B. ${投资大于1w的总次数}大于5次；
C. ${最近30天投资大于2w的总次数}大于3次；
D. ${最近10次投资大于2w的总次数}大于3次；
E. ${当前自然月的首投大于1w的次数}等于1；
F. ${首次投资发生在注册后20天内的次数}等于1；
需要注意的是单条行为数据本身也是一组简单数据，同样可以在其基础上按照基础数据的方式构建规则。
比如想要判断用户是否满足“已实名用户近20天单次投资超过5w的总次数”大于3，此规则可以抽象为先在投资行为记录上应用时间限制（最近20天）筛选、进一步做基础数据筛选（用户已经实名，且投资额大于5w），最后做count计算得出表达式所需的“行为数据规约结果”。
< 规则组成 >
一条完整的规则由多个“原子规则条件”的AND/OR组成，规则通过后执行action集合。
< 优先级规则 >
一条简单的规则由多个原子规则条件组成，规则通过后执行对应的action集合。但有时候需要多条规则，通过其中一条就跳出去执行action集合，且先跑哪个规则要有优先级顺序。以给近期活跃用户发体验金奖励为例，以下几种情况都可以定义为活跃用户：
规则1：一次性投资超过5w、且已经完成风险测评；
规则2：近7天投资次数超过5次；
规则3：近5天跟帖次数超过10次且完成过至少一次投资；
以上几种情况完成任意一种都会发放体验金，但是满足其中一种，其他规则就不能继续执行，比如用户可能规则1和规则2同时满足，但是要求规则1通过后，其他规则就不能再被触发，这就要求规则之间支持优先级、且互斥存在。
< 延迟规则 >
存在这样的场景，一个规则由用户某个行为触发，但需要延迟一定的时间后再执行。比如要判断用户满足投资后20天内未发生过任何退团，则给其发放体验金奖励，或者判断用户注册后30天内没有任何投资，则给其发放代金券鼓励其投资。
这就要求支持延迟执行的规则，用户注册后触发延迟规则，在30天后运行此延迟规则判断用户是否没有任何投资行为。
自建规则引擎如何满足需求
需要什么？
针对规则引擎，需要满足如下几个需求：
1 易于理解、易于编写、且表达能力强的规则描述语言；
2 支持动态构造规则、并立即热部署生效；
3 支持从数据库等外部存储读取规则；
4 支持基础数据、流式数据上构建规则；
5 数据的计算和加载延迟到规则运行过程中，避免不必要的计算，且支持外部服务调用；
技术选型
实现规则引擎的方式有很多，可以采用原生的脚本语言如Groovy、Python、jruby、java等，好处是表达能力强、可动态修改并生效，但很容易让开发人员陷入规则中写业务的困境，后期的维护困难。
另外其毕竟不是为规则引擎而生、要形成规则引擎框架需要大量的工作。而开源的java规则引擎包括Drools、Mandarax、JLisa、JEOPS 、Prova 、OpenRules 、Open Lexicon、SweetRules 、JRuleEngine 、Zilonis 、DTRules 、OpenL Tablets等几十种，它们的好处是为规则引擎而生，已经为此做了大量工作，缺点在于学习成本。
我们决定站在巨人的肩上，选择基于社区活跃、文档丰富、功能强大的Drools来构建规则引擎，其最近一次发布是2018/04/04的7.7.0版。Drools本身能很好地支持支持java表达式、外部依赖数据运行时加载、基于时间的流式数据计算、规则互斥、规则优先级等功能，同时还和动态脚本语言一样可以动态生成、并动态执行，基于Drools构建的规则引擎框架可以很好地满足3.1中提到的所有需求。
如何使用
步骤一：提供数据模型
以lender用户为例，首先定义其数据模型，如下表所示为部分数据模型定义：
（1）基础数据

（2）流式数据

步骤二：构造规则
然后就是基于数据模型构造规则，下面举几个规则的例子，其中规则1-4的数据主要是来自于前面提到的“基础数据”，规则5开始涉及到“流式数据的规约结果”，规则3和规则7演示了运行时加载外部数据：
规则1：手机号181开头的用户、投资金额大于1w且排除特定的投团范围

这里演示了从准备数据，构造规则，到运行规则的整个过程。规则部分由“原子规则条件”组成，然后是设置规则通过后要执行的Action集合，最后运行规则。需要注意的是数据需用${}标记，接下来演示更多规则，将只贴出来具体规则部分的代码。
规则2：投资额为偶数、且投资额大于年龄的30倍和用户等级的100倍中最小的那个值

比较的左右两边都可以支持任意${}数据、以及任意java表达式，包括java.lang包、java.util包等一切可以引入的jar包功能。
规则3：注册时间在指定范围内、已经完成实名、且在注册后的20天内完成绑卡

运行时一旦发现${}数据是传入的数据集合中不存在的，则会尝试加载以该数据变量命名的外部数据加载器计算并加载数据到规则内存中，这里registerTime、registerChannel等数据都是当前传入的数据中没有的，所以会调用对应的数据加载器加载数据到规则内存中，我们需要做的就是针对registerTime、registerChannel编写对应的数据加载器：

规则4：完成实名、或完成绑卡

注意，下面从规则5开始，会演示表达式中的数据来自“流式数据的规约结果”。
规则5：用户大于1w的投资的次数、大于3次

前面的规则都是基于基础数据的比较，而这里是针对流式数据的操作，正如前面介绍的，首先执行reduce操作，包括筛选用户投资记录数据流中投资额超过1w的记录，并执行count操作，然后与condition进行比较，判断次数是否大于三次。
需要注意的是，流式数据也是外部依赖数据，并不是在规则执行前加载到规则内存中的，而是需要运行时动态加载，所以我们需要针对“STREAM_INEST”编写对应的流式数据加载器，根据reduce操作传入的Duration限制(包括时间和长度的限制)返回数据流，流式数据加载器的例子参见规则7。
规则6：用户大于1w的投资的总额、大于5w

规则7：最近7天投资额大于1w的总次数、大于3次

可以对流式数据增加时间窗口限制，其他支持的时间窗口包括最近x秒/分钟/小时/月/年、当前自然周/月/年等。下面是用户投资流式数据加载器实现，所有类型时间限制都会转换成<beginDate、endDate、limit>，加载器根据这三个字段的值查询数据返回。

实现原理
规则引擎执行的入口即前面提到的DrRuleEngine.runRuleEngine(Map,List<DrRule>)，大致思路是将DrRule规则集合转换为Drools规则语言并执行，大致分为如下步骤：

如何将DrRule规则集合转换为Drools规则语言，通过Pattern、操作符、java表达式、from、accumulate、salience、activation-group等丰富的Drools功能支撑我们的规则是核心。另外规则的加载到转换为知识库KieBase的过程需要异步化，而不是每次运行规则都实时构建知识库，这样有助于提升性能，后面介绍的基于自建规则引擎构建的促销系统就是这样做的。下面是自建规则引擎运行时从DrRule规则集合动态生成的Drools规则语言片段：

基于自建规则引擎构建促销系统
如下图所示为DR促销系统规则引擎和发奖相关的架构图：

1.规则配置控台
从数据库读取支持的数据模型呈现给运营人员，运营人员基于数据模型，通过UI界面创建规则及对应的奖励，创建好的规则将存储到数据库中。
前面已经提到了lender用户的数据模型，展示到UI提供给运营人员的就是数据模型的中文描述，如用户${注册渠道}、${注册时间}、${投资额}、${投资团等}，操作符如大于、大于等于/小于/小于等于/包含于/闭区间/开区间等，运营人员只需在界面上选择对应的数据、操作符、以及创建对应的奖励，即可生成对应规则。

2.规则引擎
来自MQ的用户行为、来自定时Job的调用、或来自第三方系统的http调用都可以触发规则引擎实时加载并执行对应的规则。
3.延迟规则存储和加载模块
针对一些需要延迟触发规则二次执行的特殊场景，在触发行为发生后，将需要延迟调度的规则存储到库中，由延迟规则调度模块在正确的时间触发规则引擎执行。
4.发奖系统
发奖系统只业务落地的核心，当用户满足特定规则后，需要根据配置发放对应奖励，这里面包括优惠券、体验金、现金、DR币等的发放，甚至包含app/短信/微信等不同渠道的用户消息促达。
促销系统的核心不是规则引擎，而是数据、以及运营模式，规则引擎只是工具。如何构造并完善用户数据模型；如何让运营人员快速方便地构建，修改规则，并能够立刻生效；如何让开发人员快速响应新的业务需求开发新的条件和调整已有条件；才是更应该去思考的。
12返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (937)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

快速登录：????
登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?
美女总裁嫌弃吃软饭的未婚夫，却不知他竟是神秘雇佣兵部队的大佬！
?
?
?
?
?广告?·?今天 20:14

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:14

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
2019年新品平板电脑仅598元

?广告?·?今天 20:14

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?
冬虫夏草多少钱一克？藏民解答！价格更省40%
?
?
?
?
?广告?·?今天 20:14

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023
?广告?·?今天 20:14

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:085

这鞋太牛了，柔软不臭脚，秒杀抢购中
?广告?·?今天 20:14

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

华为Mate20：再见了！
科技小李?·?今天 00:10173

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11181

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:14

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24172

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:14

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

三星S10：回来了！
火科技?·?今天 16:30154

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:14

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08329

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03146

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26633

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

这样病态的网红，不要也罢！
经济日报?·?今天 15:04

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

百度的冰与火
阑夕?·?昨天 23:45

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7965万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7965万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
浅谈JVM原理?
2017-11-30 18:30程序设计/操作系统
概念
虚拟机：指以软件的方式模拟具有完整硬件系统功能、运行在一个完全隔离环境中的完整计算机系统,是物理机的软件实现。JVM分类：VMWare ，Visual Box，JVM（其中VMWare和Visual Box都是使用软件模拟物理CPU的指令集 ，而JVM使用软件模拟Java 字节码的指令集）
运行机制

图1 jvm运行机制
基本架构

图2 jvm基本架构
Java运行时编译源码(.java)成字节码，然后再由jre（java运行环境）运行。jre是由java虚拟机（jvm）实现。Jvm分析字节码，后解释并执行。JVM由三个主要的子系统构成：
1.类加载器子系统
2.运行时数据区（内存）
3.执行引擎
类加载器子系统

图3 java类生命周期
类装载包括了加载，连接（验证、准备、解析（可选）），初始化。其中类加载工作由ClassLoader及其子类负责。
加载：在硬盘上查找并通过IO读入字节码文件
连接：执行校验、准备、解析（可选）步骤
校验，校验字节码文件的正确性
准备，给类的静态变量分配内存，并赋予默认值
解析，将符号引用转为直接引用
初始化：对类的静态变量初始化为指定的值，执行静态代码块
类加载器体系结构：

图4 类加载器体系
1．启动类加载器：负责加载JRE的核心类库，如jre目标下的rt.jar,charsets.jar等.
2．扩展类加载器：负责加载JRE扩展目录ext中JAR类包
3．系统类加载器：负责加载ClassPath路径下的类包
4．用户自定义加载器：负责加载用户自定义路径下的类包
类加载机制：全盘负责委托机制。全盘负责，当一个ClassLoader加载一个类时，除非显示的使用另一个ClassLoader，该类所依赖和引用的类也由这个ClassLoader载入。委托机制：是指先委托父类加载器寻找目标类，只有在找不到的情况下采用自己的路径中查找并载入目标类
运行时数据区
PC寄存器：用来存储待执行指令的地址。分支，循环，跳转，异常处理，线程恢复等功能都需要依赖pc寄存器。若线程执行的时一个java方法，则pc寄存器中保存的是待执行指令的地址。若执行的是一个native方法，则pc寄存器中为空。线程独占。
Java栈（java虚拟机栈）：是java方法执行的内存模型，为虚拟机执行java方法，每个方法在执行的同时都会创建一个栈帧（用于存储局部变量表，操作数栈，动态链接，方法出口等信息）。
Jvm对该区域规范了两种异常：1，线程请求的栈深度大于虚拟机栈所允许的深度，将抛出StackOverFlowError异常。2，若虚拟机栈可动态扩展，当无法申请到足够内存空间时将抛出OutOfMemoryError异常。通过jvm参数 –Xss指定栈空间，空间大小决定了函数调用的深度。线程独占。
本地方法栈：为虚拟机执行native方法，其他规范与java栈类似。不同类型的虚拟机对该区域可自由实现。线程独占。
java堆：虚拟机启动时创建，用于存放对象实例。几乎所有的对象在堆上分配内存，当对象无法再该空间申请到内存时将抛出OutOfMemoryError异常。同时也是垃圾收集器管理的主要区域。可通过-Xmx –Xms 参数来分别指定最大堆和最小堆。线程共享。
方法区（非堆）：存储类信息、常量、静态变量、即时编译器编译后的代码等数据。运行时常量池是其一部分，用于存放编译器生成的各种字面量和符号引用。Jvm规定当方法区无法满足内存分配需求时，将抛出OutOfMemeoryError异常。可通过-XX:PermSize -XX:MaxPermSize 参数分别设置永久区的初始空间和最大空间。线程共享。
直接内存：并不是虚拟机运行时数据区的一部分，也不是JVM规范中定义的内存区域。但也在频繁使用，也会发生OutOfMemory异常。
执行引擎
执行引擎读取运行时数据区的字节码并逐个执行
(1) 解释器：解释器更快地解释字节码,但执行缓慢,解释一句执行一句。
(2) JIT编译器：JIT编译器消除了解释器的缺点。执行引擎通过解释器转换字节码，当它发现重复的代码时，将使用JIT编译器，它编译整个字节码并将其更改为本地代码。这个本地代码将直接用于重复的方法调用，这提高了系统的性能。
JIT的构成组件为：
中间代码生成器（Intermediate Code Generator）：生成中间代码 。
代码优化器（Code Optimizer）：负责优化上面生成的中间代码 。
目标代码生成器（Target Code Generator）：负责生成机器代码或本地代码 。
分析器（Profiler）：一个特殊组件，负责查找热点（被多次调用的方法）
(3) 垃圾收集器：收集和删除未引用的对象。可以通过调用“System.gc（）”触发垃圾收集，但不能保证执行。JVM的垃圾回收对象是已创建的对象。
Java本机接口（JNI）：JNI将与本机方法库进行交互，并提供执行引擎所需的本机库。
本地方法库：执行引擎所需的本机库的集合。
垃圾收集
1，如何识别垃圾，判定对象是否可被回收
引用计数：给每个对象添加一个计数器，当有地方引用该对象时计数器加1，当引用失效时计数器减1。用对象计数器是否为0来判断对象是否可被回收。缺点：无法解决循环引用的问题
可达性分析：通过“GC ROOTs”的对象作为搜索起始点，通过引用向下搜索，所走过的路径称为引用链。通过对象是否有到达引用链的路径来判断对象是否可被回收（可作为GC ROOTs的对象：虚拟机栈中引用的对象，方法区中类静态属性引用的对象，方法区中常量引用的对象，本地方法栈中JNI引用的对象）
2，使用GC算法回收释放垃圾对象所占用的内存空间
区分内存溢出和内存泄露:内存溢出是指程序在申请内存时,没有足够的内存空间供其使用.内存泄露是指在程序在申请内存使用完后,无法释放回收已申请的内存空间
GC算法
按照回收策略划分：标记清除算法，标记整理算法，复制算法
1.标记-清除算法：分为两阶段“标记”和“清除”。首先标记出哪些对象可被回收，在标记完成之后统一回收所有被标记的对象所占用的内存空间。不足之处：1.无法处理循环引用的问题2.效率不高3.产生大量内存碎片（ps：空间碎片太多可能会导致以后在分配大对象的时候而无法申请到足够的连续内存空间，导致提前触发新一轮gc）

图 5 标记-清除算法
2.标记-整理算法：分为两阶段“标记”和“整理”。首先标记出哪些对象可被回收，在标记完成后，将对象向一端移动，然后直接清理掉边界以外的内存。

图 6 标记-整理算法
3.复制算法：把内存空间划为两个相等的区域，每次只使用其中一个区域。gc时遍历当前使用区域，把正在使用中的对象复制到另外一个区域中。算法每次只处理正在使用中的对象，因此复制成本比较小，同时复制过去以后还能进行相应的内存整理，不会出现“碎片”问题。不足之处：1.内存利用率问题2.在对象存活率较高时，其效率会变低。

图 7 复制算法
按照分区对待的方式分：增量收集算法，分代收集算法
1.增量收集:实时垃圾回收算法，即：在应用进行的同时进行垃圾回收。
2.分代收集:基于对对象生命周期对象分为年青代、年老代、持久代，对不同生命周期的对象使用不同的算法进行回收。
按系统线程分：串行收集算法，并行收集算法，并发收集算法
1.串行收集:使用单线程处理垃圾回收工作，实现容易，效率较高。不足之处：1.无法发挥多处理器的优势 2.需要暂停用户线程
2.并行收集:使用多线程处理垃圾回收工作，速度快，效率高。理论上CPU数目越多，越能体现出并行收集器的优势。不足之处：需要暂停用户线程
3.并发收集:垃圾线程与用户线程同时工作。系统在垃圾回收时不需要暂停用户线程
GC收集器
垃圾收集算法是内存回收的理论基础，而垃圾收集器就是内存回收的具体实现。
1.Serial/Serial Old收集器是最基本最古老的收集器，它是一个单线程收集器，工作时必须暂停所有用户线程。该收集器采用复制算法主要针对新生代的收集。Serial Old收集器采用标记-整理算法主要针对老年代的收集器。实现简单高效，但会停顿。
2.ParNew收集器是Serial收集器的多线程版本，使用多个线程进行垃圾收集。
3.Parallel Scavenge收集器是一个采用复制算法针对新生代的多线程收集器（并行收集器），不需要暂停其他用户线程。
4.Parallel Old收集器是Parallel Scavenge收集器的老年代版本（并行收集器），使用多线程和标记整理算法。
5.CMS（Current MarkSweep）收集器是一种以获取最短回收停顿时间为目标的收集器，它是一种并发收集器，采用的是标记-清除算法。
6.G1收集器是收集器技术发展最前沿的成果，面向服务端应用的收集器，能充分利用多CPU、多核环境。因此它是一款并行与并发收集器，并且它能建立可预测的停顿时间模型。
GC参数
-XX:+UseSerialGC：在新生代和老年代使用串行收集器
-XX:SurvivorRatio：设置eden区大小和survivior区大小的比例
-XX:NewRatio:新生代和老年代的比
-XX:+UseParNewGC：在新生代使用并行收集器
-XX:+UseParallelGC ：新生代使用并行回收收集器
-XX:+UseParallelOldGC：老年代使用并行回收收集器
-XX:ParallelGCThreads：设置用于垃圾回收的线程数
-XX:CMSFullGCsBeforeCompaction：设定进行多少次CMS垃圾回收后，进行一次内存压缩
-XX:+CMSClassUnloadingEnabled：允许对类元数据进行回收
-XX:CMSInitiatingPermOccupancyFraction：当永久区占用率达到这一百分比启动CMS回收
-XX:UseCMSInitiatingOccupancyOnly：表示只在到达阀值的时候，才进行CMS回收
-XX:+UseConcMarkSweepGC：新生代使用并行收集器，老年代使用CMS+串行收集器
-XX:ParallelCMSThreads：设定CMS的线程数量
-XX:CMSInitiatingOccupancyFraction：设置CMS收集器在老年代空间被使用多少后触发
-XX:+UseCMSCompactAtFullCollection：设置CMS收集器在完成垃圾收集后是否要进行一次内存碎片的整理
性能分析和监控工具
感兴趣的朋友可自行深入研究下列各工具。
JDK自带命令行工具：
Jps：虚拟机进程状况工具
Jstat：虚拟机统计信息监视工具
Jinfo：虚拟机配置信息工具
Jmap：内存映像工具
Jhat：虚拟机堆转储快照分析工具
Jstack：堆栈跟踪工具
JDK可视化工具：
JConsole：java监视与管理控制台
VisualVM：故障处理工具
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (3555)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:19

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?
2019年新品平板电脑仅598元

?广告?·?今天 20:19

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:19

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:19

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023
?广告?·?今天 20:19

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:085

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

华为Mate20：再见了！
科技小李?·?今天 00:10173

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11181

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:19

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

三星S10：回来了！
火科技?·?今天 16:30154

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08330

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03146

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26638

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:55

这样病态的网红，不要也罢！
经济日报?·?今天 15:04

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

百度的冰与火
阑夕?·?昨天 23:45

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7966万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7966万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
线程池入门?
2017-11-16 18:30

一．什么是线程池？
早期的工作线程处理任务的模型。每提交一个任务,会伴随着线程的创建，销毁，资源回收。这种一个任务一个线程一系列创建销毁的模式，缺陷毋庸置疑，不仅是线程创建销毁带来的系统开销，也不好管理工作线程。于是引入了"线程池"的概念，它是一种预创建线程的技术。每次线程执行完任务前，先把任务委派给线程池空闲的线程，如果没有空闲的线程，则根据线程池任务策略执行。处理完任务后，线程不会直接被销毁掉，而会放到线程池管理。
二．为什么要使用线程池？
1、降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁线程造成的消耗。
2、提高响应速度。当任务到达时，任务可以不需要等到线程创建就能立即执行。
3、提高线程的可管理性。线程是稀缺资源，如果无限制地创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一分配、调优和监控。
在面向对象编程语言中，例如Java中对象的创建，销毁必然会产生内存资源或者其它资源的消耗，如果能减少一些很耗资源对象的创建和销毁的次数就能提高程序的效率，如何利用已有对象来服务就是一个需要解决的问题，其实这也是一些"池化资源"技术产生的原因。下面分享一些Java线程池相关的内容。
三．线程池工作流程

corePoolSize：线程池的基本大小，当提交一个任务到线程池时，线程池会创建一个线程来执行任务，即使其他空闲的基本线程能够执行新任务也会创建线程，直到需要执行的任务数大于线程池基本大小时就不再创建。如果调用了线程池的prestartAllCoreThreads()方法，线程池会提前创建并启动所有基本线程。
maximumPoolSize：线程池的最大数量，线程池允许创建的最大线程数。如果队列满了，并且已创建的线程数小于最大线程数，则线程池会再创建新的线程执行任务。这个最大线程数量有点歧义，因为这个数量只有当任务队列满的时候，任务无法再加入到队列中时，线程池才会新增线程到线程池中，值得注意的是，如果使用了无界的任务队列，这个参数就没什么效果。
KeepAliveTime：线程活动保持时间，线程池的工作线程空闲后，保持存活的时间。
unit：线程活动保持时间的单位，可选的单位有天，小时，分钟，毫秒，微秒，纳秒。
workQueue：任务队列，用来保存等待执行的任务的阻塞队列。在任务被执行之前存储这些任务，工作队列仅存储执行了execute方法的任务。可以选择以下几个阻塞队列：ArrayBlockingQueue，LinkedBlockingQueue，SynchronousQueue和PriorityBlockingQueue（这几个阻塞队列的区别这里就不赘述，感兴趣的可以自己搜搜资料）。
threadFactory：用于设置创建线程的工厂（这里提倡使用ThreadFactoryBuilder给一个有意义的命名方便出错后定位问题）。
handler：饱和策略，当队列和线程池都满了，说明线程池处于饱和状态，那么必须采取一种策略处理提交的新任务。这个策略默认情况下是AbortPolicty，表示无法处理新任务时抛出异常。
四．线程池的拒绝策略
线程池的拒绝策略是什么呢？它是在处理能力达到饱和的时候，对新任务采取的执行策略。RejectedExecutionHandler是拒绝任务策略的基础接口，Jdk提供了四种拒绝策略。
1、 CallerRunsPolicy：这种策略是说线程池在没被关闭前，直接会去执行此任务,，否则丢弃任务。
2、 AbortPolicy：简单粗暴，直接throw exception出来了，丢弃任务。
3、DiscardPolic：它跟AbortPolicy一样，直接丢弃任务，只不过不会抛出Exception。
4、 DiscardOldestPolicy： 是在线程池没被关闭的情况下，丢弃任务等待队列中最早的任务。然后重新尝试运行该任务。
5、用户自定义拒绝策略：就是自己实现 RejectedExecutionHandler 接口就可以了。
下面我写了一个简单的如何定义一个自定义拒绝策略的demo：


五．Java自带的几种线程池
在java世界中线程池的使用通常是通过java.util.concurrent.ExecutorService的各类实现来达成，工具类Executors 为我们封装了一系列不同特性的线程池。



1、newFixedThreadPool 创建一个指定工作线程数量的线程池。每次提交一个任务就创建一个线程，直到线程达到线程池的最大大小，线程池的大小一旦达到最大值就会保持不变，如果某个线程因为执行异常而结束，那么线程池会补充一个新线程。
2、newCachedThreadPool 创建一个可缓存的线程池。以共享的无界队列方式来运行这些线程。
3、newSingleThreadExecutor 创建一个单线程化的Executor，只创建唯一的工作者线程来执行任务，如果这个线程异常结束，会有另一个取代它，单工作线程最大的特点是可保证顺序地执行各个任务。
4、newScheduleThreadPool 创建一个定长的线程池，而且支持定时的以及周期性的任务执行，类似于Timer。
线程池的关闭
ThreadPoolExecutor 提供了两个方法，用于线程池的关闭，分别是 shutdown() 和shutdownNow()。
shutdown()：不会立即的终止线程池，而是要等所有任务缓存队列中的任务都执行完后才终止，但再也不会接受新的任务。
shutdownNow()：立即终止线程池，并尝试打断正在执行的任务，并且清空任务缓存队列，返回尚未执行的任务。
六．Spring中的使用
现在大多数项目都是使用的Spring 的ThreadPoolTaskExecutor来使用线程池，spring的 ThreadPoolTaskExecutor是基于jdk中的ThreadPoolExecutor 进行实现。


线程池的提交有两种方式submit（）,execute（）两个方法，二者的区别如下：
submit有返回值，而execute没有。
submit方便Exception处理：
意思就是如果你在你的task里会抛出exception，而你又希望在执行失败后能够感知这些exception并做出及时的处理，那么就需要用到submit，通过捕获Future.get（）抛出的异常来分析失败的原因。
其实翻看submit（）方法的源码会发现它内部是调用的execute（）方法执行的。
以上就是本人对线程池的一些基本分享，希望各位看了或多或少能有所收货！
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (817)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:25

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
2019年新品平板电脑仅598元

?广告?·?今天 20:25

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:25

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:25

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?
?广告?·?今天 20:25

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

华为Mate20：再见了！
科技小李?·?今天 00:10173
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:25

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11182

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

三星S10：回来了！
火科技?·?今天 16:30154

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08332

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03146

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26638

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:04

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

百度的冰与火
阑夕?·?昨天 23:45

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7966万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7966万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
一次避免插入重复记录的实践?
2017-11-08 20:35
背景: Java mysql
在工作中，我们在向数据库插入数据的时候，经常会遇到“判断记录是否存在，如果不存在就新增记录；如果存在则不新增记录”的逻辑。在这里描述一下最近遇到的场景，以及思考和实践的过程。
为了更清楚的描述问题，我们假设有一张user_task表，它的结构如下
CREATE TABLE `user_task` ( `key`?int(?11) NOT NULL AUTO_INCREMENT, `field_one` varchar(?20) , `field_two` varchar(?20) , `user_id`?int(?11) NOT NULL , `task_id`?int(?11) NOT NULL , `other_field` varchar(?20) NOT NULL comment?'任务执行备注',?PRIMARY?KEY(`key`), KEY `idx_field_one`?(`field_one`), KEY `idx_field_two`?(`field_two`), KEY `idx_other_field`?(`other_field`)
)ENGINE=InnoDB AUTO_INCREMENT=?0DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
现在假设在用户端的操作或者其他服务调用，会往这张表插入记录，要求不能有user_id+task_id重复的记录，业务上不会按照userid+task_id的条件查询，另外用户可能出现重复提交，其他服务的调用频率比较高。
下面就来看一下我们的解决思路：
1.最先想到的实现逻辑
从数据库查询user_id+task_id的记录
if(记录不存在) { 插入该记录到数据库 }?else{ 重复插入，不采取任何措施 }
问题: 当并发请求到来，就会插入user_id+task_id重复的记录。
2.添加唯一索引user_id+task_id
通过数据库唯一索引来避免重复数据，当数据库层发现唯一索引有重复数据，就会抛出异常。
优点: 简单有效。
问题：数据库索引已经有两个了，而且不会按照user_id+task_id的条件查询。在这个场景下，为了避免重复记录，去新建索引的代价比较大，先想想其他办法，不行再使用这个办法。
PS：如果重复插入时，不想让数据库抛异常，可以使用”INSERT IGNORE INTO TABLE(…) VALUES(…)” ， 这样当有重复记录就会忽略，执行后返回数字0。
3.数据库语句
INSERT INTO?USER_TASK(key, field_one, field_two,user_id, task_id, other_field)
SELECT key, field_one, field_two, user_id, task_id,other_field FROM dual WHERE NOT?EXISTS( SELECT * FROM USER_TASK WHERE user_id = ? and task_id=?);
问题：并发插入的时候回出现重复记录。
测试：
使用mysql工具打开两个窗口，相当于打开了两个数据库连接。每个窗口贴上一样的sql语句：
start transaction;
INSERT INTO?USER_TASK( field_one,field_two, user_id, task_id, other_field)
SELECT 1, 1, 1, 2, 1 FROM dual WHERE NOT?EXISTS( SELECT * FROM USER_TASK WHERE user_id =?1and task_id=2);commit;
然后两个窗口都先开启事务执行插入,但是不提交，

最后，分别单独执行commit，提交事务。
然后查看数据库表中的数据，如下：

发现Userid+task_id的记录重复了。
4.对记录加锁
start transaction;SELECT key from USER_TASK WHERE user_id=?And task_id=? For update ;
INSERT INTO?USER_TASK(key, field_one, field_two,user_id, task_id, other_field)
SELECT key, field_one, field_two, user_id, task_id,other_field FROM dual WHERE NOT?EXISTS( SELECT * FROM USER_TASK WHERE user_id = ? and task_id=?);commit;
问题：看似可以，其实并不可以，对记录加锁的前提是必须要数据存在，当数据库不存在记录user_id+task_id的时候，并发执行，会产生重复记录。
测试：
使用mysql工具打开两个窗口，相当于打开了两个数据库连接。每个窗口贴上一样的SQL语句：
start transaction;SELECT * from USER_TASK WHERE user_id=?1ANDtask_id=?3FOR UPDATE ;
INSERT INTO?USER_TASK( field_one,field_two, user_id, task_id, other_field)SELECT 1, 1, 1, 3, 1 FROM dual WHERE NOT?EXISTS( SELECT * FROM USER_TASK WHERE user_id =?1and task_id=3);commit;
然后两个窗口分别都先开启事务，尝试锁定数据，

最后，分别单独执行commit，提交事务。

然后查看数据库表中的数据，如下：

发现Userid+task_id的记录重复了。
5.对第一种方案加个锁
Try{ lock.lock(); if(记录不存在) { 插入该记录到数据库 }else { 重复插入，不采取任何措施 }}finally{ Lock.unlock();}
问题：如果是单实例应用，虽然能解决插入重复记录的问题，但是由于任何的插入请求都会加锁，并发请求插入记录的时候性能差。
如果是多实例（分布式）应用，由于加锁是在一台机器上，多台机器同时并发执行，同样会产生多条重复记录。如果把锁换成一个大的分布式锁，高并发请求插入记录的时候性能比较差。
6.按照业务规则过滤掉一段时间内重复的插入请求
由于Redis服务处理请求是单线程的，所有每一条到达服务端的命令不会立刻执行，所有的命令都会进入一个队列中，然后逐个被执行。这里我们通过使用redis的‘INCR’命令来避免并发问题，过滤掉多余的并发请求。业务key=user_id+task_id。
思想: 当执行’INCR’的过程中，只可能有一个线程成功的设置value为1。如果期待的值等于1，执行后面的逻辑；期待的值不等于1，被过滤掉。
privatevoidfilterRedundantInsertion(Integer userId,Integer taskId){ String key = userId +?"_"+ taskId;
//如果key不存在, 初始化value默认为0RedisAtomicLong counter =?newRedisAtomicLong(key, redisTemplate.getConnectionFactory()); Long expectedValue=?1L; Long value = counter.incrementAndGet();
if(expectedValue.equals(value)) { counter.expire(?5, TimeUnit.SECONDS); }?else{
thrownewBusinessException("redundant Insertion"); }}
在执行插入之前，调用“filterRedundantInsertion”方法，过滤掉30秒之内的key=userId+taskId重复的插入请求。这里30秒钟执行一个插入操作足够了。
执行插入使用第3种方法中的SQL语句:
INSERT INTO?USER_TASK(key, field_one, field_two,user_id, task_id, other_field)
SELECT key, field_one, field_two, user_id, task_id,other_field FROM dual WHERE NOT?EXISTS( SELECT * FROM USER_TASK WHERE user_id = ? and task_id=?);
优点:这种方法和第五种方法相比，粒度更细，插入数据时候的并发性能更好。在保证了并发插入的高性能的同时，避免了重复记录的插入。
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (1748)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:26

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
2019年新品平板电脑仅598元

?广告?·?今天 20:26

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:26

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:26

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?
?广告?·?今天 20:26

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

华为Mate20：再见了！
科技小李?·?今天 00:10173

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11184

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198
还没看吧！但凡腋下异味，教你个老方法，一辈子受益
?广告?·?今天 20:26

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

三星S10：回来了！
火科技?·?今天 16:30154

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08333

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03146

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26638

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:04

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

百度的冰与火
阑夕?·?昨天 23:45

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7966万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7966万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
点融账户系统建设?
2017-09-04 12:00操作系统/支付宝
1同业现状
账户系统，在金融行业最早起源于银行的核心系统。银行出于自身管理与监管的需要，在核心系统中作为子系统（账户系统）存在，大部分人对于银行账户都有直接的体验，因为开办银行卡，其实银行就给个人开设了结算账户，属于负债类账户，大家登陆网上银行后，查看银行卡每笔资金的支出和存入，实际就是结算账户的资金流水凭证。
后续支付行业和其他金融机构纷纷效仿银行核心系统的建设思路，最为典型的是支付宝，支付宝作为互联网支付公司，并发量等问题并不能全部照搬银行的模式。传统银行大多采用交易与账务捆绑的模式进行系统设计，而支付宝打破了这种方式，它将交易与账务分离，并采用的分布式的架构。这不仅解决了高并发的问题，同时也满足了用户体验，保证用户资金安全，同时还能提升公司财务管理和清结算管理，满足了监管的需求。
对于支付宝，想必大部分用户应该感受比较深，因为使用过支付宝和余额宝的用户，其实支付宝公司已经给你开设了支付宝账户和余额宝账户，并且你每进行一次交易，都会在支付宝账户或余额宝账户登记资金明细，并且交易明细也有记录，这样对于用户来说，是双重保险，能给用户带来非常好的体验，因为非常安全。
?
交易明细
?

?
支付账户明细
?

1账户规划
点融作为互联网金融公司，虽然银行存管对用户有资金安全保障，但并不提供用户账务的支持，并且涉及用户资金的出金与入金都由点融系统发起，为了提升用户体验，进一步加强用户资金安全，建设了新一代账户系统。
点融账户系统主要包含账户和账务两大部分，交易与账务分离为基本原则，采用分布式架构，主要为用户服务，以客户为中心，保证客户资金的安全和严谨性，可让用户每笔资金的增加与减少都有详细的资金流水作为凭证，还便于企业用户内部财务管理的便捷性，因为点融会提供交易明细账单与结算账户明细作为对账依据，并保持两者的一致性；其次作为公司的基础平台，为各项金融业务提供强有力支持，还可以提升财务管理，使其账目清晰可查、账账相符、账实相符。
1账户体系
账户是用来记录会计科目所反映的业务内容的工具，它根据会计科目来开设的。账户有多种维度的分类。按照经济内容来说，账户分为资产类账户、负债类账户、所有者权益类账户、损益类账户、成本类账户和共同类账户。按照会计周期内期末是否有余额，也分为实账户和虚账户。
点融的主营业务主要是网络借贷，对于点融用户能直接感观到的账户主要是：
?
投资人主要涉及的两类账户：结算账户、投资账户；
?
?
借款人主要涉及的一类账户：结算账户。
?
通过这些账户，点融用户可以看到账户每次变动的资金流水凭证，同时每次发生的交易也能查看。
?
结算账户，类似于用户的钱包，可充值、提现、投资、还款，每笔交易发生时都会在这个账户中登记资金增减变化的情况；
?
?
投资账户：类似于余额宝账户，主要记录用户投资的产品涉及的资金，利息复投涉及的资金，这个账户会按产品分开设立。
?

除此之外，还有很多用户无法感观到的账户，这些账户也是为进一步保证客户账务正确性和严谨性而设计，根据会计记账规则，利用复式记账的原理。

基于以上的账户体系，用户在注册时，会开设结算账户，投资时，会开设投资账户。
1客户账户
账务是指实现会计处理进行原始单证的收集、整理、记载、计算、结报等会计处理的具体事务，它要求规范、准确，保证会计核算，会计监督和会计准则的有效实施。
点融作为P2P领军企业，本着对客户资金高度负责的态度，对客户账务的管理也是非常重视，客户的每笔资金的来龙去脉都有详细的记账，并用复式记账的原理对客户的每笔交易进行记账。如下示列：

而作用用户，则只需关心自身账户的资金流水凭证与交易提供的账单是否一致，因为每笔资金的出入都涉及用户的真金白银，事关自身的利益，以下附上记账流程：

返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (3106)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:33

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:33

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:33

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333
2019年新品平板电脑仅598元

?广告?·?今天 20:33

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?
?广告?·?今天 20:33

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

华为Mate20：再见了！
科技小李?·?今天 00:10173
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:33

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11185

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

三星S10：回来了！
火科技?·?今天 16:30154

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08339

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03151

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26642

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43?
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22171

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:04

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37

百度的冰与火
阑夕?·?昨天 23:45

旗舰手机何须过万?国产旗舰给你不一样的选择
戴客?·?昨天 21:35
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
Java Cache 实践?
2017-08-30 12:00谷歌/程序设计
前言
最近在工作中涉及到一些Cache的东东，我整理了相关知识以及实践来和大家分享探讨。
1一本正经地讲什么是Cache
1、缓存的定义
不同情境下缓存的含义不太一样，我把它分为两类：
?
因为取原始数据结果的代价比较大，把它们（使用频繁）存贮到一临时地方以代价更小的方式获得；
?
?
凡是速度相差较大的两者交互时，用于协调两者处理数据速度差异的结构，均可称之为Cache。
?
2、Cache使用情境
?
操作系统Cache：CPU和主内存之间有Cache，内存和硬盘之间也有Cache
?
?
HTTP Cache：304大家应该不会陌生 :)
?
?
静态化页面
?
?
CDN缓存
?
?
后台应用Cache（本文提及的就是此类Cache）
?
3、后台应用Cache大概分以下三种模式
?
本地Cache：Guava Cache，EhCache（两者都是很成熟的JVM级别缓存）
?
?
单机版的远程Cache：一套远程的Cache服务
?
?
分布式集群Cache：比如Redis，Memcached
?
4、使用Cache的好处
?
提升性能：将相应数据存储起来以避免数据的重复创建、处理和传输，可有效提高性能；
?
?
增强稳定：提供数据的服务可能会意外停止；Cache可以在一定时间内仍提供对最终用户的支持。
?
2努力复现Cache实践
1、自定义Cache实现
cache-sequence：

简单的实现：

上面的例子在并发情况下可能会多次调service，这违背了我们避免重复取原始数据的初衷，所以还有下面的写法：

虽然上面我们解决了并发缓存的问题，但更多的关于Cache的大小、元素的回收等功能均未实现，下面提及的Google Guava Cache对这些功能都有很不错的实现。
2、Guava Cache 简介
Guava Cache作为Google工具库中的一部分，我们自然不能期待Guava对Cache有特别完善的实现，但Guava中的Cache可以在项目的前期为了实现简单而引入。
上面说到ConcurrentHashMap与Guava Cache，他们看起来类似，但Guava Cache还有其他的特性，可以看看Guava CacheBuilder的注释：

看到这些特性，你或许已经在想如何去实现了，咳-咳，但这不是我们今天的重点:)，下面演示一下它的简单使用：
这两种方法都实现了上面cache-sequence的逻辑：从缓存中取key的值，如果Cache中存在，则返回值，反之，调用service来获取值，然后存到Cache中。但不同的在于Cacheloader的定义比较宽泛，是针对整个Cache定义的，即当你明确了键关联的值的加载方法时使用这种方式是很合适的，而Callable的方式较为灵活，允许你在get的时 候指定。
更详细的Cache定义
项目前期引入Guava Cache可以很方便高效的实现服务Cache功能，然而我建议你再往前走一步：引入缓存抽象。因为在项目后期我们可能需迁移到其他缓存方案，譬如Redis，假设你没有对Cache的使用做抽象，每个使用Cache的地都需要修改可能会让你怀疑人生 :)。在怀疑人生和买后悔药的十字路口间，我选择注解驱动的Spring Cache...
3、Spring Cache
看官网文档你会发现这东西和Spring transaction使用惊人的类似，你是对的，因为它也是基于动态生成的proxy代理机制实现的。Ok，下面我们来复习下Spring Cache吧（以下是最基本的Spring Cache使）：
Service：
CacheConfig：（下面使用Java config，xml-based方式官网很详细）
Test：

PS：其他的注解我就不一一演示了，详见Spring官网（http://docs.spring.io/spring/docs/current/spring-framework-reference/html/cache.html）。
4、在分布式应用中使用Redis
当我们做分布式应时，JVM级别的Cache已经不太适合了，分布式Cache才是正道，下面我们来看看基于key-value内存存储的Redis。
从Redis官网（https://redis.io/）可以简单了解到它有以下特点：
?
支持丰富的数据结构和命令
?
?
支持数据持久化（硬盘上）
?
?
支持事务
?
?
值最大可到512M
?
?
支持集群部署（3.0开始自带）
?
当然本文也不是来介绍Redis如何好用的，言归如何使用Redis来完善我们的缓存功能吧。
采用注解驱动的Spring Cache来实现缓存功能优势就凸显了，我们不需要改Cache的调用地方，如下只需替换掉CacheManager、Cache对象即可：

5、踩坑中进击，使用Cache注意事项
Spring Cache基于proxy的Spring AOP带来嵌套调用的问题
嵌套调用如下:
我们使用Spring Aop进行代理，当执行proxy类a的方法时，会进行拦截，紧接着逻辑走到target类上a方法，再调用target类的b方法。它调用的是target类上的b方法, 而不是proxy类的b方法。而且，针对方法b的横切逻辑，只植入到了proxy类上的方法b中，所以嵌套调用的方法中没有我们的增强代码以致AOP失效。
简单介绍下两种解决嵌套调用问题的方案：（当然你可以在使用AOP编码时就绕开嵌套调用）
方案A：构建一个Spring BeanPostProcessor在目标类中注入被代理的对象，在嵌套调用处使用代理对象，具体代码如下：
BeanPostProcessor

BeanSelfAware
Service
方案B：通过ThreadLocal暴露Aop代对象，然后在嵌套调用的地方使用它，具体如下：
开启AspectJAutoProxy的exposeProxy：
在嵌套调用的地方使用AopContext获取当前的代理：
两种方案比较：
BeanSelfProcessor的方案需要在每个嵌套调的地方编码，而且有代码侵入；AopContext的方案需要额外去暴露当前的AOP proxy，正如Api docs上说的这样做会耗费一定的性能，而且同样会有代码侵入；
综上两种都有代码侵入问题，如果你考虑性能采用BeanSelfProcessor，考虑编码更简单采用AopContext。
其他的一些问题比如：
?
数据库中不存在的数据的处理，可以在缓存中放一个无效的对象表明“数据为空”来提高缓存命中率；
?
?
必须设置缓存的过期时间，否则缓存对象将永不过期；
?
?
上线缓存后Cache异常缓存的对象不正确，可以使用在上线缓存前添加一些Cache管理功能来清除错误缓存；
?
?
例如线上程序没有处理异常情况把空对象缓存了，后续所有的请求都只能拿到异常的空对象；
?
?
这种时候如果没有一些缓存管理方案，我们只好启紧急重启应用这样相对麻烦的方案了。
?
?
正在加载中... （更多的问题在前方等待着我们ㄟ(▔,▔)ㄏ）
?
3总结
对于单实例应用Spring Cache + Guava Cache是个很实用的Cache 案，这套方案同样适用于项目的前期高效的实现Cache功能，后面切换缓存方案也相对容易；由于分布式项目的需要可以切换到Spring Cache + Redis的方案。
对于应用Cache我还在探索实践之中，缓存涉及的知识非常多，本文只是浅尝辄止，而且限于文章篇幅，很多东西本文只是一带而过，热切欢迎家的指导 :)。
4参考内容
http://docs.spring.io/spring/docs/current/spring-framework-
reference/html/cache.html
http://docs.spring.io/spring-data/redis/docs/current/reference/
html/#redis:support:cache-abstraction
http://ifeve.com/google-guava-cachesexplained/
http://jinnianshilongnian.iteye.com/blog/1487235
http://www.infoq.com/cn/news/2015/09/cache-problems
https://zh.wikipedia.org/wiki/%E7%BC%93%E5%AD%98
http://blog.jobbole.com/30940/
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (3482)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:36

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:36

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
2019年新品平板电脑仅598元

?广告?·?今天 20:36

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:36

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539
?广告?·?今天 20:36

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

华为Mate20：再见了！
科技小李?·?今天 00:10173

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:36

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11185

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

三星S10：回来了！
火科技?·?今天 16:30154

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08339

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03151

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:085

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26642

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

百度的冰与火
阑夕?·?昨天 23:45

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
点融会计系统浅析?
2017-08-08 13:15操作系统

会计系统（Accounting System），即影响企业经营业绩和财务状况的事件进行日常处理的一整套记录，程序和设施。 在单位的内部控制结构中，单位为了记录、分析、汇总、分类、报告单位的业务活动而建立的方法和程序，称之为会计系统。
—— 摘自百度百科
一、会计概念
会计：以货币为计量，对企业的经济活动进行会计核算的工作。
会计要素：是对会计对象的具体化，即会计核算的具体内容。按照属性主要可分为资产类、负债类、所有者权益类、共同类、损益类（费用、收入）等。
会计要素在实际使用时是通过会计科目进行具体表现，如银行存款科目属于资产类；企业向供应商应付而未付的款项记入应付账款科目，属于负债类；企业通过销售商品而获得的资金记入主营业务收入科目，属于损益类中的收入项。
会计中存在两个著名的恒等式：
l资产=负债+所有者权益
l有借必有贷，借贷必相等。
整个会计系统都是围绕会计要素或会计科目来进行展开。
二、点融会计系统
随着点融业务的不断增长及所在行业的迅猛发展，其外部环境要求点融加强审计、顺应监管需求；同时公司内部本着加强资金、财务管理，降低资金风险，释放交易系统压力，使其更专注于市场的变化与需求，规划与建设了点融账务核心系统，第一阶段即搭建会计系统，实现账务的日清月结，为整个公司的财务核算提供业务相关的基础财务数据。

图：整体流程图
点融会计系统适应《企业会计准则》要求，以权责发生制为记账基础，采用复式记账法，通过灵活配置可实现多法人架构、多币种核算，自定义余额期间等多维度核算需求。该系统主要包含以下几个关键部分组成：科目体系、会计凭证、账簿管理、科目余额、财务报表等。
1.数据收集录入
会计系统为非业务系统，其所依赖的数据均来源于交易系统中的交易数据，因此会计系统需要获取企业中所有涉及到资金活动的业务数据。如支付系统中的交易手续费，交易系统中的充值、提现、投资等交易。

图：数据内容
2.数据处理&存储
会计系统按批次对交易数据进行处理，匹配会计规则引擎，将每一笔交易转化为相应的会计凭证。
会计规则引擎可实现业务交易与核算分离，通过产品、事件、场景及规则，完成会计核算科目匹配、金额计算等功能。
根据产生的会计凭证科目发生额，更新相对应的科目余额，这一过程称为“过账”。科目余额是编制财务报表最重要的基础数据，科目余额信息主要包含账簿、科目、币种、期间、期初余额、本期发生额、期末余额等信息。

图：会计凭证生成图
会计凭证过账后，该凭证包含的科目发生金额立即在科目余额信息中得到体现，进而反应在会计报表中。
3.数据展示
会计系统通过报表形式对外展示其会计数据，可实现报表项及对应科目的自定义配置，可灵活配置资产负债表、损益表等常用财务报表。

表：资产负债表
三、与银行等金融企业会计系统的区别
银行等金融企业的业务系统存在人行监管及数据报送需求，大部分系统在建设时考虑了财务核算功能，各业务系统可独立进行会计科目核算及余额管理，并支持简单的报表查询功能。

图：银行系统简介
而互联网企业业务发展迅速，系统迭代更新频繁，在建设业务系统时往往只关注业务、交易本身，同时系统开发工作主要有科技部门主导，管理部门参与较少，导致系统开发过程中并不关心会计核算相关内容。

本文作者：熊昊明（点融黑帮），FinCore后端开发人员，爱旅游，闲时靠电影打发时间。
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (2403)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:37

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:37

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
2019年新品平板电脑仅598元

?广告?·?今天 20:37

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:37

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539
?广告?·?今天 20:37

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

华为Mate20：再见了！
科技小李?·?今天 00:10173

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11185

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:37

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

三星S10：回来了！
火科技?·?今天 16:30154

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08339

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03151

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:085

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26647

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

百度的冰与火
阑夕?·?昨天 23:45

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
广告

24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
点融会计系统浅析?
2017-08-08 13:15操作系统

会计系统（Accounting System），即影响企业经营业绩和财务状况的事件进行日常处理的一整套记录，程序和设施。 在单位的内部控制结构中，单位为了记录、分析、汇总、分类、报告单位的业务活动而建立的方法和程序，称之为会计系统。
—— 摘自百度百科
一、会计概念
会计：以货币为计量，对企业的经济活动进行会计核算的工作。
会计要素：是对会计对象的具体化，即会计核算的具体内容。按照属性主要可分为资产类、负债类、所有者权益类、共同类、损益类（费用、收入）等。
会计要素在实际使用时是通过会计科目进行具体表现，如银行存款科目属于资产类；企业向供应商应付而未付的款项记入应付账款科目，属于负债类；企业通过销售商品而获得的资金记入主营业务收入科目，属于损益类中的收入项。
会计中存在两个著名的恒等式：
l资产=负债+所有者权益
l有借必有贷，借贷必相等。
整个会计系统都是围绕会计要素或会计科目来进行展开。
二、点融会计系统
随着点融业务的不断增长及所在行业的迅猛发展，其外部环境要求点融加强审计、顺应监管需求；同时公司内部本着加强资金、财务管理，降低资金风险，释放交易系统压力，使其更专注于市场的变化与需求，规划与建设了点融账务核心系统，第一阶段即搭建会计系统，实现账务的日清月结，为整个公司的财务核算提供业务相关的基础财务数据。

图：整体流程图
点融会计系统适应《企业会计准则》要求，以权责发生制为记账基础，采用复式记账法，通过灵活配置可实现多法人架构、多币种核算，自定义余额期间等多维度核算需求。该系统主要包含以下几个关键部分组成：科目体系、会计凭证、账簿管理、科目余额、财务报表等。
1.数据收集录入
会计系统为非业务系统，其所依赖的数据均来源于交易系统中的交易数据，因此会计系统需要获取企业中所有涉及到资金活动的业务数据。如支付系统中的交易手续费，交易系统中的充值、提现、投资等交易。

图：数据内容
2.数据处理&存储
会计系统按批次对交易数据进行处理，匹配会计规则引擎，将每一笔交易转化为相应的会计凭证。
会计规则引擎可实现业务交易与核算分离，通过产品、事件、场景及规则，完成会计核算科目匹配、金额计算等功能。
根据产生的会计凭证科目发生额，更新相对应的科目余额，这一过程称为“过账”。科目余额是编制财务报表最重要的基础数据，科目余额信息主要包含账簿、科目、币种、期间、期初余额、本期发生额、期末余额等信息。

图：会计凭证生成图
会计凭证过账后，该凭证包含的科目发生金额立即在科目余额信息中得到体现，进而反应在会计报表中。
3.数据展示
会计系统通过报表形式对外展示其会计数据，可实现报表项及对应科目的自定义配置，可灵活配置资产负债表、损益表等常用财务报表。

表：资产负债表
三、与银行等金融企业会计系统的区别
银行等金融企业的业务系统存在人行监管及数据报送需求，大部分系统在建设时考虑了财务核算功能，各业务系统可独立进行会计科目核算及余额管理，并支持简单的报表查询功能。

图：银行系统简介
而互联网企业业务发展迅速，系统迭代更新频繁，在建设业务系统时往往只关注业务、交易本身，同时系统开发工作主要有科技部门主导，管理部门参与较少，导致系统开发过程中并不关心会计核算相关内容。

本文作者：熊昊明（点融黑帮），FinCore后端开发人员，爱旅游，闲时靠电影打发时间。
返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (2403)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:37

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:37

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
2019年新品平板电脑仅598元

?广告?·?今天 20:37

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:37

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539
?广告?·?今天 20:37

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

华为Mate20：再见了！
科技小李?·?今天 00:10173

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11185

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:37

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

三星S10：回来了！
火科技?·?今天 16:30154

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08339

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03151

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:085

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26647

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

百度的冰与火
阑夕?·?昨天 23:45

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
广告

24小时热文
1
情人节惨案！刷爆医生的朋友圈！肛门千万不能这样折腾！
1亿?阅读
2
每天早上一个磁性的男声叫你起床？
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
?返回
?首页
?用户
?反馈
?

?
?搜狐首页
?新闻
?体育
?汽车
?房产
?旅游
?教育
?时尚
?科技
?财经
?娱乐
?更多

?
登录狐友
搜狐>科技>正文

点融黑帮
430文章
121万总阅读
查看TA的文章>
0
?分享到
?
?
?
最终一致性实现的一种方式?
2017-06-29 14:43
一、什么是最终一致性
在分布式系统中，一致性是指数据在多个副本之间能否保持一致的特性。当系统在数据一致的状态执行更新操作后，也应该保证系统的数据仍保持一致的状态。在CAP理论中，系统的一致性（C），可用性（A），分区容错性（P）不可同时满足，而可用性和分区容错性又是分布式系统必要的，只能牺牲一致性保证系统的最终一致性来保证系统的高可用。

二、传统分布式事务
2PC、3PC协议能保证数据的强一致性，但不是分布式系统中一致性保证的最佳实践。原因如下：
1）分布式系统中各个应用的数据大多是自己私有的，应用之间通过API进行访问，这种方式使得应用之间松耦合，彼此之间很容易进行扩展。若通过传统分布式事务，则将不同应用的数据访问捆绑在一起。
2）不同应用使用不同数据库，若有的应用使用NOSQL数据库，这些非关系型数据库不支持2PC。
三、最终一致性实现
在我原来所做系统中，要根据不同维度记录用户的账本，如根据用户名、银行卡号记录月账、年账。由于数据量大，需对记账数据进行分库分表，一致性的问题就产生了。

采用的方法是创建一张映射表，映射表和请求表一样，通过请求号进行hash取模，因此可保证请求表和映射表在同一个库里，可进行事务操作。映射表中记录的是请求号和每个记账主体的对应关系，当接收到请求时，将请求按记账主体进行拆分后同时入库到请求表和映射表，同时映射表中会记录每个记账主体的状态为记账中（PROCESSING）。
而账本表中则是根据记账主体号进行hash取模，为保证记账操作不重复，增加一张凭证表，凭证表也是根据主体号进行hash取模，且凭证表需保证记账的幂等性。由于凭证表和账本表的入库在一个事务中，可根据是否存在凭证信息来判断记账是否成功。

当记账成功后，回到映射表将对应映射表中的状态改为记账成功（SUCCESS）。同时配置一个定时任务，定期（10分钟）扫描映射表，看是否有状态不为记账成功的记录，若有则重新进行一次记账操作，由于记账时做了幂等性校验，因此重复的记账操作对记账结果没有影响。
还可创建一张重试表，在记账操作重试过若干次（3次）还不成功的情况下，给运营人员发送短信，由人为介入的方式进行相应的调账。至此，可保证记账操作的最终一致性。

本文作者：钟亮（点融黑帮），java程序猿，平常看看电影玩玩游戏，目前就职于点融成都分公司，软件开发工程师一枚。返回搜狐，查看更多
声明：该文观点仅代表作者本人，搜狐号系信息发布平台，搜狐仅提供信息存储空间服务。
阅读 (826)
不感兴趣?投诉
广告
我来说两句
0人参与，0条评论

登录并发表
搜狐“我来说两句” 用户公约
还没有评论，快来抢沙发吧！
推荐阅读
?推荐
?创业武林大会
?移动互联网
?工业技术
?国家电网
?阿里星球
?Surface
?陈竺
?运动手环
?智能手表
?Apple Watch
?测评
?AR

刚宣布裁员的滴滴又要削减员工福利：全员夜宵政策被取消
雷帝触网?·?昨天 20:25?

同4800万摄像头，小米9与荣耀V20谁更强？网友：差距很大
科技小刀?·?02-22 15:481

自杀残杀：更便宜的红米骁龙855旗舰在路上，要干掉小米9！
机智玩机机?·?02-20 21:36?

华为5G可折叠手机亮相，价格基本确定，网友吐槽：真买不起！
sorockln?·?02-20 16:525
美女总裁嫌弃未婚夫窝囊，没想到他竟是雇佣兵中的顶尖高手
?
?
?
?
?广告?·?今天 20:38

红米Note7 Pro只是开胃菜！这款廉价骁龙855才是主角
闲搞机?·?昨天 14:00?

小米9连光学防抖都不支持，拿什么来超过华为P20 Pro？
好机汇?·?02-16 17:5150

华为2019MWC全球发布会直播地址 2月24日视频观看入口
小明测评?·?今天 14:47?

滴滴员工为补偿求被裁，未富先享受浪费惊人，巨亏超百亿不奇怪
野火科技?·?今天 13:37?
2019年新品平板电脑仅598元

?广告?·?今天 20:38

三星S10港版价格真香，三星S9为新机让路价格感人！
轻武器?·?昨天 12:34?

副总裁没有免死金牌！滴滴取消年终奖，刘强东也向“兄弟”动手！
野火科技?·?02-20 07:408

华为Mate20Pro性能很强，为啥身边用的人并不多？原因让人心酸！
大牛数码?·?02-16 10:124

二月不建议入手的3款华为手机，降价也劝你别入坑！
科技小李?·?02-11 19:11?
但凡腋下异味，无论后天或遗传，牢记这方法，一生受用
?广告?·?今天 20:38

新西兰禁止华为参与5G建设后，华为霸气买下整个报纸版面回怼
百略网官方?·?02-15 14:58?

不用等25号了，华为P30被配件厂曝光，3大黑科技“稳”了！
格空?·?02-16 11:59?

华为Mate20一夜跌至新低价，网友吐槽不断，真的买早了？
科技小李?·?02-20 11:333

战斗天使小米9悲剧了，华为P30确认：5倍光变+潜望四摄！
机智玩机机?·?02-19 17:4621
女性专属懒人祛腋下异味小妙招，清水加一物搅均匀涂抹，值得一试
?广告?·?今天 20:38

见过裁员，没见过这么开心的！滴滴有人拿了十几万，员工抢着被裁....
中国基金报?·?02-22 10:00418

滴滴什么时候将不再为私家车派单？双证制度执行之后，就是清退了
小兔兔网络?·?02-20 13:23?

科学家发现一颗超级地球，质量是地球的5.4倍，但却高兴不起来
UFO之家?·?今天 17:49?

华为MateX真机上手：比三星Galaxy Fold更大！
叽歪数码?·?今天 18:2539
?广告?·?今天 20:38

5G商用手机频亮相 超360家中国企业参展MWC 2019
每日经济新闻?·?今天 18:14?

日本人再现强盗行径，向中国收二维码使用费
科技喻小川?·?昨天 12:07?

华为Mate20：再见了！
科技小李?·?今天 00:10173

iQ00“智商00”vivo发布新手机子品牌，定价或在5000元以上，
全媒体聚焦?·?02-12 17:0560

小米9使用三天后的个人体验，说一说优缺点！
科技小李?·?今天 16:59158

热点 | 胡玮炜卸任摩拜CEO后花68万上学 与程维戴威成“校友”
铅笔道pencilnews?·?今天 10:11185

小米9刚出来，就拿它跟华为Mate20pro比，真没可比性
健身程序猿?·?02-21 11:24173

你买得起5G手机，用得起5G网络吗？三星华为OPPO争先发布5G手机！
黑天鹅?·?今天 04:43198
开局一条鲲，你能进阶多少级？
?
?
?
?
?广告?·?今天 20:38

世界第四大人口国被中国手机攻陷！小米OPPO华为等抢近60%份额
虎龙吟?·?昨天 10:58381

尴尬的折叠屏手机，从3888元降至1498元，依旧无人问津！
科技小李?·?今天 18:13?

华为折叠屏5G手机曝光，8寸大屏+价格2.18万元+限量版！
科技微聚焦?·?02-22 09:27?

全民折叠时代！又一国产折叠屏手机曝光：所有形态都做了！
雷科技?·?今天 12:052

流量明星一条微博转发上亿，当心影视行业的“虚假繁荣”
新京报?·?今天 17:30?

三星手机犯了与苹果同样的错误，败走中国手机市场已成定局？
小阅微草堂?·?02-22 01:2610

三星S10：回来了！
火科技?·?今天 16:30154

雷军亲自站台小米无线充电宝，售价149元，网友：鸡肋玩意儿
郭静的互联网圈?·?昨天 16:26128

努比亚将发布5G手机，运营商看了自叹不如：这速度也太快了
智玩TOP?·?今天 16:56?

“法国华为”是如何被美国吃掉的？
乌鸦校尉?·?02-17 22:011

小米9这么强，为什么不推5G版本？第三个原因最重要
士豆不土?·?昨天 14:34?

滴滴裁员补偿丰厚，员工称裁出幸福感？
CSDN?·?今天 08:08339

5G对社会的改变有多大：超出你的想象
马继华?·?昨天 21:03152

三星Galaxy S10发布后好评如潮：设计更贴心
玩懂手机?·?昨天 20:085

华为P30发布会定档3月26号 拍照又要霸占全球第一？
手机中国?·?昨天 07:3037

电池门事件背后，小米的不归路
孙永杰?·?今天 09:26647

一加7配置曝光：升降式前摄+4800万主摄 或有5G版
玩懂手机?·?今天 11:3431

华为Mate X可折叠手机海报曝光
IT之家?·?昨天 06:57181
QQ安卓版强制获取通话记录？回应：QQ新版不再要求该权限
澎湃新闻?·?今天 08:55138

一加7真机上手照曝光 无刘海设计你觉得怎么样？
手机中国?·?昨天 06:3023

雷军给了卢伟冰一手好牌，红米手机将与最强对手开打
数码评价?·?今天 07:5556

这样病态的网红，不要也罢！
经济日报?·?今天 15:049

MWC2019什么时候开始？MWC2019时间、地点介绍
好特游戏?·?02-20 15:43

华为手机高速增长背后的隐患：屏幕频现瑕疵 供应链能力受限
小阅微草堂?·?昨天 00:14

已确认！库克与马云达成合作出免息业务，苹果销量要起飞？
全媒体聚焦?·?今天 16:22

小米三款手机或被禁售 拿下欧洲遇大麻烦
蓝鲸TMT?·?今天 13:07

移动联通电信争夺5G市场背后：高成本高资源阻碍普及率
小阅微草堂?·?今天 07:36

【虎嗅早报】腾讯QQ辟谣：网传“212事件”处罚通知系谣言；库克谈iPhone在华降价：效果...
虎嗅APP?·?02-13 07:31

华为5G折叠屏手机价格多少？华为5G折叠屏手机华为MateX售价预测
手机小师妹?·?昨天 15:29

4月新机来袭！OPPO 10倍光变，魅族16s狙击小米9，雷军有压力
Adair品科技?·?今天 15:39

京东裁员10%，滴滴裁员15%，互联网企业转型升级的必经之路
小阅微草堂?·?今天 08:08

华为折叠屏手机Mate X曝光：8英寸外折叠屏幕 比三星更轻薄
科技先生?·?昨天 18:17

小米难以走出平民手机的旋涡，雷军的小米高端化梦碎？
小阅微草堂?·?02-21 09:12

职场人士开工新装备，让你在职场也能“吃鸡”
戴客?·?02-21 20:19

新浪微博回应“流量明星数据造假”：有人开“外挂”刷量
环球网?·?今天 15:34

默安科技联合创始人云舒宣布离婚决定
三言财经?·?02-22 21:31

互联网企业裁员潮下的逆行者：阿里巴巴为何继续扩招？
小阅微草堂?·?今天 08:29
亚马逊货机坠毁，机上3人疑死亡
三言财经?·?今天 11:27

AI：未来研究重点是赋予机器常识
酷玩儿?·?昨天 08:41

华为Mate X真机海报首曝！华为首款5G折叠屏长这样
手机中国?·?今天 06:00

IBM的人工智能输给了人类顶级辩手
MiHomes?·?02-12 13:12

OPPO发布10倍光学变焦技术 首款5G手机亮相 今年Q2发布
搜狐科技视界?·?今天 05:32

谷歌、微软、Facebook 这样的科技巨头，为什么很难监管？
酷玩儿?·?今天 08:53

红米Note7Pro节后首度曝光，红米Note7为新机让路，价格感人
轻武器?·?今天 14:10

进口跨境电商全渠道零售O2O发展模式
新零售顾问黎代云?·?02-21 15:00

华为荣耀V20存瑕疵，证明三星在技术上还是要强一些
柏颖?·?昨天 17:50

旅行带上运动相机，让世间美好掌握在自己手中
戴客?·?02-21 20:22

豆瓣影评深陷危机：猫眼淘票票合围冲击 频现刷分公信力下降
小阅微草堂?·?昨天 07:29
2019 MWC前瞻，除了5G手机还有这些值得关注…
新京报?·?今天 17:10

百度的冰与火
阑夕?·?昨天 23:45

百度Q4财报背后：危机与机遇
小阅微草堂?·?昨天 00:01

万能空间推出旗下首款民工在线择业App
MiHomes?·?02-14 10:37
已经到底了

广告

热门图集
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
泰最叛逆公主追爱逃离王室 68岁唱跳全能
炖鹅太香 大爷在欲望与道德边徘徊3分钟
海口最牛钉子楼：时隔3年终于倒了
??
?女子被家暴后求助媒体 被丈夫打成骨折
?印度大火烧毁300辆车 现场民众不忘自拍
?男童先天胆闭 父亲无钱治病跪地痛哭
?不敢相信眼睛！她们竟都没穿衣服！！
广告

24小时热文
1
华为知错就改：凡是出现绿屏的Mate 20 Pro都可更换新机
1亿?阅读
2
红灯区背后的人皮交易：她们是妓女，但她们也是人
7967万?阅读
3
百度Q3财报透露出的自信与危机
1亿?阅读

突发！腾讯损失近万亿，马云重回中国首富！腾讯危机来了？
1亿?阅读

代购们哭了！代购3年，罚款550万，淘宝店主被判十年！
1亿?阅读
广告
搜狐号推荐

搜狐科技视界
搜狐科技官方原创账号。聚焦TMT领域大事件、大趋势和新变化，用我们的视角观...

果壳网
面向都市科技青年们的社交网站。开放、多元的泛科技兴趣社区，并提供负责任...

科技说说
科技说说，说说科技，用最通俗易懂的文字解读行业。专注文娱、金融、电商、...

科技小李
科技评测与最新的科技信息

创业家精选
推送及时的创业创新新闻，传递融资信息，提供行业热点报道。
广告

?联系我们
?返回
?首页
?用户
?反馈
?


Bright Moon ‘ s Blog
你有你的规则，我有我的选择
?博客园
?首页
?新随笔
?联系
?管理
?订阅
随笔- 75? 文章- 0? 评论- 6?
分布式消息最终一致性事务
现在先抛出问题，假设有一个主数据中心在北京M，然后有成都A，上海B两个地方数据中心，现在的问题是，假设成都上海各自的数据中心有记录变更，需要先同步到主数据中心，主数据中心更新完成之后，在把最新的数据分发到上海，成都的地方数据中心A，地方数据中心更新数据，保持和主数据中心一致性（数据库结构完全一致）。数据更新的消息是通过一台中心的MQ进行转发。

先把问题简单化处理，假设A增加一条记录Message_A，发送到M，B增加一条记录 MESSAGE_B发送到M，都是通过MQ服务器进行转发，那么M系统接收到条消息，增加两条数据，那么M在把增加的消息群发给A，B，A和B找到自己缺失的数据，更新数据库。这样就完成了一个数据的同步。
从正常情况下来看，都没有问题，逻辑完全合理，但是请考虑以下三个问题
1 如何保证A->M的消息，M一定接收到了，同样，如何保证M->A的消息，M一定接收到了
2 如果数据需要一致性更新，比如A发送了三条消息给M，M要么全部保存，要么全部不保存，不能够只保存其中的几条记录。我们假设更新的数据是一条条发送的。
3 假设同时A发送了多条更新请求，如何保证顺序性要求？
这两个问题就是分布式环境下数据一致性的问题
对于第一个问题，比较好解决，我们先看看一个tcp/ip协议链接建立的过程

我们的思路可以从这个上面出发，在简化一下，就一个请求，一个应答。
简单的通信模型是这样的
A->M : 你收到我的一条消息没有，消息的ID是12345
M->A: 我收到了你的一条消息数据，消息数据是ID;12345
这样就一个请求，一个应答，就完成了一次可靠性的传输。如果A一致没有收到M的应答，就不断的重试。这个时候M就必须保证幂等性。不能重复的处理消息。那么最极端的情况是，怎么也收不到M的应答，这个时候是系统故障。自己检查一下吧。
这么设计就要求，A在发送消息的时候持久化这个消息的数据内容，然后不断的重试，一旦接收到M的应答，就删除这条消息。同样，M端也是一样的。不要相信MQ的持久化机制，不是很靠谱的。
那么M给A发送消息也采取类似的原理就可以了。
下面在看看第二个问题，如何保持数据的一致性更新，这个还是可以参考TCP/IP的协议。
首先A发送一条消息给M：我要发送一批消息数据给你，批次号是10000，数据是5条。
M发送一条消息给A：ok，我准备好了，批次号是10000，发送方你A
接着A发送5条消息给M，消息ID分别为1，2，3，4，5 ，批次号是10000，
紧接着，A发送一个信息给M：我已经完成5小消息的发送，你要提交数据更新了
接下来可能发送两种情况
1 那么M发送消息给A：ok，我收到了5条消息，开始提交数据
2 那么M也可以发送给A：我收到了5条消息，但是还缺少，请你重新发送，那么A就继续发送，直到A收到M成功的应答。
整个过程相当复杂。这个也就是数据一旦分布了，带来最大的问题就是数据一致性的问题。这个成本非常高。
对于第三个问题，这个就比较复杂了
这个最核心的问题就是消息的顺序性，我们只能在每个消息发一个消息的序列号，但是还是没有最好解决这个问题的办法。因为消息接收方不知道顺序。因为即使给他了序列号，也没有办法告诉他，这个应该何时处理。最好的办法是在第二种方式的基础作为一个批次来更新。
这个只是以最简单的例子来说明一下分布式系统的要保证数据一致性是一件代价很大的事情。当然有的博主会说，这个何必这么复杂，直接数据库同步不就可以了。这个例子当然是没有问题的，万一这个几个库的模型都不一样，我发送消息要处理的事情不一样的。怎么办？
在上文，简单的介绍了分布式数据的同步问题，上面的问题比较抽象，在目前的互联网应用中还很少见，这次在通过一个比较常见的例子，让大家更深入的了解一下分布式系统设计中关于数据一致性的问题
这次我们拿我们经常使用的功能来考虑吧，最近网购比较热门，就以京东为例的，我们来看看京东的一个简单的购物流程

用户在京东上下了一个订单，发现自己在京东的账户里面有余额，然后使用余额支付，支付成功之后，订单状态修改为支付成功，然后通知仓库发货。假设订单系统，支付系统，仓库系统是三个独立的应用，是独立部署的，系统之间通过远程服务调用。
订单的有三个状态：I:初始 P:已支付 W:已出库，订单金额100, 会员帐户余额200
如果整个流程比较顺利，正常情况下，订单的状态会变为I->P->W，会员帐户余额100，订单出库。
但是如果流程不顺利了？考虑以下几种情况
1：订单系统调用支付系统支付订单，支付成功，但是返回给订单系统数据超时，订单还是I（初始状态），但是此时会员帐户余额100,会员肯定会马上找京东骂京东，为啥不给老子发货，我都付钱了
2：订单系统调用支付系统成功，状态也已经更新成功，但是通知仓库发货失败，这个时候订单是P（已支付）状态，此时会员帐户余额是100,但是仓库不会发货。会员也要骂京东。
3：订单系统调用支付系统成功，状态也已经更新成功，然后通知仓库发货，仓库告诉订单系统，没有货了。这个时候数据状态和第二种情况一样。
对于问题一，我们来分析一下解决方案，能想到的解决方案如下
1 假设调用支付系统支付订单的时候先不扣钱，订单状态更新完成之后，在通知支付系统你扣钱
如果采用这种设计方案，那么在同一时刻，这个用户，又支付了另外一笔订单，订单价格200，顺利完成了整个订单支付流程，由于当前订单的状态已经变成了支付成功，但是实际用户已经没有钱支付了，这笔订单的状态就不一致了。即使用户在同一个时刻没有进行另外的订单支付行为，通知支付系统扣钱这个动作也有可能完不成，因为也有可能失败，反而增加了系统的复杂性。
2 订单系统自动发起重试，多重试几次，例如三次，直到扣款成功为止。
这个看起来也是不错的考虑，但是和解决方案一样，解决不了问题，还会带来新的问题，假设订单系统第一次调用支付系统成功，但是没有办法收到应答，订单系统又发起调用，完了，重复支付，一次订单支付了200。
假设支付系统正在发布，你重试多少次都一样，都会失败。这个时候用户在等待，你怎么处理？
3 在第二种方案的基础上，我们先解决订单的重复支付行为，我们需要在支付系统上对订单号进行控制，一笔订单如果已经支付成功，不能在进行支付。返回重复支付标识。那么订单系统根据返回的标识，更新订单状态。
接下来解决重试问题，我们假设应用上重试三次，如果三次都失败，先返回给用户提示支付结果未知。假设这个时候用户重新发起支付，订单系统调用支付系统，发现订单已经支付，那么继续下面的流程。如果会员没有发起支付，系统定时（一分钟一次）去核对订单状态，如果发现已经被支付，则继续后续的流程。
这种方案，用户体验非常差，告诉用户支付结果未知，用户一定会骂你，你丫咋回事情，我明明支付了，你告诉我未知。假设告诉用户支付失败，万一实际是成功的咋办。你告诉用户支付成功，万一支付失败咋办。
4 第三种方案能够解决订单和支付数据的一致性问题，但是用户体验非常差。当然这种情况比较可能是少数，可以牺牲这一部分的用户体验，我们还有没有更好的解决方案，既能照顾用户体验，又能够保证资金的安全性。
我们再回来看看第一种方案，我们先不扣钱，但是有木有办法让这一部分钱不让用户使用，对了，我们先把这一部分钱冻结起来，订单系统先调用支付系统成功的时候，支付系统先不扣钱，而是先把钱冻结起来，不让用户给其他订单支付，然后等订单系统把订单状态更新为支付成功的时候，再通知支付系统，你扣钱吧，这个时候支付系统扣钱，完成后续的操作。
看起来这个方案不错，我们仔细在分析一下流程，这个方案还存在什么问题，假设订单系统在调用支付系统冻结的时候，支付系统冻结成功，但是订单系统超时，这个时候返回给用户，告知用户支付失败，如果用户再次支付这笔订单，那么由于支付系统进行控制，告诉订单系统冻结成功，订单系统更新状态，然后通知支付系统，扣钱吧。如果这个时候通知失败，木有问题，反正钱都已经是冻结的了，用户不能用，我只要定时扫描订单和支付状态，进行扣钱而已。
那么如果变态的用户重新拍下来一笔订单,100块钱，对新的订单进行支付，这个时候由于先前那一笔订单的钱被冻结了，这个时候用户余额剩余100，冻结100，发现可用的余额足够，那就直接在对用户扣钱。这个时候余额剩余0，冻结100。先前那一笔怎么办，一个办法就是定时扫描，发现订单状态是初始的话，就对用户的支付余额进行解冻处理。这个时候用户的余额变成100，订单数据和支付数据又一致了。假设原先用户余额只有100，被冻结了，用户重新下单，支付的时候就失败了啊，的确会发生这一种情况，所以要尽可能的保证在第一次订单结果不明确的情况，尽早解冻用户余额，比如10秒之内。但是不管如何快速，总有数据不一致的时刻，这个是没有办法避免的。
第二种情况和第三种情况如何处理，下次在分析吧。
由于互联网目前越来越强调分布式架构，如果是交易类系统，面临的将会是分布式事务上的挑战。当然目前有很多开源的分布式事务产品，例如java JPA，但是这种解决方案的成本是非常高的，而且实现起来非常复杂，效率也比较低下。对于极端的情况：例如发布，故障的时候都是没有办法保证强一致性的。
在上文主要介绍了数据分布的情况下保证一致性的情况，在第二篇文章里面，我这里提出了三个问题
1.订单系统调用支付系统支付订单，支付成功，但是返回给订单系统数据超时，订单还是I（初始状态），但是此时会员帐户余额100,会员肯定会马上找京东骂京东，为啥不给老子发货，我都付钱了
2.订单系统调用支付系统成功，状态也已经更新成功，但是通知仓库发货失败，这个时候订单是P（已支付）状态，此时会员帐户余额是100,但是仓库不会发货。会员也要骂京东。
3.订单系统调用支付系统成功，状态也已经更新成功，然后通知仓库发货，仓库告诉订单系统，没有货了。这个时候数据状态和第二种情况一样。
重点分析解决了第一个的问题以及相应的方案，发现在数据分布的环境下，很难绝对的保证数据一致性（任何一段区间），但是有办法通过一种补偿机制，最终保证数据的一致性。
在下面在分析一下第二个问题
订单系统调用支付系统成功，状态也已经更新成功，但是通知仓库发货失败，这个时候订单是P（已支付）状态，此时会员帐户余额是100,但是仓库不会发货。会员也要骂京东。
通过在上一篇文章里面分析过，这个相对来说是比较简单的，我可以采取重试机制，如果发现通知仓库发货失败，就一致重试，
这里面有两种方式：
1 异步方式：通过类似MQ（消息通知）的机制，这个是异步的通知
2 同步调用：类似于远程过程调用
对于同步的调用的方式，比较简单，我们能够及时获取结果，对于异步的通知，就必须采用请求，应答的方式进行，这一点在（关于分布式系统的数据一致性问题(一)）里面有介绍。这里面就不再阐述。
来看看第三个问题
订单系统调用支付系统成功，状态也已经更新成功，然后通知仓库发货，仓库告诉订单系统，没有货了。这个时候数据状态和第二种情况一样。
我觉得这是一个很有意思的问题，我们还是考虑几种解决的方案
1 在会员下单的时刻，就告诉仓库，我要你把货物留下来，
2 在会员支付订单时候，在支付之前检查仓库有没有货，如果没有货，就告知会员木有货物了
3 如果会员支付成功，这个时候没有货了，就会退款给用户或者等待有货的时候在发货
正常情况，京东的仓库一般都是有货的，所以影响到的会员很少，但是在秒杀和营销的时候，这个时候就不一定了，我们考虑假设仓库有10台iphone
如果采用第一种方案，
1 在会员下单的时候，相当于库存就-1，那么用户恶意拍下来，没有去支付，就影响到了其他用户的购买。京东可以设置一个订单超时时间，如果这段时间内没有支付，就自动取消订单
2 在会员支付之前，检查仓库有货，这种方案了，对于用户体验不好，但是对于京东比较好，至少我东西都卖出去了。那些没有及时付款的用户，只能投诉了京东无故取消订单
3 第三种方案，这个方案体验更不好，而且用户感觉受到京东欺诈，但是对于京东来说，比第二种方案更有益，毕竟我还可以多卖出一点东西。
个人觉得，京东应该会采用第二种或者第三种方式来处理这类情况，我在微博上搜索了 “京东 无故取消订单”，发现果真和我预料的处理方式。不过至于这里的无故取消是不是技术上的原因我不知道，如果真的是技术上的原因，我觉得京东可以采用不同的处理方案。对于秒杀和促销商品，可以考虑第一种方案，大多数人都会直接付款，毕竟便宜啊，如果用户抢不到便宜的东西，抱怨当然很大了。这样可以照顾大多数用户的体验。对于一般的订单，可以采用第二种或者第三种方式，这种情况下，发生付款之后仓库没有货的情况会比较少，并且就算发生了，用户也会觉得无所谓，大不了退钱吗，这样就可以实现自己的利益最大化而最低程度的减少用户体验。

而铁道部在这个问题上，采用的是第一种方案，为什么和京东不一样，就是因为用户体验，如果用户把票都买了，你告诉我木有票了，旅客会杀人的。哈哈，不过铁道部不担心票卖不出去，第一种方案对他影响没有什么。
说了这么多，就是说 分布式环境下（数据分布）要任何时刻保证数据一致性是不可能的，只能采取妥协的方案来保证数据最终一致性。这个也就是著名的CAP定理。
在前面三篇文章中，介绍了关于分布式系统中数据一致性的问题，这一篇主要介绍CAP定理以及自己对CAP定理的了解。
CAP定理是2000年，由 Eric Brewer 提出来的
Brewer认为在分布式的环境下设计和部署系统时，有3个核心的需求，以一种特殊的关系存在。这里的分布式系统说的是在物理上分布的系统，比如我们常见的web系统。
这3个核心的需求是：Consistency，Availability和Partition Tolerance，赋予了该理论另外一个名字 － CAP。
Consistency：一致性，这个和数据库ACID的一致性类似，但这里关注的所有数据节点上的数据一致性和正确性，而数据库的ACID关注的是在在一个事务内，对数据的一些约束。
Availability：可用性，关注的在某个结点的数据是否可用，可以认为某一个节点的系统是否可用，通信故障除外。
Partition Tolerance：分区容忍性，是否可以对数据进行分区。这是考虑到性能和可伸缩性。
为什么不能完全保证这个三点了，个人觉得主要是因为一旦进行分区了，就说明了必须节点之间必须进行通信，涉及到通信，就无法确保在有限的时间内完成指定的行文，如果要求两个操作之间要完整的进行，因为涉及到通信，肯定存在某一个时刻只完成一部分的业务操作，在通信完成的这一段时间内，数据就是不一致性的。如果要求保证一致性，那么就必须在通信完成这一段时间内保护数据，使得任何访问这些数据的操作不可用。
如果想保证一致性和可用性，那么数据就不能够分区。一个简单的理解就是所有的数据就必须存放在一个数据库里面，不能进行数据库拆分。这个对于大数据量，高并发的互联网应用来说，是不可接受的。
我们可以拿一个简单的例子来说明：假设一个购物系统，卖家A和卖家B做了一笔交易100元，交易成功了，买家把钱给卖家。
这里面存在两张表的数据：Trade表Account表 ，涉及到三条数据Trade(100),Account A ,Account B
假设 trade表和account表在一个数据库，那么只需要使用数据库的事务，就可以保证一致性，同时不会影响可用性。但是随着交易量越来越大，我们可以考虑按照业务分库，把交易库和account库单独分开，这样就涉及到trade库和account库进行通信，也就是存在了分区，那么我们就不可能同时保证可用性和一致性。
我们假设初始状态
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,I)
account(accountNo,balance) = account(A,300)
account(accountNo,balance) = account(B,10)
在理想情况下，我们期望的状态是
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,S)
account(accountNo,balance) = account(A,200)
account(accountNo,balance) = account(B,110)
但是考虑到一些异常情况
假设在trade(20121001,S)更新完成之前，帐户A进行扣款之后，帐户A进行了另外一笔300款钱的交易，把钱消费了，那么就存在一个状态
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,S)
account(accountNo,balance) = account(A,0)
account(accountNo,balance) = account(B,10)
产生了数据不一致的状态
由于这个涉及到资金上的问题，对资金要求比较高，我们必须保证一致性，那么怎么办，只能在进行trade(A,B,20121001)交易的时候，对于任何A的后续交易请求trade(A,X,X)，必须等到A完成之后，才能够进行处理，也就是说在进行trade(A,B,20121001)的时候，Account(A)的数据是不可用的。
任何架构师在设计分布式的系统的时候，都必须在这三者之间进行取舍。首先就是是否选择分区，由于在一个数据分区内，根据数据库的ACID特性，是可以保证一致性的，不会存在可用性和一致性的问题，唯一需要考虑的就是性能问题。对于可用性和一致性，大多数应用就必须保证可用性，毕竟是互联网应用，牺牲了可用性，相当于间接的影响了用户体验，而唯一可以考虑就是一致性了。
牺牲一致性
对于牺牲一致性的情况最多的就是缓存和数据库的数据同步问题，我们把缓存看做一个数据分区节点，数据库看作另外一个节点，这两个节点之间的数据在任何时刻都无法保证一致性的。在web2.0这样的业务，开心网来举例子，访问一个用户的信息的时候，可以先访问缓存的数据，但是如果用户修改了自己的一些信息，首先修改的是数据库，然后在通知缓存进行更新，这段期间内就会导致的数据不一致，用户可能访问的是一个过期的缓存，而不是最新的数据。但是由于这些业务对一致性的要求比较高，不会带来太大的影响。
异常错误检测和补偿
还有一种牺牲一致性的方法就是通过一种错误补偿机制来进行，可以拿上面购物的例子来说，假设我们把业务逻辑顺序调整一下，先扣买家钱，然后更新交易状态，在把钱打给卖家
我们假设初始状态
account(accountNo,balance) = account(A,300)
account(accountNo,balance) = account(B,10)
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,I)
那么有可能出现
account(accountNo,balance) = account(A,200)
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,S)
account(accountNo,balance) = account(B,10)
那么就出现了A扣款成功，交易状态也成功了，但是钱没有打给B，这个时候可以通过一个时候的异常恢复机制，把钱打给B，最终的情况保证了一致性，在一定时间内数据可能是不一致的，但是不会影响太大。
两阶段提交协议
当然，还有一种方式就是我另外一篇文章里面《X/Open DTP-分布式事务模型》里面说的，但是再第一阶段和第二阶段之间，数据也可不能是一致性的，也可能出现同样的情况导致异常。而且DTP的分布式事务模型 限制太多，例如必须有实现其功能的相关的容器支持，并且资源管理器也必须实现了XA规范。限制比较多。
国外有的架构师有两种方案去解决CAP的限制，但是也是比较适合特定的业务，而没有通用的解决方案，
探知分区->分区内操作->事后补偿

就是上面介绍的异常检测恢复机制，这种机制其实还是有限制，
首先对于分区检测操作，不同的业务涉及到的分区操作可能不一样
分区内操作限制：不同的业务对应的约束不一致
事后补偿：由于业务约束不一样，补偿方式也不一样。
所以这只能作为一种思想，不能做一个通用的解决方案
分类:?JAVA相关,系统架构
好文要顶?关注我?收藏该文??

Bright Moon ‘ s Blog
关注 - 12
粉丝 - 17
+加关注
5
0
??上一篇：Nginx+Tomcat服务器环境中配置https访问
??下一篇：分布式最终一致方案梳理
posted @?2016-06-28 10:46?Bright Moon ‘ s Blog?阅读(13728) 评论(1)?编辑?收藏

评论
??
#1楼?2018-09-18 19:48?|?doucequan??
虽然看不太明白，但是好像很厉害的样子。
支持(0)反对(0)
刷新评论刷新页面返回顶部
注册用户登录后才能发表评论，请?登录?或?注册，访问网站首页。
【推荐】超50万C++/C#源码: 大型实时仿真HMI组态CAD\GIS图形源码！
【推荐】专业便捷的企业级代码托管服务 - Gitee 码云
相关博文：
·?如何用消息系统避免分布式事务？
·?分布式系统事务一致性解决方案
·?分布式消息最终一致性事务
·?分布式消息最终一致性事务
·?分布式事务最终一致性常用方案
最新新闻：
·?互联网裁员阴影下，如何避免成为那只“火鸡？”
·?俞敏洪：创办新东方的25年告诉了我这9点经验
·?亏损扩大的爱奇艺，股价为何不降反涨？
·?硅谷创业传奇：我对自己没能打造一家独角兽的思考
·?高调宣布不裁员的阿里 为何不去清华招人？
??更多新闻...
昵称：Bright Moon ‘ s Blog
园龄：6年
粉丝：17
关注：12
+加关注
<	2019年2月	>

日	一	二	三	四	五	六
27	28	29	30	31	1	2
3	4	5	6	7	8	9
10	11	12	13	14	15	16
17	18	19	20	21	22	23
24	25	26	27	28	1	2
3	4	5	6	7	8	9
搜索
?
?
常用链接
?我的随笔
?我的评论
?我的参与
?最新评论
?我的标签
?
随笔分类
?C#相关(10)
?Hibernate(7)
?JAVA相关(24)
?JSP(2)
?linux(16)
?Spring(1)
?Struts2(9)
?windows OS(3)
?服务器(12)
?人生感悟(3)
?设计模式(1)
?手机web(3)
?数据库相关(9)
?系统架构(13)
随笔档案
?2016年7月 (1)
?2016年6月 (2)
?2016年5月 (1)
?2015年12月 (1)
?2015年11月 (1)
?2015年8月 (2)
?2015年5月 (2)
?2015年4月 (3)
?2015年2月 (1)
?2015年1月 (2)
?2014年12月 (8)
?2014年11月 (1)
?2014年10月 (2)
?2014年9月 (4)
?2014年7月 (6)
?2014年6月 (1)
?2014年4月 (2)
?2014年3月 (1)
?2014年1月 (2)
?2013年12月 (1)
?2013年11月 (1)
?2013年10月 (1)
?2013年9月 (1)
?2013年8月 (1)
?2013年7月 (2)
?2013年6月 (2)
?2013年4月 (7)
?2013年3月 (2)
?2013年2月 (14)
最新评论
?1. Re:大多数程序员单身的原因（转）
?赞一个
?--魅影独秀
?2. Re:分布式消息最终一致性事务
?虽然看不太明白，但是好像很厉害的样子。
?--doucequan
?3. Re:Linux下添加新硬盘,分区及挂载
?给个赞！！！！
?--园芳宝贝
?4. Re:写给我们这些浮躁的程序员
?@马非码对啊...
?--Bright Moon ‘ s Blog
?5. Re:写给我们这些浮躁的程序员
?写得非常到位、全面，写出了我想要做的和正在做的
?--马非码
阅读排行榜
?1. 分布式消息最终一致性事务(13728)
?2. freemarker快速上手+空值+三元运算的多种处理方法(12438)
?3. 分布式最终一致方案梳理(3728)
?4. hibernate：通用DAO+动态生成HQL语句(2603)
?5. linux 二进制安装mysql(1352)
评论排行榜
?1. 写给我们这些浮躁的程序员(2)
?2. C# 读取XML文件和写入XML文件(1)
?3. 分布式消息最终一致性事务(1)
?4. Linux下添加新硬盘,分区及挂载(1)
?5. 大多数程序员单身的原因（转）(1)
推荐排行榜
?1. 分布式消息最终一致性事务(5)
?2. 分布式最终一致方案梳理(2)
?3. Linux下添加新硬盘,分区及挂载(1)
?4. C#（利用c#制作托盘程序，并禁止多个应用实例运行）(1)
?5. 大多数程序员单身的原因（转）(1)
Copyright ?2019 Bright Moon ‘ s Blog

Bright Moon ‘ s Blog
你有你的规则，我有我的选择
?博客园
?首页
?新随笔
?联系
?管理
?订阅
随笔- 75? 文章- 0? 评论- 6?
分布式消息最终一致性事务
现在先抛出问题，假设有一个主数据中心在北京M，然后有成都A，上海B两个地方数据中心，现在的问题是，假设成都上海各自的数据中心有记录变更，需要先同步到主数据中心，主数据中心更新完成之后，在把最新的数据分发到上海，成都的地方数据中心A，地方数据中心更新数据，保持和主数据中心一致性（数据库结构完全一致）。数据更新的消息是通过一台中心的MQ进行转发。

先把问题简单化处理，假设A增加一条记录Message_A，发送到M，B增加一条记录 MESSAGE_B发送到M，都是通过MQ服务器进行转发，那么M系统接收到条消息，增加两条数据，那么M在把增加的消息群发给A，B，A和B找到自己缺失的数据，更新数据库。这样就完成了一个数据的同步。
从正常情况下来看，都没有问题，逻辑完全合理，但是请考虑以下三个问题
1 如何保证A->M的消息，M一定接收到了，同样，如何保证M->A的消息，M一定接收到了
2 如果数据需要一致性更新，比如A发送了三条消息给M，M要么全部保存，要么全部不保存，不能够只保存其中的几条记录。我们假设更新的数据是一条条发送的。
3 假设同时A发送了多条更新请求，如何保证顺序性要求？
这两个问题就是分布式环境下数据一致性的问题
对于第一个问题，比较好解决，我们先看看一个tcp/ip协议链接建立的过程

我们的思路可以从这个上面出发，在简化一下，就一个请求，一个应答。
简单的通信模型是这样的
A->M : 你收到我的一条消息没有，消息的ID是12345
M->A: 我收到了你的一条消息数据，消息数据是ID;12345
这样就一个请求，一个应答，就完成了一次可靠性的传输。如果A一致没有收到M的应答，就不断的重试。这个时候M就必须保证幂等性。不能重复的处理消息。那么最极端的情况是，怎么也收不到M的应答，这个时候是系统故障。自己检查一下吧。
这么设计就要求，A在发送消息的时候持久化这个消息的数据内容，然后不断的重试，一旦接收到M的应答，就删除这条消息。同样，M端也是一样的。不要相信MQ的持久化机制，不是很靠谱的。
那么M给A发送消息也采取类似的原理就可以了。
下面在看看第二个问题，如何保持数据的一致性更新，这个还是可以参考TCP/IP的协议。
首先A发送一条消息给M：我要发送一批消息数据给你，批次号是10000，数据是5条。
M发送一条消息给A：ok，我准备好了，批次号是10000，发送方你A
接着A发送5条消息给M，消息ID分别为1，2，3，4，5 ，批次号是10000，
紧接着，A发送一个信息给M：我已经完成5小消息的发送，你要提交数据更新了
接下来可能发送两种情况
1 那么M发送消息给A：ok，我收到了5条消息，开始提交数据
2 那么M也可以发送给A：我收到了5条消息，但是还缺少，请你重新发送，那么A就继续发送，直到A收到M成功的应答。
整个过程相当复杂。这个也就是数据一旦分布了，带来最大的问题就是数据一致性的问题。这个成本非常高。
对于第三个问题，这个就比较复杂了
这个最核心的问题就是消息的顺序性，我们只能在每个消息发一个消息的序列号，但是还是没有最好解决这个问题的办法。因为消息接收方不知道顺序。因为即使给他了序列号，也没有办法告诉他，这个应该何时处理。最好的办法是在第二种方式的基础作为一个批次来更新。
这个只是以最简单的例子来说明一下分布式系统的要保证数据一致性是一件代价很大的事情。当然有的博主会说，这个何必这么复杂，直接数据库同步不就可以了。这个例子当然是没有问题的，万一这个几个库的模型都不一样，我发送消息要处理的事情不一样的。怎么办？
在上文，简单的介绍了分布式数据的同步问题，上面的问题比较抽象，在目前的互联网应用中还很少见，这次在通过一个比较常见的例子，让大家更深入的了解一下分布式系统设计中关于数据一致性的问题
这次我们拿我们经常使用的功能来考虑吧，最近网购比较热门，就以京东为例的，我们来看看京东的一个简单的购物流程

用户在京东上下了一个订单，发现自己在京东的账户里面有余额，然后使用余额支付，支付成功之后，订单状态修改为支付成功，然后通知仓库发货。假设订单系统，支付系统，仓库系统是三个独立的应用，是独立部署的，系统之间通过远程服务调用。
订单的有三个状态：I:初始 P:已支付 W:已出库，订单金额100, 会员帐户余额200
如果整个流程比较顺利，正常情况下，订单的状态会变为I->P->W，会员帐户余额100，订单出库。
但是如果流程不顺利了？考虑以下几种情况
1：订单系统调用支付系统支付订单，支付成功，但是返回给订单系统数据超时，订单还是I（初始状态），但是此时会员帐户余额100,会员肯定会马上找京东骂京东，为啥不给老子发货，我都付钱了
2：订单系统调用支付系统成功，状态也已经更新成功，但是通知仓库发货失败，这个时候订单是P（已支付）状态，此时会员帐户余额是100,但是仓库不会发货。会员也要骂京东。
3：订单系统调用支付系统成功，状态也已经更新成功，然后通知仓库发货，仓库告诉订单系统，没有货了。这个时候数据状态和第二种情况一样。
对于问题一，我们来分析一下解决方案，能想到的解决方案如下
1 假设调用支付系统支付订单的时候先不扣钱，订单状态更新完成之后，在通知支付系统你扣钱
如果采用这种设计方案，那么在同一时刻，这个用户，又支付了另外一笔订单，订单价格200，顺利完成了整个订单支付流程，由于当前订单的状态已经变成了支付成功，但是实际用户已经没有钱支付了，这笔订单的状态就不一致了。即使用户在同一个时刻没有进行另外的订单支付行为，通知支付系统扣钱这个动作也有可能完不成，因为也有可能失败，反而增加了系统的复杂性。
2 订单系统自动发起重试，多重试几次，例如三次，直到扣款成功为止。
这个看起来也是不错的考虑，但是和解决方案一样，解决不了问题，还会带来新的问题，假设订单系统第一次调用支付系统成功，但是没有办法收到应答，订单系统又发起调用，完了，重复支付，一次订单支付了200。
假设支付系统正在发布，你重试多少次都一样，都会失败。这个时候用户在等待，你怎么处理？
3 在第二种方案的基础上，我们先解决订单的重复支付行为，我们需要在支付系统上对订单号进行控制，一笔订单如果已经支付成功，不能在进行支付。返回重复支付标识。那么订单系统根据返回的标识，更新订单状态。
接下来解决重试问题，我们假设应用上重试三次，如果三次都失败，先返回给用户提示支付结果未知。假设这个时候用户重新发起支付，订单系统调用支付系统，发现订单已经支付，那么继续下面的流程。如果会员没有发起支付，系统定时（一分钟一次）去核对订单状态，如果发现已经被支付，则继续后续的流程。
这种方案，用户体验非常差，告诉用户支付结果未知，用户一定会骂你，你丫咋回事情，我明明支付了，你告诉我未知。假设告诉用户支付失败，万一实际是成功的咋办。你告诉用户支付成功，万一支付失败咋办。
4 第三种方案能够解决订单和支付数据的一致性问题，但是用户体验非常差。当然这种情况比较可能是少数，可以牺牲这一部分的用户体验，我们还有没有更好的解决方案，既能照顾用户体验，又能够保证资金的安全性。
我们再回来看看第一种方案，我们先不扣钱，但是有木有办法让这一部分钱不让用户使用，对了，我们先把这一部分钱冻结起来，订单系统先调用支付系统成功的时候，支付系统先不扣钱，而是先把钱冻结起来，不让用户给其他订单支付，然后等订单系统把订单状态更新为支付成功的时候，再通知支付系统，你扣钱吧，这个时候支付系统扣钱，完成后续的操作。
看起来这个方案不错，我们仔细在分析一下流程，这个方案还存在什么问题，假设订单系统在调用支付系统冻结的时候，支付系统冻结成功，但是订单系统超时，这个时候返回给用户，告知用户支付失败，如果用户再次支付这笔订单，那么由于支付系统进行控制，告诉订单系统冻结成功，订单系统更新状态，然后通知支付系统，扣钱吧。如果这个时候通知失败，木有问题，反正钱都已经是冻结的了，用户不能用，我只要定时扫描订单和支付状态，进行扣钱而已。
那么如果变态的用户重新拍下来一笔订单,100块钱，对新的订单进行支付，这个时候由于先前那一笔订单的钱被冻结了，这个时候用户余额剩余100，冻结100，发现可用的余额足够，那就直接在对用户扣钱。这个时候余额剩余0，冻结100。先前那一笔怎么办，一个办法就是定时扫描，发现订单状态是初始的话，就对用户的支付余额进行解冻处理。这个时候用户的余额变成100，订单数据和支付数据又一致了。假设原先用户余额只有100，被冻结了，用户重新下单，支付的时候就失败了啊，的确会发生这一种情况，所以要尽可能的保证在第一次订单结果不明确的情况，尽早解冻用户余额，比如10秒之内。但是不管如何快速，总有数据不一致的时刻，这个是没有办法避免的。
第二种情况和第三种情况如何处理，下次在分析吧。
由于互联网目前越来越强调分布式架构，如果是交易类系统，面临的将会是分布式事务上的挑战。当然目前有很多开源的分布式事务产品，例如java JPA，但是这种解决方案的成本是非常高的，而且实现起来非常复杂，效率也比较低下。对于极端的情况：例如发布，故障的时候都是没有办法保证强一致性的。
在上文主要介绍了数据分布的情况下保证一致性的情况，在第二篇文章里面，我这里提出了三个问题
1.订单系统调用支付系统支付订单，支付成功，但是返回给订单系统数据超时，订单还是I（初始状态），但是此时会员帐户余额100,会员肯定会马上找京东骂京东，为啥不给老子发货，我都付钱了
2.订单系统调用支付系统成功，状态也已经更新成功，但是通知仓库发货失败，这个时候订单是P（已支付）状态，此时会员帐户余额是100,但是仓库不会发货。会员也要骂京东。
3.订单系统调用支付系统成功，状态也已经更新成功，然后通知仓库发货，仓库告诉订单系统，没有货了。这个时候数据状态和第二种情况一样。
重点分析解决了第一个的问题以及相应的方案，发现在数据分布的环境下，很难绝对的保证数据一致性（任何一段区间），但是有办法通过一种补偿机制，最终保证数据的一致性。
在下面在分析一下第二个问题
订单系统调用支付系统成功，状态也已经更新成功，但是通知仓库发货失败，这个时候订单是P（已支付）状态，此时会员帐户余额是100,但是仓库不会发货。会员也要骂京东。
通过在上一篇文章里面分析过，这个相对来说是比较简单的，我可以采取重试机制，如果发现通知仓库发货失败，就一致重试，
这里面有两种方式：
1 异步方式：通过类似MQ（消息通知）的机制，这个是异步的通知
2 同步调用：类似于远程过程调用
对于同步的调用的方式，比较简单，我们能够及时获取结果，对于异步的通知，就必须采用请求，应答的方式进行，这一点在（关于分布式系统的数据一致性问题(一)）里面有介绍。这里面就不再阐述。
来看看第三个问题
订单系统调用支付系统成功，状态也已经更新成功，然后通知仓库发货，仓库告诉订单系统，没有货了。这个时候数据状态和第二种情况一样。
我觉得这是一个很有意思的问题，我们还是考虑几种解决的方案
1 在会员下单的时刻，就告诉仓库，我要你把货物留下来，
2 在会员支付订单时候，在支付之前检查仓库有没有货，如果没有货，就告知会员木有货物了
3 如果会员支付成功，这个时候没有货了，就会退款给用户或者等待有货的时候在发货
正常情况，京东的仓库一般都是有货的，所以影响到的会员很少，但是在秒杀和营销的时候，这个时候就不一定了，我们考虑假设仓库有10台iphone
如果采用第一种方案，
1 在会员下单的时候，相当于库存就-1，那么用户恶意拍下来，没有去支付，就影响到了其他用户的购买。京东可以设置一个订单超时时间，如果这段时间内没有支付，就自动取消订单
2 在会员支付之前，检查仓库有货，这种方案了，对于用户体验不好，但是对于京东比较好，至少我东西都卖出去了。那些没有及时付款的用户，只能投诉了京东无故取消订单
3 第三种方案，这个方案体验更不好，而且用户感觉受到京东欺诈，但是对于京东来说，比第二种方案更有益，毕竟我还可以多卖出一点东西。
个人觉得，京东应该会采用第二种或者第三种方式来处理这类情况，我在微博上搜索了 “京东 无故取消订单”，发现果真和我预料的处理方式。不过至于这里的无故取消是不是技术上的原因我不知道，如果真的是技术上的原因，我觉得京东可以采用不同的处理方案。对于秒杀和促销商品，可以考虑第一种方案，大多数人都会直接付款，毕竟便宜啊，如果用户抢不到便宜的东西，抱怨当然很大了。这样可以照顾大多数用户的体验。对于一般的订单，可以采用第二种或者第三种方式，这种情况下，发生付款之后仓库没有货的情况会比较少，并且就算发生了，用户也会觉得无所谓，大不了退钱吗，这样就可以实现自己的利益最大化而最低程度的减少用户体验。

而铁道部在这个问题上，采用的是第一种方案，为什么和京东不一样，就是因为用户体验，如果用户把票都买了，你告诉我木有票了，旅客会杀人的。哈哈，不过铁道部不担心票卖不出去，第一种方案对他影响没有什么。
说了这么多，就是说 分布式环境下（数据分布）要任何时刻保证数据一致性是不可能的，只能采取妥协的方案来保证数据最终一致性。这个也就是著名的CAP定理。
在前面三篇文章中，介绍了关于分布式系统中数据一致性的问题，这一篇主要介绍CAP定理以及自己对CAP定理的了解。
CAP定理是2000年，由 Eric Brewer 提出来的
Brewer认为在分布式的环境下设计和部署系统时，有3个核心的需求，以一种特殊的关系存在。这里的分布式系统说的是在物理上分布的系统，比如我们常见的web系统。
这3个核心的需求是：Consistency，Availability和Partition Tolerance，赋予了该理论另外一个名字 － CAP。
Consistency：一致性，这个和数据库ACID的一致性类似，但这里关注的所有数据节点上的数据一致性和正确性，而数据库的ACID关注的是在在一个事务内，对数据的一些约束。
Availability：可用性，关注的在某个结点的数据是否可用，可以认为某一个节点的系统是否可用，通信故障除外。
Partition Tolerance：分区容忍性，是否可以对数据进行分区。这是考虑到性能和可伸缩性。
为什么不能完全保证这个三点了，个人觉得主要是因为一旦进行分区了，就说明了必须节点之间必须进行通信，涉及到通信，就无法确保在有限的时间内完成指定的行文，如果要求两个操作之间要完整的进行，因为涉及到通信，肯定存在某一个时刻只完成一部分的业务操作，在通信完成的这一段时间内，数据就是不一致性的。如果要求保证一致性，那么就必须在通信完成这一段时间内保护数据，使得任何访问这些数据的操作不可用。
如果想保证一致性和可用性，那么数据就不能够分区。一个简单的理解就是所有的数据就必须存放在一个数据库里面，不能进行数据库拆分。这个对于大数据量，高并发的互联网应用来说，是不可接受的。
我们可以拿一个简单的例子来说明：假设一个购物系统，卖家A和卖家B做了一笔交易100元，交易成功了，买家把钱给卖家。
这里面存在两张表的数据：Trade表Account表 ，涉及到三条数据Trade(100),Account A ,Account B
假设 trade表和account表在一个数据库，那么只需要使用数据库的事务，就可以保证一致性，同时不会影响可用性。但是随着交易量越来越大，我们可以考虑按照业务分库，把交易库和account库单独分开，这样就涉及到trade库和account库进行通信，也就是存在了分区，那么我们就不可能同时保证可用性和一致性。
我们假设初始状态
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,I)
account(accountNo,balance) = account(A,300)
account(accountNo,balance) = account(B,10)
在理想情况下，我们期望的状态是
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,S)
account(accountNo,balance) = account(A,200)
account(accountNo,balance) = account(B,110)
但是考虑到一些异常情况
假设在trade(20121001,S)更新完成之前，帐户A进行扣款之后，帐户A进行了另外一笔300款钱的交易，把钱消费了，那么就存在一个状态
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,S)
account(accountNo,balance) = account(A,0)
account(accountNo,balance) = account(B,10)
产生了数据不一致的状态
由于这个涉及到资金上的问题，对资金要求比较高，我们必须保证一致性，那么怎么办，只能在进行trade(A,B,20121001)交易的时候，对于任何A的后续交易请求trade(A,X,X)，必须等到A完成之后，才能够进行处理，也就是说在进行trade(A,B,20121001)的时候，Account(A)的数据是不可用的。
任何架构师在设计分布式的系统的时候，都必须在这三者之间进行取舍。首先就是是否选择分区，由于在一个数据分区内，根据数据库的ACID特性，是可以保证一致性的，不会存在可用性和一致性的问题，唯一需要考虑的就是性能问题。对于可用性和一致性，大多数应用就必须保证可用性，毕竟是互联网应用，牺牲了可用性，相当于间接的影响了用户体验，而唯一可以考虑就是一致性了。
牺牲一致性
对于牺牲一致性的情况最多的就是缓存和数据库的数据同步问题，我们把缓存看做一个数据分区节点，数据库看作另外一个节点，这两个节点之间的数据在任何时刻都无法保证一致性的。在web2.0这样的业务，开心网来举例子，访问一个用户的信息的时候，可以先访问缓存的数据，但是如果用户修改了自己的一些信息，首先修改的是数据库，然后在通知缓存进行更新，这段期间内就会导致的数据不一致，用户可能访问的是一个过期的缓存，而不是最新的数据。但是由于这些业务对一致性的要求比较高，不会带来太大的影响。
异常错误检测和补偿
还有一种牺牲一致性的方法就是通过一种错误补偿机制来进行，可以拿上面购物的例子来说，假设我们把业务逻辑顺序调整一下，先扣买家钱，然后更新交易状态，在把钱打给卖家
我们假设初始状态
account(accountNo,balance) = account(A,300)
account(accountNo,balance) = account(B,10)
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,I)
那么有可能出现
account(accountNo,balance) = account(A,200)
trade(buyer,seller,tradeNo,status) = trade(A,B,20121001,S)
account(accountNo,balance) = account(B,10)
那么就出现了A扣款成功，交易状态也成功了，但是钱没有打给B，这个时候可以通过一个时候的异常恢复机制，把钱打给B，最终的情况保证了一致性，在一定时间内数据可能是不一致的，但是不会影响太大。
两阶段提交协议
当然，还有一种方式就是我另外一篇文章里面《X/Open DTP-分布式事务模型》里面说的，但是再第一阶段和第二阶段之间，数据也可不能是一致性的，也可能出现同样的情况导致异常。而且DTP的分布式事务模型 限制太多，例如必须有实现其功能的相关的容器支持，并且资源管理器也必须实现了XA规范。限制比较多。
国外有的架构师有两种方案去解决CAP的限制，但是也是比较适合特定的业务，而没有通用的解决方案，
探知分区->分区内操作->事后补偿

就是上面介绍的异常检测恢复机制，这种机制其实还是有限制，
首先对于分区检测操作，不同的业务涉及到的分区操作可能不一样
分区内操作限制：不同的业务对应的约束不一致
事后补偿：由于业务约束不一样，补偿方式也不一样。
所以这只能作为一种思想，不能做一个通用的解决方案
分类:?JAVA相关,系统架构
好文要顶?关注我?收藏该文??

Bright Moon ‘ s Blog
关注 - 12
粉丝 - 17
+加关注
5
0
??上一篇：Nginx+Tomcat服务器环境中配置https访问
??下一篇：分布式最终一致方案梳理
posted @?2016-06-28 10:46?Bright Moon ‘ s Blog?阅读(13728) 评论(1)?编辑?收藏

评论
??
#1楼?2018-09-18 19:48?|?doucequan??
虽然看不太明白，但是好像很厉害的样子。
支持(0)反对(0)
刷新评论刷新页面返回顶部
注册用户登录后才能发表评论，请?登录?或?注册，访问网站首页。
【推荐】超50万C++/C#源码: 大型实时仿真HMI组态CAD\GIS图形源码！
【推荐】专业便捷的企业级代码托管服务 - Gitee 码云
相关博文：
·?如何用消息系统避免分布式事务？
·?分布式系统事务一致性解决方案
·?分布式消息最终一致性事务
·?分布式消息最终一致性事务
·?分布式事务最终一致性常用方案
最新新闻：
·?互联网裁员阴影下，如何避免成为那只“火鸡？”
·?俞敏洪：创办新东方的25年告诉了我这9点经验
·?亏损扩大的爱奇艺，股价为何不降反涨？
·?硅谷创业传奇：我对自己没能打造一家独角兽的思考
·?高调宣布不裁员的阿里 为何不去清华招人？
??更多新闻...
昵称：Bright Moon ‘ s Blog
园龄：6年
粉丝：17
关注：12
+加关注
<	2019年2月	>

日	一	二	三	四	五	六
27	28	29	30	31	1	2
3	4	5	6	7	8	9
10	11	12	13	14	15	16
17	18	19	20	21	22	23
24	25	26	27	28	1	2
3	4	5	6	7	8	9
搜索
?
?
常用链接
?我的随笔
?我的评论
?我的参与
?最新评论
?我的标签
?
随笔分类
?C#相关(10)
?Hibernate(7)
?JAVA相关(24)
?JSP(2)
?linux(16)
?Spring(1)
?Struts2(9)
?windows OS(3)
?服务器(12)
?人生感悟(3)
?设计模式(1)
?手机web(3)
?数据库相关(9)
?系统架构(13)
随笔档案
?2016年7月 (1)
?2016年6月 (2)
?2016年5月 (1)
?2015年12月 (1)
?2015年11月 (1)
?2015年8月 (2)
?2015年5月 (2)
?2015年4月 (3)
?2015年2月 (1)
?2015年1月 (2)
?2014年12月 (8)
?2014年11月 (1)
?2014年10月 (2)
?2014年9月 (4)
?2014年7月 (6)
?2014年6月 (1)
?2014年4月 (2)
?2014年3月 (1)
?2014年1月 (2)
?2013年12月 (1)
?2013年11月 (1)
?2013年10月 (1)
?2013年9月 (1)
?2013年8月 (1)
?2013年7月 (2)
?2013年6月 (2)
?2013年4月 (7)
?2013年3月 (2)
?2013年2月 (14)
最新评论
?1. Re:大多数程序员单身的原因（转）
?赞一个
?--魅影独秀
?2. Re:分布式消息最终一致性事务
?虽然看不太明白，但是好像很厉害的样子。
?--doucequan
?3. Re:Linux下添加新硬盘,分区及挂载
?给个赞！！！！
?--园芳宝贝
?4. Re:写给我们这些浮躁的程序员
?@马非码对啊...
?--Bright Moon ‘ s Blog
?5. Re:写给我们这些浮躁的程序员
?写得非常到位、全面，写出了我想要做的和正在做的
?--马非码
阅读排行榜
?1. 分布式消息最终一致性事务(13728)
?2. freemarker快速上手+空值+三元运算的多种处理方法(12438)
?3. 分布式最终一致方案梳理(3728)
?4. hibernate：通用DAO+动态生成HQL语句(2603)
?5. linux 二进制安装mysql(1352)
评论排行榜
?1. 写给我们这些浮躁的程序员(2)
?2. C# 读取XML文件和写入XML文件(1)
?3. 分布式消息最终一致性事务(1)
?4. Linux下添加新硬盘,分区及挂载(1)
?5. 大多数程序员单身的原因（转）(1)
推荐排行榜
?1. 分布式消息最终一致性事务(5)
?2. 分布式最终一致方案梳理(2)
?3. Linux下添加新硬盘,分区及挂载(1)
?4. C#（利用c#制作托盘程序，并禁止多个应用实例运行）(1)
?5. 大多数程序员单身的原因（转）(1)
Copyright ?2019 Bright Moon ‘ s Blog
