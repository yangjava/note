[TOC]

### 第四方到底怎么过？方法论来了：你有你的支付牌照 我有我的渠道

本文主要是与大家分享一种支付宝渠道服务商的的业务模式，这种业务模式对没能拿到支付牌照且有资源的公司或企业来说具有普适性;但前提是能够获得支付宝或者微信的的渠道服务商资格(简称isv，本文以支付宝的isv为例子进行阐述)，且能在各大银行中混得开，以求得结算通道。

![img](http://paynews.net/data/attachment/portal/201801/26/104809y5hfys8y59n5y1e5.png)



　　下图为行文的顺序：首先介绍有关支付宝渠道服务商的相关知识，譬如相关概念、接口等;其次会以一种集成了支付宝三个接口的综合支付运营系统为例，具体阐述相关业务的始末。希望能给大家带来些许不一样的视角。

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809fwof5z5oagwaawsz.jpeg)



　　支付宝ISV

　　支付宝ISV(也称系统开发商)可代支付宝完成商家签约、当面付集成、优惠活动配置的主体，为商户提供线下支付宝收款、入驻口碑、发布折扣和支付宝商家服务窗等服务。

　　就个人理解而言，支付宝isv渠道商一般都是具有独立软件研团队的公司和企业。说穿了，这种公司存在的理由无非是在支付宝有一定的资源，靠着关系拿到了支付宝的几个接口，面向某一邻域的商户，为其提供商业变现的解决方案，并从中拿到分润。具体业务模式如下：

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809p80bd0wptlkdtgbe.png)



　　1、首先，公司或者企业必须获得支付宝的承认，与支付宝签订N年的渠道服务商，其中必须明确其后系统集成的支付接口的详情;并同时设置支付的对应接口的费率，每个接口都对应设置。一般：支付宝app为1.0、支付宝wap1.0、支付宝即时到账0.6。

　　2、然后，公司必须能够与一家银行合作，为商户解决每日的结算款的处理问题，同时也避免了二清。这其中，系统与银行端的交互基本上是相关的接口请求与响应。

　　3、其次，如果公司的资源很多，能够拓展数以千计甚至万计的商户，此时可以想“代理链条”模式。

　　此模式能够在很大程度上将系统的交易额提升到一个客观的高度，且能“借他人之手”来管理商户，一举两得。

　　4、最后，也是最最关键的，任何商业活动最终都会与“钱”挂钩，支付更不例外。因此，在设定支付宝成本费率的同时，公司也会与代理商签订合同，合同中就包含对应的代理商对应三个接口的费率;而商户则会与被其拓展的代理商进行合同签约，此时也会设定商户费率。而这三个费率必须满足一下关系：支付宝成本费率 ≤ 代理商陈本费率 ≤ 商户成本费率支。(此外，商业银行对每笔订单也会收取对应的手续费)否则，系统结算就会行不通。具体费率计算会在下一章节的结算中给出具体的计算公式。

　　5、支付上下游各方收取的手续费总和为商户被扣的手续费。

　　(ps：商业的本质其实是钱与服务发生了关系的存在)

　　线上支付系统

　　该系统集成了支付宝线上三种接口：支付宝即时到账、支付宝wap、支付宝app，其本身就是一个功能齐全、业务逻辑复杂的后台运营系统。可以理解为一个CRM为过，因为该系统确实管理和运营者支付下游代理商、商户的关系。如下图，为线上支付系统的元素介绍。其中商户平台通过代理商平台与运营平台发生简介数据流关系。

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809n71g7n1xxgidi79z.png)



　　系统操作权限解析

　　不管是怎样的系统，都会设计到账号登录。针对这种复杂的业务系统，登录权限设计更是必不可少。本系统主要采用“分而治之”的设计思想，大致思路如下：

　　从一个超级管理员账号出发，在运营平台为代理商创建账号;

　　然后，代理商用全局唯一的账号登录代理商平台，然后再为次代理商创建不同系统角色的用户来管理用户;

　　最终，商户的登录账号由代理商平台商户报件时自动生成。

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809y5axw1x33b5u3xen.png)



　　整个支付运营系统的功能分为四个部分：(代理商开户)商户报件、支付(开发面向下游商户的三个支付接口)、渠道对账、商户结算。如下具体的泳道图。

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809pf8euuaizh8fi0f0.png)



　　代理商开户

　　运营人员为代理商进行开户操作流程如下：

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809kkfigv7kqfgkfqnu.png)



　　代理商需要与企业签订相关协议，其中协议的主要内容包含所用支付接口的个数、接口费率等;

　　代理商签订合同后，会在相应时间里将代理商公司的企业信息、绑卡信息、费率信息以文档的形式提交给运营人员;然后由运营人员在系统进行录入、审核;审核通过后会为该代理商创建登录账号，方便代理商登录代理商系统。

　　商户报件

　　商户报件也即商户入驻：

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809b0b7d2bh9uz2u0mw.png)



　　商户入驻平台类似大学生入学，你得提供相关个人信息(身份证、手机号等)，由学校相关人员(运营人员)将你的信息录入教务系统，然后审核通过后，为你生成全局唯一的学号(商户编号)。

　　商户入驻平台时填报的信息包含：法人基本信息、费率信息、绑卡信息。

　　此操作需要代理商在代理商平台进行页面表单填报操作。

　　因为对接的是支付宝的交易接口，因此商户报件的基本信息要提交到支付宝后天进行审核。在整个过程中会调用支付宝黑名单查询接口和支付宝间连商户入驻接口。

　　支付

　　提供给下游商户的额接口包括支付宝即时到账支付、支付宝WAP支付、支付宝APP支付。

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809ccc515ccz5x1x11k.png)



　　描述：

　　用户通过商户平台下单，商户系统确认订单后对订单信息进行MD5加密，然后通过网络上传至代理商系统;

　　代理商系统也采用类似的加密方法，对商户订单进行验证，然后将加密的订单信息向上游传递;

　　运营管理系统接收到下游订单，也会采用加密机制进行验证，确认后，系统向代理商系统返回支付页面的URL;紧接代理商系统向商户系统传递URL，最终由商户系统向用户展示URL对应的支付界面;

　　商户直接与支付宝收银台交互：输入支付密码，提交支付申请后，支付宝系统确认支付成功。

　　支付宝确认支付成功后，首先会回调支付结果给企业运营平台，然后再由企业运营平台回调给代理商系统。完成整个支付流程。

　　对账

　　设计到该支付系统的对账为渠道对账。

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809kw7cek99se9c90tn.png)



　　本系统的渠道对账是指在当天某个时间通过网络协议从支付宝获取前一天平台的交易订单信息(支付宝商户号、支付订单号、商户订单号、交易金额、支付渠道、支付时间等)，一般以excel的形式从服务器上获取。

　　获取渠道对账文件后，将其与平台数据库订单表里的前天交易流水进行一一比对，判断订单是否出现问题(包含：无误、长款、短款、金额不一致)

　　长款指运营平台有此笔订单而渠道对或者那个文件里却没有。造成的原因主要是发生日切的情况下(23：59：00)，平台记录了商户提交了订单，但由于用户未能及时支付;等到支付后，时间可能来到了第二天00：10：01。此时，同一笔交易就跨越了两个时间维度(今天和明天)。

　　对于长款的处理一般会将平台的长款订单进行逻辑处理，使其在明天的对账过程中再次举行对账。

　　一般短款、和金额不一致的情况几乎不可能发生，平台可不做处理。

　　另外，当日对账完成后，系统可以生成对应的报表，其中典型的是对账差异报表。

　　结算

　　说到结算，可能很多小伙伴们会比较兴奋;因为，经过前面的一些“播种”、“施肥”操作，终于到了丰收的时候。其实，结算就是通过银行通道将商户每天的扣除手续费后的交易额打到商户的结算卡上的一个过程。如果细心的话，这里的提到的“结算卡”就是商户报件时提到的结算卡。

　　下面的费率计算公式完全可以为ni所用：

　　

![img](http://paynews.net/data/attachment/portal/201801/26/104809ehomkoxo3hfknjfv.png)



　　诚然，支付系统是一个以业务为主导的互联网产品。如上叙述的支付渠道“贩子”(运营)系统，对接的外部系统多、业务模块复杂;那么相应的，具体涉及到某个业务的细节，也是能够喝上一壶的。因此，这里由于篇幅的原因，就不具体详述业务深处细节。希望感兴趣的pm们一起探讨。

## 电商系统：对账设计

> 本文所描述的对账，非金融机构内部的对账场景。适用于公司自研以及采购的类电商系统，在此种场景下，平台背后支付渠道可能对接微信、支付宝亦或者是其他第三方聚合支付公司的通道。

![img](http://image.woshipm.com/wp-files/2019/08/w8fVkIhcKAhM3KJCYGvc.jpg)

## 一、支付系统综述

在如下图体系中，对账的目的是保障如下的等式成立：

**客户支付的钱-支付渠道手续费=应结账款**

![img](http://image.woshipm.com/wp-files/2019/08/SmPomUaxwI2D2CKxrndL.png)

有些渠道因为根据结算周期不一样或者其他运营因素，结算需要手续费。此种情况：应结账款-结算手续费=到账金额。

在一个完整的电商交易平台中，还会涉及折扣、积分兑换、满减、余额等支付场景，而且其中又夹杂多商户聚合支付。这种场景会让新入行的小伙伴手足无措。

以上两种场景的逻辑不应该放支付系统（支付模块）处理，而是应该放在交易模块的订单管理子模块处理。

支付系统只关注实付金额的处理，一笔订单的订单金额、折扣等都不是支付系统关心的。在一个复杂的电商系统中（淘宝、京东、亚马逊），交易模块的核心工作之一就是处理好业务订单和支付订单的关系。

业务订单的核心属性：业务订单编号、下单日期、订单金额、订单状态、折扣信息、商户信息、客户信息。

支付订单的核心字段：支付订单编号、业务订单编号、支付时间、支付金额、商户信息、支付状态。

## 二、对账综述

明白了支付系统的定位和分工，在对账阶段所要关注的核心工作也就清楚了。

![img](http://image.woshipm.com/wp-files/2019/08/lGnxqxR321NXEHK7oo56.png)

对账主要是保证三项数据的一致性：支付订单、支付流水、渠道流水。

这三项是分别是业务系统、支付系统、支付渠道的支付主数据，保证三者的ID关系和状态吻合既保证了支付流程的正确性。而渠道需要保障的渠道流水中的应结金额和实际结算金额的一致性，这个是支付渠道内部对账需要解决的问题。

第一阶段对账中会涉及会员积分的核销、运营折扣的匹配所以后期会专题分享；第二阶段与第三阶段很像，都是根据下游系统生产的对账文件和本地的订单或者流水核对。详细对账流程看下节。

## 三、对账流程

如下图，一般对账文件都是隔日才会生成，因为需要下游系统每日处理完前日的内部对账后才会生成给上游的对账文件。

![img](http://image.woshipm.com/wp-files/2019/08/ubRFyqc2e4FLp0KeZ01c.png)

1. **获取对账文件：**格式化存储，原始数据所有字段均存储；
2. **创建对账批次：**因为有些系统涉及商户很多或者对接多个支付渠道，所以可以根据实际需求创建对账批次易于分类管理。常见以日期为一批次。但是下游对账文件出问题时，可能需要当日需要再重新创建批次亦或是全量覆盖；
3. **对账处理：**从格式化的对账文件中抽取六流水号、类型、状态、金额、商户号等关键字段和本系统的订单匹配；
4. 如果 ID+金额+状态 一致，则该笔订单直接核销，打上对账标记。

ID 指发送请求给下游时，下游返回存储在本系统的唯一主键。

对于不一致的场景会有三种情况，分别对应不同处理方案：

1. 本地有ID，下游有ID；可以匹配但是状态不对；调用状态查询接口同步状态；
2. 本地有ID，下游无ID；根据ID查下游订单；
3. 本地无ID，下游有ID；根据ID查本地订单，或查询日志。

差错处理这一块，在实际涉及中，建议预留好人工处理的工具，等运行稳定后再根据实际情况把一些频繁出现的场景通过系统自动处理。

## 四、总结

本文中的对账针对场景是类电商系统和支付系统以及支付渠道之间的订单对账，并没有涉及钱包、资金托管模式下的财务对账。

本文提供的方法也主要是从业务需求出发，解决当平台的交易流程比较复杂的情况下，怎么保证订单信息、支付信息一致性的问题。

其他关于资金流水、应结资金、结算资金设计和财务ERP、企业网银（通过银企互联获取账户流水）的对账，后续文章在一一介绍。

## 支付系统架构设计（上）


 本文描述的支付系统作为整个电商系统的一部分，也可以作为独立的支付系统对接多个前端业务系统。各公司应根据自身业务发展和规划进行取舍，不可照搬。

![img](http://image.woshipm.com/wp-files/2019/08/5wMd7tulDp0xYfdeU5I9.jpg)

## 综述

支付是任何商业模式变现的最后一公里，是业务流程闭环的关键一环。

本文涉及的支付系统沿袭[《电商系统：对账设计》](http://www.woshipm.com/pd/2725585.html)第一节的描述，支付系统和业务系统解耦处理。业务系统关注商品、库存、交易流程、运营服务等。而支付系统要关注支付流程的完整性、**业务合规性**以及**技术可实现性**。

因为支付行业有各种监管规定，尤其是涉及跨境电商更加复杂。支付系统要兼并合规性、易用性、安全性为一体，在前期设计时一定要综合考虑。

![img](http://image.woshipm.com/wp-files/2019/08/vavlY2LplQlTj6otG28g.png)

上图为通用支付系统的架构参考。不同的业务模式和需求可以按照不同的维度分层和功能划分。（关键在于根据实际需求取舍，不可照搬）下面将对各个层级做详细介绍。

## 前台应用层

这一层主要是面向客户，由业务系统的类型决定。通俗说法就是客户支付的场景是什么样的。不同的支付渠道会有各自的支付产品来满足各种场景。

如：微信渠道提供的[支付产品【JSAPI支付】](https://pay.weixin.qq.com/static/product/product_intro.shtml?name=jsapi)就可以满足线下扫码、公众号、PC网站（web）三种场景。

移动应用（安卓、IOS）场景下，微信和支付宝分别提供有APP支付产品。（详情点击图片）

![img](http://image.woshipm.com/wp-files/2019/08/IaRlvSFKM8eCPGi8zaEe.png)

![img](http://image.woshipm.com/wp-files/2019/08/wGWFPWzJ76Wu1y16RDH3.png)

前台应用层的主要目的是帮助产品在设计支付系统时，理清业务所涉及的收款场景和系统类型。

## API接入层：

这一层主要是面向各个业务系统。比如接口权限、数据权限、紧急止付、快速冻结等。

当业务系统和支付系统非一个网段内，是不是要考虑白名单，以及控制不同应用只能操作应用范围内的商户。尤其是中国人民银行于今年（2019）下发[《关于进一步加强支付结算管理防范电信网络新型违法犯罪有关事项的通知》（银发[2019\]85号）](http://www.pbc.gov.cn/tiaofasi/144941/3581332/3804753/index.html)后，这一块尤其关键。

这一层可以参考银联、微信支付、支付、连连支付等公司开放平台的技术规范。

## 接入服务层

这一层的核心在于梳理清楚对外（业务系统）输出的能力范围。

通俗理解为api功能，当然也可以通过微服务的服务注册来实现。

![img](http://image.woshipm.com/wp-files/2019/08/9uBUgDv8O4S28pNG4cB4.png)

### 商户服务

**入网：**

商户签约流程（入网、建档、进件）：线上还是线下，需要哪些资料，是否需要签合同盖章等；如果商户入网需要和支付渠道直接签约，那此处的入网能力就没有，直接提供页面给商户，录入支付参数信息即可。（目前服务商版微信APP支付需要商户自己去微信申请）

**结算、提现：**

担保交易场景下，就会涉及针对订单的指令清算（类似确认收货后订单才完成）。有些支付渠道给商户结算的资金并非直接到商户的银行卡，而是结算到商户在渠道开的钱包。很多时候大家所说的结算，本质上是提现流程中的结算，而非交易流程的结算。因为交易流程的结算在资金到钱包时已经完成。

**充值：**

当支付系统涉及B2B支付场景，比如租金缴纳、供应链金融等，会涉及付款方商户充值。有些企业2B业务比较多，通过企业钱包（一般通过银行托管账户实现）使付款充值到钱包，收款方主动（自动或者手动）划扣，达到线上核销。（B2B场景后续会专题讨论，此为业财一体化核心环节）

还有一种场景就是商户入住平台需要交纳保证金。商户充值后，平台方冻结该笔资金。

**账单：**

此处账单泛指可以根据商户需要，同步商户的支付订单、订单流水、资金流水等信息。（请参考：[《电商系统：记账设计之订单管理、流水管理》）](http://www.woshipm.com/pd/2737301.html)

**分账：**

分账在此暂不介绍，后续文章专题讨论。

### 应用服务

应用服务比较简单，一般涉及如下几点：

**支付渠道管理：**参考下文【网关服务】。

**支付产品选择：**取决于业务系统类型和支付渠道，参考【前台应用层】。

**应用参数管理：**支付渠道校验业务系统的有效性，确保通道不被滥用。

- APP支付需要配置微信开放平台注册申请的appid或者支付宝开放平台的APPID；
- 小程序、公众号需要配置微信公众平台的appid；
- 公众号需要配置支付目录；
- PC网站、手机H5 需要提交备案域名；
- 等……

**商户层级管理：**有些应用会涉及多商户，应用需要维护商户层级关系。

### 个人服务

如果支付系统不涉及钱包服务，就不会有充、提、转、支、收，借贷、白条这个服务也不好承载。常见钱包可以分为实体钱包和虚拟钱包（通俗叫法）。

**实体钱包（支付渠道管理钱包及其账务）：**

通过接口提交资料在支付渠道侧开设钱包，前提是支付渠道必须有相关牌照。目前市场上钱包多种形式，一般有如下几种类型：

- 实名制预付卡包装成线上钱包（也可以是内部两个账户打通）。需要有预付卡牌照和互联网支付牌照，很多商场、园区APP即是这种，和实体一卡通打通。
- 虚拟账户（美团、支付宝余额、微信余额）
- 银行托管账户开设子账户（摩拜、P2P产品）
- 银行二类户、三类户包装（华为钱包、部分券商软件余额）

![img](http://image.woshipm.com/wp-files/2019/08/nVbrf8HrBU3YGvP0U0Db.png)

余额宝、微信零钱通，不属于余额，属于购买的基金理财产品。其性质和券商软件的股票资产、P2P持有资产类似，属于最广义的货币供应量(M3)。

实体钱包在开户时会根据实名验证的强度对钱包的额度、用途、范围、时效等有所限制。

**虚拟钱包（本地系统管理钱包及其账务）：**

这种只适用于公司内部充值、消费使用。比如有些食堂、连锁餐厅、理发、健身房等，皆是如此，在用户充值时，钱已到了商家的结算卡。这种钱包一般是无法提现的。

## 总结

做支付系统一定不能脱离实际业务场景，更不能照搬其他公司方案。核心在于理清业务场景（决定支付产品的选择）、商户类型（决定入网流程、分账需求、结算类型），然后选择合适的支付渠道。可以选择微信、支付宝直连通道、可以选择其服务商、聚合支付供应商。

对接银行或者银联商务的快捷支付、认证支付也是选择之一。如果没有精力做一整套的支付系统，市场上有可选择的“第四方支付”提供的SAAS服务。

接下来将分享**分账、业务服务、网关服务、清算&账务服务**，以及支付中心**运营管理平台**（web后台）的设计。

## 支付产品经理入门（1）行业各角色分析

> 本事作者梳理分析了支付体系内的各种概念和角色分工，希望通过此文能够加深你对支付行业的认识。

![img](http://image.woshipm.com/wp-files/2019/11/v8W785vwTbK5hInISSnn.jpg)

很多刚刚入门支付领域的产品经理，一定会被整个支付体系的各种概念搞的眼花缭乱。

而各个公司的场景又不一样，各位产品经理不仅要满足当前业务需求，还需要面对层出不穷的监管政策，和未来发展方向，这样理解和抓住支付系统的本质至关重要。本文为系列文章第一篇，主要普及一下整个支付行业各个角色的分工。

支付，天天都在用。可是当你自己去设计系统来支撑时，又不知从何入手。市场上众多的供应商提供的各种解决方案，看起来差不多，但是又觉得不一样。到底问题出在哪里呢？

主要的问题在于，当前我们所要面对的支付行业是一个生态组织，是一个有分工、合作、竞争的组织。各个公司在自己的领域扎根，摸爬滚打，找到自己的一席之地生存下来。所以你所接触的“支付公司”他们很多根本不是同一个物种，他是是整个支付生态的独立物种。有着自己的上下游合作，有着自己的竞争对手。

![img](http://image.woshipm.com/wp-files/2019/11/l99cgvOVB80YERbKiHey.png)

整体来说，整个支付生态可以分为如上几个角色。

## 一、监管机构

- 中国人民银行（央行）
- 银保监会（银监会、保监会）
- 证监会
- 其他监管（商务部、国家外汇管理局、中国支付清算协会、银联、网联等）

**他们是制定行业规则和规定的，以及执行奖惩措施。是裁判员。**

如果仅仅是支付场景的参与方，那么核心就是人行和支付清算协会。如果涉及跨境支付、线上保险、基金等业务，那就会涉及更多的监管部门。更多监管参考下图：

![img](http://image.woshipm.com/wp-files/2019/11/NfkqUamUKMwKy5xNxzHc.jpg)

## 二、清算机构

国内和我们理解的支付相关的就是银联、网联。这里要注意，不要把【银联】和【银联商务】搞混了。

【银联云闪付】和【银联商务】是业务应用，是银联的亲儿子而已。

> 还记得之前的“断直连”吗？说马云找银联，银联不理他，他就做了支付宝。支付宝在断直连之前，等于就做了一部分清算机构的活。所以这种模式是不允许的。

银联主要是做跨银行间的资金清算，比如你拿浦发信用卡去刷建行的POS，就需要银联清算。

网联主要做第三方支付机构和银行间的资金清算，比如你通过支付宝转钱到银行卡，就需要过网联。

参考文章：[《支付系统设计：资金流、信息流、清算、结算》](http://www.woshipm.com/pd/2762835.html)

## 三、资金通道资金归集

即使你用微信支付宝，那最原始的钱也得是绑卡吧，商户收的钱，最后也得结算到他的银行卡吧。所以银行是最终的资金通道。

有些涉及分账和资金托管的，就需要找银行来做。

参考文章：[《支付系统架构设计：分账》](http://www.woshipm.com/pd/2756616.html)

## 四、预付卡

比如我们用的公交卡，就属于预付卡，属于指定业务范围和地域范围的预付卡。比如香港的八达通可以去超市买东西，那就是多用途预付卡。深圳的公交卡只能坐公交和地铁，那就是指定区域的预付卡。现在有些城市公交卡可以跨城市使用，那就是跨地域预付卡。

现在有些商城、园区、小区物业都会提供预付卡业务。充值之后可以在不同的商户消费，这就属于预付卡范畴。

## 五、收单

收单是一个古老的职业。

早期收单就是POS机刷卡，银联卡，visa卡。

现在给你贴个二维码，也叫收单。这个二维码的功效和POS机是一样的，是给商户提供收款的渠道。这就是收单。

![img](http://image.woshipm.com/wp-files/2019/11/VnLUVNns5s5kGigHWA65.jpeg)

现在流行智能POS，不仅可以刷卡还可以扫你的微信、支付宝 付款码，这也是收单。

你在超市，扫码枪B你的二维码，同样，也是收单。

**每个商户背后都会有一个公司给他提供POS机、收款码、扫码枪，这些企业就是收单机构。**

中国银行在这个场景就是收单的角色。

![img](http://image.woshipm.com/wp-files/2019/11/CK5c5iluwUumZurNjiha.jpg)

### 移动支付和互联网质支付

这是两个容易混淆的概念。因为很多支付公司两个资质都有，把服务是打包服务的。对于用户而言看不到区别，但是对于从业者来说，需要搞清楚。

可以通俗理解为，他们提供钱包服务。

比如连连支付，之前很多的P2P软件背后对接的都是连连支付的钱包服务。微信、支付宝也有钱包服务，只不过他们的钱包只能在自己的APP用。有些第三方支付公司的钱包服务是提供接口给其他公司使用的。本质是一样的，只不过定位和场景不一样。

我们常常说的《支付牌照》也这是这一块玩家需要获取的。

![img](http://image.woshipm.com/wp-files/2019/11/iOaNG28I1jvrpkUbSQ0n.jpg)

### 互联网支付

互联网支付是一种网上交易形式，主要表现形式为网银、第三方支付、移动支付作为互联网支付。

### 移动电话支付

利用手机，安装银行支付软件后，完成支付；需要依赖移动电话本身的硬件支持。又可以细分为远程支付和近场支付。近场支付就是在手机上或SIM卡上安装NFC芯片，采用接触或非接的方式，刷卡就能支付，远程支付要通过网络，手机必须可以上网；

比如支付宝，在线下场景客户主扫（固定码）和被扫（条码支付、扫码支付）就属于移动电话支付范畴。

![img](http://image.woshipm.com/wp-files/2019/11/cD3AReGU8ZUy6wuU645E.png)

而在电脑端通过客户输入密码或者扫支付码，就属于互联网支付范畴。

![img](http://image.woshipm.com/wp-files/2019/11/48aodTNn3dsvyuAhH2wX.png)

## 六、其他

我们有时接触的一些所谓的支付公司，并没有支付牌照，只是接了一些有牌子支付公司的接口，做场景化的接入方案，应该称之为支付系统集成商。

如果你要设计的支付系统是公司内部业务使用，那么这个系统精确的来讲应该是支付服务系统集成而已。

### 商户&特约商户

比如一个商户去微信或者支付宝直接申请收款码服务，那么我们称这个商户为微信的商户。如果这个商户通过收钱吧的聚合码收款，在这个关系中，收钱吧是作为微信和支付宝的服务商（代理商）的。商户就属于收钱吧这个渠道的特约商户。

很多银行和收单机构都会提供这种“一码支付”服务，在这个给商户提供收款码的交易角色中，他们都是收单机构的角色。

参考阅读：[《一码支付的原理与发展现状》](http://www.woshipm.com/pd/2788723.html)

## 总结

整个支付是一个生态，每个公司都是不同的物种。他们之间有合作有竞争，但是都有自己的主营业务。

很多公司内部做支付，其实就是找支付渠道、资金托管，做系统集成服务而已。持牌机构做支付的核心也是做账户体系，然后根据业务方需求做系统集成服务。

### #扩展阅读#

[《一码支付的原理与发展现状》](http://www.woshipm.com/pd/2788723.html)

[《支付系统架构设计：分账》](http://www.woshipm.com/pd/2756616.html)

[《支付系统设计：资金流、信息流、清算、结算》](http://www.woshipm.com/pd/2762835.html)

## 支付系统架构设计（中）：分账

> 平台型电商系统，当客户的购物车商品属于多个商家时，客户在下单统一支付支付后，需要平台对该笔支付金额进行分账处理。涉及多级商户层层分佣也是一种分账。

![img](http://image.woshipm.com/wp-files/2019/08/AEpU6mUwyNDbUu8muZjN.jpg)

## 综述

分账：本质是一种清结算能力。通俗解释为：交易资金再分配。

分账在有些场景下称为分佣、分润、抽成等。而这些本质上都是通过分账来实现的。下面我们通过一些案例来了解下什么是分账。

### 场景1：电商平台

电商平台作为上游供货（服务）商户和下游买方的中间平台，肯定会涉及撮合交易的销售分成（抽佣、分润）。再者，当购物车商品属于不同商户时，客户一笔组合支付。平台也需要分账给相应的商户。

如：京东购物、京东到家：属于B2B2C，收款方是“平台商户”，平台商户再分账给入驻商户。

![img](http://image.woshipm.com/wp-files/2019/08/HeIthaVe5MAu9SJnwCNX.png)

如：淘宝：属于B2C，收款方是商户，但是遇到跨商户下单时，需要分账给对应商户。

![img](http://image.woshipm.com/wp-files/2019/08/LnY8Ub3DZH9EuMDva7eN.png)

感兴趣的可以研究下美团、饿了么、滴滴、拼多多等主流平台的业务订单、支付流水、银行流水。这些单据信息就包含了每个企业的支付逻辑。

### 场景2：物业缴费

有些品牌的物业会提供专属APP、公众号等给业主缴纳物业费。因为水、电、气、网，都是有专门的公司收取，如果物业公司统一收取，在物业公司的财务上就会涉及代收、代付的。

### 场景3：收单机构服务商

微信支付、支付宝、POS收单机构的代理商都是参与特约商户的交易分润的。只不过这个分账的过程是在各支付机构内部完成。比如下图的某支付机构为激励服务商推广收单设备（刷脸支付），给服务商的分润介绍。

![img](http://image.woshipm.com/wp-files/2019/08/tUSDJpY5tYrXFeit76Qy.png)

其他诸如停车场、外卖、打车、学费、加油站、旅游平台、商家多门店管理背后都是需要分账能力支撑。除非是公司自己开发一个线上商城系统，自己卖自己货。否则均需要分账系统的支撑。**可以说，无分账，不电商。**

## 分账方案选型

- 平台财务分账（也可以借助系统自动化）
- 资金存管账户（实体户分账）
- 资金存管账户（虚拟户分账）
- 微信官方分账
- 银行服务商清分平台

以上几种是目前市场上最常见的方式。再次强调：

- 重点：分账的本质是对交易资金的二次结算。
- 业务流：用户-平台-商户
- 资金流：用户资金账户-分账平台-商户账户

![img](http://image.woshipm.com/wp-files/2019/08/Tg65AdURKs7sbNRgHAGh.png)

### ①平台财务分账

这种模式集团统一收，给在并表内各子公司分账是没有问题的。只要公司内部财务规范许可即可。可以通过集团财务和各一线公司财务确定好规则和周期，借助集团内部的资金系统即可完成。

这种容易混淆的是“百货模式”，“商场模式”。传统百货商场都是集中收银模式，一般都是用户在各柜台下单后，领取柜台发票去对应收银台缴费盖章。然后领取收款回执（或盖章后的一联）去柜台领取货物。百货模式是典型的由百货公司（平台）财务分账。百货模式就是典型的交易抽成。

商场模式主要是以租金、物业费等为主（背后的资产打包运营暂且不谈）。但是不排除有些商场和商户签署的入住合同中会有集中收银的方式，这种也需要商场（平台）财务分账。

### ②资金存管账户（实体户分账）

此种模式实现需要在银行开设资金存管账户实体户分账（银行一种资金托管模式）。这种模式的系统架构大致如下：

![img](http://image.woshipm.com/wp-files/2019/08/5NPThVeeWt8DY79CvYh3.png)

资金流如下：

![img](http://image.woshipm.com/wp-files/2019/08/AobGSrcPk4Gf2Mhot9Ps.png)

此种模式因为是企业开设实体户，所以银行一般会给企业计息（计息费用可以抵扣托管、清分费用）。但是在第五步平台结算时（可以是商户主动提现、或者自动程序发起）商户到的收款凭证付款方为平台名称。

所以在资金层面，商户有一笔平台的入金，平台有一笔对商户的出金。**平台所属公司的财务需要以代收、代付的科目进行记账。**

这种方式之前P2P公司使用比较多，目前P2P这种模式已经杜绝了。P2P公司赚取所有客户的未提现金额的利息，银行获取存款。

### ③资金存管账户（虚拟户分账）

此种模式实现需要在银行开设资金存管账户虚拟户分账。这种模式的系统设计架构和【②资金存管账户（实体户分账）】类似：也需要支付系统截取业务系统传输的分账信息，等渠道结算资金到银行后，调用银行相关接口实现分账。核心在于资金流的不同，以及所影响的财务上的区别。

资金流如下：

![img](http://image.woshipm.com/wp-files/2019/08/ncKVV2FcSbVtilZBnrcU.png)

核心区别在于 平台在银行的性质变了。实体户分账时，资金到平台在银行的托管户，资金属于平台。而虚拟户时，资金到银行的内部户（银行托管户），**资金属于银行。**平台虚拟户更像是一个信息的聚合作用。真实的资金银行会内部记账分到各个商户的银行虚拟户。

此种模式在资金层面，平台和商户没有产生资金往来。平台分润部分以及商户最终的结算款在各自的收款凭证中显示的**付款方为银行**（一般为签约的支行名称）。

此种模式不会对平台的账务有所影响，**不需要记录代收、代付的科目。**但是这种模式一般需要交纳托管费给银行，此种资金属于备付金，无利息。

- 不管是实体户分账，还是虚拟户分账，支付渠道（微信、支付宝）只认平台。与客户发生收付款的对象是平台，所以平台需要和商户在客户投诉、权益纠纷等出提前做好安排。
- 实体户分账、虚拟户分账需要平台去支付渠道（微信、支付宝）申请支付商户，结算卡信息填写银行开设的托管户账号。

### ④微信官方分账

微信在2018.10.31，对外开放了其分账功能。需要平台提前在微信支付注册成为服务商。然后再开通分账功能。详情在此不做介绍，感兴趣的可以[**点击图片（图片来源于微信支付官网）**](https://pay.weixin.qq.com/wiki/doc/api/allocation_sl.php?chapter=24_1&index=1)进入官网学习。

[![img](http://image.woshipm.com/wp-files/2019/08/JccNvBs8H7FPjAgWv65x.png)](https://pay.weixin.qq.com/wiki/doc/api/allocation_sl.php?chapter=24_1&index=1)

微信分账方案的好处是，支持直接分账给个人（传微信号）。银行分账需要提交个人相关实名认证资料审核后，开通银行虚拟户（类似钱包）实现。对于直接分账给个人的场景比较实用。但开通微信此功能的前提条件不低，具体可以去官网咨询。

### ⑤银行服务商清分平台

这种模式在微信分账功能出现之前，很多企业做电商平台几乎都会采用这种方式。这种方式的本质是微信、支付宝的银行服务商模式+银行自身的清分结算能力。

此种模式的资金流和资金存管账户（虚拟户分账）的类似。优点在于不需要企业自己维护异步的分账指令。支付指令和分账指令是一起提交给银行，无需对接微信和支付宝。

![img](http://image.woshipm.com/wp-files/2019/08/AjCZoosHvCEwDsHxoE6h.png)

可参考如下链接：

[微信支付银行服务商版](https://pay.weixin.qq.com/wiki/doc/api/bank.html)

[银行服务商申请](https://pay.weixin.qq.com/index.php/public/bare_applyment/login4bank)

目前工商银行、招商银行、建设银行、平安银行、兴业银行均有类似业务，名称不一。可以联系银行内部咨询，一般内部会包装为：电商分账、智能清分、支付托管、电商解决方案、园区支付方案等（银行内部这种服务需要拉通多部门协同，各个银行有区别）。

## 总结

在目前国家政策下，相关部门也对“大商户+二清”模式进行非常严格的查处。支付系统选择合适的分账方案至关重要。本文的目的在于分享几款常见的分账方案，有助于读者根据实际需求选型。后两种方案均由银行和微信实现分账逻辑，支付系统只需要保证接口逻辑调用顺序，做好对账即可。我在上两篇文章[《电商系统：对账设计》](http://www.woshipm.com/pd/2725585.html)、[《电商系统：记账设计之订单管理、流水管理](http://www.woshipm.com/pd/2737301.html)》中对账和记账的场景比较适合后两种模式。

前三种模式除第一种当业务量很小时可以人工处理，两种银行托管的分账方案都需要支付系统处理分账信息逻辑，做好本地记账和银行的对账。当然也可以选择一些支付SaaS解决方案，由第四方对接银行。

支付系统的合规性依赖于商业模式、资金流和信息流的处理。分账是三者集中交汇的地方。银联以及其他第三方支付公司都有类似分账方案，感兴趣的同学可以自己根据关键词搜索咨询。

下一篇将会介绍业务服务层的功能，以及运营管理台的划分。敬请期待。

## 支付系统设计：资金流、信息流、清算、结算

> 搞懂支付系统的核心之一就是搞清楚资金流与信息流。在支付系统设计，以及支付渠道、资金托管方案的选取上有重要作用。搞清楚资金流与信息流，也可以方便产品设计人员与财务人员沟通，提早在合规性方面有所准备。

![img](http://image.woshipm.com/wp-files/2019/08/42tYCR14h8WN24lGV8xX.jpg)

## 资金流&信息流综述

信息流、资金流是电商兴起后出现的比较高频的词汇，和物流合称为“三流”。

- **信息流：**指的是完整的交易流程信息，包含交易、支付和结算指令集合。
- **资金流：**交易资金的流动。资金包括储蓄卡余额、信用卡授信额度、合法第三方支付机构开设的钱包余额以及消费金融公司的授信额度。以上资金的流动称为资金流。
- **物流：**交易商品的流动。（实物流、服务流等）

在新零售、供应链金融等场景下也有对上述“三流”的各种解释。

## 古代的资金流&信息流

A有一笔银子给远方的B。为了便于携带和安全，A先去钱庄兑换成银票。然后把银票委托镖局运输。B在收到银票后，去相应的钱庄再兑换成银子。在这个过程中，就存在资金和信息的流动。

晚晴的时期山西的票号和江南的钱庄都是类似的业务。

![img](http://image.woshipm.com/wp-files/2019/08/yWej4NR9CpqKGiuX6TFX.png)

**资金流：A——钱庄——B**

**信息流：A——镖局——B**

钱庄的在整个流程的角色是**账户机构**的角色。它负责把真实的资金（银子）兑换成虚拟的传输介质（银票）。和现在的银行类似，现在金融行业的票据（支票等），其本质和银票类似。

银票不是法币，不属于资金范畴。其概念和纸币（人民币、美金）在法律意义上是不一样的东西。我们在银行的活期储蓄和信用额度（信用卡）有国家法定机构（银行）承认，属于资金范畴。

## POS收单的资金流&信息流

### 1. 本行收单

**POS机、商户结算卡、客户银行卡**为同一家银行，以建行为例：

![img](http://image.woshipm.com/wp-files/2019/08/EEjJAzxta9KdnHl3Q55P.png)

因为客户的卡和商户的POS是一家银行的，所以从业务上看效果是这样的：客户银行卡的余额减少了，商户的卡余额增加了。虽然钱都是在建行体系内，但是资金的所属关系发生了转移，而资金的所属权的转移就是资金流。

### 2. 跨行收单

每个箭头都表示一个交易信息流。黄色表示有资金随着流转。因为是跨行收单，所以资金从客户的招行卡转移到商户的建行卡，中间经过了银联的清算处理。

![img](http://image.woshipm.com/wp-files/2019/08/9bXH4lccd2oBWr0Fgq3J.png)

> 以上两个例子只是大概表示支付的核心流程。本段主要是区分资金流和信息流的概念。
>
> 资金在银行体系内流转以及跨行都是需要非常复杂的处理流程，继续往下看！

## 微信支付的资金流&信息流

在微信支付的体系中，商家接入微信有三种方式：[普通商户版、服务商版、银行服务商版（点击查看详情）。](https://pay.weixin.qq.com/wiki/doc/api/index.html)

三者的异同在于入网手续（开通支付）、支付（信息流+资金流）、结算（资金流）。

### 1. 普通商户版

![img](http://image.woshipm.com/wp-files/2019/08/89daFbI09RIAm6UmZyd3.png)

**入网：**商户自己去微信支付官网申请。

**支付：**商户需要开发系统对接微信支付的API，或申请线下收款码、刷脸收单设备等。

**结算：**微信直接结算给商户。

### 2. 服务商版

![img](http://image.woshipm.com/wp-files/2019/08/fy6zYYJyFCELu1agcYEd.png)

“代”表示服务商，有些语境下叫代理商、渠道商、都可以。

- **入网：**商户自己提交资料给服务商（代理商）。
- **支付：**服务商提供系统或收款码、刷脸收单设备等。
- **结算：**微信直接结算给商户。微信会在商户交易中分佣给服务商（根据商户和服务商合作的方式而定）。

### 3. 银行服务商版

![img](http://image.woshipm.com/wp-files/2019/08/0HfAlGxHLotpwqoGNj7i.png)

“渠”表示服务商下的渠道商，因为银行是微信支付的服务商，“渠道商”可称为“子服务商”，都是市场通俗说法。

- **入网：**商户自己提交资料给子服务商（渠道商）。
- **支付：**商户可自己开发系统对接渠道商接口，或使用渠道商（渠道商本身做平台）交易系统。
- **结算：**微信结算给银行。由银行做商户的结算和分账操作。可以参考我的另外一篇文章[《支付系统架构设计（中）：分账》](http://www.woshipm.com/pd/2756616.html)。

## 银行角度的资金流&信息流

在前面两个POS收单场景中，我们是在客户和商户角度看到的资金流和信息流的关系，下面我来以银行的角度来看下。

### 1. 本行交易

![img](http://image.woshipm.com/wp-files/2019/08/T9PciKd3ZlDh4Pqfxvrr.png)

### 2. 跨行交易

![img](http://image.woshipm.com/wp-files/2019/08/aOIylrbfakJQUGsFV2Z2.png)

## 结算、清算的概念

银联定义：

- 结算：银行完成支付机构或用户交易资金转移的过程。
- 清算：大额支付系统内，不同银行间的资金首付过程。

我们回到POS收单场景，在第一个行内交易场景的时候。最后商户的账户到账的这个动作我们称之为结算。但是在给商户结算之前，银行内部有个跨系统“资金划拨”，“资金汇划”的过程。这个过程都是在行内的交易完成的，其本质就是银行内部以账户为核心的账务操作。（改变资金所属权）这个内部账务的操作我们称之为“清分”。

所以有些场景下我们可以理解为：**清算=清分+结算。**

- **清算：**账务与资金同步。
- **清分：**不涉及资金流转，系统内部跨账户的账务操作。
- **结算：**资金所属权的转移。

银联定义的清算含义 指的就是在人行内部，银行与银行之间的资金所属权转移。人行是银行的银行，可以这么理解。个人和企业在普通银行开账户，每个银行也会在人行开设账户。

## 总结

**理解概念不能脱离实际场景，基于具体场景去理解概念是最有效的方式。**

虽然基于场景理解概念会造成对其含义把握局限性，但是这个随着场景越来越多，每个人综合分析后就会把握概念其本质含义。后续文章介绍网联和备付金概念时会大量应用这些。

本文我们通过银票、POS本行收单、POS跨行收单解释了资金流和信息流，又以资金流和信息流的角度解释了微信支付的三种模式。资金流和信息流的合规性是评断支付系统合规性评断的锚点，大家可以多找场景去揣摩其含义背后的本质。

笔者近几年误打误撞进入金融科技领域工作，最开始最痛苦的就是对概念的理解把握不足。为此笔者（笔者早期自学过经济学）开始恶补金融学相关专业，看了众多的书籍和文章，同时和业内的同学、朋友交流、请教，最后结合实践总结自己的体会。希望可以分享出来给刚入行的朋友们一个少走弯路的通道，同时也希望走过路过的专家、高手不吝赐教。

## To B支付如何合规？这里提供5种模式

![img](http://image.woshipm.com/wp-files/img/64.jpg)

> 由于政策监管，To B的支付需要保证合同流、发票流、现金流都一致才能合法合规，所以相比To C的产品，需要在财务上做更多的考虑。本文以三流一致为讨论的出发点，列举5种常见的支付模式，希望抛砖引玉，能给同行朋友一点帮助。



（文章中提到的案例基本上都是从公开渠道了解到的，如果凑巧有这些公司的朋友读到，又凑巧有冒犯之处，还请见谅和指正）

14年以前，互联网处在野蛮生长期，类金融业务的合规性未引起监管机构足够的关注。自从14、15年大量的P2P平台倒闭、跑路，与此同时支付宝、微信的资金体量越来越大，传统金融机构和社会舆论开始重视互联网业务的资金安全问题。

在15年，监管政策开始要求P2P平台将资金托管在银行、第三方支付、基金等机构；16年，明确将支付宝、微信等第三方支付定位为小额支付通道；同样在16年，大批无支付牌照的互联网公司因涉嫌“二清”被约谈（蘑菇街、二维火、有赞等平台都被央行约过）。为此，上规模又存在不合规操作的电商平台可谓人人自危，直接导致支付牌照水涨船高，均价从几千万涨至几亿、十几亿。

所谓的“二清”指的是非银行及第三方支付的机构从事支付业务。这种业务之所以不被央行允许，是因为机构可以随时套现甚至是卷款走人，从而给大量用户带来损失。

举例来说，像蘑菇街这样的平台以前可以引导用户将金额充值平台上的账户中（也就是蘑菇街的账户）。用户发生消费后，金额并不是实时进入商家的账户，而是记录在平台上。在商家申请提现时，由平台按照与商家的约定，扣减分润后才将商家应得的部分打款给商家。在这种模式下，资金停留在平台期间，平台只要愿意，可以任意对资金进行处理。比如，房地产火了，就把钱提出来放进房市里炒房；股市火了，也可以把钱丢到股市里炒股。一旦赚了，皆大欢喜；即使亏了，还可以继续吸引更多用户存钱进来，拆东墙补西墙也能支撑一阵子。

正因为如此，“二清”广泛存在于众多公司中，成了大家都心知肚明却不轻易放到台面上说的秘密。也因为有较大的风险，且风险面在扩大，央行才频频出手。一众互联网公司也调转船头，开始走合规的路线。以下本汪就以工作经历中见到的解决方案为例，来谈谈互联网ToB业务中对资金流的处理方法。

## **一、 线下大客户合同模式**

![img](http://image.woshipm.com/wp-files/2017/10/1-203.png)

这种模式由平台方直接面向客户提供服务，供应商仅作为平台方的合作伙伴存在，不直接与客户接触。或者是平台向客户出售货物，货物由供应商提供。

由平台方的大客户销售在线下与客户协商好并签订合同，在合同中约定什么时间付款、用什么方式付款、付多少钱、开什么发票、什么时候开票、发票怎么给乙方、谁交税点等相关事项。实际发生交易后“一手交钱一手交货”，只要合同流、资金流、发票流三项吻合（也就是金额、交易双方等信息对得上），在财务上就是合规的。

平台方完成以上的交易后，货物的归属就转移到平台，之后平台要怎么出售都可以，所以这种方式是最简单和常见的。

## **二、 居间服务和三方合同模式**

![img](http://image.woshipm.com/wp-files/2017/10/2-158.png)

这种方式涉及到平台和第三方供应商共同为客户提供服务的，常见于居间的情况。

互联网公司经常凭借自身的流量优势做一些空手套白狼的生意。举例来说，某公司是平台方，名气大流量大，想要吸引客户到网站或者app上购买某种服务，这些服务不必由这家公司提供，而是由其它供应商提供。交易结束后，平台方先抽取提成，然后将供应商应得的款项给对方。

这是链家租房采用的方式。租客、房东、链家签订三方协议，约定好租金、平台服务费、押金等，一纸合同将各方的权益都说清楚，也把资金流向说清楚。对于平台来说，服务费在交易现场就由顾客打入链家的账户中，金额与合同中一致，一般情况下顾客也不需要发票，所以合同、资金、发票是一致的，在财务处理上也没有问题。

这种模式因涉及的关系方有3个，较难以协调，所以适用于偏线下的互联网业务，如果是线上业务得使用第三种方式。

## **三、 互联网代收代付业务**

![img](http://image.woshipm.com/wp-files/2017/10/3-142.png)

前两年兴起的很多O2O公司都是使用这种方式。以滴滴为例，平台方在线下与B端用户（也就是快车司机、专车司机）签好合同或者协议，司机以合作商家的身份入驻平台。顾客在平台上下单坐车，完成交易后通过微信、支付宝等方式将车费打入滴滴平台，滴滴在司机app上开放提现入口，当B端司机发起提现时再把钱打入司机的银行卡中。乘客需要发票时，向滴滴申请，由滴滴为乘客开具发票。读者或许有疑问，在流程中钱不是也停留在第三方平台了吗？难道不存在二清的问题吗？为什么司机为顾客服务，开发票的却是滴滴呢？

以滴滴的规模，如果存在二清的问题，早就被约谈了。滴滴的模式之所以是合法的，是因为平台是采用了互联网代收代付的模式。也就是说滴滴完全可以解释，车费都给司机了，司机可以随时提现（顺便说一下最近易道闹得沸沸扬扬就是因为司机提不到钱）；而且在实际进行交易的时候，乘客的钱也可能是直接进入了滴滴为司机个人开的（银行）账户，只不过是走了滴滴的通道而已，而司机提现的时候才从此个人账户转账到了彼个人账户（司机自己开立的银行账户）中；更何况滴滴现在也有支付牌照，就更加有恃无恐了。

这个模式能走得通有几个前提，首先是滴滴与司机都签订了合同（至于司机和滴滴是什么关系，本汪不知道，很可能是对等的合作商关系）明确了双方的权利；其次是司机都是个体户，且每月的收入不超过3万，所以司机才可以不用为乘客开发票，而是由做代收代付的平台方来出具。读者大概都知道，快车和专车的发票是向滴滴申请的，而出租车发票得在下车时找出租车司机要。那是因为出租车公司不属于滴滴啊，出租车司机和滴滴之间也没有合同关系。

滴滴模式的优点是可以少交很多增值税（那是非常多啊！！！），当然营业税还是逃不了，不管有没有毛利都得交。滴滴需要从收入中扣掉司机工资、扣掉补贴等等的款额作为利润算增值税，特别是当年狂补贴的时候，你敢相信它有利润吗？！这种模式一端是个人用户，另一端虽然是B端，但是是个体户，所以能走通。如果两端都是公司或企业，这种模式也行不通，就得用第四种处理方式了。

## **四、 银行子账户管理模式**

![img](http://image.woshipm.com/wp-files/2017/10/4-106.png)

上文说过蘑菇街被约谈，在那之后平台也走上了合规的路线（不得已而为之啊，要是没人管，谁特么自找麻烦）。合规后的蘑菇街是通过第四方支付来搭建交易和支付流程的。何为第四方支付呢？第三方支付大家都知道，不就是支付宝、微信之类的么。第四方支付是个什么鬼？

就说中华民族是一个了不起的民族，但凡有利可图就有不怕死的往前冲，但凡有勇士挑战大众的神经，国家就会出面把他灭了。之所以会出现第四方支付大体也是这个逻辑（哈哈哈，也可能不是）。

设想一下，大家都是第三方支付对吧，要不合作一下？（奸笑）反正用户的钱存着也是存着，你缺钱的时候我借你点，我缺钱的时候你再借我一点，这样不是你好我好大家好么？（再奸笑）借来的钱再用来做点其它的金融业务，简直一个爽。这样，就绕过了央妈，那还得了？！所以央行是禁止第三方支付之间的合作的。What？！原来微信支付宝不能互转不是因为在干战啊？当然不是，你见过其它第三方支付之间能相互转账吗？那么第三方支付之间的钱要流转起来该咋整？还是得通过银行。

现在央行对第三方支付的定位已经明确了，就是日常生活中使用的小额资金进出通道，而不能行使银行职能。所以所有的第三方支付只能通过用户绑定的银行卡实现间接的资金流转。而三方支付的所有的资金流动也在央行、税务局等等机构的监管之下，一旦有个风吹草动，出现不正常情况，监管机构分分钟找上门。

再回来说第四方支付。所谓第四方支付为面向于有支付需求的用户提供解决多种方案的供应商，他们可以整合多种第三方支付或者银行渠道，打包给客户，从而使客户在接入支付时更便捷。也就是说第四方支付既能对接银行，也能对接第三方支付，将这些渠道包装好后卖给客户，收取服务费和手续费。

还是说蘑菇街。通过第四方支付的解决方案，蘑菇街在银行开立两类（或者只需要一类）账户：第一类是平台的子账户，第二类（可选）是供应商子账户。一旦发生交易，流程这么进行：

首先说顾客是通过与平台无关的方式（微信、支付宝、银行卡）支付的并且是实时划账的情况（一般只适用于C2B2B），那么付款后钱先进入蘑菇街在银行的账户中，在该账户中平台已经设置好分润的规则，所以钱进来后一部分（比如10%）留在平台账户，剩下的（90%）划入供应商在银行的公户中（只要合同约定好，私户也可以）。如果不采用实时划款给供应商的方式，也可以使用提现的方案，即把顾客支付的钱留在平台在银行开立的账户中，供应商申请提现时再把货款转账给供应商。

然后在说一下用户使用平台“钱包”或者“余额”账户支付的情况（适用于C2B2B和B2B2B）。需要在平台中开立三类账户，除了上述的两种之外，还需要为客户也开账户。如果客户是企业，则和普通的开对公户类似，需要提供三证、法人身份证等；如果客户是个人，则只需要提供一张个人的银行卡即可。交易分为两个步骤，首先是充值，用户通过其它支付方式将钱转入上述开立的银行账户中，同时平台方将金额记录下来并在“钱包”或者“余额中”展示给用户；然后在支付时，需要用户主动付款，将银行账户中的钱先打入平台在银行中的账户，平台账户按照设置好的分润规则截留服务费，然后把供应商应得款项打如供应商的银行账户中。

这种方式的优点是：1.所有的充值、支付都在银行账户中，资金受银行和国家部门的监管，因此完成了合规；2.因为是采用银行内部转账的方式，所以支付时的费率低；3、供应商可以开户也可以不开户，对于个体户来说比较方便。缺点也是有的：B类客户开户依旧比较麻烦，如果个人用户要使用“钱包”功能，那么和微信支付宝一样，需要先绑定一张卡。

对接第四方支付是相对比较高效的，一旦对接之后，各种常见的第三方支付方式（比如支付宝、微信、百度钱包、京东、分期乐等）都可以借助第四方一次搞定，省去分头对接的麻烦。当然，如果读者不怕麻烦也可以和第三方支付谈，谁用谁知道，哈哈哈。

## **五、 第三方支付账户管理模式**

 

![img](http://image.woshipm.com/wp-files/2017/10/5-94.png)

 

本汪对接的是一家不太出名的支付公司。简单地说，支付公司提供的方案和第四种比较像，也就是说三方支付在账户管理方面行使了一部分类似于银行的职能。

在三方支付中，同样开立三类子账户：平台方账户、客户的账户、供应商的账户，需要说的是客户既可以是C端客户，也可以是B端客户，从业务角度看的话，其区别在于开户的麻烦程度不同（其实都很麻烦…）。客户充值后，钱进入客户的账户，交易时，平台方发出指令，钱从客户账户划入供应商的账户中，同时会按照分润规则将利润转入平台账户内。在整个流程中，平台方是不能动客户账户和供应商账户的，所以就解决的二清的问题。同时，为了保证用户充值的金额能全部到账、供应商提现能实现T+0、做充返营销活动等需求，可以在三方支付内为平台开立多个特殊用途账户。

在第三方支付中开户和在银行中开户需要的资料是差不多的，所以对于平台方，要让客户和上游供应商都提供开户资料是一件相当痛苦的事情。如果想要省事，也只能是在与供应商的合同中约定好权责，然后允许供应商提供私人卡来收取平台方的打款。但是这也只适用于不太正规的供应商。如果供应商内部比较规范，本身就会规避这样的事情发生。毕竟，把公司的钱转给个人，就存在个人卷钱走人的可能。

以上就是本汪接触的5种情况，以后更加了解之后再慢慢补充和完善。

**一般来说，采用什么方式需要考虑这些方面：**

1. 是否能使业务合规；
2. B类用户、C类用户的充值、提现、转账每一类业务的手续费是多少，到账的时间分别需要多久；
3. B类用户和C类用户是否开户便捷。

**另外再补充一下：**

- 关于充值，用户充值是需要向支付渠道支付手续费的，如果想实现充多少钱在平台账户上就显示多少，平台需要垫钱；
- 关于提现，提现一般是工作日T+1到账，而且也是有手续费的，如果要实现T+0，需要和支付渠道谈实现方式；
- 关于转账，也有费用

哈哈哈，收费无处不在啊。

## 电商系统：记账设计之订单管理、流水管理

> 本文所描述的记账，非企业ERP等专业财务软件记账场景。适用于公司自研以及采购的类电商系统后台记账设计。在电商场景下，涉及订单管理、交易流水、资金流水等多种不同口径的管理需求。

![img](http://image.woshipm.com/wp-files/2019/08/TxfOUHIPB1BMBSGUjLf8.jpg)

## 平台型电商记账特色

常见平台型电商如淘宝、拼多多、美团，京东、亚马逊也有一部分业务为平台型。所谓平台型电商就是搭建一个电子商城，引商家入驻。平台主要起着撮合交易的角色。常见模式如下图：

![img](http://image.woshipm.com/wp-files/2019/08/Zn9OVnlnrdi8FHuRYqv8.png)

平台型电商的这种业务模式也决定了其必须要**适应不同商户角色的不同需求。**

- 运营关注**订单流水**（订单支付成功与否）
- 店主关注交易流水（收入多少，支出多少）
- 财务关注资金流水（实付金额、手续费等）

**三者概念模型关系如下：**

（三者都可以加上支付渠道属性）

![img](http://image.woshipm.com/wp-files/2019/08/AGleyRR6SdAcQ195OsYX.png)

## 订单流水

常见支付订单有如下几种状态：待支付、支付失败、支付成功、部分退款、已退款、已撤销。

- 待支付：下单成功，唤起支付后，尚未完成支付。
- 支付失败：密码错误或者余额不足引起的渠道扣款失败。
- 支付成功：扣款成功
- 部分退款：发起退款，但没有退全款。
- 已退款：退全款
- 已撤销：传统POS系统中，指的是交易撤销，退全款；线上交易，指使预支付失效。

### 订单状态流转关系

![img](http://image.woshipm.com/wp-files/2019/08/qVX6HFA5LMxQ0nRcy0r3.png)

**业务含义：**以客户与商户之间达成交易的状态为核心，表达交易是否完成。

**生成条件：**和业务订单发起支付同步生成。

### 案例

- A商户订单支付成功，无分账。
- B商户交易分账，分账接收方分别为C、D。
- E商户的订单已经退款。

![img](http://image.woshipm.com/wp-files/2019/08/vyhIJs3Cf2PIsWO8nuYC.png)

![img](http://image.woshipm.com/wp-files/2019/08/uJINoDHEa8XGXE6dIgYT.png)

## 交易流水

店铺的经营情况的主要指标。交易流水不关心卖了什么，只关注各个商户收了多少钱，退了多少款。交易流水不关注订单的状态和订单的交易时间，只关注交易的类型和时间。

交易流水类型为：

- ‘1’：支付
- ‘2’：退款

（不计算费率因素）

**业务含义：**商户经营情况。

**生成条件：**以订单结算商户为核心，参考支付订单、分账订单、退款订单、撤销订单为触发条件。

### 案例

根据上述“订单流水”的例子，可生成如下交易流水信息。

- B商户虽然有订单，但是因为其分账给C、D，所有其无交易流水。
- C、D商户参与B订单的分账，所有C、D商户各有一条交易流水。
- E商户的订单支付成功后，又退款成功，所以涉及两条交易流水。（如果是部分退款，就会关联多条退款流水）

![img](http://image.woshipm.com/wp-files/2019/08/02pzrDRj1w3GaBF9afOU.png)

## 资金流水

资金流水是我们财务意义上真正的“记账”。

资金流水要在交易流水的基础上考虑费率的因素。在每个结算周期结束时，根据资金流水来计算应结算金额。以目前支付行业相关规定，支付成功的订单在1年以内都可以操作退款。且渠道会退回手续费。我们以常见费率0.6% 为例，请看案例：

（注：应结算金额=收入-支出）

### 案例

- A商户加上费率因素，涉及两条资金流水；
- B商户无资金流水；
- C、D各涉及两条资金流水；
- E涉及4条，因为其订单在支付和退款两个状态切换时，各会涉及两条记录；

![img](http://image.woshipm.com/wp-files/2019/08/SXLFWxsFlPqKu1dpOasT.png)

资金流水信息一般要同步到企业财务系统。在退款时一定要记录手续费的收入。因为支付渠道在操作退款时，会用之前所收取的手续费抵扣掉今天所产生的手续费。

## 总结

做电商系统后台时，切不可把订单流水、交易流水、资金流水混为一谈。否则会陷入无止境的数据核对和口径问题中。最好的办法就是三者解耦和，根据事件触发去保证三者的关系。三者各司其责，各有独自的业务含义和统计意义。

订单流水、交易流水、资金流水 此为作者本人习惯叫法，切勿去扣订单、交易、流水等词汇标准含义。因为支付行业是发展很快，词汇含义也同步演化。大家可以根据各自系统特点叫不同的名称均可。

## 一码支付的原理与发展现状

> 扫码支付也称为“聚合收款二维码”、“聚合码”、“收款码”、“一码支付”等名称。本文将介绍其实现原理和未来发展方向。

![img](http://image.woshipm.com/wp-files/2019/08/dxRhydDxlOIdqXoSmD4V.jpg)

## 一、扫码支付概述

我们在一些便利店一定看过如下这种收款码。相比于商家直接把自己微信、支付宝的收款码打印出来，消费者的体验有很大的提升。

因为客户可以直接用习惯的微信或者支付宝等直接扫码，不用切换应用。而且还可以选择信用卡等支付方式。所以深受很多小微商家青睐。

![img](http://image.woshipm.com/wp-files/2019/08/2YDtFoIu6pwnzlu6jbSB.png)

客户被扫（条码支付、面对面付，超市场景）；

客户主扫（付款码，码已经包含金额等信息，PC网站、餐厅扫付款单场景），本次暂不讨论。

## 二、实现原理

二维码的本质是一个字符串。聚合码的本质就是一个链接地址，类似：

> “https://sdfwesdczd.gsuyd.com/dsfsdfwef”。

当客户用APP扫码后，网站后台就会判断客户的**扫码环境**。（微信、支付宝、QQ钱包、京东支付、云闪付等）。

判断扫码环境的原理就是根据打开链接浏览器的 HTTP header。任何浏览器打开http链接时，请求的header都会有User-Agent(UA、用户代理)信息。

UA是一个特殊字符串头，服务器依次可以识别出客户使用的操作系统及版本、CPU 类型、浏览器及版本、浏览器渲染引擎、浏览器语言、浏览器插件等很多信息。

感兴趣的同学可以搜索“支付宝 UA“、“微信 UA”、”Chrome UA“等。

以java为例：

![img](http://image.woshipm.com/wp-files/2019/08/M5971W0KnL6vzVcez265.png)

判断完成客户的扫码环境之后，页面会提示用户输入金额，然后点击支付（也可以在点击支付时再判断）。后面的支付流程就是走各支付渠道官方接口。

![img](http://image.woshipm.com/wp-files/2019/08/zosSPDPK1cWfoFnuIL90.png)

其中各渠道对应支付产品的名称不一样，一定要仔细看各支付产品的API介绍。

- 微信支付：JSAPI支付支付
- 支付宝：手机网站支付
- QQ钱包：公众号支付

其本质均为在APP内置浏览器中实现HTML5支付。

## 三、商业模式

### 1. SAAS 服务

这种模式需要商户自己去微信、支付宝等渠道申请开通支付产品，然后把参数配置在SAAS的商户管理台。由SAAS服务商生成商户二维码。商户下载打印后即可。（例：ping++）

微信和支付宝收取商户的交易手续费、SAAS服务商收取年费。

### 2. 代理商服务

这种模式商户直接把资料给到服务商（也可称为代理商），服务商直接提供二维码给到商家。服务商还会提供配套的立牌、收款音响等。（例：美团收单、收钱吧、拉卡拉）

这种方式的成本看商户的交易量。如果商户交易量大，作为服务商，在微信、支付宝会得到返佣奖励。如果商户交易量不大，服务商是通过通道费分润获取收益。

详细可以参考我的另外一篇文章[《支付系统架构设计（中）：分账》](http://www.woshipm.com/pd/2756616.html)有提到。

## 四、未来发展

固定码模式会遇到被替换的风险。所以现在有一些服务商提供“活码”服务。就是给客户的体验依然是一码支付，但是这个码会定时刷新。（需要电子显示屏的支持）

2019-08-22央行发布的《金融科技（FinTech） 发展规划（2019—2021年）》中对扫码支付也有了清晰的规划。（“（十四）加大科技赋能支付服务力度”小节）

推动条码支付互联互通，研究制定条码支付互联互通技术标准，统一条码支付编码规则、构建条码支付互联互通技术体系，打通条码支付服务壁垒，实现不同APP和商户条码标识互认互扫。

目前第三方支付接入网联、备付金上交，已经扫清了真正的“一码支付”的障碍。

目前支付APP非常多，招行掌上生活、银联云闪付、壹钱包、微信支付、支付宝、QQ钱包等等，只因微信、支付宝占得先机使得其他支付APP只能在特性的商圈和场景内拓展业务。

当银联云闪付有个支付立减活动时，是商户（场景方、受理方、收款方）不支持云闪付收款，或者商户支持，客户却没有安装云闪付。这笔活动其实是无效的，无法落地。

目前市场中小支付机构饱受拓客难、场景少的苦恼。《规划》的时间节点是2021，所以在2022年之前，商户一个码，客户随便扫就可能成为现实。（不排除有新的技术会替代掉扫码支付）

整个支付行业的发展趋势就是正本清源，回归支付本质。随着AI、5G、区块链等技术发展和应用，未来支付方式一定会产生新的变化。

**从便捷性、安全性多方便入手，永恒的方向就是有效降低交易的支付成本，助力商业服务发展。**

## 对产品经理来说，懂中台架构很重要！

> 很多地方都在说中台，很多公司都在建中台。那么，究竟需不需要中台，怎么建中台？产品经理首先要想清楚。

![img](http://image.woshipm.com/wp-files/2019/10/Ctk91WZ8ClQWuMuuSE8s.jpg)

中台其本质是企业IT架构的一种形式，和传统IT架构的核心区别在于其更加贴合业务架构，是企业IT战略适应业务战略的高阶抽象，业内称之为中台战略。

本文目的不是探讨中台的起源和概念，而是从中台本质、中台目的、中台落地三个角度来谈谈中台。

相信通过此文，可以让大家对中台的理解有一个新的广度和深度。

> 我们讨论问题，应当从实际出发，而不是从定义出发。——毛泽东

## 一、中台的本质：回归企业架构

### 1. 企业架构回顾

在文章[《企业架构》、](http://www.woshipm.com/zhichang/2879933.html)[《业务架构》](http://www.woshipm.com/zhichang/2889373.html)中，介绍过企业架构的概念。

简单回顾两点：

1. 企业架构分：业务架构、IT架构；
2. IT架构分：数据（信息）架构、应用架构、技术架构。

![img](http://image.woshipm.com/wp-files/2019/10/i5gkf9noaIpoXSKBWzD3.png)

企业架构的核心作用，就是填补了企业业务规划和具体IT建设之间的差距，最终达到企业战略、业务、IT建设的协调统一。最终目的都是支撑企业目标的实现——中台的本质就是回归企业架构。

很多关于中台的书和文章在追溯中台概念时，近则引用美军海豹突击队的架构，远则引用中国古代的三省六部制。

所以，我们可以认为“中台”本身是一个业务组织架构的概念。阿里的中台战略，本身也是因为业务组织架构的中台化调整，促使IT架构升级转型。

所以，中台概念的核心在于业务架构，业务是其灵魂。

### 2. 中台是IT架构的一种选择

为了支撑业务架构中台化这个战略目标，“中台”是IT架构的一种选择方式。

以阿里的中台为例，其强调**“共享服务体系”**——这是中台的基础。其初心很简单，即为：**服务重用，快速响应和创新。**

基于阿里自身的业务发展，其电商的基因使得关于订单、库存、支付等核心业务流程都是相通的。所以，根据这些不同业务部门而又相同的业务诉求，才发展出符合阿里的中台形态。

![img](http://image.woshipm.com/wp-files/2019/10/vp1BJidZ81uilaEZI9Ei.png)

量变是过程，质变是结果。

阿里中台的架构，是质变的产物。

我们如果想要设计符合自己公司业务的中台，更要学习阿里IT架构演进的过程，这个过程是量变过程。模仿参考的价值，在于根据对过程梳理，总结规律，再根据规律结合自身企业的需求来实践自己的量变过程。

即使“中台”上线后，阿里也强调“服务需要业务的不断滋养”。

因为市场在变、业务在变，要求IT服务必须也跟着变。

——这才是真正的企业架构所要达到的目的。

### 本节总结

- 中台的本质是回归企业架构，中台是企业IT架构为了适应业务架构的一种有效的解决方案；
- 阿里中台是基于自身业务架构发展需求，逐步摸索迭代，是量变到质变的产物；
- 任何企业做中台，需要从企业架构入手，梳理出业务架构，根据核心业务流程来规划自己的“服务共享体系”。

## 二、中台的目的：调和不可能三角

### 1. 中台需要取舍：主要矛盾、次要矛盾

“不可能三角”是金融金域的一个概念。

类似于项目管理中的时间、质量、成本，并非三个不能同时成立，而是说必须有所取舍，最终达到均衡。

如下图，各边必须有所扭曲才能物理存在。

![img](http://image.woshipm.com/wp-files/2019/10/QJ8zC0clJ65VNAomxguD.png)

在IT系统架构中也存在不可能三角，Consistency（一致性），Availability（可用性）和Partition Tolerance（分区容错性）。

通俗解释如下：

- 一致性：数据一致、信息一致；
- 可用性：所有请求的在限定时间内有返回；
- 分区容错性：某个分区有故障，依然保证其他服务正常使用。

![img](http://image.woshipm.com/wp-files/2019/10/CYJ3A6Ww8NzMaB0uyXqa.png)

上述就是2000年由Eric Brewer的提出的CAP定律，初始目的是针对分布式计算机系统的。但是，我们从企业架构层面看IT架构，其本质逻辑是一致的，就是由个体组织成整体，给外部提供统一的服务。

IT架构要兼顾一致性、可用性、容错性的需求，如何实现最优配置是一个关键点。

我们回到不可能三角理论的初始场景-金融场景。在金融系统中的不可能三角是：资本的自由流动、货币完全独立、汇率稳定。

易纲在中国提出了X+Y+M=2理论来指导中国的金融政策。

我们把该思想带入IT架构中可以如下假设：

- X=1表示数据必须完全一致性，x=0表示完全不在乎数据一致性；
- Y=1表示系统必须100%可用，Y=0表示不在乎系统是否可用；
- M=1表示系统必须具有分区容错性，M=0表示不在乎分区容错性。

如果我们按照上述指标给我们的系统打分，极值的X+Y+M=0，X+Y+M=3不可能成立。，而中台的目的就是在于找到X+Y+M=2的一个解。

比如，我们以电商系统的购物车、支付、登录三个场景为例。

![img](http://image.woshipm.com/wp-files/2019/10/e1Jm9yjz6EFB3DgxBU8B.png)

（上述评分仅供参考，解释概念之用）

针对各种不同场景对于CAP取舍，按照辩证法的来说就是找到主要矛盾和次要矛盾。

阿里通过中台划分：业务中台、数据中台、技术中台。其中业务中台又分为：账户、会员、商品、交易、订单、支付等。

不同的业务中台都是找到该场景下的CAP最优组合，然后选择不同的技术中台服务来实现。

而数据中台和业务中台的本质区别在于，业务中台产生数据，数据中台加工分析数据。

### 2. 中台需要优化资源配置

经济学有个研究的方向就是资源配置。

因为资源总是表现出相对的稀缺性，从而要求人们对有限的、相对稀缺的资源进行合理配置，以便用最少的资源耗费，生产出最适用的商品和服务，获取最佳的效益。

所以，人类社会会有各种规则、制度、结构，这些和IT领域是一样的。因为IT资源也是相对有限的、稀缺的，怎么用最小的成本，实现最大的效益是IT架构要解决的问题之一。

笔者几年前就遇到一个情况，公司的一个项目使用的是阿里云的RDS for MySQL。

因为云资源那时刚刚在公司推广，所以预算没有算在项目组内部，导致有个报表的的sql写了N多个join，每次执行变慢都是申请提高配置，后来配置已经到顶了，暴雷了。

IT资源就是有限的和稀缺的，这个不仅仅是指性能，也包括公司投入的资金和精力。所以，只能通过梳理报表取数逻辑，优化数据物理结构和查询逻辑来解决。优化后，MySQL配置砍了2/3 依然反应很快。

其实，中台的价值和上面例子殊途同归——中台就是用有限的资源，通过架构合理的设计，来产生最大的效益。

### 本节总结

- 中台需要的是均衡，而不是极致。其需要根据具体场景在一致性、可用性、容错性实现取舍；
- 中台需要降本提效。中台目的在于优化资源配置，实现IT架构效益最大化。

## 三、中台的落地：侵入性和融合性

### 1. 中台落地的问题

经常看到一句话：中台是个一把手项目。

这句话的本质核心是：一把手更具有对业务架构调整权力。

但是，现在很多企业实施中台容易出现下面几个问题：

- 照搬别的企业中台架构和设计方案；
- 中台作为一个单纯的IT项目实施，强制让其他系统接入；
- 后期规划模糊，项目进入运营阶段，要死不活。

这种照搬的问题，从古至今各个领域数不胜数。

几年前有个很火的词可以形容这个情况，就是“山寨”。照搬说简单点就是抄、借鉴，说深入一点就是理论和实践的结合。

肯定不存在一套可以支撑所有企业需求的方案，因为每个企业的商业模式不同，业务架构也不同。IT架构是支撑业务架构的，肯定是不同的。

比如，阿里的要做统一登录，但是腾讯却硬把QQ和微信登录拆开；阿里需要交易中心，百度肯定不需要交易中心。

这些都是企业业务架构决定的，回到中台的本质，其实业务架构中台化在IT架构的提现。

中台作为一个单纯的IT项目实施，最后上线后推广效果一般来说都是差强人意的。因为中台项目组的成员一心一意都是中台思维，但是对于其他项目（产品）组的人来说，他们需要的可能就是一个简单的服务共享。

当中台的设计对其他现有系统侵入性太强时，不同项目组成员的项目目标是不一样的。中台想着接入，而其他产品组是求稳求快。

一个中心是忠，两个中心是患——不同目标（KPI、OKR）就是不同的中心，最后肯定是差强人意。

中台是一个和战略比较接近的概念，当做一个项目做，在遇到前面两个问题后，肯定会进入内部的迷茫和踌躇。

因为中台需要顶层设计，需要从上到下的一种共识。它不仅要关注企业的各种业务场景，而且还要关注场景背后的本质，场景是快变量，但背后商业本质是慢变量。

中台就是要抓住慢变量来支撑快变量，就像掌握加速度的这个概念来预测未来速度一样。

### 2. 公司是否真的需要中台

什么样的企业适合做中台？

这个问题反过来就是：公司IT战略下一步怎么走？

很多事情我们总是做不对，后来才发现，其实我们根本就不需要做这个事。这就是南辕北辙、背道而驰。

先问是不是，再问为什么。

做中台也是这样，先回答我们是不是需要中台，再回答我们怎样做中台。

什么时候需要中台，我觉得要回到企业本身商业模式的本质，以及中台的本质。

根据各项比对来看，企业是否需要中台，个人总结中台本质主要是以下三块：

1. 服务共享，使得专业部门专注于领域本身；
2. 资源配置优化，解决烟囱式重复建设，降本；
3. 快速支撑业务，抓住慢变量，提前准备，当业务的快变量来临时可以快速支撑。

所以企业做中台时，也要考虑是否有以上三点诉求，对应的公司业务就是：

1. 是否需要强大的服务共享中心；
2. 目前有哪些项目是重复建设；
3. 公司的业务是否面临市场快速变化的冲击，需要快速调整。

如果用上文中X+Y+M=2的思维方式，也可以把上述三点分别打分。求和后如果结果等于0，那肯定是完全不需要中台；如果是3，那表示不做中台就会死，这个值可以由公司以及顾问评审确定。

### 3. 中台落地解决之道

在解决了企业要不要做的问题后，进入了怎么落地的问题。

根据个人经验和与业内高手交流，我把步骤分为如下：

1. 梳理业务架构，找出相同痛点——做出来；
2. 组织中台核心团队，从相关系统或业务单元抽调——用起来；
3. 根据公司业务战略，制定中台迭代计划——持续用。

从业务、组织入手，看需要什么样的共享中心，这是第一步。

同时，也要调研企业IT项目重复建设的情况，从业务、技术两方面入手。

比如滴滴打车，他有一个出行中台，根据快车、拼车、优享、出租车等不同场景的需求，他们抽象出乘客、司机、计费、订单、接驾送架等共享中心。滴滴给客户体验可能是一个APP打车服务而已，但是其不同的叫车服务，背后都是独立运营团队，但是打车服务的共性也是很明显的。

团队成员的组成非常重要，因为做中台不仅需要了解中台的概念，更要对现有系统熟悉，不然最后肯定是鸡同鸭讲。

因为就像有人质问的，我一个表加一个API解决的事情，为什么要调用你那么多的服务才能搞定。所以，中台团队里一定要有一些现有产品团队的人，并且是那些对现有产品深入了解和思考的人。

前面两个是解决做出来，用起来的问题。但是，中台是深入贴合企业业务架构变动的，所以“持续用”是中台必须面对的问题。

有些工具性项目，可能就是几个月或者几年的生命周期，但是中台是要和企业共同发展的。

就像阿里说的，需要业务的滋养，然后反过来再促进业务的成长。

对复杂度的控制是设计工作的本质。

系统的目的是实现特定功能来解决问题，而架构的目的是给系统提供一个蓝图，中台架构就是如此。

中台系统持久性的生命力，来源其架构设计的前瞻性，而前瞻性的核心就是找到所服务的业务架构中的慢变量。比如公司的营销策略是快变量，但是其库存是慢变量。

而一切企业业务架构的核心慢变量，就是公司的业务战略。业务战略，也是基于企业对市场趋势的预测和公司现有情况做的目标集合。

下图为作者之前做完中台项目后的第一时间体会总结，功能大家参考.

![img](http://image.woshipm.com/wp-files/2019/10/yRZuUeTfX235UKgac3sH.png)

## 本文总结

- 中台不是万能的，不是包治百病；它只是根据企业架构的中IT架构的一种选择，其灵魂是业务架构。
- 中台尤其自己的理论基础，成功的中台项目是量变到质变的产物，非一日之功。
- 中台不追求极致，它追求合理、合适，在CAP中找到一个平衡。
- 中台落地，一定要结合企业自身业务架构和需求为基础。

### #相关阅读#

[《对产品经理来说，懂业务架构很重要！》](http://www.woshipm.com/zhichang/2889373.html)

[《对产品经理来说，懂业务很重要！》](http://www.woshipm.com/zhichang/2812804.html)

[《对产品经理来说，懂企业架构很重要！》](http://www.woshipm.com/zhichang/2879933.html)

[《对产品经理来说，计划管理很重要！》](http://www.woshipm.com/zhichang/2794350.html)

聚合支付从广义上讲，是指聚合了主流的微信、支付宝、百度钱包，银联等支付方式为一体，提供一个聚合类型的二维码给商户进行收款，具有便捷、高效的特性。聚合支付平台不涉及资金的所有权，不进行清算，只做技术上的渠道整合，且无需支付牌照。

本分析以聚合支付行业为重点，分析内容包括**行业规模、行业新拓展点、政策对聚合支付领域影响等**进行逐一论述。分析定义与分析方法如下：

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/GnzeXiAQM2j6tV8RBhvI.jpg)

## 一、聚合支付行业发展背景

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/LYhtQ2ZynRHavtJsGHs8.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/Nrt29g8xjCQtQE9AS8EY.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/wheKCnY5fy8ZsqdaapGW.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/WrvpNbcLtoW5d6H315b4.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/X1f6pdnEYsFEL5OUpnmD.jpg)

## 二、聚合支付行业发展现状

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/gPRLVC9mcbrG8I3Tdl3D.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/1lNuDV6aqRgFO1SWfM9M.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/ptXP4eLFW10g8WaOZFEw.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/NfInnRBqtswjhI3UAdiG.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/ZQ1etfsERkOfw7Qzznou.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/BcV5mOiV1bbHi85ctsO2.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/bVi3K7nGVWFJQrk2XIsL.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/vyvNCwthZuEHYCZhChjg.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/BCTlBdHbxNq8V1Tke3QC.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/hUwLWnFNawseRpS7cU3J.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/vnFMdxnuJyR8VKMq9osU.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/n3AYrv73k54GT802Saim.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/dcvFl9Bg2tysK2VhpQyz.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/4XW7YWnvnGREwTEz1G2i.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/yTfV2bZ4m8LMcGu03qo1.jpg)

## 三、聚合支付行业典型企业案例

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/6qYAu0LSObEFEvfJn5PW.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/oD3QomFtvFnCFChx8vzo.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/6i1UVvVxefW3wtJTF0MR.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/HHh1sY0x1idgGMkaUF4D.jpg)

## 四、聚合支付行业发展趋势

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/O6FGVVP3hHZtRue9Epqy.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/J21DnzwQZxs39ddDP5Rp.jpg)

![2019中国聚合支付市场专题分析](http://image.woshipm.com/wp-files/2019/09/bBLDn7wminOhCDUtvFws.jpg)

聚合支付业务平台面向商户使用的核心功能包括商户进件入驻第三方支付或银行渠道、对账功能。

## 商户进件

商户要使用聚合支付，首先需要将入驻支付渠道所需的进件资料（进件资料需要仔细阅读支付渠道给的对接接口里需要提供的字段信息，细节方面有时需要和对接公司人员详细沟通）上传到网站，然后网站会将资料传给支付渠道，完成进件入驻流程；

进件的主要目的是在具有支付牌照的支付渠道那里创建一个账户，用来收款分账。

当然，聚合支付平台也需要创建一个商户，与第三方支付或银行渠道相对接。（商户进件填写资料申请后，需要等待支付渠道审核通过之后，才能使用聚合支付服务。）

## 对账功能

包括两大功能：查看交易记录和分账记录。

### 1. 交易记录

商户能在网站上查看每天的交易明细和交易汇总。

- **交易明细**：每天的所有交易流水订单记录，每一笔交易无论是付款、退款都要记录，要记录交易单号、交易时间、交易金额、收款账号、订单状态、支付方式（支付宝/微信等）等信息。
- **交易汇总**：将一天的所有交易汇总记录，需要记录包括统计日期、总交易金额、总交易笔数等信息，商户可以按照日期范围查看每天的交易汇总。（退款的金额不算在汇总金额里）

### 2. 分账记录

用户交易付款会先到商户在第三方支付或银行的账户上，一般第二天会统一对前一天的交易进行分账清算，先将到账金额从冻结金额变为商户账户的可用余额，然后再讲可用余额提现，将交易金额打到商户的银行卡上，此时才能算实际到账。

注意，这里面会有分账退款这种额外分账订单处理操作，跟交易退款比较类似。

分账明细、汇总和交易明细、汇总比较类似了。

- **分账明细**：每一笔的分账订单记录，包括分账时间、内部订单号、外部订单号、支付平台订单号、订单金额、分账金额、分账状态等信息，无论正在分账中、分账成功还是分账失败的分账订单都要展示出来。
- **分账汇总**：将每一天的分账信息汇总展示，包括交易日期、打款时间、分账打款金额、银行账户、银行账户名称、付款状态、付款备注等信息。